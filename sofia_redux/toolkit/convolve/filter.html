<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Convolution Filters &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    
    <script src="../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <link rel="icon" href="../../../_static/redux.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Fitting (sofia_redux.toolkit.fitting)" href="../fitting/index.html" />
    <link rel="prev" title="Convolution" href="kernel.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="../fitting/index.html" title="Fitting (sofia_redux.toolkit.fitting)">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="kernel.html" title="Convolution">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../../../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../../index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../index.html" >sofia_redux.toolkit: Shared Utilities for SOFIA Pipelines</a> &#187;</li>
      <li><a href="index.html" accesskey="U">Convolution  (<code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.toolkit.convolve</span></code>)</a> &#187;</li>
      
      <li>Convolution Filters</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="convolution-filters">
<h1>Convolution Filters<a class="headerlink" href="#convolution-filters" title="Permalink to this heading">¶</a></h1>
<p>The <a class="reference internal" href="../index.html#module-sofia_redux.toolkit.convolve.filter" title="sofia_redux.toolkit.convolve.filter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.toolkit.convolve.filter</span></code></a> module currently contains Sobel and
Savitzky-Golay filters.  These are 1-dimensional filters that are applied
in serial if an operation over multiple dimensions is required.</p>
<section id="edge-effects">
<h2>Edge Effects<a class="headerlink" href="#edge-effects" title="Permalink to this heading">¶</a></h2>
<p>Convolution at the edges of data arrays are handled according to the following
rules, and may be passed into either <a class="reference internal" href="../../../api/sofia_redux.toolkit.convolve.filter.sobel.html#sofia_redux.toolkit.convolve.filter.sobel" title="sofia_redux.toolkit.convolve.filter.sobel"><code class="xref py py-func docutils literal notranslate"><span class="pre">sobel()</span></code></a> or <a class="reference internal" href="../../../api/sofia_redux.toolkit.convolve.filter.savgol.html#sofia_redux.toolkit.convolve.filter.savgol" title="sofia_redux.toolkit.convolve.filter.savgol"><code class="xref py py-func docutils literal notranslate"><span class="pre">savgol()</span></code></a> using the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">mode</span></code> keyword argument as defined by <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/signal.html#module-scipy.signal" title="(in SciPy v1.11.1)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.signal</span></code></a>:</p>
<blockquote>
<div><dl class="simple">
<dt>‘mirror’:</dt><dd><p>Repeats the values at the edges in reverse order.  The value
closest to the edge is not included.</p>
</dd>
<dt>‘nearest’:</dt><dd><p>The extension contains the nearest input value.</p>
</dd>
<dt>‘constant’:</dt><dd><p>The extension contains the value given by the <code class="xref py py-obj docutils literal notranslate"><span class="pre">cval</span></code> argument.</p>
</dd>
<dt>‘wrap’:</dt><dd><p>The extension contains the values from the other end of the array.</p>
</dd>
</dl>
</div></blockquote>
<p>For example, if the input is [1, 2, 3, 4, 5, 6, 7, 8], and <code class="xref py py-obj docutils literal notranslate"><span class="pre">window_length</span></code> is
7, the following shows the extended data for the various <code class="xref py py-obj docutils literal notranslate"><span class="pre">mode</span></code> options
(assuming <code class="xref py py-obj docutils literal notranslate"><span class="pre">cval</span></code> is 0):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mode       |   Ext   |         Input          |   Ext
-----------+---------+------------------------+---------
&#39;mirror&#39;   | 4  3  2 | 1  2  3  4  5  6  7  8 | 7  6  5
&#39;nearest&#39;  | 1  1  1 | 1  2  3  4  5  6  7  8 | 8  8  8 (not available for savgol)
&#39;constant&#39; | 0  0  0 | 1  2  3  4  5  6  7  8 | 0  0  0
&#39;wrap&#39;     | 6  7  8 | 1  2  3  4  5  6  7  8 | 1  2  3
&#39;reflect&#39;  | 3  2  1 | 1  2  3  4  5  6  7  8 | 8  7  6 (not available for savgol)
&#39;interp&#39;   | 1  1  1 | 1  2  3  4  5  6  7  8 | 8  8  8 (not available for sobel)
</pre></div>
</div>
<p>The default mode for <a class="reference internal" href="../../../api/sofia_redux.toolkit.convolve.filter.savgol.html#sofia_redux.toolkit.convolve.filter.savgol" title="sofia_redux.toolkit.convolve.filter.savgol"><code class="xref py py-func docutils literal notranslate"><span class="pre">savgol()</span></code></a> is ‘nearest’, and the default mode for
<a class="reference internal" href="../../../api/sofia_redux.toolkit.convolve.filter.sobel.html#sofia_redux.toolkit.convolve.filter.sobel" title="sofia_redux.toolkit.convolve.filter.sobel"><code class="xref py py-func docutils literal notranslate"><span class="pre">sobel()</span></code></a> is ‘reflect’.</p>
</section>
<section id="sobel-feldman-filtering">
<h2>Sobel-Feldman Filtering<a class="headerlink" href="#sobel-feldman-filtering" title="Permalink to this heading">¶</a></h2>
<p>The Sobel-Feldman kernel is used for edge enhancement by returning an
approximation to the gradient over each dimension and returning the gradient
magnitude as</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[G = \|g\|_{2} = \sqrt{\sum_{i=1}^{N}{g_{i}^{2}}}\]</div>
</div></blockquote>
<p>However, <a class="reference internal" href="../../../api/sofia_redux.toolkit.convolve.filter.sobel.html#sofia_redux.toolkit.convolve.filter.sobel" title="sofia_redux.toolkit.convolve.filter.sobel"><code class="xref py py-func docutils literal notranslate"><span class="pre">sobel()</span></code></a> was designed to replicate the IDL implementation of the
Sobel-Feldman filter in the
<a class="reference external" href="https://www.harrisgeospatial.com/docs/SOBEL.html">sobel</a> function, which
only operates on 2-dimensional data, and also defines the gradient magnitude
as:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[G = \|g\|_{1} = | g_{x} | + | g_{y} |\]</div>
</div></blockquote>
<p>I.e., the general implementation uses the Euclidean norm, while IDL uses the
Manhattan norm.  Therefore, <a class="reference internal" href="../../../api/sofia_redux.toolkit.convolve.filter.sobel.html#sofia_redux.toolkit.convolve.filter.sobel" title="sofia_redux.toolkit.convolve.filter.sobel"><code class="xref py py-func docutils literal notranslate"><span class="pre">sobel()</span></code></a> allows for a p-norm implementation
with a default of <span class="math notranslate nohighlight">\(p=1\)</span>.  The p-norm returns a value such that</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[G = \| g \|_{p} = \left(\sum_{i=1}^{N}{| g_i |^{p}}\right)^\frac{1}{p}\]</div>
</div></blockquote>
<p>An estimate of the gradient <span class="math notranslate nohighlight">\(g_i\)</span> for dimension <span class="math notranslate nohighlight">\(i\)</span> is given by
applying a kernel that is the result of two separable functions.  For the
Sobel-Feldman filter these are:</p>
<blockquote>
<div><ul class="simple">
<li><p>Derivative direction: <span class="math notranslate nohighlight">\(h(-1)=-1, h(0)=0, h(1)=1\)</span></p></li>
<li><p>Perpendicular to derivative direction: <span class="math notranslate nohighlight">\(h^{\prime}(-1)=1, h^{\prime}(0)=2, h^{\prime}(1)=1\)</span></p></li>
</ul>
</div></blockquote>
<p>For example, in 2-dimensions:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\begin{eqnarray}
g_{x} &amp;= &amp; \begin{bmatrix}
        -1 &amp; 0 &amp; +1  \\
        -2 &amp; 0 &amp; +2 \\
        -1 &amp; 0 &amp; +1
        \end{bmatrix} \circledast d \\
g_{y} &amp;= &amp; \begin{bmatrix}
        -1 &amp; -2 &amp; -1  \\
        0 &amp; 0 &amp; 0 \\
        +1 &amp; +2 &amp; +1
        \end{bmatrix} \circledast d
\end{eqnarray}</div></div></blockquote>
<p>The filter used can be defined using the <code class="xref py py-obj docutils literal notranslate"><span class="pre">kderiv</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">kperp</span></code> keyword argument.
By default, these are set to <code class="xref py py-obj docutils literal notranslate"><span class="pre">kderiv=(-1,</span> <span class="pre">0,</span> <span class="pre">1)</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">kperp=(1,</span> <span class="pre">2,</span> <span class="pre">1)</span></code> in
order to produce a Sobel-Feldman filter.  However, there is no reason that
different filter values or even different sizes cannot be provided.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">imageio</span>
<span class="kn">from</span> <span class="nn">sofia_redux.toolkit.convolve.filter</span> <span class="kn">import</span> <span class="n">sobel</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;imageio:page.png&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Image&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sobel</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray_r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Sobel-Feldman filter p-norm=1&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sobel</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">pnorm</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray_r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Sobel-Feldman filter p-norm=2&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sobel</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">pnorm</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">kperp</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray_r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Scharr filter p-norm=2&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="../../../_downloads/24120e03c0bac2183d1eac607904fc68/filter-1.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/acc37afca66d4a9a195dc17a6f5fcf39/filter-1.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/fa8858154578ce3edaa9c84c1b0e902b/filter-1.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/77ee3e5f2df0e7131990c1738bd3a687/filter-1.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="../../../_images/filter-1.png" class="plot-directive" src="../../../_images/filter-1.png" />
</figure>
</section>
<section id="savitzky-golay-filter">
<h2>Savitzky-Golay Filter<a class="headerlink" href="#savitzky-golay-filter" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference internal" href="../../../api/sofia_redux.toolkit.convolve.filter.savgol.html#sofia_redux.toolkit.convolve.filter.savgol" title="sofia_redux.toolkit.convolve.filter.savgol"><code class="xref py py-func docutils literal notranslate"><span class="pre">savgol()</span></code></a> function is used to create the Savitzky-Golay filter and
apply filtering over N-dimensions.  Convolution with the Savitzky-Golay filter
essentially fits a polynomial of a given order using linear least squares so
long as data points are equally spaced.</p>
<p>The user must pass in a <code class="xref py py-obj docutils literal notranslate"><span class="pre">window</span></code> argument specifying the width of the filtering
window over each dimension (may be a single value for each dimension, or an
array containing the window width for each dimension).  The default polynomial
order is 2 for each dimension, but may also be specified for all, or per
dimension, using <code class="xref py py-obj docutils literal notranslate"><span class="pre">order</span></code>.  The following displays the various orders of the
1-dimensional Savitzky-Golay filter for a window of width 11:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sofia_redux.toolkit.convolve.filter</span> <span class="kn">import</span> <span class="n">savgol</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="n">y</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">savgol</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;order </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Savitzky-Golay Coefficients&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Kernel index&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Coefficient value&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="../../../_downloads/a989b65b41ef12569fff7542c1ebe1f7/filter-2.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/340d7fc62d2b3afdfe578ff99487b39a/filter-2.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/f4d69d204293fda1558df71ee2dda3e7/filter-2.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/01e1c9811a45d83ec088c603eafa3482/filter-2.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="../../../_images/filter-2.png" class="plot-directive" src="../../../_images/filter-2.png" />
</figure>
<p>Be aware that the Savitzky-Golay coefficients are generated as a function of
<span class="math notranslate nohighlight">\(\lfloor\frac{order}{2}\rfloor\)</span> so that orders 0 and 1 produce the same
results, as do orders 2 and 3, etc.</p>
<p>The following example applies a 2nd order Savitzky-Golay filter of width 7 to
a 3-dimensional data set.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sofia_redux.toolkit.convolve.filter</span> <span class="kn">import</span> <span class="n">savgol</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="o">-</span><span class="mi">70</span><span class="p">:</span><span class="mi">70</span><span class="p">,</span> <span class="o">-</span><span class="mi">70</span><span class="p">:</span><span class="mi">70</span><span class="p">,</span> <span class="o">-</span><span class="mi">70</span><span class="p">:</span><span class="mi">70</span><span class="p">]</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">z</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">41</span><span class="p">)</span>
<span class="n">d</span> <span class="o">+=</span> <span class="n">rand</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">savgol</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;gist_stern&#39;</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;x-section of original data along axis 0&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">40</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;x-section of original data along axis 1&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span> <span class="mi">40</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;x-section of filtered data along axis 0&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">40</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;x-section of filtered data along axis 1&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">result</span><span class="p">[:,</span> <span class="mi">40</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="../../../_downloads/830fbc60c778109f181850fdc531081c/filter-3.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/c03eb9541ee5025bb61d90b8e2970efc/filter-3.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/c662d0a18a2be4832e994deac2aaba26/filter-3.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/a04404ece979ac675ed329ea8c6be4c4/filter-3.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="../../../_images/filter-3.png" class="plot-directive" src="../../../_images/filter-3.png" />
</figure>
<p>Note that a NaN border has been placed around the filtered image using
<code class="xref py py-obj docutils literal notranslate"><span class="pre">mode='constant,</span> <span class="pre">cval=np.nan</span></code>.  The
<a class="reference internal" href="../../../api/sofia_redux.toolkit.convolve.kernel.SavgolConvolve.html#sofia_redux.toolkit.convolve.kernel.SavgolConvolve" title="sofia_redux.toolkit.convolve.kernel.SavgolConvolve"><code class="xref py py-class docutils literal notranslate"><span class="pre">sofia_redux.toolkit.convolve.kernel.SavgolConvolve</span></code></a>
class and <a class="reference internal" href="../../../api/sofia_redux.toolkit.convolve.kernel.savitzky_golay.html#sofia_redux.toolkit.convolve.kernel.savitzky_golay" title="sofia_redux.toolkit.convolve.kernel.savitzky_golay"><code class="xref py py-func docutils literal notranslate"><span class="pre">sofia_redux.toolkit.convolve.kernel.savitzky_golay()</span></code></a> function are
wrappers for the <a class="reference internal" href="../../../api/sofia_redux.toolkit.convolve.filter.savgol.html#sofia_redux.toolkit.convolve.filter.savgol" title="sofia_redux.toolkit.convolve.filter.savgol"><code class="xref py py-func docutils literal notranslate"><span class="pre">savgol()</span></code></a> function, but allow the additional
functionality of NaN handling, robust outlier rejection, statistics, and
error propagation.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Convolution Filters</a><ul>
<li><a class="reference internal" href="#edge-effects">Edge Effects</a></li>
<li><a class="reference internal" href="#sobel-feldman-filtering">Sobel-Feldman Filtering</a></li>
<li><a class="reference internal" href="#savitzky-golay-filter">Savitzky-Golay Filter</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../../../_sources/sofia_redux/toolkit/convolve/filter.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>