<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sofia_redux.calibration.pipecal_calfac &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    
    <script src="../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <link rel="icon" href="../../../_static/redux.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sofia_redux.calibration.pipecal_calfac</h1><div class="highlight"><pre>
<span></span># Licensed under a 3-clause BSD style license - see LICENSE.rst
&quot;&quot;&quot;Calculate a calibration factor from a standard flux value.&quot;&quot;&quot;

from astropy import log
import numpy as np

from sofia_redux.calibration.pipecal_error import PipeCalError

__all__ = [&#39;pipecal_calfac&#39;]


<div class="viewcode-block" id="pipecal_calfac"><a class="viewcode-back" href="../../../api/sofia_redux.calibration.pipecal_calfac.pipecal_calfac.html#sofia_redux.calibration.pipecal_calfac.pipecal_calfac">[docs]</a>def pipecal_calfac(flux, flux_err, config):
    &quot;&quot;&quot;
    Calculate the calibration factor for a flux standard.

    Flux values are as measured from aperture photometry on
    an uncalibrated image of a known standard source.  It is
    assumed that the image has already been telluric-corrected
    to the reference ZA and altitude/PWV.  The calibration
    factor is intended to divide raw data that has also been
    telluric-corrected to the same reference atmosphere, in order
    to calibrate it to physical units (Jy/pixel).  The
    error on the calibration factory is calculated from the flux
    error and the model flux error, added in quadrature with
    appropriate scale factors.

    The model flux and its associated error must be present
    in the `config` data structure, as well as a mean and pivot
    wavelength, and a color correction factor.  That is, the keys
    &#39;wref&#39;, &#39;lpivot&#39;, &#39;std_flux&#39;, &#39;std_eflux&#39;, and &#39;color_corr&#39;
    must be present in the configuration dictionary.

    The calibration factor is calculated as::

        calfac = (flux * Lpivot^2) /
                 (color_cor * model_flux * Lmean^2)


    Parameters
    ----------
    flux : float
        Observed flux of standard, from aperture photometry.
    flux_err : float
        1-sigma uncertainty on flux.
    config : dictionary
        Describes the configuration of this run, as generated by
        `pipecal_config`.

    Returns
    -------
    ref_calfac : float
        Calibration factor
    ref_ecalfac : float
        1-sigma uncertainty on calibration factor

    Raises
    ------
    PipeCalError
        Any improper inputs

    &quot;&quot;&quot;

    # Get the values from pipecal config
    try:
        lmean = config[&#39;wref&#39;]
        lpivot = config[&#39;lpivot&#39;]
        model_flux = config[&#39;std_flux&#39;]
        model_flux_err = config[&#39;std_eflux&#39;]
        color_corr = config[&#39;color_corr&#39;]
    except KeyError:
        message = &#39;Invalid config&#39;
        log.error(message)
        raise PipeCalError(message)

    # Check all values are positive
    parameters = np.array([lmean, lpivot, model_flux, model_flux_err,
                           color_corr, flux, flux_err])
    if np.any(parameters &lt;= 0):
        message = &#39;All inputs to pipecal_calfac must be positive&#39;
        log.error(message)
        raise PipeCalError(message)

    # Calculate the calibration factor at the reference ZA, Alt/PWV
    # Equation:
    #  calfac = (flux * Lpivot**2) /
    #           (color_cor * model_flux * Lmean**2)
    calconst = lpivot**2 / (color_corr * model_flux * lmean**2)
    ref_calfac = flux * calconst
    ref_ecalfac = np.sqrt((flux_err * calconst)**2
                          + (ref_calfac * model_flux_err / 100.)**2)

    return ref_calfac, ref_ecalfac</div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>