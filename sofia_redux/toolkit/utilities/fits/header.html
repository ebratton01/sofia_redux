<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>General Use Header Functions &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/plot_directive.css" />
    
    <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../../_static/copybutton.js"></script>
    <link rel="icon" href="../../../../_static/redux.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Spline" href="../../../../api/sofia_redux.toolkit.splines.spline.Spline.html" />
    <link rel="prev" title="FITS I/O" href="fitsio.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="../../../../api/sofia_redux.toolkit.splines.spline.Spline.html" title="Spline">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="fitsio.html" title="FITS I/O">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../../../../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../../../index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../../index.html" >sofia_redux.toolkit: Shared Utilities for SOFIA Pipelines</a> &#187;</li>
      <li><a href="../index.html" >Utilities (<code class="xref py py-mod docutils literal notranslate"><span class="pre">sofia_redux.toolkit.utilities</span></code>)</a> &#187;</li>
      <li><a href="index.html" accesskey="U">FITS Handling</a> &#187;</li>
      
      <li>General Use Header Functions</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p>The majority of header functions were specifically developed for use with
SOFIA data pipeline products, performing tasks that are frequently required.</p>
<section id="general-use-header-functions">
<h1>General Use Header Functions<a class="headerlink" href="#general-use-header-functions" title="Permalink to this heading">¶</a></h1>
<p>There are a few general use header functions:</p>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">get_key_value()</span></code> is a very simple function that retrieves a keyword value
from a FITS header and if it is a string, removes leading/trailing whitespace
before converting it to uppercase.  If the value cannot be retrieved, a default
value is returned instead (default is the string, ‘UNKNOWN’):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">sofia_redux.toolkit.fits</span> <span class="kn">import</span> <span class="n">get_key_value</span>

<span class="n">header</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span>
<span class="n">header</span><span class="p">[</span><span class="s1">&#39;KEY1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;  this should be uppercase, no leading whitespace&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Original header value: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;KEY1&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Retrieved value: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">get_key_value</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="s1">&#39;KEY1&#39;</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Value for KEY2 (not in header): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">get_key_value</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="s1">&#39;KEY2&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Original header value: &#39;  this should be uppercase, no leading whitespace&#39;
Retrieved value: &#39;THIS SHOULD BE UPPERCASE, NO LEADING WHITESPACE&#39;
Value for KEY2 (not in header): UNKNOWN
</pre></div>
</div>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">hdinsert()</span></code> acts as a more user friendly wrapper for
<code class="xref py py-func docutils literal notranslate"><span class="pre">astropy.io.fits.Header.insert()</span></code>, inserting new FITS header keywords at a
specified location.  If the key already exists in the header, a new value
and/or optional comment may be supplied.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sofia_redux.toolkit.fits</span> <span class="kn">import</span> <span class="n">hdinsert</span>

<span class="n">header</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span>
<span class="n">header</span><span class="p">[</span><span class="s1">&#39;KEY1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;comment 1&#39;</span>
<span class="n">header</span><span class="p">[</span><span class="s1">&#39;KEY2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;comment 2&#39;</span>
<span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;A history entry&#39;</span>
<span class="n">hdinsert</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="s1">&#39;KEY3&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;new comment&#39;</span><span class="p">)</span>
<span class="n">hdinsert</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="s1">&#39;INSERTED&#39;</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">refkey</span><span class="o">=</span><span class="s1">&#39;KEY2&#39;</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">hdinsert</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="s1">&#39;KEY2&#39;</span><span class="p">,</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;KEY2&#39;</span><span class="p">],</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;Replaced comment&#39;</span><span class="p">)</span>
<span class="n">header</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>KEY1    =                    1 / comment 1
KEY2    =                    2 / Replaced comment
INSERTED=                  2.5
KEY3    =                    3 / new comment
HISTORY A history entry
</pre></div>
</div>
</section>
<section id="sofia-specific-header-functions">
<h1>SOFIA Specific Header Functions<a class="headerlink" href="#sofia-specific-header-functions" title="Permalink to this heading">¶</a></h1>
<p>The SOFIA DPS pipeline distinguishes keywords and history entries found in the
original raw data file from those added by the pipeline.  The key ‘AAAAAAAA’
(eight A’s) separates original and pipeline keywords while ‘BBBBBBBB’ (eight
B’s) separates original and pipeline history entries.  These values are
hard coded into the <code class="xref py py-obj docutils literal notranslate"><span class="pre">kref</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">href</span></code> variables in the
<code class="xref py py-mod docutils literal notranslate"><span class="pre">sofia_redux.toolkit.fits</span></code> module where:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">kref</span> <span class="o">=</span> <span class="s1">&#39;AAAAAAAA&#39;</span>  <span class="c1"># Keywords reference key marker</span>
<span class="n">href</span> <span class="o">=</span> <span class="s1">&#39;BBBBBBBB&#39;</span>  <span class="c1"># HISTORY reference key marker</span>
</pre></div>
</div>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">hdinsert()</span></code> is used to place pipeline specific keywords in the correct
partition by setting <code class="xref py py-obj docutils literal notranslate"><span class="pre">refkey=kref</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">refkey=href</span></code>.  In addition,
<code class="xref py py-func docutils literal notranslate"><span class="pre">add_history()</span></code> and <code class="xref py py-func docutils literal notranslate"><span class="pre">add_history_wrap()</span></code> are wrappers for
<code class="xref py py-func docutils literal notranslate"><span class="pre">hdinsert()</span></code>, adding history entries from the pipeline at the correct
location.  For example, here is an excerpt of a SOFIA header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>...
PIPEVERS= &#39;2_0_0   &#39;           / Pipeline version
PRODTYPE= &#39;drooped &#39;           / Product type
AAAAAAAA= &#39;Keywords reference&#39;
RN_HIGH = &#39;2400.   &#39;           / Read noise for high capacitance mode
RN_LOW  = &#39;244.8   &#39;           / Read noise for low capacitance mode
BETA_G  = &#39;1.0     &#39;           / Excess noise
JBCLEAN = &#39;MEDIAN  &#39;           / Jail bar cleaning algorithm
MINDROOP= &#39;0.0     &#39;           / minimum value for droop correction
MAXDROOP= &#39;65535.0 &#39;           / maximum value for droop correction
NRODROOP= &#39;16      &#39;           / number of rows for droop correction
HISTORY keyword AOR_ID updated to NONE on Nov 27 01:23:02 2013 UTC
BBBBBBBB= &#39;History reference&#39;
HISTORY keyword PLANID updated to NONE on Nov 27 01:23:02 2013 UTC
HISTORY keyword OBJECT updated to Alpha_Ori on Nov 27 01:23:02 2013 UTC
HISTORY keyword DITHER updated to F on Nov 27 01:23:02 2013 UTC
...
HISTORY Droop: Channel suppression correction factor 0.003500
</pre></div>
</div>
<p>And here is the behavior of <code class="xref py py-func docutils literal notranslate"><span class="pre">hdinsert()</span></code> and <code class="xref py py-func docutils literal notranslate"><span class="pre">add_history_wrap()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>from sofia_redux.toolkit.fits import kref, hdinsert, add_history_wrap

history_function = add_history_wrap(&#39;My pipeline step&#39;)
history_function(header, &quot;Giving an example of add_history_wrap&quot;)
hdinsert(header, &#39;NEW_KEY&#39;, &#39;hello&#39;)
header
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>...
PIPEVERS= &#39;2_0_0   &#39;           / Pipeline version
PRODTYPE= &#39;drooped &#39;           / Product type
AAAAAAAA= &#39;Keywords reference&#39;
RN_HIGH = &#39;2400.   &#39;           / Read noise for high capacitance mode
RN_LOW  = &#39;244.8   &#39;           / Read noise for low capacitance mode
BETA_G  = &#39;1.0     &#39;           / Excess noise
JBCLEAN = &#39;MEDIAN  &#39;           / Jail bar cleaning algorithm
MINDROOP= &#39;0.0     &#39;           / minimum value for droop correction
MAXDROOP= &#39;65535.0 &#39;           / maximum value for droop correction
NRODROOP= &#39;16      &#39;           / number of rows for droop correction
NEW_KEY = &#39;hello   &#39;
HISTORY keyword AOR_ID updated to NONE on Nov 27 01:23:02 2013 UTC
BBBBBBBB= &#39;History reference&#39;
HISTORY keyword PLANID updated to NONE on Nov 27 01:23:02 2013 UTC
HISTORY keyword OBJECT updated to Alpha_Ori on Nov 27 01:23:02 2013 UTC
HISTORY keyword DITHER updated to F on Nov 27 01:23:02 2013 UTC
...
HISTORY Droop: Channel suppression correction factor 0.003500
HISTORY My pipeline step: Giving an example of add_history_wrap
</pre></div>
</div>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">General Use Header Functions</a></li>
<li><a class="reference internal" href="#sofia-specific-header-functions">SOFIA Specific Header Functions</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../../../../_sources/sofia_redux/toolkit/utilities/fits/header.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>