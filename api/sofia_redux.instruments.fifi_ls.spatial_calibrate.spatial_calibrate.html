<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>spatial_calibrate &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="icon" href="../_static/redux.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="wrap_spatial_calibrate" href="sofia_redux.instruments.fifi_ls.spatial_calibrate.wrap_spatial_calibrate.html" />
    <link rel="prev" title="calculate_offsets" href="sofia_redux.instruments.fifi_ls.spatial_calibrate.calculate_offsets.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="sofia_redux.instruments.fifi_ls.spatial_calibrate.wrap_spatial_calibrate.html" title="wrap_spatial_calibrate">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="sofia_redux.instruments.fifi_ls.spatial_calibrate.calculate_offsets.html" title="calculate_offsets">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../sofia_redux/index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../manuals/fifils/developers/developers.html" accesskey="U">FIFI-LS Redux Developer’s Manual</a> &#187;</li>
      
      <li>spatial_calibrate</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="spatial-calibrate">
<h1>spatial_calibrate<a class="headerlink" href="#spatial-calibrate" title="Permalink to this heading">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="sofia_redux.instruments.fifi_ls.spatial_calibrate.spatial_calibrate">
<span class="sig-prename descclassname"><span class="pre">sofia_redux.instruments.fifi_ls.spatial_calibrate.</span></span><span class="sig-name descname"><span class="pre">spatial_calibrate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obsdate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flipsign</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">write</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/fifi_ls/spatial_calibrate.html#spatial_calibrate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.fifi_ls.spatial_calibrate.spatial_calibrate" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply spatial calibration (x and y offsets).</p>
<p>Each data extension will be updated with xs and ys fields, containing
spatial coordinates for each pixel in the data array.  The input
file should have been created by fifi_ls.lambda_calibrate.
This procedure handles only ERF coordinates;  SIRF mapping is neither
detected nor handled properly.</p>
<p>The FIFI-LS optics are not perfectly aligned so the pixels do not
fall on an even grid.  This routine calculates the x, y locations
for each pixel and shifts them according to dither positions.  The
procedure is, for each grating scan extension:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Calculate spatial positions in mm (from fifi_ls.offset_xy)</p></li>
<li><p>Convert positions to arcseconds, using PLATSCAL, dither
offsets (DLAM_MAP and DBET_MAP, possibly with a sign-flip
on each), and offsets of the secondary array from the
primary (from data/secondary_offset.txt).</p></li>
<li><p>Convert arcsecond offsets to RA and Dec coordinates.</p></li>
<li><p>Create FITS file and (optionally) write results to disk.</p></li>
</ol>
</div></blockquote>
<p>For OTF mode data, each input ramp sample has a separate
DLAM_MAP and DBET_MAP value, as recorded in the SCANPOS table in the
input FITS file.  These values are used to calculate the X and Y
offsets for each sample.  The output XS and YS image extensions
have dimension 25 x 1 x n_ramp.  The SCANPOS table is not propagated
to the output.</p>
<p>For all other data, the X and Y offsets are calculated from the
DLAM_MAP and DBET_MAP keywords in the header, and are
attached to the output as a 25-element array in the XS and YS
image extensions.</p>
<p>For all data, RA and DEC image extensions are additionally attached,
containing the sky coordinates for each spaxel in hours and degrees,
respectively.  Array dimensions for these extensions match the XS and
YS arrays.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>filename</strong><span class="classifier">str</span></dt><dd><p>File to be spatial-calibrated</p>
</dd>
<dt><strong>obsdate</strong><span class="classifier">array_like of int, optional</span></dt><dd><p>Date of observation.  Intended for files that do not have
the DATE-OBS keyword (and value) in the FITS primary header
(early files do not).  Format is [YYYY,MM,DD].</p>
</dd>
<dt><strong>flipsign</strong><span class="classifier">bool, optional</span></dt><dd><p>If True, DLAM_MAP and DBET_MAP will be multiplied by -1.  If
False, DLAM_MAP and DBET_MAP will be used as is.  If None
(default), the observation date will be used to determine
what the sign convention should be.</p>
</dd>
<dt><strong>rotate</strong><span class="classifier">bool, optional</span></dt><dd><p>If True, rotate by the detector angle to set N up.</p>
</dd>
<dt><strong>outdir</strong><span class="classifier">str, optional</span></dt><dd><p>Directory path to write output.  If None, output files
will be written to the same directory as the input files.</p>
</dd>
<dt><strong>write</strong><span class="classifier">bool, optional</span></dt><dd><p>If True, write to disk and return the path to the output
file.  If False, return the HDUList. The output filename is
created from the input filename, with the suffix ‘WAV’ replaced
with ‘XYC’.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>fits.HDUList or str</dt><dd><p>Either the HDUList (if write is False) or the filename of
the output file (if write is True).</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">spatial_calibrate</a><ul>
<li><a class="reference internal" href="#sofia_redux.instruments.fifi_ls.spatial_calibrate.spatial_calibrate"><code class="docutils literal notranslate"><span class="pre">spatial_calibrate()</span></code></a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/sofia_redux.instruments.fifi_ls.spatial_calibrate.spatial_calibrate.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>