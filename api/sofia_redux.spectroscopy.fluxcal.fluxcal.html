<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>fluxcal &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="icon" href="../_static/redux.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="get_apertures" href="sofia_redux.spectroscopy.getapertures.get_apertures.html" />
    <link rel="prev" title="get_wave_shift" href="sofia_redux.spectroscopy.fluxcal.get_wave_shift.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="sofia_redux.spectroscopy.getapertures.get_apertures.html" title="get_apertures">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="sofia_redux.spectroscopy.fluxcal.get_wave_shift.html" title="get_wave_shift">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../sofia_redux/index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../manuals/exes/developers/developers.html" accesskey="U">EXES Redux Developer’s Manual</a> &#187;</li>
      
      <li>fluxcal</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="fluxcal">
<h1>fluxcal<a class="headerlink" href="#fluxcal" title="Permalink to this heading">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="sofia_redux.spectroscopy.fluxcal.fluxcal">
<span class="sig-prename descclassname"><span class="pre">sofia_redux.spectroscopy.fluxcal.</span></span><span class="sig-name descname"><span class="pre">fluxcal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spectra</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atran</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">response</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">auto_shift</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift_subsample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/spectroscopy/fluxcal.html#fluxcal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.spectroscopy.fluxcal.fluxcal" title="Permalink to this definition">¶</a></dt>
<dd><p>Calibrate and telluric correct spectral flux.</p>
<p>The provided atmospheric transmission and response values are
interpolated onto the wavelength range for each order.  The correction
curve is computed as transmission * response.</p>
<p>Optionally, an optimum wavelength shift for the 1D spectra, relative
to the correction curve, may be computed by minimizing the residuals
in the corrected spectrum. If the calculated shift is greater than
0.1 pixel and less than <code class="xref py py-obj docutils literal notranslate"><span class="pre">shift_limit</span></code>, the spectrum is shifted by
this amount, via a linear interpolation, along the wavelength dimension
before correction.</p>
<p>The 1D spectral_flux and spectral error provided are divided by the
correction curve.  For the 2D spectral flux and error, each
row is divided by the correction curve.</p>
<p>If multiple ATRAN data sets are provided, then the optimum correction
will be determined by fitting a low order polynomial to the corrected
1D spectrum.  The correction curve that produces the lowest chi-squared
residuals on the fit is selected.  The index of the ATRAN data set
chosen is returned in the output dictionary, with key ‘atran_index’.</p>
<p>The calculated wavelength shift and the interpolated transmission,
response, and response error are stored in the output dictionary,
with keys ‘wave_shift’, ‘transmission’, ‘response’, and
‘response_error’, respectively.</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl>
<dt><strong>spectra</strong><span class="classifier">dict</span></dt><dd><p>Spectra to calibrate.</p>
<dl class="simple">
<dt>Structure is:</dt><dd><dl class="simple">
<dt>order (int) -&gt; list of dict</dt><dd><dl class="simple">
<dt>flux -&gt; numpy.ndarray (ns, nw)</dt><dd><p>Rectified 2D spectral flux image.</p>
</dd>
<dt>error -&gt; numpy.ndarray (ns, nw)</dt><dd><p>Rectified 2D spectral error image.</p>
</dd>
<dt>wave -&gt; numpy.ndarray (nw,)</dt><dd><p>Wavelength coordinates.</p>
</dd>
<dt>spectral_flux -&gt; numpy.ndarray (nw,)</dt><dd><p>1D spectral flux.</p>
</dd>
<dt>spectral_error -&gt; numpy.ndarray (nw,)</dt><dd><p>1D spectral error.</p>
</dd>
<dt>wave_shift -&gt; float</dt><dd><p>Manual shift to apply in the wavelength dimension
(pixels). If present and not None, will override
the <code class="xref py py-obj docutils literal notranslate"><span class="pre">auto_shift</span></code> parameter.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt><strong>atran</strong><span class="classifier">numpy.ndarray or list of numpy.ndarray</span></dt><dd><p>A (2, nt) array; first element is the wavelength coordinate, second
is the fractional transmission.  If a list of arrays is provided,
the optimum one will be selected.</p>
</dd>
<dt><strong>response</strong><span class="classifier">dict, optional</span></dt><dd><p>The instrumental response for the order.  If not provided,
only the ATRAN correction will be applied.</p>
<dl class="simple">
<dt>Structure is:</dt><dd><dl class="simple">
<dt>order (int) -&gt; dict</dt><dd><dl class="simple">
<dt>wave -&gt; numpy.ndarray (nr,)</dt><dd><p>Wavelength coordinates.  Need not match the spectral
flux coordinates.</p>
</dd>
<dt>response -&gt; numpy.ndarray (nr,)</dt><dd><p>Instrument response, in raw units/Jy.</p>
</dd>
<dt>error -&gt; numpy.ndarray (nr,)</dt><dd><p>Error on the response.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt><strong>auto_shift</strong><span class="classifier">bool, optional</span></dt><dd><p>If set, the spectrum cross-correlated with the
response * transmission, and the calculated wavelength
shift will be applied to the flux and error images and spectra.</p>
</dd>
<dt><strong>shift_limit</strong><span class="classifier">float, optional</span></dt><dd><p>Maximum wavelength shift to be applied by the <code class="xref py py-obj docutils literal notranslate"><span class="pre">auto_shift</span></code>,
in pixels.</p>
</dd>
<dt><strong>shift_subsample</strong><span class="classifier">int, optional</span></dt><dd><p>Subsampling for wavelength shifts.  Set to 1 to get whole pixel
shifts only.</p>
</dd>
<dt><strong>model_order</strong><span class="classifier">int, optional</span></dt><dd><p>Polynomial order for continuum model, used in optimizing wavelength
shifts and ATRAN optimization.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl>
<dt><strong>spectra</strong><span class="classifier">dict</span></dt><dd><p>Calibrated spectra.</p>
<dl class="simple">
<dt>Structure is:</dt><dd><dl class="simple">
<dt>order (int) -&gt; list of dict</dt><dd><dl class="simple">
<dt>flux -&gt; numpy.ndarray (ns, nw)</dt><dd><p>Calibrated rectified 2D spectral flux image.</p>
</dd>
<dt>error -&gt; numpy.ndarray (ns, nw)</dt><dd><p>Calibrated rectified 2D spectral error image.</p>
</dd>
<dt>wave -&gt; numpy.ndarray (nw,)</dt><dd><p>Wavelength coordinates.</p>
</dd>
<dt>spectral_flux -&gt; numpy.ndarray (nw,)</dt><dd><p>Calibrated 1D spectral flux.</p>
</dd>
<dt>spectral_error -&gt; numpy.ndarray (nw,)</dt><dd><p>Calibrated 1D spectral error.</p>
</dd>
<dt>wave_shift -&gt; float</dt><dd><p>Wavelength shift applied.</p>
</dd>
<dt>atran_index -&gt; int</dt><dd><p>Index of the ATRAN data set selected.</p>
</dd>
<dt>transmission -&gt; numpy.ndarray (nw,)</dt><dd><p>Transmission correction applied to flux.</p>
</dd>
<dt>response -&gt; numpy.ndarray (nw,)</dt><dd><p>Response correction applied to flux.</p>
</dd>
<dt>response_error -&gt; numpy.ndarray (nw,)</dt><dd><p>Error on the response.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">fluxcal</a><ul>
<li><a class="reference internal" href="#sofia_redux.spectroscopy.fluxcal.fluxcal"><code class="docutils literal notranslate"><span class="pre">fluxcal()</span></code></a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/sofia_redux.spectroscopy.fluxcal.fluxcal.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>