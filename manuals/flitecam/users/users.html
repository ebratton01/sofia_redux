<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>FLITECAM Redux User’s Manual &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    
    <script src="../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <link rel="icon" href="../../../_static/redux.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="FORCAST Redux User’s Manual" href="../../forcast/users/users.html" />
    <link rel="prev" title="FIFI-LS Redux User’s Manual" href="../../fifils/users/users.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="../../forcast/users/users.html" title="FORCAST Redux User’s Manual">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="../../fifils/users/users.html" title="FIFI-LS Redux User’s Manual">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../../../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../../../sofia_redux/index.html" accesskey="U">SOFIA Redux</a> &#187;</li>
      
      <li>FLITECAM Redux User’s Manual</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="flitecam-redux-user-s-manual">
<h1>FLITECAM Redux User’s Manual<a class="headerlink" href="#flitecam-redux-user-s-manual" title="Permalink to this heading">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>The SI Pipeline Users Manual (OP10) is intended for use by both SOFIA
Science Center staff during routine data processing and analysis, and
also as a reference for General Investigators (GIs) and archive users to
understand how the data in which they are interested was processed. This
manual is intended to provide all the needed information to execute the
SI Level 2 Pipeline, flux calibrate the results, and assess the data
quality of the resulting products. It will also provide a description of
the algorithms used by the pipeline and both the final and intermediate
data products.</p>
<p>A description of the current pipeline capabilities, testing results,
known issues, and installation procedures are documented in the SI
Pipeline Software Version Description Document (SVDD, SW06, DOCREF). The
overall Verification and Validation (V&amp;V) approach can be found in the
Data Processing System V&amp;V Plan (SV01-2232). Both documents can be
obtained from the SOFIA document library in Windchill.</p>
<p>This manual applies to FLITECAM Redux version 2.0.0.</p>
</section>
<section id="si-observing-modes-supported">
<h2>SI Observing Modes Supported<a class="headerlink" href="#si-observing-modes-supported" title="Permalink to this heading">¶</a></h2>
<section id="flitecam-instrument-information">
<h3>FLITECAM instrument information<a class="headerlink" href="#flitecam-instrument-information" title="Permalink to this heading">¶</a></h3>
<p>The First Light Infrared Test Camera (FLITECAM) is an infrared camera,
operating in the 1.0 - 5.5 <span class="math notranslate nohighlight">\(\mu m\)</span> range. It has a set of broadband
filters for imaging and a set of grisms and order sorting filters for medium
resolution spectroscopy.</p>
<p>The FLITECAM imaging mode provides seeing-limited images at 1 - 3
<span class="math notranslate nohighlight">\(\mu m\)</span> and diffraction-limited images at 3 - 5.5 <span class="math notranslate nohighlight">\(\mu m\)</span>
(McLean, et al. 2006). The array (InSb ALADDIN III) size is 1024 x 1024 with a
pixel scale of 0.47 arcseconds per pixel. This configuration results in a
field of view (FOV) of approximately 8.0 arcminutes,
but a circular stop and coma at the edges of the image restrict the
usable FOV to 5.6 arcminutes (see <a class="reference internal" href="#flitecam-fov"><span class="std std-numref">Fig. 43</span></a>).</p>
<p>FLITECAM has two filter
wheels that contain a set of broadband imaging filters, a suite of broad
order sorting filters for spectroscopy, and a few narrow-band imaging
filters. Available broadband imaging filters for FLITECAM are <em>J</em>, <em>H</em>, and
<em>K</em>. The narrow band filters are <span class="math notranslate nohighlight">\(P_\alpha\)</span>, <span class="math notranslate nohighlight">\(P_\alpha\)</span> <em>Continuum</em>,
<span class="math notranslate nohighlight">\(3.0 \mu m\)</span> <em>ice</em>, and <span class="math notranslate nohighlight">\(3.30 \mu m\)</span> <em>PAH</em>. In addition, FLITECAM
offers several filters with limited support:
<span class="math notranslate nohighlight">\(H_{wide}\)</span>, <span class="math notranslate nohighlight">\(K_{wide}\)</span>, <span class="math notranslate nohighlight">\(K_{long}\)</span>, <em>L</em>, <em>nbL</em>, <em>L’</em>, <em>M</em>,
<em>nbM</em>, and <em>L+M</em>. Detailed information about filter
characteristics, saturation limits, sensitivities and observation
planning can be found in the FLITECAM chapter of the <a class="reference external" href="https://www.sofia.usra.edu/science/proposing-and-observing/sofia-observers-handbook-cycle-6/4-flitecam">SOFIA Observer’s
Handbook</a>.</p>
<figure class="align-default" id="flitecam-fov">
<img alt="Raw data with a large square and an oval inscribed around a darker area. Arrows point to small dark circles." src="../../../_images/flitecam_fov.png" />
<figcaption>
<p><span class="caption-number">Fig. 43 </span><span class="caption-text">A typical FLITECAM image obtained during a commissioning
flight. The cyan box represents the usable portion of the array. Sources
that fall outside of this box show too much coma for accurate PSF
measurement. The small white dots visible in the image are hot pixels.
The green ellipse encompasses a region of low quantum efficiency and the
green arrows show obscurations in the optical path.</span><a class="headerlink" href="#flitecam-fov" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>FLITECAM also has three grisms and five order-sorting filters that can
be combined in different ways in order to access the full 1 - 5 <span class="math notranslate nohighlight">\(\mu m\)</span>
wavelength range. It has two slits, a narrow slit (1 arcsecond) and a wide slit
(~2 arcseconds), which allow for higher (R~2000) or lower (R~1300) resolution,
respectively. The slits are both 60 arcseconds long and are adjacent to each
other on the slit mask, such that spectra from both slits are acquired
simultaneously during an integration (see <a class="reference internal" href="#flitecam-grism-fov"><span class="std std-numref">Fig. 44</span></a>).</p>
<p>FLITECAM was retired from SOFIA operations, effective February 2018.
FLITECAM data is available for archival research via the
<a class="reference external" href="https://irsa.ipac.caltech.edu/applications/sofia/">SOFIA archive</a>.</p>
<figure class="align-default" id="flitecam-grism-fov">
<img alt="Raw image with red lines flanking a bright rectangular area with a visible spectral trace." src="../../../_images/flitecam_grism_fov.png" />
<figcaption>
<p><span class="caption-number">Fig. 44 </span><span class="caption-text">A typical FLITECAM grism observation taken with the wide slit. As
with the raw imaging data, there are hot pixels scattered across
the frame.  The wide-slit region is outlined in red; the
narrow-slit region is visible to the right of the wide-slit region.
Wavelength increases from the bottom to the top of the frame.</span><a class="headerlink" href="#flitecam-grism-fov" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="flitecam-observing-techniques">
<h3>FLITECAM observing techniques<a class="headerlink" href="#flitecam-observing-techniques" title="Permalink to this heading">¶</a></h3>
<p>In any given pixel on a detector, the total number of counts is given by
the sum of the counts from the dark current, telescope emission, sky
background, and the target itself. Since the sky level can vary
significantly over short timescales in the near infrared, it is typical
to take pairs of observations back-to-back and subtract them in order to
remove the dark current, telescope signal, and sky signal (to first
order). An A frame exposure of the target is immediately followed by a B
frame containing only sky at the target’s position:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}A &amp;= dark + telescope + sky_A + target\\B &amp;= dark + telescope + sky_B\\A - B &amp;= target + (sky_A - sky_B)\end{aligned}\end{align} \]</div>
<p>Note that it is assumed that the sky level may vary somewhat between
frame A and frame B, but the dark current and telescope emission do not.
This residual sky emission is typically removed in the data reduction
process.</p>
<p>For FLITECAM imaging, there are two observing modes: stare and
nod-off-array. Both of these modes can be used with or without dithers.
Most FLITECAM observations using are performed
either in stare mode with dithers for uncrowded fields of view or
nod-off-array with dithers for crowded and extended emission fields of view.
In the first case, all dither positions are combined to produce a sky/flat
frame to correct each image. In the second case, only the sky
frames are combined to correct the on-source images.</p>
<p>FLITECAM grism observations offer two modes for producing A-B pairs.
In the nod-along-slit mode, the A frame is taken with the target
positioned one-third to one-quarter of the distance along the slit.
After the A frame is complete, the telescope moves to place the target
approximately the same distance from the other end of the slit. The
exposure taken in this configuration is the B frame. It is typical,
then, to repeat A-B pairs in either an A-B-A-B or A-B-B-A sequence until
the total desired integration time is achieved. In this mode, the A
frame provides the sky measurement at the target position for the B
frame, and the B frame provides the sky for the A frame. This mode is
useful as long as the target is compact, relative to the slit length.</p>
<p>In the second mode, nod-off-slit, the A frame is taken with the target
at the center of the slit. The B frame is taken with the target
completely off the slit, so that the exposure contains only the sky
signal. In this mode, the B frame exists only to provide the sky
measurement at the target position for the A frame, which may be useful
if the target is significantly extended. In this mode, too, either the
A-B-A-B or A-B-B-A observing sequence can be used.</p>
</section>
</section>
<section id="algorithm-description">
<h2>Algorithm Description<a class="headerlink" href="#algorithm-description" title="Permalink to this heading">¶</a></h2>
<section id="overview-of-data-reduction-steps">
<h3>Overview of data reduction steps<a class="headerlink" href="#overview-of-data-reduction-steps" title="Permalink to this heading">¶</a></h3>
<p>This section will describe, in general terms, the major algorithms that
the FLITECAM Redux pipeline uses to reduce a FLITECAM observation.</p>
<p>The pipeline applies a number of corrections to each input file, regardless of
the observing mode used to take the data. The initial steps used for
imaging and grism modes are nearly identical. After preprocessing,
individual images or spectra of a source
must be combined to produce the final data product. This procedure depends
strongly on the instrument configuration and observation mode.</p>
<p>See <a class="reference internal" href="#flitecam-flowchart-img"><span class="std std-numref">Fig. 45</span></a> and <a class="reference internal" href="#flitecam-flowchart-grism"><span class="std std-numref">Fig. 46</span></a> for
flowcharts of the processing steps used by the imaging and grism pipelines.</p>
<figure class="align-default" id="flitecam-flowchart-img">
<a class="reference internal image-reference" href="../../../_images/flitecam_flowchart_img.png"><img alt="Flowchart of processing steps for imaging data with cartoon depictions of all steps." src="../../../_images/flitecam_flowchart_img.png" style="height: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 45 </span><span class="caption-text">Processing steps for imaging data.</span><a class="headerlink" href="#flitecam-flowchart-img" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="flitecam-flowchart-grism">
<a class="reference internal image-reference" href="../../../_images/flitecam_flowchart_grism.png"><img alt="Flowchart of processing steps for grism data with cartoon depictions of all steps." src="../../../_images/flitecam_flowchart_grism.png" style="height: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 46 </span><span class="caption-text">Processing steps for grism data.</span><a class="headerlink" href="#flitecam-flowchart-grism" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="reduction-algorithms">
<h3>Reduction algorithms<a class="headerlink" href="#reduction-algorithms" title="Permalink to this heading">¶</a></h3>
<p>The following subsections detail each of the data reduction pipeline
steps:</p>
<ul class="simple">
<li><p>Imaging steps</p>
<ul>
<li><p>Correct for detector nonlinearity</p></li>
<li><p>Clip image and clean bad pixels</p></li>
<li><p>Correct gain</p></li>
<li><p>Subtract background</p></li>
<li><p>Register images</p></li>
<li><p>Correct for atmospheric transmission (telluric correct)</p></li>
<li><p>Coadd multiple observations</p></li>
<li><p>Calibrate flux</p></li>
</ul>
</li>
<li><p>Spectroscopy steps</p>
<ul>
<li><p>Correct for detector nonlinearity</p></li>
<li><p>Pair-subtract and rotate spectral images</p></li>
<li><p>Rectify spectral image</p></li>
<li><p>Identify apertures</p></li>
<li><p>Extract spectra</p></li>
<li><p>Calibrate flux and correct for atmospheric transmission</p></li>
<li><p>Combine multiple observations, or generate response spectra</p></li>
</ul>
</li>
</ul>
<section id="imaging-steps">
<h4>Imaging steps<a class="headerlink" href="#imaging-steps" title="Permalink to this heading">¶</a></h4>
<p>The following subsections detail each of the data reduction pipeline
steps outlined in the imaging flowchart (<a class="reference internal" href="#flitecam-flowchart-img"><span class="std std-numref">Fig. 45</span></a>).</p>
<section id="correct-for-detector-nonlinearity">
<span id="flitecam-nonlin"></span><h5>Correct for detector nonlinearity<a class="headerlink" href="#correct-for-detector-nonlinearity" title="Permalink to this heading">¶</a></h5>
<p>The first step of the imaging pipeline is to correct each input image for
detector nonlinearity and generate an uncertainty image that associates an
error value with each pixel in the flux image.</p>
<p>The nonlinearity coefficients for FLITECAM were determined by taking a
series of flat exposures with varying exposure times. The count rates at
each pixel in the flats were fit with a fourth order polynomial, and the
resulting coefficients were stored in a FITS image file as a 3D data
cube, where each plane corresponds to a different coefficient in the
polynomial fit.</p>
<p>Following the Spextool nonlinearity paper (Vacca et al., 2004; see the
<a class="reference internal" href="#flitecam-resources"><span class="std std-ref">Other Resources</span></a> section), the coefficients are applied to the
raw data as follows.  First, the flat pedestal is determined from the first
plane of the linearity coefficients:</p>
<div class="math notranslate nohighlight">
\[p_{flat} = C_0 \delta t_{flat}\]</div>
<p>where <span class="math notranslate nohighlight">\(C_0\)</span> is the first coefficient plane and <span class="math notranslate nohighlight">\(\delta t_{flat}\)</span>
is the readout time for the flats used as input.</p>
<p>The pedestal for the image to be corrected is determined iteratively.
The first estimate of the pedestal is:</p>
<div class="math notranslate nohighlight">
\[p^{(1)} = \frac{S_{tot} \delta t}{n_r n_c \Delta t} \Big( \frac{n_r + 1}{2} - f \Big)\]</div>
<p>where <span class="math notranslate nohighlight">\(S_{tot}\)</span> is the raw counts in the image, <span class="math notranslate nohighlight">\(n_r\)</span> is
the number of readouts, <span class="math notranslate nohighlight">\(n_c\)</span> is the number of hardware coadds,
<span class="math notranslate nohighlight">\(\delta t\)</span> is the readout time, <span class="math notranslate nohighlight">\(\Delta t\)</span> is the integration time,
and <em>f</em> is a fractional value indicating how long it takes for an individual
pixel to read out. Rigorously, <em>f</em> varies for each pixel, depending on its
position in the array; for FLITECAM, an average value of <em>f=0.5</em> is used for
all pixels.</p>
<p>Using this pedestal estimate, the signal for an individual readout is
estimated as:</p>
<div class="math notranslate nohighlight">
\[s^{(1)} = \frac{S_{tot}}{n_r n_c} + p^{(1)}\]</div>
<p>and both pedestal and signal are corrected for nonlinearity. To
account for the pedestal value of the flats used to determine the
linearity coefficients, the coefficients are normalized by the first
coefficient plane, and the polynomial is applied to the value to
correct, minus the flat pedestal:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}p^{(2)} = p^{(1)} \frac{C_0}{C_{nl} ( p^{(1)} - p_{flat} )}\\s^{(2)} = s^{(1)} \frac{C_0}{C_{nl} ( s^{(1)} - p_{flat} )}\end{aligned}\end{align} \]</div>
<p>where <span class="math notranslate nohighlight">\(C_{nl}\)</span> is the full correction polynomial for each pixel in the
image. This process is then repeated once more, replacing <span class="math notranslate nohighlight">\(S_{tot}\)</span> with</p>
<div class="math notranslate nohighlight">
\[S_{tot}^{(2)} = n_c n_r s^{(2)} - n_c n_r p^{(2)} .\]</div>
<p>The final value for <span class="math notranslate nohighlight">\(S_{tot}\)</span>, calculated from <span class="math notranslate nohighlight">\(s^{(3)}\)</span> and
<span class="math notranslate nohighlight">\(p^{(3)}\)</span>, is the linearity corrected image.</p>
<p>After linearity correction, the variance is calculated for each pixel
from:</p>
<div class="math notranslate nohighlight">
\[V = \frac{S_{tot}}{g n_r n_c^2 \Delta t^2} \Big[1 - \frac{\delta t (n_r^2 - 1)}{3 n_r \Delta t} \Big] + \frac{2 \sigma_r^2}{g^2 n_r n_c \Delta t^2}\]</div>
<p>where <em>g</em> is the electronic gain and <span class="math notranslate nohighlight">\(\sigma_r\)</span> is the read noise for the
detector (Vacca et al., 2004). This variance is propagated through all
remaining reduction steps and its square root (the uncertainty) is
recorded in all output files along with the image, as a separate extension
in the file. <a class="footnote-reference brackets" href="#fn-flitecam-uncertainty" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-flitecam-uncertainty" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Earlier versions of this pipeline stored the uncertainty image as a
second plane in a data cube in the output FITS files.  As of v2.0.0,
the flux image is stored in the primary FITS extension and
auxiliary data like the uncertainty, bad pixel mask, and exposure map
are stored in separate extensions.</p>
</aside>
</aside>
<p>Finally, the units in the flux and uncertainty images are converted from
raw counts to counts per second by dividing by the integration time per
coadd (<span class="math notranslate nohighlight">\(\Delta t\)</span>).</p>
<p>A bad pixel mask is also associated with the data after the nonlinearity
correction step, in a BADMASK FITS extension.  This initial mask marks any
saturated pixels, recorded before linearity correction is applied, as bad
pixels (0 = good, 1 = bad).  These pixels are replaced with NaN values so
that they do not propagate to subsequent steps.</p>
</section>
<section id="clip-image-and-clean-bad-pixels">
<h5>Clip image and clean bad pixels<a class="headerlink" href="#clip-image-and-clean-bad-pixels" title="Permalink to this heading">¶</a></h5>
<p>For the imaging pipeline, before proceeding, the linearity-corrected
images and the corresponding uncertainty images are clipped to
the size of the useful part of the detector (the cyan box in
<a class="reference internal" href="#flitecam-fov"><span class="std std-numref">Fig. 43</span></a>; see also <a class="reference internal" href="#flitecam-clip"><span class="std std-numref">Fig. 47</span></a>).</p>
<p>Hot and cold bad pixels are then identified in the clipped image by iteratively
searching for local outlier values.  Bad pixels are replaced with NaN
and their locations are added to the associated bad pixel mask.</p>
<figure class="align-default" id="flitecam-clip">
<img alt="Left: a raw image clipped to the rectangular FOV. Right: a bad pixel mask identifying scattered bad pixels." src="../../../_images/flitecam_clip.png" />
<figcaption>
<p><span class="caption-number">Fig. 47 </span><span class="caption-text">Left: a clipped image, taken as part of a stare mode observation,
corrected for nonlinearity and with bad pixels set
to NaN.  Right: the corresponding bad pixel mask.</span><a class="headerlink" href="#flitecam-clip" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="correct-gain">
<h5>Correct gain<a class="headerlink" href="#correct-gain" title="Permalink to this heading">¶</a></h5>
<p>As with all modern near-IR detectors, raw images produced by FLITECAM
have significant pixel-to-pixel gain variations. In addition, FLITECAM’s
detector has a large region of low quantum efficiency in the third quadrant
and the top of the fourth quadrant of the detector, as shown in
<a class="reference internal" href="#flitecam-fov"><span class="std std-numref">Fig. 43</span></a>. These gain variations can be corrected by dividing
by a normalized flat field image.</p>
<p>Imaging flats for FLITECAM are made from images of the sky. In
nod-off-array mode, dithered sky images are used to generate a flat that
is used to correct all on-source images. In stare mode, the dithered source
images themselves are used to generate the flat.  For each source image,
a different flat is created from the remaining source images in order not
to introduce correlations in the gain correction.  In either case, the
algorithm to generate the flat from the input files is the same.</p>
<p>First, all images are median-combined into a “draft” flat, with a sigma-clipping
outlier rejection algorithm. The draft flat is used to flat-correct
all input images. These draft images are then used to create object masks
that identify any strong sources in the frame, via an image segmentation
algorithm.  The raw images are then scaled to the median value across all
images and re-combined, ignoring any pixels identified in the object mask
for each frame.</p>
<p>When the final flat frame has been created, it is divided by its median
value to normalize it.  This normalization value is stored in the FITS
header in the FLATNORM keyword.  This value may optionally be used later to
correct for the sky background in the source images.</p>
<p>The final flat frame is divided into each source image to correct it for
gain variations (<a class="reference internal" href="#flitecam-gaincor"><span class="std std-numref">Fig. 48</span></a>).</p>
<figure class="align-default" id="flitecam-gaincor">
<img alt="Left: corrected image flat background and sources are visible. Right: normalized flat with gain artifacts." src="../../../_images/flitecam_gaincor.png" />
<figcaption>
<p><span class="caption-number">Fig. 48 </span><span class="caption-text">Left: the stare mode image from <a class="reference internal" href="#flitecam-clip"><span class="std std-numref">Fig. 47</span></a>, corrected for
gain variations.  Right: the normalized flat image used to correct the
data, derived from the remaining dithers in the observation.</span><a class="headerlink" href="#flitecam-gaincor" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="subtract-background">
<h5>Subtract background<a class="headerlink" href="#subtract-background" title="Permalink to this heading">¶</a></h5>
<p>The sky background level must then be subtracted for each image. For
imaging frames, since the flat is made from sky image, the average
sky level is the median level of the unnormalized flat.
This sky level is subtracted from each source image. Optionally, the
median value of each individual image can be subtracted to correct for
residual sky level variations, in place of the median level from the flat.</p>
<p>The sky level correction is recommended for observations of diffuse sources,
for which emission fills the frame.  The median level correction is
recommended for observations in which the sky level varied significantly.</p>
</section>
<section id="register-images">
<h5>Register images<a class="headerlink" href="#register-images" title="Permalink to this heading">¶</a></h5>
<p>In order to combine multiple imaging observations of the same source,
each image must be registered to a reference image, so that the pixels
from each image correspond to the same location on the sky.</p>
<p>The registration information is typically encoded in the world coordinate
system (WCS) embedded in each FITS file header.  For most observations,
the WCS is sufficiently accurate that no change is required in the registration
step.  However, if the WCS is faulty, it may be corrected in the registration
step, using centroiding or cross-correlation between images to identify common
sources.  In this case,the first image is taken as the reference image,
and calculated offsets are applied to the WCS header keywords (CRPIX1 and
CRPIX2) in all subsequent images (<a class="reference internal" href="#flitecam-register"><span class="std std-numref">Fig. 49</span></a>). <a class="footnote-reference brackets" href="#fn-register" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-register" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Earlier versions of this pipeline applied registration to the images
themselves, rather than to the WCS in the FITS header, interpolating
them into the same spatial grid.  As of v2.0.0, registration affects
only the CRPIX1 and CRPIX2 keywords in the header.</p>
</aside>
</aside>
<figure class="align-default" id="flitecam-register">
<img alt="Three dithered images of a field, aligned in WCS with a crosshair marking the location of the brightest source." src="../../../_images/flitecam_register.png" />
<figcaption>
<p><span class="caption-number">Fig. 49 </span><span class="caption-text">Three dither positions from the stare mode observation of
<a class="reference internal" href="#flitecam-clip"><span class="std std-numref">Fig. 47</span></a>.  The WCS was inaccurate for this observation,
so the centroiding algorithm was used to correct the registration
for these images. The registered images have not changed in dimension,
but the FITS header keywords have been corrected to align them into
a reference coordinate frame.</span><a class="headerlink" href="#flitecam-register" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="correct-for-atmospheric-transmission">
<h5>Correct for atmospheric transmission<a class="headerlink" href="#correct-for-atmospheric-transmission" title="Permalink to this heading">¶</a></h5>
<p>For accurate flux calibration, the pipeline must first correct for the
atmospheric opacity at the time of the observation. In order to combine
images taken in different atmospheric conditions, or at different
altitudes or zenith angles, the pipeline corrects the flux in each
individual registered file for the estimated atmospheric transmission
during the observations, based on the altitude and zenith angle at the
time when the observations were obtained, relative to that computed for
a reference altitude (41,000 feet) and reference zenith angle (45
degrees), for which the instrumental response has been calculated. The
atmospheric transmission values are derived from the ATRAN code
provided to the SOFIA program by Steve Lord. The pipeline applies the
telluric correction factor directly to the flux in the image, and
records it in the header keyword TELCORR.</p>
<p>After telluric correction, the pipeline performs aperture photometry on
all observations that are marked as flux
standards (FITS keyword OBSTYPE = STANDARD_FLUX). The brightest source
in the field is fit with a Moffat profile to determine its centroid, and
then its flux is measured, using an aperture of 12 pixels and a
background region of 15-25 pixels. The aperture flux and error, as well
as the fit characteristics, are recorded in the FITS header, to be used
in the flux calibration process.</p>
</section>
<section id="coadd-multiple-observations">
<h5>Coadd multiple observations<a class="headerlink" href="#coadd-multiple-observations" title="Permalink to this heading">¶</a></h5>
<p>After registration and scaling, the pipeline coadds multiple
observations of the same source with the same instrument configuration
and observation mode. Each image is projected into the coordinate system
of the first image, using its WCS to transform input coordinates into output
coordinates.  An additional offset may be applied for non-sidereal targets
in order to correct for the motion of the target across the sky, provided
that the target position is recorded in the FITS headers (TGTRA and TGTDEC).
The projection is performed with a bilinear interpolation, then individual
images are mean- or median-combined, with optional error weighting and robust
outlier rejection.</p>
<p>For flux standards, photometry calculations are repeated on the coadded
image, in the same way they were performed on the individual images.</p>
</section>
<section id="calibrate-flux">
<h5>Calibrate flux<a class="headerlink" href="#calibrate-flux" title="Permalink to this heading">¶</a></h5>
<p>For the imaging mode, flux calibration factors are typically calculated from
all standards observed within a flight series. These calibration factors are
applied directly to the flux images to produce an image calibrated to
physical units. The final Level 3 product has image units of Jy per pixel
(<a class="reference internal" href="#flitecam-coadd"><span class="std std-numref">Fig. 50</span></a>). <a class="footnote-reference brackets" href="#fn-flitecam-flux" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a></p>
<p>See the flux calibration section, below, for more information.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-flitecam-flux" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>Earlier versions of this pipeline did not produce a final
calibrated file. Prior to v1.2.0, the final Level 3 products had image
units of DN/sec, with the flux calibration factor (DN/sec/Jy) recorded
in the FITS header keyword, CALFCTR. To convert these products to
Jy/pixel, divide the flux image by the CALFCTR value.</p>
</aside>
</aside>
<figure class="align-default" id="flitecam-coadd">
<img alt="A rotated rectangular field, with several sources visible and black outer borders with no data." src="../../../_images/flitecam_coadd.png" />
<figcaption>
<p><span class="caption-number">Fig. 50 </span><span class="caption-text">The final coadded, calibrated image for the dithered stare mode observation
of <a class="reference internal" href="#flitecam-clip"><span class="std std-numref">Fig. 47</span></a>.  The final image is rotated into a standard
North-up, East-left orientation.</span><a class="headerlink" href="#flitecam-coadd" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="mosaic">
<h5>Mosaic<a class="headerlink" href="#mosaic" title="Permalink to this heading">¶</a></h5>
<p>In some cases, it may be useful to stack together separate calibrated
observations of the same target. In order to create a deeper image of a
faint target, for example, observations taken across multiple flights
may be combined together. Large maps may also be generated by taking
separate observations, and stitching together the results. In these
cases, the pipeline may register these files and coadd them, using the
same methods as in the initial registration and coadd steps. The output
product is a LEVEL_4 mosaic.</p>
</section>
</section>
<section id="spectroscopy-reduction-algorithms">
<h4>Spectroscopy Reduction algorithms<a class="headerlink" href="#spectroscopy-reduction-algorithms" title="Permalink to this heading">¶</a></h4>
<p>The following subsections detail each of the data reduction pipeline
steps outlined in the grism flowchart (<a class="reference internal" href="#flitecam-flowchart-grism"><span class="std std-numref">Fig. 46</span></a>).</p>
<section id="image-processing">
<h5>Image Processing<a class="headerlink" href="#image-processing" title="Permalink to this heading">¶</a></h5>
<p>As for the FLITECAM imaging mode, the pipeline first corrects the input
images for detector nonlinearity and creates an uncertainty image, using the
algorithm described above, in the <a class="reference internal" href="#flitecam-nonlin"><span class="std std-ref">Correct for detector nonlinearity</span></a> section).
Then, the pipeline does A-B pair subtraction of all the input images.
It also divides by a normalized flat image, if available. The
resulting signal in the 2-D spectrum is:</p>
<div class="math notranslate nohighlight">
\[S_{AB} = \frac{S_A - S_B}{flat}\]</div>
<p>where <span class="math notranslate nohighlight">\(S_A\)</span> is the corrected counts per second in frame A, <span class="math notranslate nohighlight">\(S_B\)</span> is
the corrected counts per second in frame B, and <em>flat</em> is the normalized flat image.</p>
<p>Alongside the image processing, the individual variances for the A
frame, B frame, and flat are combined as follows to get the total
variance for the 2-D spectrum:</p>
<div class="math notranslate nohighlight">
\[V_{AB} = \frac{V_{A} + V_{B}}{flat^2} + \frac{V_{flat} S_{AB}^2}{flat^2}\]</div>
<p>where <span class="math notranslate nohighlight">\(V_A\)</span> is the variance of frame A, <span class="math notranslate nohighlight">\(V_B\)</span> is the variance of
frame B, and <span class="math notranslate nohighlight">\(V_{flat}\)</span> is the variance of the normalized flat image.</p>
</section>
<section id="stack-common-dithers">
<h5>Stack common dithers<a class="headerlink" href="#stack-common-dithers" title="Permalink to this heading">¶</a></h5>
<p>For very faint spectra, a stacking step may be optionally performed before
spectral extraction. This step identifies spectra at common dither positions
and mean- or median-combines them in order to increase signal-to-noise.
This step may be applied if spectra are too faint to automatically identify
appropriate apertures.</p>
</section>
<section id="rectify-spectral-image">
<span id="flitecam-rectify-image"></span><h5>Rectify spectral image<a class="headerlink" href="#rectify-spectral-image" title="Permalink to this heading">¶</a></h5>
<p>For the spectroscopic mode, spatial and spectral distortions are
corrected for by defining calibration images that assign a wavelength
coordinate (in <span class="math notranslate nohighlight">\(\mu m\)</span>) and a spatial coordinate (in <em>arcsec</em>) to each
detector pixel within the slit region of the detector
(see <a class="reference internal" href="#flitecam-grism-fov"><span class="std std-numref">Fig. 44</span></a>).  Each 2D spectral image in
an observation is clipped and resampled into a rectified spatial-spectral
grid, using these coordinates to define the output grid.  If appropriate
calibration data is available, the output from this step is an image in which
wavelength values are constant along the columns, and spatial values are
constant along the rows, correcting for any curvature in the spectral trace
(<a class="reference internal" href="#flitecam-rectified"><span class="std std-numref">Fig. 51</span></a>).</p>
<p>The calibration maps used in rectification are generated from identifications
of sky emission and telluric absorption lines and a polynomial fit to centroids
of those features in pixel space for each row (i.e. along the dispersion
direction). The derivation of a wavelength calibration is an interactive process,
but application of the derived wavelength calibration is an automatic part
of the data reduction pipeline. The default wavelength calibration is
expected to be good to within approximately one pixel in the output
spectrum.</p>
<p>For some observational cycles, sufficient calibration data may not be available,
resulting in some residual spectral curvature, or minor wavelength calibration
inaccuracies.  The spectral curvature can be compensated for, in sources
with strong continuum emission, by tracing the continuum center during
spectral extraction (see next section).  For other sources, a wider
aperture may be set, at the cost of decreased signal-to-noise.</p>
<p>Additionally, a correction that accounts
for spatial variations in the instrumental throughput may be applied to the
rectified image. This “slit correction function” is a function of the position
of the science target spectrum along the slit relative to that used for
the standard stars.  The slit function image is produced in a separate
calibration process, from wavelength-rectified, averaged sky frames.</p>
<figure class="align-default" id="flitecam-rectified">
<img alt="Top: full square array with two traces. Bottom: smaller rectangle containing only the slit region of the detector." src="../../../_images/flitecam_rectified.png" />
<figcaption>
<p><span class="caption-number">Fig. 51 </span><span class="caption-text">A nod-along-slit spectral image after pair-subtraction, before (top)
and after (bottom) rectification.  Black spots indicate NaN values,
marking saturated pixels identified during the nonlinearity correction
step.  Further bad pixels will be identified and ignored later in the
extraction process.</span><a class="headerlink" href="#flitecam-rectified" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="flitecam-set-apertures">
<span id="identify-apertures"></span><h5>Identify apertures<a class="headerlink" href="#flitecam-set-apertures" title="Permalink to this heading">¶</a></h5>
<p>In order to aid in spectral extraction, the pipeline constructs a smoothed
model of the relative intensity of the target spectrum at each spatial
position, for each wavelength. This spatial profile is used to compute
the weights in optimal extraction or to fix bad pixels in standard
extraction (see next section). Also, the pipeline uses the median profile,
collapsed along the wavelength axis, to define the extraction
parameters.</p>
<p>To construct the spatial profile, the pipeline first subtracts the median
signal from each column in the rectified spectral image to remove the residual
background.  The intensity in this image in column <em>i</em> and row <em>j</em> is given by</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(O_{ij} = f_{i}P_{ij}\)</span></p>
</div></blockquote>
<p>where <span class="math notranslate nohighlight">\(f_i\)</span> is the total intensity of the spectrum at
wavelength <em>i</em>, and <span class="math notranslate nohighlight">\(P_{ij}\)</span> is the spatial profile at column <em>i</em>
and row <em>j</em>. To get the spatial profile <span class="math notranslate nohighlight">\(P_{ij}\)</span>, we must
approximate the intensity <span class="math notranslate nohighlight">\(f_i\)</span>. To do so, the pipeline computes a
median over the wavelength dimension (columns) of the order image to get a
first-order approximation of the median spatial profile at each row
<span class="math notranslate nohighlight">\(P_j\)</span>. Assuming that</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(O_{ij} \approx c_{i}P_{j}\)</span>,</p>
</div></blockquote>
<p>the pipeline uses a linear least-squares algorithm to fit <span class="math notranslate nohighlight">\(P_j\)</span> to
<span class="math notranslate nohighlight">\(O_{ij}\)</span> and thereby determine the coefficients <span class="math notranslate nohighlight">\(c_i\)</span>. These
coefficients are then used as the first-order approximation to <span class="math notranslate nohighlight">\(f_i\)</span>:
the resampled order image <span class="math notranslate nohighlight">\(O_{ij}\)</span> is divided by <span class="math notranslate nohighlight">\(f_i\)</span> to derive
<span class="math notranslate nohighlight">\(P_{ij}\)</span>.  The pipeline then fits a low-order polynomial along the
columns at each spatial point <em>s</em> in order to smooth the profile and
thereby increase its signal-to-noise. The coefficients of these fits can
then be used to determine the value of <span class="math notranslate nohighlight">\(P_{ij}\)</span> at any column <em>i</em> and
spatial point <em>j</em> (see <a class="reference internal" href="#flitecam-profile"><span class="std std-numref">Fig. 52</span></a>, left). The median of <span class="math notranslate nohighlight">\(P_{ij}\)</span>
along the wavelength axis generates the median spatial profile, <span class="math notranslate nohighlight">\(P_j\)</span>
(see <a class="reference internal" href="#flitecam-profile"><span class="std std-numref">Fig. 52</span></a>, right).</p>
<figure class="align-default" id="flitecam-profile">
<img alt="Left: 3D surface in slit position vs. wavelength vs. flux.  Right: 1D plot of slit position vs. flux." src="../../../_images/flitecam_profile.png" />
<figcaption>
<p><span class="caption-number">Fig. 52 </span><span class="caption-text">Spatial model and median spatial profile, for the image in
<a class="reference internal" href="#flitecam-rectified"><span class="std std-numref">Fig. 51</span></a>.  The spatial model image here
is rotated for comparison with the profile plot: the y-axis is
along the bottom of the surface plot; the x-axis is along the left.</span><a class="headerlink" href="#flitecam-profile" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The pipeline then uses the median spatial profile to identify extraction
apertures for the source. The aperture centers can be identified
automatically by iteratively finding local maxima in the absolute value
of the spatial profile, or can be specified directly by the user.  By
default, a single aperture is expected and defined for nod-off-slit mode;
two apertures are expected for nod-along-slit mode.</p>
<p>The true position of the aperture center may vary somewhat
with wavelength, as a result of small optical effects or atmospheric
dispersion. To account for this variation, the pipeline attempts to
trace the spectrum across the array. It fits a Gaussian in the spatial
direction, centered at the specified position, at regular intervals in
wavelength. The centers of these fits are themselves fitted with a
low-order polynomial; the coefficients of these fits give the trace
coefficients that identify the center of the spectral aperture at each
wavelength. For extended sources, the continuum cannot generally be
directly traced. Instead, the pipeline fixes the aperture center to a
single spatial value.</p>
<p>Besides the aperture centers, the pipeline also specifies a PSF radius,
corresponding to the distance from the center at which the flux from the
source falls to zero. By default, this value is automatically determined from the
width of a Gaussian fit to the peak in the median spatial profile, as</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(R_{psf} = 2.15 \cdot \text{FWHM}\)</span>.</p>
</div></blockquote>
<p>For optimal extraction, the pipeline also identifies a smaller aperture
radius, to be used as the integration region:</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(R_{ap} = 0.7 \cdot \text{FWHM}\)</span>.</p>
</div></blockquote>
<p>This value should give close to optimal signal-to-noise for a Moffat or
Gaussian profile.  The pipeline also attempts to specify background regions
outside of any extraction apertures, for fitting and removing the residual
sky signal.  All aperture parameters may be optionally overridden by the
pipeline user.</p>
</section>
<section id="spectral-extraction-and-merging">
<h5>Spectral extraction and merging<a class="headerlink" href="#spectral-extraction-and-merging" title="Permalink to this heading">¶</a></h5>
<p>The spectral extraction algorithms used by the pipeline offer two
different extraction methods, depending on the nature of the target
source. For point sources, the pipeline uses an optimal extraction
algorithm, described at length in the Spextool paper (see the
<a class="reference internal" href="#flitecam-resources"><span class="std std-ref">Other Resources</span></a> section, below, for a reference).
For extended sources, the pipeline uses a standard summing extraction.</p>
<p>In either method, before extracting a spectrum, the pipeline first uses
any identified background regions to find the residual sky background
level. For each column in the 2D image, it fits a low-order
polynomial to the values in the specified regions, as a function of
slit position. This polynomial determines the wavelength-dependent
sky level (<span class="math notranslate nohighlight">\(B_{ij}\)</span>) to be subtracted from the spectrum
(<span class="math notranslate nohighlight">\(D_{ij}\)</span>).</p>
<p>The standard extraction method uses values from the spatial profile image
(<span class="math notranslate nohighlight">\(P_{ij}\)</span>) to replace bad pixels and outliers, then sums the flux
from all pixels contained within the PSF radius. The flux at column
<em>i</em> is then:</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(f_{i,\text{sum}} = \sum_{j=j_1}^{j_2}(D_{ij} - B_{ij})\)</span></p>
</div></blockquote>
<p>where <span class="math notranslate nohighlight">\(j_1\)</span> and <span class="math notranslate nohighlight">\(j_2\)</span> are the upper and lower limits of the extraction
aperture (in pixels):</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(j_1 = t_i - R_{PSF}\)</span></p>
<p><span class="math notranslate nohighlight">\(j_2 = t_i + R_{PSF}\)</span></p>
</div></blockquote>
<p>given the aperture trace center (<span class="math notranslate nohighlight">\(t_i\)</span>) at
that column. This extraction method is the only algorithm available
for extended sources.</p>
<p>Point sources may occasionally benefit from using standard extraction,
but optimal extraction generally produces higher signal-to-noise ratios
for these targets. This method works by weighting each pixel in the
extraction aperture by how much of the target’s flux it contains.
The pipeline first normalizes the spatial profile by the sum of the spatial
profile within the PSF radius defined by the user:</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(P_{ij}^{'} = P_{ij} \Big/ \sum_{j=j_1}^{j_2}P_{ij}\)</span>.</p>
</div></blockquote>
<p><span class="math notranslate nohighlight">\(P_{ij}^{'}\)</span> now represents the fraction of the total flux from
the target that is contained within pixel <em>(i,j)</em>, so that
<span class="math notranslate nohighlight">\((D_{ij} - B_{ij}) / P_{ij}^{'}\)</span> is a set of <em>j</em> independent
estimates of the total flux at column <em>i</em>. The pipeline does a weighted
average of these estimates, where the weight depends on the pixel’s
variance and the normalized profile value. Then, the flux at column <em>i</em> is:</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(f_{i,\text{opt}} = \frac{\sum_{j=j_3}^{j_4}{M_{ij}P_{ij}^{'}(D_{ij} - B_{ij}) \big/ (V_{D_{ij}} + V_{B_{ij}})}}{\sum_{j=j_3}^{j_4}{M_{ij}{P_{ij}^{'}}^{2} \big/ (V_{D_{ij}} + V_{B_{ij}})}}\)</span></p>
</div></blockquote>
<p>where <span class="math notranslate nohighlight">\(M_{ij}\)</span> is a bad pixel mask and <span class="math notranslate nohighlight">\(j_3\)</span>
and <span class="math notranslate nohighlight">\(j_4\)</span> are the upper and lower limits given by the aperture radius:</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(j_3 = t_i - R_{ap}\)</span></p>
<p><span class="math notranslate nohighlight">\(j_4 = t_i + R_{ap}\)</span></p>
</div></blockquote>
<p>Note that bad pixels are simply ignored, and outliers will have little
effect on the average because of the weighting scheme.</p>
<p>The variance for the standard spectroscopic extraction is a simple sum of the
variances in each pixel within the aperture. For the optimal extraction
algorithm, the variance on the <em>i</em>th pixel in the extracted spectrum
is calculated as:</p>
<div class="math notranslate nohighlight">
\[V_{i} = \sum_{j=j_3}^{j_4} \frac{M_{ij}}{{P_{ij}^{'}}^2 V_{ij}}\]</div>
<p>where <span class="math notranslate nohighlight">\(P_{ij}^{'}\)</span> is the scaled spatial profile, <span class="math notranslate nohighlight">\(M_{ij}\)</span> is
a bad pixel mask, <span class="math notranslate nohighlight">\(V_{ij}\)</span> is the variance at each background-subtracted
pixel, and the sum is over all spatial pixels <span class="math notranslate nohighlight">\(j\)</span> within the aperture
radius. The error spectrum for 1D spectra is the square root of the
variance.</p>
</section>
<section id="calibrate-flux-and-correct-for-atmospheric-transmission">
<span id="flitecam-spectral-calibration"></span><h5>Calibrate flux and correct for atmospheric transmission<a class="headerlink" href="#calibrate-flux-and-correct-for-atmospheric-transmission" title="Permalink to this heading">¶</a></h5>
<p>Extracted spectra are corrected individually for instrumental
response and atmospheric transmission, a process that yields a
flux-calibrated spectrum in units of Jy per pixel. See the
section on flux calibration, below, for more detailed information.</p>
<p>The rectified spectral images are also corrected for atmospheric transmission,
and calibrated to physical units in the same manner.  Each row of the image
is divided by the same correction as the 1D extracted spectrum.  This image
is suitable for custom extractions of extended fields: a sum over any number of
rows in the image produces a flux-calibrated spectrum of that region,
in the same units as the spectrum produced directly by the pipeline.</p>
<p>Note that the FITS header for the primary extension for this product
(PRODTYPE = ‘calibrated_spectrum’)
contains a full spatial and spectral WCS that can be used to identify
the coordinates of any spectra so extracted.  The primary WCS identifies
the spatial direction as arcseconds up the slit, but a secondary WCS
with key = ‘A’ identifies the RA, Dec, and wavelength of every pixel
in the image. <a class="footnote-reference brackets" href="#fn-flitecam-wcs" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>  Either can be extracted and used for pixel identification
with standard WCS manipulation packages, such as the
<a class="reference external" href="http://docs.astropy.org/en/stable/wcs/">astropy WCS package</a>.</p>
<p>After telluric correction, it is possible to apply a correction to the
calibrated wavelengths for the motion of the Earth relative to the solar
system barycenter at the time of the observation.  For FLITECAM resolutions,
we expect this wavelength shift to be a small fraction of a pixel, well within
the wavelength calibration error, so we do not directly apply it to the data.
The shift (as <span class="math notranslate nohighlight">\(d\lambda / \lambda\)</span>) is calculated and stored in the
header in the BARYSHFT keyword.  An additional wavelength correction to the
local standard of rest (LSR) from the barycentric velocity is also stored in
the header, in the LSRSHFT keyword.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-flitecam-wcs" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">4</a><span class="fn-bracket">]</span></span>
<p>The overall accuracy of the FLITECAM WCS in spectroscopic mode has
not been studied in detail.  In particular, for nod-along-slit data,
no attempt has been made to co-align positive and negative spectral
traces in the 2D spectral image.  The reference position for the
WCS may refer to one or neither of the spectral positions in the
rectified 2D image.</p>
</aside>
</aside>
</section>
<section id="combine-multiple-observations">
<h5>Combine multiple observations<a class="headerlink" href="#combine-multiple-observations" title="Permalink to this heading">¶</a></h5>
<p>The final pipeline step for most grism observation modes is
coaddition of multiple spectra of the same
source with the same instrument configuration and observation mode. The
individual extracted 1D spectra are combined with a robust weighted
mean, by default.  The 2D spectral images are also coadded, using the same
algorithm as for imaging coaddition, and the spatial/spectral WCS to project
the data into a common coordinate system.</p>
<p>Reductions of flux standards have an alternate final product
(see <a class="reference internal" href="#flitecam-response"><span class="std std-ref">Response spectra</span></a>, below).</p>
</section>
<section id="response-spectra">
<span id="flitecam-response"></span><h5>Response spectra<a class="headerlink" href="#response-spectra" title="Permalink to this heading">¶</a></h5>
<p>The final product of pipeline processing of telluric standards is not a
calibrated, combined spectrum, but rather an instrumental response
spectrum that may be used to calibrate science target spectra.  These
response spectra are generated from individual observations of
calibration sources by dividing the observed spectra by a model of the
source multiplied by an atmospheric model.  The resulting response
curves may then be combined with other response spectra from a flight
series to generate a final instrument response spectrum that is used in
calibrating science spectra.  See the flux calibration section, below,
for more information.</p>
</section>
</section>
</section>
<section id="other-resources">
<span id="flitecam-resources"></span><h3>Other Resources<a class="headerlink" href="#other-resources" title="Permalink to this heading">¶</a></h3>
<p>For more information on the instrument itself, see the FLITECAM paper:</p>
<blockquote>
<div><p><a class="reference external" href="http://adsabs.harvard.edu/abs/2006SPIE.6269E.168M">FLITECAM: a 1-5 micron camera and spectrometer for
SOFIA</a><em>, Ian
S.</em> McLean, et al. (2006, SPIE 6269E, 168).</p>
</div></blockquote>
<p>For more information on the algorithms used in spectroscopic
data reduction, see the Spextool papers:</p>
<blockquote>
<div><p><a class="reference external" href="http://irtfweb.ifa.hawaii.edu/~spex/Spextool.pdf">Spextool: A Spectral Extraction Package for SpeX, a 0.8-5.5 Micron
Cross-Dispersed
Spectrograph</a><em>,</em>
Michael C. Cushing, William D. Vacca and John T. Rayner (2004, PASP
116, 362).</p>
<p><a class="reference external" href="http://irtfweb.ifa.hawaii.edu/~spex/Telluric.pdf">A Method of Correcting Near-Infrared Spectra for Telluric
Absorption</a><em>,</em>
William D. Vacca, Michael C. Cushing and John T. Rayner (2003, PASP
115, 389).</p>
<p><a class="reference external" href="http://irtfweb.ifa.hawaii.edu/~spex/Nonlinearity.pdf">Nonlinearity Corrections and Statistical Uncertainties Associated
with Near-Infrared
Arrays</a><em>,</em>
William D. Vacca, Michael C. Cushing and John T. Rayner  (2004, PASP
116, 352).</p>
</div></blockquote>
</section>
</section>
<section id="flux-calibration">
<h2>Flux calibration<a class="headerlink" href="#flux-calibration" title="Permalink to this heading">¶</a></h2>
<section id="imaging-flux-calibration">
<h3>Imaging Flux Calibration<a class="headerlink" href="#imaging-flux-calibration" title="Permalink to this heading">¶</a></h3>
<p>The reduction process, up through image coaddition, generates Level 2
images with data values in units of counts per second (ct/s).
After Level 2 imaging products are generated, the pipeline derives the
flux calibration factors (in units of ct/s/Jy) and applies them to
each image. The calibration factors are derived for each FLITECAM filter
configuration from observations of calibrator stars.</p>
<p>After the calibration factors have been derived, the coadded flux
is divided by the appropriate factor to produce the Level 3 calibrated
data file, with flux in units of Jy/pixel.  The value used is stored in
the FITS keyword CALFCTR.</p>
<section id="reduction-steps">
<h4>Reduction steps<a class="headerlink" href="#reduction-steps" title="Permalink to this heading">¶</a></h4>
<p>The calibration is carried out in several steps. The first step consists
of measuring the photometry of all the standard stars for a specific
mission or flight series, after the images have been corrected for the
atmospheric transmission relative to that for a reference altitude and
zenith angle <a class="footnote-reference brackets" href="#fn-flitecam-atran" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>. The pipeline performs aperture photometry on the
reduced Level 2 images of the standard stars after the registration
stage using a photometric aperture radius of 12 pixels. The telluric-corrected
photometry of the standard star is related to the measured photometry of the star via</p>
<div class="math notranslate nohighlight">
\[N_{e}^{std,corr} = N_{e}^{std} \frac{R_{\lambda}^{ref}}{R_{\lambda}^{std}}\]</div>
<p>where the ratio <span class="math notranslate nohighlight">\(R_{\lambda}^{ref} / R_{\lambda}^{std}\)</span>
accounts for differences in system response (atmospheric transmission)
between the actual observations and those for the reference altitude of
41000 feet and a telescope elevation of 45<span class="math notranslate nohighlight">\(^\circ\)</span>. Similarly, for the science
target, we have</p>
<div class="math notranslate nohighlight">
\[N_{e}^{obj,corr} = N_{e}^{obj} \frac{R_{\lambda}^{ref}}{R_{\lambda}^{obj}}\]</div>
<p>Calibration factors (in ct/s/Jy) for each filter are then derived from
the measured photometry (in ct/s) and the known fluxes of the standards
(in Jy) in each filter. These predicted fluxes were computed by
multiplying a model stellar spectrum by the overall filter + instrument
+ telescope + atmosphere (at the reference altitude and zenith angle)
response curve and integrating over the filter passband to compute the
mean flux in the band. The adopted filter throughput curves are those
provided by the vendor. The instrument throughput is calculated by
multiplying an estimate of the instrumental optics transmission(0.80)
and the detector quantum efficiency (0.56). The FLITECAM overall
throughput is (0.285). The telescope throughput value is assumed to be
constant (0.85) across the entire FLITECAM wavelength range.</p>
<p>Photometric standards for FLITECAM have been chosen from three
sources: (1) bright stars with spectral classifications of A0V as
listed in SIMBAD; (2) Landolt SA stars (K giants and A0-4 main sequence
stars) listed as ‘supertemplate’ stars in Cohen et al. (2003); K giant stars
listed as ‘spectral template’ stars in Cohen et al. (1999). For all of these
objects, models are either available (from the Cohen papers) or
derivable (from a model of Vega for the A0V stars). Use of the A0V stars
requires scaling the Vega model to the observed magnitudes of the target
and reddening the model to match the observed color excess of the target.
It should be noted that A0V stars should be used to calibrate the Pa alpha
filter, as these objects have a strong absorption feature in this band.
The models of the spectral template K giants listed
in Cohen et al. (1999) extend down only to 1.2 microns, and therefore
cannot be used to calibrate the J band filter.</p>
<p>The calibration factor, <em>C</em>, is computed from</p>
<div class="math notranslate nohighlight">
\[C = \frac{N_e^{std,corr}}{F_{\nu}^{nom,std}(\lambda_{ref})} = \frac{N_e^{std,corr}}{\langle F_{\nu}^{std} \rangle} \frac{\lambda^2_{piv}}{\langle \lambda \rangle \lambda_{ref}}\]</div>
<p>with an uncertainty given by</p>
<div class="math notranslate nohighlight">
\[\bigg( \frac{\sigma_C}{C} \bigg)^2 = \bigg( \frac{\sigma_{N_e^{std}}}{N_e^{std}} \bigg)^2 + \bigg( \frac{\sigma_{\langle F_{\nu}^{std} \rangle}}{\langle F_{\nu}^{std} \rangle} \bigg)^2 .\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\lambda_{piv}\)</span> is the pivot wavelength of the filter, and <span class="math notranslate nohighlight">\(\langle \lambda \rangle\)</span> is
the mean wavelength of the filter. The calibration factor refers to a
nominal flat spectrum source at the reference
wavelength <span class="math notranslate nohighlight">\(\lambda_{ref}\)</span>.</p>
<p>The calibration factors derived from each standard for each filter are
then averaged. The pipeline inserts this value and its associated
uncertainty into the headers of the Level 2 data files for the flux
standards, and uses the value to produce calibrated flux standards.
The final step involves examining the calibration values and
ensuring that the values are consistent. Outlier values may come from
bad observations of a standard star; these values are removed to produce
a robust average of the calibration factor across the flight series. The
resulting average values are then used to calibrate the observations of
the science targets.</p>
<p>Using the telluric-corrected photometry of the standard,
<span class="math notranslate nohighlight">\(N_e^{std,corr}\)</span> (in ct/s), and the predicted mean fluxes
of the standards in each filter, <span class="math notranslate nohighlight">\(\langle F_{\nu}^{std} \rangle\)</span>
(in Jy), the flux of a target object is given by</p>
<div class="math notranslate nohighlight">
\[F_{\nu}^{nom,obj}(\lambda_{ref}) = \frac{N_e^{obj,corr}}{C}\]</div>
<p>where <span class="math notranslate nohighlight">\(N_e^{obj,corr}\)</span> is the telluric-corrected count
rate in ct/s detected from the source, <span class="math notranslate nohighlight">\(C\)</span> is the
calibration factor (ct/s/Jy), and
<span class="math notranslate nohighlight">\(F_{\nu}^{nom,obj}(\lambda_{ref})\)</span> is the flux in Jy of a
nominal, flat spectrum source (for which <span class="math notranslate nohighlight">\(F_{\nu} \sim \nu^{-1}\)</span>)
at a reference wavelength <span class="math notranslate nohighlight">\(\lambda_{ref}\)</span>.</p>
<p>The values of <span class="math notranslate nohighlight">\(C\)</span>, <span class="math notranslate nohighlight">\(\sigma_C\)</span>, and <span class="math notranslate nohighlight">\(\lambda_{ref}\)</span> are written into
the headers of the calibrated (PROCSTAT=LEVEL_3 ) data as the keywords CALFCTR, ERRCALF, and
LAMREF, respectively. The reference wavelength <span class="math notranslate nohighlight">\(\lambda_{ref}\)</span> for these
observations was taken to be the mean wavelengths of the filters,
<span class="math notranslate nohighlight">\(\langle \lambda \rangle\)</span>.</p>
<p>Note that <span class="math notranslate nohighlight">\(\sigma_C\)</span>, as stored in the ERRCALF value,
is derived from the standard deviation of the calibration factors
across multiple flights.  These values are typically on the order of
about 6%.  There is an additional systematic
uncertainty on the stellar models, which is on the order of
3-6%.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-flitecam-atran" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">5</a><span class="fn-bracket">]</span></span>
<p>The atmospheric transmission in each filter has been computed using
the ATRAN code (Lord 1992) for a range of observatory altitudes
(corresponding to a range of overhead precipitable water vapor
values) and telescope elevations. The ratio of the transmission at
each altitude and zenith angle relative to that at the reference
altitude (41000 feet) and zenith angle (45 degrees) has been
calculated for each filter and fit with a low order polynomial. The
ratio appropriate for the altitude and zenith angle of each
observation is calculated and applied to each image.</p>
</aside>
</aside>
</section>
<section id="color-corrections">
<h4>Color corrections<a class="headerlink" href="#color-corrections" title="Permalink to this heading">¶</a></h4>
<p>An observer often wishes to determine the true flux of an object at the
reference wavelength, <span class="math notranslate nohighlight">\(F_{\nu}^{obj}(\lambda_{ref})\)</span>, rather
than the flux of an equivalent nominal, flat spectrum source. To do
this, we define a color correction <em>K</em> such that</p>
<div class="math notranslate nohighlight">
\[K = \frac{F_{\nu}^{nom,obj}(\lambda_{ref})}{F_{\nu}^{obj}(\lambda_{ref})}\]</div>
<p>where <span class="math notranslate nohighlight">\(F_{\nu}^{nom,obj}(\lambda_{ref})\)</span> is the flux density
obtained by measurement on a data product. Divide the measured
values by <em>K</em> to obtain the “true” flux density. In terms of the
wavelengths defined above,</p>
<div class="math notranslate nohighlight">
\[K = \frac{\langle \lambda \rangle \lambda_{ref}}{\lambda_{piv}^2}\frac{\langle F_{\nu}^{obj} \rangle}{F_{\nu}^{obj}(\lambda_{ref})} .\]</div>
<p>For most filters and spectral shapes, the color corrections are small
(&lt;10%). Tables listing <em>K</em> values and filter wavelengths are available
from the <a class="reference external" href="https://www.sofia.usra.edu/science/proposing-and-observing/data-products">SOFIA website</a>.</p>
</section>
</section>
<section id="spectrophotometric-flux-calibration">
<h3>Spectrophotometric Flux Calibration<a class="headerlink" href="#spectrophotometric-flux-calibration" title="Permalink to this heading">¶</a></h3>
<p>The common approach to characterizing atmospheric transmission for
ground-based infrared spectroscopy is to obtain, for every science
target, similar observations of a spectroscopic standard source with as
close a match as possible in both airmass and time. Such an approach is
not practical for airborne observations, as it imposes too heavy a
burden on flight planning and lowers the efficiency of science
observations. Therefore, we employ a calibration plan that incorporates
a few observations of a calibration star per flight and a model of the
atmospheric absorption for the approximate altitude and airmass (and
precipitable water vapor, if known) at which the science objects were
observed.</p>
<p>Instrumental response curves are generated from the extracted spectra of
calibrator targets, typically A0V stars with stellar models constructed
from a model of Vega. The
extracted spectra are corrected for telluric absorption using the ATRAN
models corresponding to the altitude and zenith angle of the calibrator
observations, smoothed to the nominal resolution for the grism/slit
combination, and sampled at the observed spectral binning. The
telluric-corrected spectra are then divided by the appropriate models to
generate response curves (with units of ct/s/Jy at each wavelength) for
each grism passband. The response curves
derived from the various calibrators for each instrumental combination
are then combined and smoothed to generate a set of master instrumental
response curves. The statistical uncertainties on these response curves
are on the order of 5-10%.</p>
<p>Flux calibration of FLITECAM grism data for a science target is
currently carried out in a two-step process:</p>
<ol class="arabic simple">
<li><p>For any given observation of a science target, the closest telluric
model (in terms of altitude and airmass of the target observations)
is selected and then smoothed to the observed resolution and sampled
at the observed spectral binning. The observed spectrum is then
divided by the smoothed and re-sampled telluric model.</p></li>
<li><p>The telluric-corrected spectrum is then divided by a response
function corresponding to the observed instrument mode to convert
DN/s to Jy at each pixel.</p></li>
</ol>
<p>In order to account for any wavelength shifts between the models and
the observations, an optimal shift is estimated by minimizing the
residuals of the corrected spectrum, with respect to small relative
wavelength shifts between the observed data and the telluric
spectrum.  This wavelength shift is applied to the data before dividing
by the telluric model and response function.</p>
<p>Based on our experience with FORCAST calibration, and with using A0V
stars to calibrate near-infrared data, we expect the overall error in
the flux calibration to be about 10-20%. However, the uncertainty on the
slope of the calibrated spectrum should be substantially less than that,
on the order of a few percent (see e.g., Cushing et al. 2005; Rayner et
al. 2009). The Level 3 data product for any grism includes the
calibrated spectrum and an error spectrum that incorporates these RMS
values. The adopted telluric absorption model and the
instrumental response functions are also provided in the output product.</p>
<p>As for any slit spectrograph, highly accurate absolute flux levels from
FLITECAM grism observations (for absolute spectrophotometry, for
example) require additional photometric observations to correct the
calibrated spectra for slit losses that can be variable (due to varying
image quality) between the spectroscopic observations of the science
target and the calibration standard.</p>
</section>
</section>
<section id="data-products">
<h2>Data products<a class="headerlink" href="#data-products" title="Permalink to this heading">¶</a></h2>
<section id="filenames">
<h3>Filenames<a class="headerlink" href="#filenames" title="Permalink to this heading">¶</a></h3>
<p>FLITECAM output files from Redux are named according to the convention:</p>
<blockquote>
<div><p>FILENAME = <em>F[flight]_FC_IMA|GRI_AOR-ID_SPECTEL1_Type_FN1[-FN2]</em>.fits</p>
</div></blockquote>
<p>where flight is the SOFIA flight number, FC is the instrument
identifier, IMA or GRI specifies that it is an imaging or grism file,
AOR-ID is the AOR identifier for the observation, SPECTEL1 is the
keywords specifying the filter or grism used,
Type is three letters identifying the product type (listed in
<a class="reference internal" href="#flitecam-img-prod"><span class="std std-numref">Table 9</span></a> and <a class="reference internal" href="#flitecam-gri-prod"><span class="std std-numref">Table 10</span></a> below),
and FN1 is the file number corresponding to the input file.
FN1-FN2 is used if there are multiple input files for a single output
file, where FN1 is the file number of the first input file and FN2 is
the file number of the last input file.</p>
</section>
<section id="pipeline-products">
<h3>Pipeline Products<a class="headerlink" href="#pipeline-products" title="Permalink to this heading">¶</a></h3>
<p>The following tables list all intermediate products generated by
the pipeline for imaging and grism modes, in the order in which they
are produced. <a class="footnote-reference brackets" href="#fn-flitecam-pipeprod" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a>  The product type
is stored in the FITS headers under the keyword PRODTYPE. By default,
for imaging, the <em>flat</em>, <em>telluric_corrected</em>, <em>coadded</em>, and <em>calibrated</em>
products are saved. For spectroscopy, the <em>spectral_image</em>,
<em>rectified_image</em>, <em>spectra</em>, <em>spectra_1d</em>, <em>calibrated_spectrum</em>,
<em>coadded_spectrum</em>, and <em>combined_spectrum</em> products are saved.</p>
<p>The final grism mode output product from the Combine Spectra or Combine Response
steps are dependent on the input data: for OBSTYPE=STANDARD_TELLURIC, the
<em>instrument_response</em> is produced instead of a <em>coadded_spectrum</em> and <em>combined_spectrum</em>.</p>
<p>For most observation modes, the pipeline additionally produces an image in PNG
format, intended to provide a quick-look preview of the data contained in
the final product.  These auxiliary products may be distributed to observers
separately from the FITS file products.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-flitecam-pipeprod" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">6</a><span class="fn-bracket">]</span></span>
<p>Earlier versions of this pipeline (before v2.0.0) produced different
sets of default products.  Refer to earlier revisions of this manual
for complete information.</p>
</aside>
</aside>
<table class="longtable docutils align-default" id="flitecam-img-prod">
<caption><span class="caption-number">Table 9 </span><span class="caption-text">Intermediate and final data products for imaging reductions</span><a class="headerlink" href="#flitecam-img-prod" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 16.9%" />
<col style="width: 11.9%" />
<col style="width: 15.3%" />
<col style="width: 15.3%" />
<col style="width: 8.5%" />
<col style="width: 10.2%" />
<col style="width: 22.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line"><strong>Step</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>Data type</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>PRODTYPE</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>PROCSTAT</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>Code</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>Saved</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>Extensions</strong></div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">Correct Nonlinearity</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">linearized</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LNZ</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, BADMASK</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Clip Image</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">clipped</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">CLP</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR,</div>
<div class="line">BADMASK, EXPOSURE</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Make Flat</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">flat</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLT</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR,</div>
<div class="line">BADMASK, EXPOSURE</div>
<div class="line">FLAT, FLAT_ERROR,</div>
<div class="line">FLAT_BADMASK</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Correct Gain</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">gain_</div>
<div class="line">corrected</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">GCR</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR,</div>
<div class="line">BADMASK, EXPOSURE</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Subtract Sky</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">background_</div>
<div class="line">subtracted</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">BGS</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR,</div>
<div class="line">BADMASK, EXPOSURE</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Register</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">registered</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">REG</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR,</div>
<div class="line">BADMASK, EXPOSURE</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Telluric Correct</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">telluric_</div>
<div class="line">corrected</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">TEL</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR,</div>
<div class="line">BADMASK, EXPOSURE</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Coadd</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">coadded</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">COA</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, EXPOSURE</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Flux Calibrate</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">calibrated</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_3</div>
</div>
</td>
<td><div class="line-block">
<div class="line">CAL</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, EXPOSURE</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Mosaic</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">mosaic</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_4</div>
</div>
</td>
<td><div class="line-block">
<div class="line">MOS</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, EXPOSURE</div>
</div>
</td>
</tr>
</tbody>
</table>
<table class="longtable docutils align-default" id="flitecam-gri-prod">
<caption><span class="caption-number">Table 10 </span><span class="caption-text">Intermediate and final data products for spectroscopy reduction</span><a class="headerlink" href="#flitecam-gri-prod" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 16.8%" />
<col style="width: 11.8%" />
<col style="width: 15.1%" />
<col style="width: 15.1%" />
<col style="width: 8.4%" />
<col style="width: 10.1%" />
<col style="width: 22.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line"><strong>Step</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>Data type</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>PRODTYPE</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>PROCSTAT</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>Code</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>Saved</strong></div>
</div>
</th>
<th class="head"><div class="line-block">
<div class="line"><strong>Extensions</strong></div>
</div>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">Correct Nonlinearity</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">linearized</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LNZ</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, BADMASK</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Make Spectral Image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">spectral_</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">IMG</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Stack Dithers</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">dithers_</div>
<div class="line">stacked</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SKD</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Make Profiles</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">rectified_</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">RIM</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, BADMASK,</div>
<div class="line">WAVEPOS, SLITPOS,</div>
<div class="line">SPATIAL_MAP,</div>
<div class="line">SPATIAL_PROFILE</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Locate Apertures</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">apertures_</div>
<div class="line">located</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LOC</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, BADMASK,</div>
<div class="line">WAVEPOS, SLITPOS,</div>
<div class="line">SPATIAL_MAP,</div>
<div class="line">SPATIAL_PROFILE</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Trace Continuum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">continuum_</div>
<div class="line">traced</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">TRC</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, BADMASK,</div>
<div class="line">WAVEPOS, SLITPOS,</div>
<div class="line">SPATIAL_MAP,</div>
<div class="line">SPATIAL_PROFILE,</div>
<div class="line">APERTURE_TRACE</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Set Apertures</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">apertures_set</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">APS</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, BADMASK,</div>
<div class="line">WAVEPOS, SLITPOS,</div>
<div class="line">SPATIAL_MAP,</div>
<div class="line">SPATIAL_PROFILE,</div>
<div class="line">APERTURE_TRACE,</div>
<div class="line">APERTURE_MASK</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Subtract</div>
<div class="line">Background</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">background_</div>
<div class="line">subtracted</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">BGS</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, BADMASK,</div>
<div class="line">WAVEPOS, SLITPOS,</div>
<div class="line">SPATIAL_MAP,</div>
<div class="line">SPATIAL_PROFILE,</div>
<div class="line">APERTURE_TRACE,</div>
<div class="line">APERTURE_MASK</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Extract Spectra</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image;</div>
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">spectra</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SPM</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, BADMASK,</div>
<div class="line">WAVEPOS, SLITPOS,</div>
<div class="line">SPATIAL_MAP,</div>
<div class="line">SPATIAL_PROFILE,</div>
<div class="line">APERTURE_TRACE,</div>
<div class="line">APERTURE_MASK,</div>
<div class="line">SPECTRAL_FLUX,</div>
<div class="line">SPECTRAL_ERROR,</div>
<div class="line">TRANSMISSION</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Extract Spectra</div>
</div>
</td>
<td><div class="line-block">
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">spectra_1d</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_3</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SPC</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Calibrate Flux</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image;</div>
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">calibrated_</div>
<div class="line">spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_3</div>
</div>
</td>
<td><div class="line-block">
<div class="line">CRM</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, BADMASK,</div>
<div class="line">WAVEPOS, SLITPOS,</div>
<div class="line">SPATIAL_MAP,</div>
<div class="line">SPATIAL_PROFILE,</div>
<div class="line">APERTURE_TRACE,</div>
<div class="line">APERTURE_MASK,</div>
<div class="line">SPECTRAL_FLUX,</div>
<div class="line">SPECTRAL_ERROR</div>
<div class="line">TRANSMISSION,</div>
<div class="line">RESPONSE,</div>
<div class="line">RESPONSE_ERROR</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Combine Spectra</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image;</div>
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">coadded_</div>
<div class="line">spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_3</div>
</div>
</td>
<td><div class="line-block">
<div class="line">COA</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR,</div>
<div class="line">EXPOSURE, WAVEPOS,</div>
<div class="line">SPECTRAL_FLUX,</div>
<div class="line">SPECTRAL_ERROR</div>
<div class="line">TRANSMISSION,</div>
<div class="line">RESPONSE</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Combine Spectra</div>
</div>
</td>
<td><div class="line-block">
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">combined_</div>
<div class="line">spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_3</div>
</div>
</td>
<td><div class="line-block">
<div class="line">CMB</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Make Response</div>
</div>
</td>
<td><div class="line-block">
<div class="line">1D response</div>
<div class="line">spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">response_</div>
<div class="line">spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_3</div>
</div>
</td>
<td><div class="line-block">
<div class="line">RSP</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Combine Response</div>
</div>
</td>
<td><div class="line-block">
<div class="line">1D response</div>
<div class="line">spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">instrument_</div>
<div class="line">response</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_4</div>
</div>
</td>
<td><div class="line-block">
<div class="line">IRS</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX</div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="data-format">
<h3>Data Format<a class="headerlink" href="#data-format" title="Permalink to this heading">¶</a></h3>
<p>All files produced by the pipeline are multi-extension FITS
files (except for the <em>combined_spectrum</em>, <em>response_spectrum</em>, and
<em>instrument_response</em> products: see below). <a class="footnote-reference brackets" href="#fn-flitecam-dataprod" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a>
The flux image is stored in the primary
header-data unit (HDU); its associated error image is stored in extension
1, with EXTNAME=ERROR.</p>
<p>Imaging products may additionally contain an extension with EXTNAME=EXPOSURE,
which contains the nominal exposure time at each pixel, in seconds.  This
extension has the same meaning for the spectroscopic <em>coadded_spectrum</em> product.</p>
<p>In spectroscopic products, the SLITPOS and WAVEPOS extensions give the
spatial (rows) and spectral (columns) coordinates, respectively, for
rectified images.  These coordinates may also be derived from the WCS
in the primary header.  WAVEPOS also indicates the wavelength coordinates
for 1D extracted spectra.</p>
<p>Intermediate spectral products may contain SPATIAL_MAP and SPATIAL_PROFILE
extensions.  These contain the spatial map and median spatial profile,
described in the <a class="reference internal" href="#flitecam-rectify-image"><span class="std std-ref">Rectify spectral image</span></a> section, above.  They may also contain
APERTURE_TRACE and APERTURE_MASK extensions.  These contain the spectral aperture
definitions, as described in the <a class="reference internal" href="#flitecam-set-apertures"><span class="std std-ref">Identify apertures</span></a> section.</p>
<p>Final spectral products contain SPECTRAL_FLUX and SPECTRAL_ERROR extensions:
these are the extracted 1D spectrum and associated uncertainty.  They
also contain TRANSMISSION and RESPONSE extensions, containing the atmospheric
transmission and instrumental response spectra used to calibrate the spectrum
(see the <a class="reference internal" href="#flitecam-spectral-calibration"><span class="std std-ref">Calibrate flux and correct for atmospheric transmission</span></a> section).</p>
<p>The <em>combined_spectrum</em>, <em>response_spectrum</em>, and <em>instrument_response</em>
are one-dimensional spectra, stored in Spextool format, as rows of data in
the primary extension.</p>
<p>For the <em>combined_spectrum</em>, the first row is the wavelength (um), the second
is the flux (Jy), the third is the error (Jy), the fourth is
the estimated fractional atmospheric transmission spectrum, and the fifth
is the instrumental response curve used in flux calibration (ct/s/Jy).
These rows correspond directly to the WAVEPOS, SPECTRAL_FLUX, SPECTRAL_ERROR,
TRANSMISSION, and RESPONSE extensions in the <em>coadded_spectrum</em> product.</p>
<p>For the <em>response_spectrum</em>, generated from telluric standard observations,
the first row is the wavelength (um), the second is the response spectrum
(ct/s/Jy), the third is the error on the response (ct/s/Jy),
the fourth is the atmospheric transmission spectrum (unitless), and the
fifth is the standard model used to derive the response (Jy).
The <em>instrument_reponse</em> spectrum, generated from combined
<em>response_spectrum</em> files, similarly has wavelength (um), response (ct/s/Jy),
error (ct/s/Jy), and transmission (unitless) rows.</p>
<p>The final uncertainties in calibrated images and spectra contain
only the estimated statistical uncertainties due to the noise in the
image or the extracted spectrum. The systematic uncertainties due to the
calibration process are recorded in header keywords. For imaging data,
the error on the calibration factor is recorded in the keyword ERRCALF.
For grism data, the estimated overall fractional error on the flux is
recorded in the keyword CALERR. <a class="footnote-reference brackets" href="#fn-flitecam-calerr" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a></p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-flitecam-dataprod" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">7</a><span class="fn-bracket">]</span></span>
<p>In earlier versions of this pipeline (prior to 2.0.0), all image products
were 3D arrays of data, where the first plane was the image and the
second plane was the error associated with
each pixel in the image. An optional third plane was the bad pixel mask,
indicating the location of bad pixels.  All spectral products were
in the Spextool format described above for the <em>combined_spectrum</em> product.</p>
</aside>
<aside class="footnote brackets" id="fn-flitecam-calerr" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">8</a><span class="fn-bracket">]</span></span>
<p>Earlier versions of this pipeline (prior to 2.0.0) may have stored the
systematic calibration error in the error spectrum or variance image,
added in quadrature with the statistical error. Check PIPEVERS and
compare the error estimates for the calibrated products to earlier
products to ensure correct interpretation of the error estimates.</p>
</aside>
</aside>
</section>
</section>
<section id="grouping-level-1-data-for-processing">
<h2>Grouping LEVEL_1 data for processing<a class="headerlink" href="#grouping-level-1-data-for-processing" title="Permalink to this heading">¶</a></h2>
<p>For both imaging and grism mode for FLITECAM, there are two possible
kinds of input data: sky frames and sources. Sky frames have OBSTYPE = SKY,
while source frames may have OBSTYPE = OBJECT, STANDARD_FLUX, or
STANDARD_TELLURIC.  The sky frames and source frames should all share
the same instrument configuration and filters.  Optionally, it may also be
useful to separate out data files taken from different missions,
observation plans, or AOR-IDs.</p>
<p>These grouping requirements translate into a set of FITS keywords that
must match in order for a set of data to be grouped together. These
relationships are summarized in the tables below.</p>
<p>Note that data grouping must be carried out before the pipeline is run.
The pipeline expects all inputs to be reduced together as a single data
set.</p>
<table class="docutils align-default" id="flitecam-img-group">
<caption><span class="caption-number">Table 11 </span><span class="caption-text">Grouping Criteria: Imaging</span><a class="headerlink" href="#flitecam-img-group" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Keyword</strong></p></th>
<th class="head"><p><strong>Data Type</strong></p></th>
<th class="head"><p><strong>Match Criterion</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>OBSTYPE</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact (unless SKY)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>OBJECT</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>INSTCFG</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>INSTMODE</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>SPECTEL1</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>MISSN-ID (optional)</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>PLANID (optional)</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>AOR_ID (optional)</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="flitecam-spec-group">
<caption><span class="caption-number">Table 12 </span><span class="caption-text">Grouping Criteria: Spectroscopy</span><a class="headerlink" href="#flitecam-spec-group" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Keyword</strong></p></th>
<th class="head"><p><strong>Data Type</strong></p></th>
<th class="head"><p><strong>Match Criterion</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>OBSTYPE</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact (unless SKY)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>OBJECT</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>INSTCFG</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>INSTMODE</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>SPECTEL1</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>SPECTEL2</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>MISSN-ID (optional)</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>PLANID (optional)</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>AOR_ID (optional)</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
</tbody>
</table>
</section>
<section id="configuration-and-execution">
<h2>Configuration and execution<a class="headerlink" href="#configuration-and-execution" title="Permalink to this heading">¶</a></h2>
<section id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h3>
<p>The FLITECAM pipeline is written entirely in Python.  The pipeline is
platform independent and has been tested on Linux, Mac OS X, and Windows
operating systems.  Running the pipeline requires a minimum of 16GB RAM,
or equivalent-sized swap file.</p>
<p>The pipeline is comprised of six modules within the <code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux</span></code> package:
<code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.instruments.flitecam</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.instruments.forcast</span></code>,
<code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.pipeline</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.calibration</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.spectroscopy</span></code>,
<code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.toolkit</span></code>, and <code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.visualization</span></code>.
The <code class="xref py py-obj docutils literal notranslate"><span class="pre">flitecam</span></code> module provides the data processing
algorithms specific to FLITECAM, with supporting libraries from the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">forcast</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">toolkit</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">calibration</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">spectroscopy</span></code>, and <code class="xref py py-obj docutils literal notranslate"><span class="pre">visualization</span></code>
modules.  The <code class="xref py py-obj docutils literal notranslate"><span class="pre">pipeline</span></code> module provides interactive and batch interfaces
to the pipeline algorithms.</p>
<section id="external-requirements">
<h4>External Requirements<a class="headerlink" href="#external-requirements" title="Permalink to this heading">¶</a></h4>
<p>To run the pipeline for any mode, Python 3.8 or
higher is required, as well as the following packages: numpy, scipy,
matplotlib, pandas, astropy, configobj, numba, bottleneck, joblib,
and photutils.
Some display functions for the graphical user interface (GUI)
additionally require the PyQt5, pyds9, and regions packages.
All required external packages are available to install via the
pip or conda package managers.  See the Anaconda environment file
(environment.yml), or the pip requirements file (requirements.txt)
distributed with <code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux</span></code> for up-to-date version requirements.</p>
<p>Running the pipeline interactively also requires an installation of
SAO DS9 for FITS image display. See <a class="reference external" href="http://ds9.si.edu/">http://ds9.si.edu/</a> for download
and installation instructions.  The <em>ds9</em> executable
must be available in the PATH environment variable for the pyds9
interface to be able to find and control it.  Please note that pyds9
is not available on the Windows platform.</p>
</section>
<section id="source-code-installation">
<h4>Source Code Installation<a class="headerlink" href="#source-code-installation" title="Permalink to this heading">¶</a></h4>
<p>The source code for the FLITECAM pipeline maintained by the SOFIA Data
Processing Systems (DPS) team can be obtained directly from the
DPS, or from the external <a class="reference external" href="https://github.com/SOFIA-USRA/sofia_redux">GitHub repository</a>.
This repository contains all needed configuration
files, auxiliary files, and Python code to run the pipeline on FLITECAM
data in any observation mode.</p>
<p>After obtaining the source code, install the package with
the command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>python setup.py install
</pre></div>
</div>
<p>from the top-level directory.</p>
<p>Alternately, a development installation may be performed from inside the
directory with the command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pip install -e .
</pre></div>
</div>
<p>After installation, the top-level pipeline interface commands should
be available in the PATH.  Typing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux
</pre></div>
</div>
<p>from the command line should launch the GUI interface, and:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux_pipe -h
</pre></div>
</div>
<p>should display a brief help message for the command line interface.</p>
</section>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading">¶</a></h3>
<p>For FLITECAM algorithms, default parameter values are defined by the
Redux object that interfaces to them. These values may be overridden
manually for each step, while running in interactive mode. They may also
be overridden by an input parameter file, in INI format, in either
interactive or automatic mode. See Appendix A for an example of an input
parameter file, which contains the current defaults for all parameters.</p>
</section>
<section id="input-data">
<h3>Input data<a class="headerlink" href="#input-data" title="Permalink to this heading">¶</a></h3>
<p>Redux takes as input raw FLITECAM FITS data files containing 1024x1024
pixel image arrays. The FITS headers contain data acquisition and
observation parameters and, combined with the pipeline configuration
files, comprise the information necessary to complete all steps of the
data reduction process. Some critical keywords are required to be
present in the raw data in order to perform a successful grouping,
reduction, and ingestion into the SOFIA archive. See Appendix B for a
description of these keywords.</p>
<p>It is assumed that the input data have been successfully grouped before
beginning reduction: Redux considers all input files in a reduction to
be part of a single homogeneous reduction group, to be reduced together
with the same parameters. As such, when the
pipeline reads a raw FLITECAM data file, it uses the first input file to
identify the observing mode used. Given this information, it identifies
a set of auxiliary and calibration data files to be used in the
reduction (<a class="reference internal" href="#flitecam-auxiliary"><span class="std std-numref">Table 13</span></a>). The default files to be used are defined in a
lookup table that reads the DATE-OBS keyword from the raw file, and then
chooses the appropriate calibrations for that date.</p>
<table class="docutils align-default" id="flitecam-auxiliary">
<caption><span class="caption-number">Table 13 </span><span class="caption-text">Auxiliary files</span><a class="headerlink" href="#flitecam-auxiliary" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Auxiliary data file</strong></p></th>
<th class="head"><p><strong>Data type</strong></p></th>
<th class="head"><p><strong>Comments</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Keyword definition file</p>
<p>(e.g. header_req_ima.cfg)</p>
</td>
<td><p>INI</p></td>
<td><p>Contains the definition of required keywords, with allowed value ranges</p></td>
</tr>
<tr class="row-odd"><td><p>Linearity coefficients file</p>
<p>(e.g. lc_coeffs_20140325.fits)</p>
</td>
<td><p>FITS</p></td>
<td><p>FITS file containing linearity correction coefficients for all pixels in the raw data array</p></td>
</tr>
<tr class="row-even"><td><p>Reference flux calibration table</p>
<p>(e.g. refcalfac_20171007.txt)</p>
</td>
<td><p>ASCII</p></td>
<td><p>Flux calibration factors (imaging only)</p></td>
</tr>
<tr class="row-odd"><td><p>Spectral order definition file</p>
<p>(e.g. flat_kla_multinight.fits)</p>
</td>
<td><p>FITS</p></td>
<td><p>Image file containing flat data and an edge mask for a spectral order (grism only)</p></td>
</tr>
<tr class="row-even"><td><p>Wavelength calibration map</p>
<p>(e.g. kla_map_arcs.fits)</p>
</td>
<td><p>FITS</p></td>
<td><p>Two-frame image associating a wavelength value and a spatial distance across the slit with each pixel (grism only)</p></td>
</tr>
<tr class="row-odd"><td><p>Atmospheric transmission curve</p>
<p>(e.g. atran_41K_45deg_1-6mum.fits)</p>
</td>
<td><p>FITS</p></td>
<td><p>A FITS image with wavelength and transmission values for a particular altitude and zenith angle (grism only)</p></td>
</tr>
<tr class="row-even"><td><p>Instrumental response curve</p>
<p>(e.g. FC_GRI_A2KL_SS20_RSP.fits)</p>
</td>
<td><p>FITS</p></td>
<td><p>FITS image containing the response at each wavelength for a particular grism/slit mode (grism only)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="automatic-mode-execution">
<h3>Automatic Mode Execution<a class="headerlink" href="#automatic-mode-execution" title="Permalink to this heading">¶</a></h3>
<p>The DPS pipeline infrastructure runs a pipeline on previously-defined
reduction groups as a fully-automatic black box. To do so, it creates an
input manifest (<em>infiles.txt</em>) that contains relative paths to the input
files (one per line). The command-line interface to the
pipeline is run as:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux_pipe infiles.txt
</pre></div>
</div>
<p>The command-line interface will read in the specified input files, use
their headers to determine the observation mode, and accordingly
the steps to run and any intermediate files to save. Output files are
written to the current directory, from which the pipeline was called.
After reduction is complete, the script will generate an output manifest
(<em>outfiles.txt</em>) containing the relative paths to all output FITS files
generated by the pipeline.</p>
<p>Optionally, in place of a manifest file, file paths to input files may
be directly specified on the command line.  Input files may be raw
FITS files, or may be intermediate products previously produced
by the pipeline.  For example, this command will complete the reduction
for a set of FITS files in the current directory, previously reduced
through the calibration step of the pipeline:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux_pipe *CAL*.fits
</pre></div>
</div>
<p>To customize batch reductions from the command line, the <em>redux_pipe</em> interface
accepts a configuration file on the command line.  This file may contain
any subset of the full configuration file, specifying any non-default
parameters for pipeline steps.  An output directory for pipeline products
and the terminal log level may also be set on the command line.</p>
<p>The full set of optional command-line parameters accepted by the <em>redux_pipe</em>
interface are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-h, --help            show this help message and exit
-c CONFIG, --configuration CONFIG
                      Path to Redux configuration file.
-o OUTDIR, --out OUTDIR
                      Path to output directory.
-l LOGLEVEL, --loglevel LOGLEVEL
                      Log level.
</pre></div>
</div>
</section>
<section id="manual-mode-execution">
<h3>Manual Mode Execution<a class="headerlink" href="#manual-mode-execution" title="Permalink to this heading">¶</a></h3>
<p>In manual mode, the pipeline may be run interactively, via a graphical
user interface (GUI) provided by the Redux package.  The GUI is launched by
the command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux
</pre></div>
</div>
<p>entered at the terminal prompt (<a class="reference internal" href="#flitecam-startup"><span class="std std-numref">Fig. 53</span></a>).  The GUI allows
output directory specification, but it may write initial or temporary
files to the current directory, so it is recommended to start the
interface from a location to which the user has write privileges.</p>
<p>From the command line, the <em>redux</em> interface accepts an optional config file
(<em>-c</em>) or log level specification (<em>-l</em>), in the same way the <em>redux_pipe</em>
command does.  Any pipeline parameters provided to the interface in a
configuration file will be used to set default values; they will still be
editable from the GUI.</p>
<figure class="align-default" id="flitecam-startup">
<img alt="Startup screen showing an outline of an airplane with an open telescope door on a blue background showing faint spiral arms and stylized stars." src="../../../_images/startup2.png" />
<figcaption>
<p><span class="caption-number">Fig. 53 </span><span class="caption-text">Redux GUI startup.</span><a class="headerlink" href="#flitecam-startup" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<section id="basic-workflow">
<h4>Basic Workflow<a class="headerlink" href="#basic-workflow" title="Permalink to this heading">¶</a></h4>
<p>To start an interactive reduction, select a set of input files, using
the File menu (<strong>File-&gt;Open New Reduction</strong>). This will bring up a file
dialog window (see <a class="reference internal" href="#flitecam-open-new"><span class="std std-numref">Fig. 54</span></a>). All files selected will be reduced
together as a single reduction set.</p>
<p>Redux will decide the appropriate reduction steps from the input files,
and load them into the GUI, as in <a class="reference internal" href="#flitecam-reduction-steps"><span class="std std-numref">Fig. 55</span></a>.</p>
<figure class="align-default" id="flitecam-open-new">
<img alt="File system dialog window showing selected filenames." src="../../../_images/open_new2.png" />
<figcaption>
<p><span class="caption-number">Fig. 54 </span><span class="caption-text">Open new reduction.</span><a class="headerlink" href="#flitecam-open-new" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="flitecam-reduction-steps">
<img alt="GUI window showing reduction steps with Edit and Run buttons. A log window is displayed with text messages from a reduction." src="../../../_images/reduction_steps2.png" />
<figcaption>
<p><span class="caption-number">Fig. 55 </span><span class="caption-text">Sample reduction steps. Log output from the pipeline is
displayed in the <strong>Log</strong> tab.</span><a class="headerlink" href="#flitecam-reduction-steps" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Each reduction step has a number of parameters that can be edited
before running the step. To examine or edit these parameters,
click the <strong>Edit</strong> button next to the step name to bring up the
parameter editor for that step (<a class="reference internal" href="#flitecam-parameters"><span class="std std-numref">Fig. 56</span></a>). Within the
parameter editor, all values may be edited.  Click <strong>OK</strong> to save the
edited values and close the window. Click <strong>Reset</strong> to restore any
edited values to their last saved values.  Click <strong>Restore Defaults</strong>
to reset all values to their stored defaults.
Click <strong>Cancel</strong> to discard all changes to the parameters and
close the editor window.</p>
<figure class="align-default" id="flitecam-parameters">
<img alt="An Edit Parameters dialog window, showing various selection widgets." src="../../../_images/parameters2.png" />
<figcaption>
<p><span class="caption-number">Fig. 56 </span><span class="caption-text">Sample parameter editor for a pipeline step.</span><a class="headerlink" href="#flitecam-parameters" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The current set of parameters can be displayed, saved to a file,
or reset all at once using the <strong>Parameters</strong> menu. A previously
saved set of parameters can also be restored for use with the
current reduction (<strong>Parameters -&gt; Load Parameters</strong>).</p>
<p>After all parameters for a step have been examined and set to the
user’s satisfaction, a processing step can be run on all loaded
files either by clicking <strong>Step</strong>, or the <strong>Run</strong> button next to the
step name. Each processing step must be run in order, but if a
processing step is selected in the <strong>Step through:</strong> widget,
then clicking <strong>Step</strong> will treat all steps up through the selected
step as a single step and run them all at once. When a step has
been completed, its buttons will be grayed out and inaccessible.
It is possible to undo one previous step by clicking <strong>Undo</strong>.
All remaining steps can be run at once by clicking <strong>Reduce</strong>.
After each step, the results of the processing may be displayed
in a data viewer. After running a pipeline step or reduction,
click <strong>Reset</strong> to restore the reduction to the initial state,
without resetting parameter values.</p>
<p>Files can be added to the reduction set (<strong>File -&gt; Add Files</strong>) or
removed from the reduction set (<strong>File -&gt; Remove Files</strong>), but
either action will reset the reduction for all loaded files.
Select the <strong>File Information</strong> tab to display a table of information
about the currently loaded files (<a class="reference internal" href="#flitecam-file-info"><span class="std std-numref">Fig. 57</span></a>).</p>
<figure class="align-default" id="flitecam-file-info">
<img alt="A table display showing filenames and FITS keyword values." src="../../../_images/file_info2.png" />
<figcaption>
<p><span class="caption-number">Fig. 57 </span><span class="caption-text">File information table.</span><a class="headerlink" href="#flitecam-file-info" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="display-features">
<h4>Display Features<a class="headerlink" href="#display-features" title="Permalink to this heading">¶</a></h4>
<p>The Redux GUI displays images for quality analysis and display (QAD)
in the DS9 FITS viewer.  DS9 is a standalone image display
tool with an extensive feature set.  See the SAO DS9 site
(<a class="reference external" href="http://ds9.si.edu/">http://ds9.si.edu/</a>) for more usage information.</p>
<p>After each pipeline step completes, Redux may load the produced images
into DS9.  Some display options may be customized directly in DS9;
some commonly used options are accessible from the Redux interface, in the
<strong>Data View</strong> tab (<a class="reference internal" href="#flitecam-data-view"><span class="std std-numref">Fig. 58</span></a>).</p>
<figure class="align-default" id="flitecam-data-view">
<img alt="Data viewer settings with various widgets and buttons to control display parameters and analysis tools." src="../../../_images/data_view2.png" />
<figcaption>
<p><span class="caption-number">Fig. 58 </span><span class="caption-text">Data viewer settings and tools.</span><a class="headerlink" href="#flitecam-data-view" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>From the Redux interface, the <strong>Display Settings</strong> can be used to:</p>
<ul class="simple">
<li><p>Set the FITS extension to display (<strong>First</strong>, or edit to enter
a specific extension), or specify that all extensions should
be displayed in a cube or in separate frames.</p></li>
<li><p>Lock individual frames together, in image or WCS coordinates.</p></li>
<li><p>Lock cube slices for separate frames together, in image or
WCS coordinates.</p></li>
<li><p>Set the image scaling scheme.</p></li>
<li><p>Set a default color map.</p></li>
<li><p>Zoom to fit image after loading.</p></li>
<li><p>Tile image frames, rather than displaying a single frame at a
time.</p></li>
</ul>
<p>Changing any of these options in the Data View tab will cause the
currently displayed data to be reloaded, with the new options.
Clicking <strong>Reset Display Settings</strong> will revert any edited options
to the last saved values.  Clicking <strong>Restore Default Display Settings</strong>
will revert all options to their default values.</p>
<p>In the <strong>QAD Tools</strong> section of the <strong>Data View</strong> tab, there are
several additional tools available.</p>
<p>Clicking the <strong>ImExam</strong> button
(scissors icon) launches an event loop in DS9.  After launching it,
bring the DS9 window forward, then use the keyboard to perform interactive
analysis tasks:</p>
<ul class="simple">
<li><p>Type ‘a’ over a source in the image to perform photometry at the
cursor location.</p></li>
<li><p>Type ‘p’ to plot a pixel-to-pixel comparison of all frames at the
cursor location.</p></li>
<li><p>Type ‘s’ to compute statistics and plot a histogram of the data
at the cursor location.</p></li>
<li><p>Type ‘c’ to clear any previous photometry results or active plots.</p></li>
<li><p>Type ‘h’ to print a help message.</p></li>
<li><p>Type ‘q’ to quit the ImExam loop.</p></li>
</ul>
<p>The photometry settings (the image window considered, the model fit,
the aperture sizes, etc.) may be customized in the <strong>Photometry Settings</strong>.
Plot settings (analysis window size, shared plot axes, etc.) may be
customized in the <strong>Plot Settings</strong>.
After modifying these settings, they will take effect only for new
apertures or plots (use ‘c’ to clear old ones first).  As for the display
settings, the reset button will revert to the last saved values
and the restore button will revert to default values.
For the pixel-to-pixel and histogram plots, if the cursor is contained within
a previously defined DS9 region (and the <code class="xref py py-obj docutils literal notranslate"><span class="pre">regions</span></code> package is installed),
the plot will consider only pixels within the region.  Otherwise, a window
around the cursor is used to generate the plot data.  Setting the window
to a blank value in the plot settings will use the entire image.</p>
<p>Clicking the <strong>Header</strong> button (magnifying glass icon) from the
<strong>QAD Tools</strong> section opens a new window that displays headers
from currently loaded FITS files in text form (<a class="reference internal" href="#flitecam-headers"><span class="std std-numref">Fig. 59</span></a>).
The extensions displayed depends on the extension
setting selected (in <strong>Extension to Display</strong>).  If a particular extension is
selected, only that header will be displayed.  If all extensions
are selected (either for cube or multi-frame display), all extension
headers will be displayed.  The buttons at the bottom of the window
may be used to find or filter the header text, or generate a table
of header keywords.  For filter or table display, a comma-separated
list of keys may be entered in the text box.</p>
<p>Clicking the <strong>Save Current Settings</strong> button (disk icon) from the
<strong>QAD Tools</strong> section saves all current display and photometry
settings for the current user.  This allows the user’s settings to
persist across new Redux reductions, and to be loaded when Redux
next starts up.</p>
<figure class="align-default" id="flitecam-headers">
<img alt="A dialog window showing a sample FITS header in plain text." src="../../../_images/headers2.png" />
<figcaption>
<p><span class="caption-number">Fig. 59 </span><span class="caption-text">QAD FITS header viewer.</span><a class="headerlink" href="#flitecam-headers" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="flitecam-reduction">
<h3>FLITECAM Reduction<a class="headerlink" href="#flitecam-reduction" title="Permalink to this heading">¶</a></h3>
<section id="imaging-reduction">
<h4>Imaging Reduction<a class="headerlink" href="#imaging-reduction" title="Permalink to this heading">¶</a></h4>
<p>FLITECAM imaging reduction with Redux is straightforward. The
processing steps follow the flowchart of <a class="reference internal" href="#flitecam-flowchart-img"><span class="std std-numref">Fig. 45</span></a>.
At each step, Redux attempts to determine automatically the correct
action, given the input data and default parameters, but each step
can be customized as needed.</p>
<section id="useful-parameters">
<h5>Useful Parameters<a class="headerlink" href="#useful-parameters" title="Permalink to this heading">¶</a></h5>
<p>Some key parameters to note are listed below.</p>
<p>In addition to the specified parameters, the output from each step may
be optionally saved by selecting the ‘save’ parameter.</p>
<ul class="simple">
<li><p><strong>Check Headers</strong></p>
<ul>
<li><p><em>Abort reduction for invalid headers</em>: By default, Redux will halt the
reduction if the input header keywords do not meet requirements.
Uncheck this box to attempt the reduction anyway.</p></li>
</ul>
</li>
<li><p><strong>Correct Nonlinearity:</strong></p>
<ul>
<li><p><em>Linearity correction file</em>: The default linearity correction file
on disk is automatically loaded. Set to a valid FITS file path to
override the default coefficients file with a new one.</p></li>
<li><p><em>Saturation level</em>: Pixels with raw flux values greater than this
value, divided by the DIVISOR, are marked as bad pixels.  Set to
blank to propagate all pixels, regardless of value.</p></li>
</ul>
</li>
<li><p><strong>Clip Image:</strong></p>
<ul>
<li><p><em>Skip clean</em>: If selected, bad pixels will not be identified in
the clipped image.</p></li>
<li><p><em>Data to clip to</em>: Enter a pixel range to use as the data section.
Values should be entered as xmin, xmax, ymin, ymax,
with index values starting at 0. Max values are not included.</p></li>
</ul>
</li>
<li><p><strong>Make Flat:</strong></p>
<ul>
<li><p><em>Override flat file</em>: If specified, the provided FITS
file will be used in place of generating a flat field from the
input data.  The provided file must have a FLAT extension.
If FLAT_ERROR is also present, the errors will be propagated
in the gain correction step.</p></li>
<li><p><em>Skip gain correction</em>: If selected, no flat will be generated, and
any file specified as an override will be ignored.
Data will not be gain corrected.</p></li>
</ul>
</li>
<li><p><strong>Subtract Sky:</strong></p>
<ul>
<li><p><em>Override sky file</em>: If specified, the provided FITS
file will be used as a sky image to subtract, in place of using
the method parameter.  The provided file must have a FLUX extension.
If an ERROR extension is also present, the errors will be propagated.</p></li>
<li><p><em>Skip sky subtraction</em>: If selected, no sky values will be subtracted.</p></li>
<li><p><em>Method for deriving sky value</em>: If ‘Use image median’, the background
will be determined from the median of each frame.  If ‘Use flat
normalization value’, the value in the FITS keyword FLATNORM will be
subtracted.  This is only appropriate if the flat was generated from
sky data close in time to the observation (e.g the input data itself).</p></li>
</ul>
</li>
<li><p><strong>Register Images</strong></p>
<ul>
<li><p><em>Registration algorithm</em>: The default for all data is to
use the WCS as is for registration. Centroiding is
may be useful for bright, compact objects; cross-correlation
may be useful for bright, diffuse fields. Registration via the
‘Header shifts’ method may be useful for older data, for which the
relative WCS is not very accurate. The ‘Use first WCS’ option
will treat all images as pre-registered: the data will be coadded
directly without shifts.</p></li>
<li><p><em>Override offsets for all images</em>: If registration offsets are
known a priori, they may be directly entered here. Specify
semi-colon separated offsets, as x,y. For example, for three
input images, specify ‘0,0;2,0;0,2’ to leave the first as is,
shift the second two pixels to the right in x,
and shift the third two pixels up in y.</p></li>
<li><p><em>Expected FWHM for centroiding</em>: Specify the expected FWHM in pixels,
for the centroiding algorithm.  This may be useful in registering
bright compact sources that are not point sources.</p></li>
<li><p><em>Maximum shift for cross-correlation</em>: Specify the maximum allowed
shift in pixels for the cross-correlation algorithm.  This limit is
applied for shifts in both x- and y-direction.</p></li>
</ul>
</li>
<li><p><strong>Combine images</strong></p>
<ul>
<li><p><em>Skip coaddition</em>: If selected, each input registered file will be
saved as a separate file of type ‘coadded’ rather than combined
together into a single output file.</p></li>
<li><p><em>Reference coordinate system</em>: If set to ‘First image’, all
images will be referenced to the sky position in the first image
file. If set to ‘Target position’, the
TGTRA/TGTDEC keywords in the FITS header will be used to apply
an additional offset for registering non-sidereal targets.  If
these keywords are not present, or if their value is constant,
the algorithm defaults to the ‘First image’ behavior.
‘Target position’ is on by default; ‘First image’ is recommended only
if the TGTRA/TGTDEC keywords are known to have bad values.</p></li>
<li><p><em>Combination method</em>: Median is the default; mean may also be useful
for some input data.  The resample option may project data more
accurately, and allows an additional smoothing option, but takes
much longer to complete.</p></li>
<li><p><em>Use weighted mean</em>: If set, the average of the data will be
weighted by the variance. Ignored for method=median.</p></li>
<li><p><em>Robust combination</em>: If set, data will be sigma-clipped before
combination for mean or median methods.</p></li>
<li><p><em>Outlier rejection threshold (sigma)</em>: The sigma-clipping threshold
for robust combination methods, in units of sigma (standard deviation).</p></li>
<li><p><em>Gaussian width for smoothing (pixels)</em>: If method=resample, a smoothing
may be applied to the output averages.  Specify the Gaussian width in
pixels.  Set smaller (but non-zero) for less smoothing; higher for
more smoothing.</p></li>
</ul>
</li>
<li><p><strong>Flux Calibrate</strong></p>
<ul>
<li><p><em>Re-run photometry for standards</em>: If selected, and observation is
a flux standard, photometric fits and aperture measurements on the
brightest source will be recalculated, using the input parameters
below.</p></li>
<li><p><em>Source position</em>: Enter the approximate position (x,y) of the
source to measure. If not specified, the SRCPOSX/SRCPOSY keywords
in the FITS header will be used as the first estimate of the
source position.</p></li>
<li><p><em>Photometry fit size</em>: Smaller subimages may sometimes
be necessary for faint sources and/or variable background.</p></li>
<li><p><em>Initial FWHM</em>: Specify in pixels. This parameter
should be modified only if the PSF of the source is significantly
larger or smaller than usual.</p></li>
<li><p><em>Profile type</em>: Moffat fits are the default, as they generally
give a more reliable FWHM value. However, Gaussian fits may
sometimes be more stable, and therefore preferable if the Moffat
fit fails.</p></li>
</ul>
</li>
<li><p><strong>Make Image Map</strong></p>
<ul>
<li><p><em>Color map</em>: Color map for the output PNG image.  Any valid Matplotlib
name may be specified.</p></li>
<li><p><em>Flux scale for image</em>: A low and high percentile value , used for
scaling the image, e.g. [0,99].</p></li>
<li><p><em>Number of contours</em>: Number of contour levels to be over-plotted on
the image.  Set to 0 to turn off contours.</p></li>
<li><p><em>Contour color</em>: Color for the contour lines.  Any valid Matplotlib
color name may be specified.</p></li>
<li><p><em>Filled contours</em>: If set, contours will be filled instead of overlaid.</p></li>
<li><p><em>Overlay grid</em>: If set, a coordinate grid will be overlaid.</p></li>
<li><p><em>Beam marker</em>: If set, a beam marker will be added to the plot.</p></li>
<li><p><em>Watermark text</em>: If set to a non-empty string, the text will be
added to the lower-right of the image as a semi-transparent watermark.</p></li>
<li><p><em>Crop NaN border</em>: If set, any remaining NaN or zero-valued border
will be cropped out of plot.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="grism-reduction">
<h4>Grism Reduction<a class="headerlink" href="#grism-reduction" title="Permalink to this heading">¶</a></h4>
<p>Spectral extraction with Redux is slightly more complicated than
image processing. The GUI breaks down the spectral extraction algorithms
into six separate reduction steps to give more control over the extraction
process. These steps are:</p>
<ul class="simple">
<li><p>Make Profiles: Generate a smoothed model of the relative distribution
of the flux across the slit (the spatial profile). After this step is
run, a separate display window showing a plot of the spatial profile
appears.</p></li>
<li><p>Locate Apertures: Use the spatial profile to identify spectra to extract.
By default, Redux attempts to automatically identify sources, but
they can also be manually identified by entering a guess position to
fit near, or a fixed position, in the parameters. Aperture locations
are plotted in the profile window.</p></li>
<li><p>Trace Continuum: Identify the location of the spectrum across the
array, by either fitting the continuum or fixing the location to the
aperture center.  The aperture trace is displayed as a region
overlay in DS9.</p></li>
<li><p>Set Apertures: Identify the data to extract from the spatial profile.
This is done automatically by default, but all aperture
parameters can be overridden manually in the parameters for this
step.  Aperture radii and background regions are plotted in the
profile window (see <a class="reference internal" href="#flitecam-profile-plot"><span class="std std-numref">Fig. 60</span></a>).</p></li>
<li><p>Subtract Background: Residual background is fit and removed for
each column in the 2D image, using background regions specified
in the Set Apertures step.</p></li>
<li><p>Extract Spectra: Extract one-dimensional spectra from the
identified apertures. By default, Redux will perform standard
extraction for observations that are marked as extended sources
(SRCTYPE=EXTENDED_SOURCE) and will attempt optimal extraction for
any other value. The method can be overridden in the parameters for
this step.</p></li>
</ul>
<p>Extracted spectra are displayed in an interactive plot window, for
data analysis and visualization (see <a class="reference internal" href="#flitecam-spectral-plot"><span class="std std-numref">Fig. 61</span></a>).</p>
<p>The spectral display tool has a number of useful features and controls.
See <a class="reference internal" href="#flitecam-eye-controls-image"><span class="std std-numref">Fig. 62</span></a> and the table below for a quick summary.</p>
<table class="longtable docutils align-default" id="id22">
<caption><span class="caption-number">Table 14 </span><span class="caption-text">Spectral Viewer controls</span><a class="headerlink" href="#id22" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 30.0%" />
<col style="width: 30.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Feature</strong></p></th>
<th class="head"><p><strong>Control</strong></p></th>
<th class="head"><p><strong>Keyboard shortcut</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Load new FITS file</p></td>
<td><p><em>File Choice -&gt; Add File</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Remove loaded FITS file</p></td>
<td><p><em>File Choice -&gt;</em>
<em>Remove File</em></p></td>
<td><p>Press <em>delete</em> in the
<em>File Choice</em> panel</p></td>
</tr>
<tr class="row-even"><td><p>Plot selected file</p></td>
<td><p><em>File Choice -&gt;</em>
<em>(double-click)</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Add a new plot window (pane)</p></td>
<td><p><em>Panes -&gt;</em>
<em>Add Pane</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Remove a pane</p></td>
<td><p><em>Panes -&gt;</em>
<em>Remove Pane</em></p></td>
<td><p>Press <em>delete</em> in the
<em>Panes</em> panel, or in
the plot window</p></td>
</tr>
<tr class="row-odd"><td><p>Show or hide a plot</p></td>
<td><p><em>Panes -&gt; Pane # -&gt;</em>
<em>File name -&gt; Enabled</em>,
or click the <em>Hide all</em>/
<em>Show all</em> button</p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Display a different X or Y
field (e.g. spectral error,
transmission, or response)</p></td>
<td><p><em>Axis -&gt;</em>
<em>X Property</em> or
<em>Y Property</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Overplot a different Y axis
field (e.g. spectral error,
transmission, or response)</p></td>
<td><p><em>Axis -&gt;</em>
<em>Overplot -&gt; Enabled</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Change X or Y units</p></td>
<td><p><em>Axis -&gt;</em>
<em>X Unit</em> or
<em>Y Unit</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Change X or Y scale</p></td>
<td><p><em>Axis -&gt;</em>
<em>X Scale</em> or <em>Y Scale</em>
<em>-&gt; Linear</em> or <em>Log</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Interactive zoom</p></td>
<td><p><em>Axis -&gt; Zoom</em>:
<em>X</em>, <em>Y</em>, <em>Box</em>,
then click in the plot
to set the limits; or
<em>Reset</em> to reset the
limits to default.</p></td>
<td><p>In the plot window,
press <em>x</em>, <em>y</em>, or
<em>z</em> to start zoom mode
in x-direction,
y-direction, or box
mode, respectively.
Click twice on the
plot to set the new
limits.  Press <em>w</em>
to reset the plot
limits to defaults.</p></td>
</tr>
<tr class="row-odd"><td><p>Fit a spectral feature</p></td>
<td><p>–</p></td>
<td><p>In the plot window,
press <em>f</em> to start
the fitting mode.
Click twice on the
plot to set the data
limits to fit.</p></td>
</tr>
<tr class="row-even"><td><p>Change the feature or baseline
fit model</p></td>
<td><p><em>Analysis -&gt; Feature,</em>
<em>Background</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Load a spectral line list for
overplot display</p></td>
<td><p><em>Analysis -&gt; Reference</em>
<em>Data: Open, Load List</em></p>
<p>Select a one- or two-
column text file
containing wavelengths in
microns and (optionally)
labels for the values.
Columns may be comma,
space, or ‘|’ separated.</p>
</td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Clear zoom or fit mode</p></td>
<td><p>–</p></td>
<td><p>In the plot window,
press <em>c</em> to clear
guides and return to
default display mode.</p></td>
</tr>
<tr class="row-odd"><td><p>Change the plot color cycle</p></td>
<td><p><em>Plot -&gt;
Color cycle -&gt;
Accessible</em>, <em>Spectral</em>
or <em>Tableau</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Change the plot type</p></td>
<td><p><em>Plot -&gt; Plot type -&gt;
Step</em>, <em>Line</em>, or
<em>Scatter</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Change the plot display options</p></td>
<td><p><em>Plot -&gt;
Show markers</em>,
<em>Show errors</em>,
<em>Show grid</em>, or
<em>Dark mode</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Display the cursor position</p></td>
<td><p><em>Cursor panel</em> -&gt;
Check <em>Cursor Location</em>
for a quick display or
press <em>Popout</em> for full
information</p></td>
<td><p>–</p></td>
</tr>
</tbody>
</table>
<figure class="align-default" id="flitecam-profile-plot">
<img alt="A display window with a profile plot and lines marking the aperture." src="../../../_images/profile_plot1.png" />
<figcaption>
<p><span class="caption-number">Fig. 60 </span><span class="caption-text">Aperture location automatically identified and over-plotted
on the spatial profile.  The cyan line indicates the aperture center.
Green lines indicate the integration aperture for optimal extraction,
dark blue lines indicate the PSF radius (the point at which the flux
goes to zero), and red lines indicate background regions.</span><a class="headerlink" href="#flitecam-profile-plot" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="flitecam-spectral-plot">
<img alt="A GUI window showing a spectral trace plot, in Wavepos (um) vs. Spectral_flux (Jy)." src="../../../_images/spectral_plot1.png" />
<figcaption>
<p><span class="caption-number">Fig. 61 </span><span class="caption-text">Final extracted spectrum, displayed in an interactive plot window.</span><a class="headerlink" href="#flitecam-spectral-plot" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="flitecam-eye-controls-image">
<img alt="A GUI window showing a spectral plot and various buttons and widgets to control the plot display." src="../../../_images/eye_controls1.png" />
<figcaption>
<p><span class="caption-number">Fig. 62 </span><span class="caption-text">Control panels for the spectral viewer are located to the left and
below the plot window.  Click the arrow icons to show or collapse
them.</span><a class="headerlink" href="#flitecam-eye-controls-image" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<section id="id9">
<h5>Useful Parameters<a class="headerlink" href="#id9" title="Permalink to this heading">¶</a></h5>
<p>Below are listed some key parameters for the grism processing steps.
Note that the Check Headers and Correct Nonlinearity steps are identical to
those used for the imaging data: their parameters are listed above.
In addition to the specified parameters, the output from each step may
be optionally saved by selecting the ‘save’ parameter.</p>
<ul class="simple">
<li><p><strong>Make Spectral Image:</strong></p>
<ul>
<li><p><em>Subtract pairs</em>: If checked, files will be pair-subtracted in the
order they were taken, according to the DATE-OBS keyword in their
headers.  Mismatched pairs will be dropped from the reduction.</p></li>
<li><p><em>Flat file</em>: If provided, data will be divided by the image in
the first extension of the FITS file.  Set blank to skip flat
correction.  The default order mask is automatically loaded for this
purpose, but most of the masks provided have flat values set to
1.0, so there is no effective flat correction.</p></li>
</ul>
</li>
<li><p><strong>Stack Dithers</strong></p>
<ul>
<li><p><em>Skip dither stacking</em>: If set, common dither positions will not be
stacked.  This is the default: dither stacking is only recommended
for faint spectra that cannot otherwise be automatically extracted.</p></li>
<li><p><em>Ignore dither information from header</em>: If set, all input files are
stacked regardless of dither position.</p></li>
<li><p><em>Combination method</em>: Mean is the default; median may also be useful
for some input data.</p></li>
<li><p><em>Use weighted mean</em>: If set, the average of the data will be
weighted by the variance. Ignored for method=median.</p></li>
<li><p><em>Robust combination</em>: If set, data will be sigma-clipped before
combination.</p></li>
<li><p><em>Outlier rejection threshold (sigma)</em>: The sigma-clipping threshold
for robust combination methods, in units of sigma (standard deviation).</p></li>
</ul>
</li>
<li><p><strong>Make Profiles</strong></p>
<ul>
<li><p><em>Wave/space calibration file</em>: The default calibration
file is automatically loaded. Set to a valid FITS file path to
override the default calibration map with a new one.</p></li>
<li><p><em>Slit correction file</em>: The default slit correction
file is automatically loaded, if available. If blank, no slit
correction will be applied. Set to a valid FITS file path to
override the default file with a new one.</p></li>
<li><p><em>Row fit order</em>: Typically a third-order polynomial fit is used
to calculate the smooth spatial profile. Occasionally, a higher or
lower order fit may give better results.</p></li>
<li><p><em>Subtract median background</em>: If set, then the
median level of the smoothed spatial profile will be subtracted
out to remove residual background from the total extracted flux.
If the SRCTYPE is EXTENDED_SOURCE this option will be off by default.
For other data, this option is appropriate as long as the slit is
dominated by background, rather than source flux. If the spatial profile
dips below zero at any point (other than for a negative spectrum), this
option should be deselected.</p></li>
<li><p><em>Atmospheric transmission threshold</em>: Transmission values below this
threshold are not considered when making the spatial profile.
Values are 0-1.</p></li>
<li><p><em>Simulate calibrations</em>: Simulate calibration values instead of using
the wave/space calibration file.  This option is primarily used for
testing.</p></li>
</ul>
</li>
<li><p><strong>Locate Apertures</strong></p>
<ul>
<li><p><em>Aperture location method</em>: If ‘auto’, the strongest Gaussian peak(s) in the
spatial profile will be selected, with an optional starting guess
(<em>Aperture position</em>, below).  If ‘fix to input’, the value in the
<em>Aperture position</em> parameter will be used without refinement.
If ‘fix to center’, the center of the slit will be used.  ‘Fix to center’
is default for EXTENDED_SOURCE; otherwise ‘auto’ is default.</p></li>
<li><p><em>Number of auto apertures</em>: Set this parameter
to 1 to automatically find the single brightest source, or 2 to find the
two brightest sources, etc. Sources may be positive or negative.</p></li>
<li><p><em>Aperture position</em>: Enter a guess value for the aperture to use as a
starting point for method = ‘auto’, or a fixed value to use as the
aperture center for method = ‘fix to input’. Values are in arcseconds
up the slit (refer to the spatial profile). Separate multiple
apertures for a single file by commas;
separate values for multiple files by semi-colons. For example,
<em>3,8;2,7</em> will look for two apertures in each of two files, near
3” and 8” in the first image and 2” and 7” in the second image. If
there are multiple files loaded, but only one aperture list is
given, the aperture parameters will be used for all images.</p></li>
<li><p><em>Expected aperture FWHM (arcsec)</em>: Gaussian FWHM estimate for spatial
profile fits, to determine peaks.</p></li>
</ul>
</li>
<li><p><strong>Trace Continuum</strong></p>
<ul>
<li><p><em>Trace method</em>: If ‘fit to continuum’ is selected, points along the
continuum will be fit with a Gaussian to determine the trace
center at each location, and then the positions will be fit with a
low-order polynomial. If ‘fix to aperture position’ is selected,
no fit will be attempted, and the default slit curvature defined
by the edge definition file will be used as the aperture location.
By default, the trace will be fixed for EXTENDED_SOURCE,
but a fit will be attempted for all other data types.</p></li>
<li><p><em>Trace fit order</em>: Polynomial fit order for the aperture center,
along the spectral dimension.</p></li>
<li><p><em>Trace fit threshold</em>: Sigma value to use for rejecting discrepant
trace fits.</p></li>
<li><p><em>Fit position step size (pixels)</em>: Step size along the trace for
fit positions.</p></li>
</ul>
</li>
<li><p><strong>Set Apertures</strong></p>
<ul>
<li><p><em>Extract the full slit</em>: If set, all other parameters are ignored,
and the PSF radius will be set to include the full slit.</p></li>
<li><p><em>Refit apertures for FWHM</em>: The spatial FWHM for the aperture is used
to determine the aperture and PSF radii, unless they are directly
specified.  If this parameter is set, the profile will be re-fit with
a Gaussian to determine the FWHM.  If it is not set, the value
determined or set in the Locate Apertures step is used (stored
as APFWHM01 in the FITS header).</p></li>
<li><p><em>Aperture sign</em>: Enter either 1 or -1 to skip the
automatic determination of the aperture sign from the spatial
profile. If the value is -1, the spectrum will be multiplied by
-1. Separate multiple apertures by commas; separate values for
multiple files by semi-colons. If a single value is specified,
it will be applied to all apertures.</p></li>
<li><p><em>Aperture radius</em>: Enter a radius in arcsec to skip the
automatic determination of the aperture radius from the profile
FWHM. Separate multiple apertures by commas; separate values for
multiple files by semi-colons. If a single value is specified,
it will be applied to all apertures.</p></li>
<li><p><em>PSF radius</em>: Enter a radius in arcsec to skip the
automatic determination of the PSF radius from the profile
FWHM. Separate multiple apertures by commas; separate values for
multiple files by semi-colons. If a single value is specified,
it will be applied to all apertures.</p></li>
<li><p><em>Background regions</em>: Enter a range in arcsec to use as the
background region, skipping automatic background determination.
For example, <em>0-1,8-10</em> will use the regions
between 0” and 1” and between 8” and 10” to determine the
background level to subtract in extraction. Values are for the
full image, rather than for a particular aperture.  Separate
values for multiple files with semi-colons.</p></li>
</ul>
</li>
<li><p><strong>Subtract Background</strong></p>
<ul>
<li><p><em>Skip background subtraction</em>: Set to skip calculating and removing
residual background. If no background regions were set, background
subtraction will be automatically skipped.</p></li>
<li><p><em>Background fit order</em>: Set to a number greater than or equal to
zero for the polynomial order of the fit to the background
regions.</p></li>
</ul>
</li>
<li><p><strong>Extract Spectra</strong></p>
<ul>
<li><p><em>Save extracted 1D spectra</em>: If set, the extracted spectra will
be saved to disk in Spextool format.  This option is normally used only
for diagnostic purposes.</p></li>
<li><p><em>Extraction method</em>: The default is to use
standard extraction for EXTENDED_SOURCE and optimal
extraction otherwise. Standard extraction may be necessary for
some faint sources.</p></li>
<li><p><em>Use median profile instead of spatial map</em>: By default, the pipeline uses a
wavelength-dependent spatial map for extraction, but this
method may give poor results if the signal-to-noise
in the profile is low. Set this option to use the median spatial
profile across all wavelengths instead.</p></li>
<li><p><em>Use spatial profile to fix bad pixels</em>: The pipeline usually
uses the spatial profile to attempt to fix bad pixels during
standard extraction, and in the 2D image for either extraction
method. Occasionally, this results in a failed extraction.
Unset this options to extract the spectra without bad pixel correction.</p></li>
<li><p><em>Bad pixel threshold</em>: Enter a value for the threshold for a pixel
to be considered a bad pixel. This value is multiplied by the
standard deviation of all good pixels in the aperture at each
wavelength bin.</p></li>
</ul>
</li>
<li><p><strong>Flux Calibrate</strong></p>
<ul>
<li><p>General Parameters</p>
<ul>
<li><p><em>Save calibrated 1D spectra</em>: If set, the calibrated spectra will
be saved to disk in Spextool format.  This option is normally used only
for diagnostic purposes.</p></li>
<li><p><em>Skip flux calibration</em>: If set, no telluric correction or flux
calibration will be applied.</p></li>
<li><p><em>Response file</em>: The default instrumental response file on disk
is automatically loaded. If blank, no response correction will
be applied, but transmission correction will still occur. Set to a
valid FITS file path to override the default response file with a
new one.</p></li>
<li><p><em>Spectral resolution</em>: Expected resolution for the grism mode, used
to smooth the ATRAN model.  This value should match that of the
response file, and should only need modification if the response
file is modified from the default.</p></li>
</ul>
</li>
<li><p>Telluric Correction Parameters</p>
<ul>
<li><p><em>ATRAN directory</em>: This parameter specifies the location of the
library of ATRAN FITS files to use.  If blank, the default files
provided with the pipeline will be used.</p></li>
<li><p><em>ATRAN file</em>: This parameter is used to override the ATRAN file
to use for telluric correction. If blank, the default ATRAN
file on disk will be used. Set to a valid FITS file path to override the
default ATRAN file with a new one.</p></li>
</ul>
</li>
<li><p>Wavelength Shift Parameters</p>
<ul>
<li><p><em>Auto shift wavelength to telluric spectrum</em>: If set, the data will be
shifted to match the telluric spectrum.  The optimum shift chosen
is the one that minimizes residuals in the corrected spectrum,
when fit with a low order polynomial. All values within the range
of the maximum shift are tested, at a resolution of 0.1 pixels.
Auto shift will not be attempted for the FOR_G111 grism.</p></li>
<li><p><em>Maximum auto wavelength shift to apply</em>: The maximum shift allowable
for auto-shifts, in pixels.</p></li>
<li><p><em>Wavelength shift to apply</em>: Set to specify a manual shift in pixels
along the wavelength axis to apply to the science spectrum. If
non-zero, the auto-shift parameter will be ignored.</p></li>
<li><p><em>Polynomial order for continuum</em>: The fit order for the spectrum,
used to determine the optimum wavelength shift.</p></li>
<li><p><em>S/N threshold for auto-shift</em>: If the median S/N for a spectrum
is below this threshold, auto shift will not be attempted.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Combine Spectra</strong></p>
<ul>
<li><p>General Parameters</p>
<ul>
<li><p><em>Registration method</em>: If set to ‘Use WCS as is’, all
images will be referenced to the sky position in the first image
file. If set to ‘Correct to target position’, the
TGTRA/TGTDEC keywords in the FITS header will be used to apply
an additional offset for registering non-sidereal targets.  If
these keywords are not present, or if their value is constant,
the algorithm defaults to the ‘Use WCS as is’ behavior.
‘Correct to target position’ is on by default; the other options
are recommended only if the TGTRA/TGTDEC or WCS keywords are known to
have bad values. In that case, set to ‘Use header offsets’ for
non-sidereal targets or files with known bad WCS parameters;
otherwise use ‘Use WCS as is’.</p></li>
<li><p><em>Combination method</em>: Mean is the default; median may also be
useful for some input data. If ‘spectral_cube’ is set,
the input data will be resampled into a 3D spatial/spectral cube
instead of coadding 1D spectra and 2D images.</p></li>
<li><p><em>Weight by errors</em>: If set, the average of the data will be
weighted by the errors. Ignored for method=median.</p></li>
</ul>
</li>
<li><p>1-2D Combination Parameters</p>
<ul>
<li><p><em>Combine apertures</em>: If multiple apertures have been extracted,
set this option to combine them into a single 1D spectrum.  The
2D image will not attempt to co-align the spectral traces.</p></li>
<li><p><em>Robust combination</em>: If set, data will be sigma-clipped before
combination for mean or median methods.</p></li>
<li><p><em>Outlier rejection threshold (sigma)</em>: The sigma-clipping threshold
for robust combination methods, in units of sigma (standard deviation).</p></li>
</ul>
</li>
<li><p>3D Resample Parameters</p>
<ul>
<li><p><em>Spatial surface fit order</em>: This parameter controls the polynomial
order of the surface fit to the data at each grid point. Higher
orders give more fine-scale detail, but are more likely to be
unstable. Set to zero to do a weighted mean of the nearby data.</p></li>
<li><p><em>Spatial fit window</em>: Spatial window (pixels) for consideration in local
data fits.  Set higher to fit to more pixels.</p></li>
<li><p><em>Spatial smoothing radius</em>: Gaussian width (pixels) for smoothing radius in
distance weights for local data fits.  Set higher to smooth over
more pixels.</p></li>
<li><p><em>Spatial edge threshold</em>: A value between 0 and 1 that determines how
much of the image edge is set to NaN.  Set higher to set more pixels
to NaN.</p></li>
<li><p><em>Adaptive smoothing algorithm</em>: If ‘scaled’, the size of the smoothing
kernel is allowed to vary, in order to optimize reconstruction of
sharply peaked sources. If ‘shaped’, the kernel shape and rotation
may also vary. If ‘none’, the kernel will not vary.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Make Spectral Map</strong></p>
<ul>
<li><p><em>Color map</em>: Color map for the output PNG image.  Any valid Matplotlib
name may be specified.</p></li>
<li><p><em>Flux scale for image</em>: A low and high percentile value , used for
scaling the spectral image, e.g. [0,99].</p></li>
<li><p><em>Number of contours</em>: Number of contour levels to be over-plotted on
the image.  Set to 0 to turn off contours.</p></li>
<li><p><em>Contour color</em>: Color for the contour lines.  Any valid Matplotlib
color name may be specified.</p></li>
<li><p><em>Filled contours</em>: If set, contours will be filled instead of overlaid.</p></li>
<li><p><em>Overlay grid</em>: If set, a coordinate grid will be overlaid.</p></li>
<li><p><em>Watermark text</em>: If set to a non-empty string, the text will be
added to the lower-right of the image as a semi-transparent watermark.</p></li>
<li><p><em>Fraction of outer wavelengths to ignore</em>:  Used to block edge effects
for noisy spectral orders. Set to 0 to include all wavelengths in
the plot.</p></li>
<li><p><em>Overplot transmission</em>: If set, the atmospheric transmission spectrum
will be displayed in the spectral plot.</p></li>
<li><p><em>Flux scale for spectral plot</em>: Specify a low and high percentile value
for the spectral flux scale, e.g. [0,99].  If set to [0, 100],
Matplotlib defaults are used.</p></li>
</ul>
</li>
<li><p><strong>Make Response</strong></p>
<ul>
<li><p><em>Standard model file</em>: If blank, a model file will be searched for
in the default data directory.  Set to a valid FITS file to override.</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>
</section>
<section id="data-quality-assessment">
<h2>Data quality assessment<a class="headerlink" href="#data-quality-assessment" title="Permalink to this heading">¶</a></h2>
<p>After the pipeline has been run on a set of input data, the output
products should be checked to ensure that the data has been properly
reduced.  Data quality and quirks can vary widely across individual
observations, but the following general guideline gives some strategies
for approaching quality assessment (QA) for FLITECAM data.</p>
<ul>
<li><p>Check for QA comments in the FITS header HISTORY.  These comments may
make suggestions for files to exclude from final reductions, or
for non-default parameters to set for optimal reductions.</p></li>
<li><p>Check the output to the log file (usually called
<em>redux_[date]_[time].log</em>), written to the same directory as the
output files. Look for messages marked ERROR or WARNING. The log will
also list every parameter used in the pipeline steps, which may help
disambiguate the parameters as actually-run for the pipeline.</p></li>
<li><p>Check that the expected files were written to disk: there should, at
a minimum, be a calibrated file (<em>CAL</em>) for imaging data and a combined
spectrum (<em>CMB</em>) for grism data. Check the data product
tables (<a class="reference internal" href="#flitecam-img-prod"><span class="std std-numref">Table 9</span></a> and <a class="reference internal" href="#flitecam-gri-prod"><span class="std std-numref">Table 10</span></a>)
for other expected data products for each mode.</p></li>
<li><p>For imaging data:</p>
<blockquote>
<div><ul class="simple">
<li><p>Check the flat frame in the FLT file by comparing it with the raw image. All
instrumental artifacts (areas of low quantum efficiency, obscurations
in the optical path, and other systematics) that are present in the
raw frame should be present in the flat. Sources in the raw image
should not appear in the flat. Also check that the gain-corrected image
does not contain any residual artifacts.</p></li>
<li><p>Check for excessive hot or cold pixels in the coadded image. Bad
pixels should be ignored in the coadding process.</p></li>
<li><p>Check that the background was correctly subtracted. The counts in
regions containing no sources should be zero, within the standard
deviation.</p></li>
<li><p>Check that the registration process calculated offsets correctly:
compare all the registered images to verify that all sources appear
at the same location in the WCS.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>For grism data:</p>
<blockquote>
<div><ul class="simple">
<li><p>Display the spatial profile with apertures overlaid. Verify that
apertures look well placed and the spatial profile does not dip
below zero (except for negative spectral traces).</p></li>
<li><p>Display the rectified image, and overlay the locations of the
extracted apertures. Verify that the apertures lie on top of any
visible spectral traces.</p></li>
<li><p>Display the intermediate spectra, and verify that all spectra
of the same target look similar.</p></li>
<li><p>Display the final spectrum (<em>CMB</em>) and overplot the expected atmospheric
transmission. Check that the calibrated spectrum does not include
residual artifacts from the telluric absorption features. If it
does, the assumed resolution for the grism, or the wavelength
calibration of the observation, may need updating.</p></li>
<li><p>Overlay a model spectrum on the calibrated spectra of flux
standards. Verify that the observed spectrum matches the
theoretical spectrum, within the error bars of the observation. If
it does not, the instrumental response file may need updating.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="appendix-a-sample-configuration-files">
<h2>Appendix A: Sample configuration files<a class="headerlink" href="#appendix-a-sample-configuration-files" title="Permalink to this heading">¶</a></h2>
<p>Below are sample FLITECAM Redux parameter override files in INI format.
If present, the parameter value overrides the
default defined by the FLITECAM reduction object. If not present, the
default value will be used.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Redux parameters for FLITECAM instrument in imaging mode
# Pipeline: FLITECAM_REDUX v2_0_0
[1: check_header]
    abort = True
[2: correct_linearity]
    save = False
    linfile = linearity_files/lc_coeffs_20140325.fits
    saturation = 5000
[3: clip_image]
    save = False
    skip_clean = False
    datasec = 186, 838, 186, 838
[4: make_flat]
    save = True
    flatfile = &quot;&quot;
    skip_flat = False
[5: correct_gain]
    save = False
[6: subtract_sky]
    save = False
    skyfile = &quot;&quot;
    skip_sky = False
    sky_method = Use image median
[7: register]
    save = False
    corcoadd = Use WCS as is
    offsets = &quot;&quot;
    mfwhm = 6
    xyshift = 100
[8: tellcor]
    save = True
[9: coadd]
    save = True
    skip_coadd = False
    reference = Target position
    method = median
    weighted = True
    robust = True
    threshold = 8.0
    maxiters = 5
    smoothing = 1.0
[10: fluxcal]
    save = True
    rerun_phot = False
    srcpos = &quot;&quot;
    fitsize = 138
    fwhm = 6.0
    profile = Moffat
[11: imgmap]
    colormap = plasma
    scale = 0.25, 99.9
    n_contour = 0
    contour_color = gray
    fill_contours = False
    grid = True
    beam = False
    watermark = &quot;&quot;
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Redux parameters for FLITECAM instrument in spectroscopy mode
# Pipeline: FLITECAM_REDUX v2_0_0
[1: check_header]
    abort = True
[2: correct_linearity]
    save = False
    linfile = linearity_files/lc_coeffs_20140325.fits
    saturation = 5000
[3: make_image]
    save = True
    pair_sub = True
    flatfile = grism/Cals_20151006/Flats/FLT_A1_LM_flat.fits
[4: stack_dithers]
    save = True
    skip_stack = True
    ignore_dither = False
    method = mean
    weighted = True
    robust = True
    threshold = 8.0
    maxiters = 5
[5: make_profiles]
    save = True
    wavefile = grism/Cals_20151006/2dWaveCals/flt_a1_lm_map2pos_ngc7027.fits
    slitfile = &quot;&quot;
    fit_order = 3
    bg_sub = True
    atmosthresh = 0.0
    simwavecal = False
[6: locate_apertures]
    save = False
    method = auto
    num_aps = 2
    input_position = &quot;&quot;
    fwhm = 3.0
[7: trace_continuum]
    save = False
    method = fit to continuum
    fit_order = 2
    fit_thresh = 4.0
    step_size = 9
[8: set_apertures]
    save = False
    full_slit = False
    refit = True
    apsign = &quot;&quot;
    aprad = &quot;&quot;
    psfrad = &quot;&quot;
    bgr = &quot;&quot;
[9: subtract_background]
    save = False
    skip_bg = False
    bg_fit_order = 0
[10: extract_spectra]
    save = True
    save_1d = True
    method = optimal
    use_profile = False
    fix_bad = True
    threshold = 4.0
[11: flux_calibrate]
    save = True
    save_1d = False
    skip_cal = False
    respfile = grism/response/v4.0.0/FC_GRI_A1LM_SS20_RSP.fits
    resolution = 1075.0
    atrandir = &quot;&quot;
    atranfile = &quot;&quot;
    auto_shift = True
    auto_shift_limit = 2.0
    waveshift = 0.0
    model_order = 1
    sn_threshold = 10.0
[12: combine_spectra]
    save = True
    registration = Correct to target position
    method = mean
    weighted = True
    combine_aps = True
    robust = True
    threshold = 8.0
    maxiters = 5
    fit_order = 2
    fit_window = 7.0
    smoothing = 2.0
    edge_threshold = 0.7
    adaptive_algorithm = none
[13: specmap]
    colormap = plasma
    scale = 0.25, 99.9
    n_contour = 0
    contour_color = gray
    fill_contours = False
    grid = False
    watermark = &quot;&quot;
    ignore_outer = 0.0
    atran_plot = True
    spec_scale = 0.25, 99.75
</pre></div>
</div>
</section>
<section id="appendix-b-required-input-keywords">
<h2>Appendix B: Required input keywords<a class="headerlink" href="#appendix-b-required-input-keywords" title="Permalink to this heading">¶</a></h2>
<p>The files below define all keywords that the FLITECAM pipeline checks for
validity before proceeding. They are normally located in the pipeline distribution
distribution at <em>sofia_redux/instruments/flitecam/data/keyword_files</em>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># FLITECAM imaging header requirements configuration file
#
# Keywords in this list are only those required for successful
# data reduction (grouping and processing).  There may be more
# keywords required by the SOFIA DCS.
#
# Requirement value should be *, nodding, or dithering,
# (as denoted by the corresponding FITS keywords).
# * indicates a keyword that is required for all data.  All
# others will only be checked if they are appropriate to the
# mode of the input data.
#
# DRange is not required to be present in the configuration --
# if missing, the keyword will be checked for presence only.  If
# drange is present, it will be checked for an enum requirement
# first; other requirements are ignored if present.  Min/max
# requirements are only used for numerical types, and are inclusive
# (i.e. the value may be &gt;= min and &lt;= max).
#
# 2021-02-19 Melanie Clarke: First version

[ALTI_STA]
    requirement = *
    dtype = float
    [[drange]]
        min = 0
        max = 60000

[COADDS]
    requirement = *
    dtype = int
    [[drange]]
        min = 1

[CYCLES]
    requirement = *
    dtype = int
    [[drange]]
        min = 0

[DATE-OBS]
    requirement = *
    dtype = str

[DITHER]
    requirement = *
    dtype = bool

[DIVISOR]
    requirement = *
    dtype = int
    [[drange]]
        min = 1

[EXPTIME]
    requirement = *
    dtype = float
    [[drange]]
        min = 0.0

[INSTCFG]
    requirement = *
    dtype = str
    [[drange]]
        enum = IMAGING

[INSTMODE]
    requirement = *
    dtype = str
    [[drange]]
        enum = STARE, NOD_OFFARRAY

[INSTRUME]
    requirement = *
    dtype = str
    [[drange]]
        enum = FLITECAM

[ITIME]
    requirement = *
    dtype = float
    [[drange]]
        min = 0.0

[MISSN-ID]
    requirement = *
    dtype = str

[NDR]
    requirement = *
    dtype = int
    [[drange]]
        min = 1
        max = 32

[NODDING]
    requirement = *
    dtype = bool

[NODBEAM]
    requirement = nodding
    dtype = str
    [[drange]]
        enum = A, B

[OBJECT]
    requirement = *
    dtype = str

[OBS_ID]
    requirement = *
    dtype = str

[OBSTYPE]
    requirement = *
    dtype = str
    [[drange]]
        enum = OBJECT, STANDARD_FLUX, FLAT, SKY

[SPECTEL1]
    requirement = *
    dtype = str
    [[drange]]
        enum = FLT_J, FLT_H, FLT_K, FLT_ICE_308, FLT_PAH_329, FLT_Pa, FLT_Pa_cont, FLT_NbL, FLT_NbM, FLT_L, FLT_Lprime, FLT_M

[SPECTEL2]
    requirement = *
    dtype = str
    [[drange]]
        enum = NONE

[SRCTYPE]
    requirement = *
    dtype = str
    [[drange]]
        enum = POINT_SOURCE, COMPACT_SOURCE, EXTENDED_SOURCE, OTHER, UNKNOWN

[TABLE_MS]
    requirement = *
    dtype = float
    [[drange]]
        min = 0

[ZA_START]
    requirement = *
    dtype = float
    [[drange]]
        min = 0
        max = 90
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># FLITECAM grism header requirements configuration file
#
# Keywords in this list are only those required for successful
# data reduction (grouping and processing).  There may be more
# keywords required by the SOFIA DCS.
#
# Requirement value should be *, nodding, or dithering,
# (as denoted by the corresponding FITS keywords).
# * indicates a keyword that is required for all data.  All
# others will only be checked if they are appropriate to the
# mode of the input data.
#
# DRange is not required to be present in the configuration --
# if missing, the keyword will be checked for presence only.  If
# drange is present, it will be checked for an enum requirement
# first; other requirements are ignored if present.  Min/max
# requirements are only used for numerical types, and are inclusive
# (i.e. the value may be &gt;= min and &lt;= max).
#
# 2021-02-19 Melanie Clarke: First version

[ALTI_STA]
    requirement = *
    dtype = float
    [[drange]]
        min = 0
        max = 60000

[COADDS]
    requirement = *
    dtype = int
    [[drange]]
        min = 1

[CYCLES]
    requirement = *
    dtype = int
    [[drange]]
        min = 0

[DATE-OBS]
    requirement = *
    dtype = str

[DITHER]
    requirement = *
    dtype = bool

[DIVISOR]
    requirement = *
    dtype = int
    [[drange]]
        min = 1

[EXPTIME]
    requirement = *
    dtype = float
    [[drange]]
        min = 0.0

[INSTCFG]
    requirement = *
    dtype = str
    [[drange]]
        enum = SPECTROSCOPY, GRISM

[INSTMODE]
    requirement = *
    dtype = str
    [[drange]]
        enum = STARE, NOD_ALONG_SLIT, NOD_OFF_SLIT

[INSTRUME]
    requirement = *
    dtype = str
    [[drange]]
        enum = FLITECAM

[ITIME]
    requirement = *
    dtype = float
    [[drange]]
        min = 0.0

[MISSN-ID]
    requirement = *
    dtype = str

[NDR]
    requirement = *
    dtype = int
    [[drange]]
        min = 1
        max = 32

[NODDING]
    requirement = *
    dtype = bool

[NODBEAM]
    requirement = nodding
    dtype = str
    [[drange]]
        enum = A, B

[OBJECT]
    requirement = *
    dtype = str

[OBS_ID]
    requirement = *
    dtype = str

[OBSTYPE]
    requirement = *
    dtype = str
    [[drange]]
        enum = OBJECT, STANDARD_TELLURIC, FLAT, SKY

[SLIT]
    requirement = *
    dtype = str
    [[drange]]
        enum = FLT_SS10, FLT_SS20

[SPECTEL1]
    requirement = *
    dtype = str
    [[drange]]
        enum = FLT_A1_LM, FLT_A2_KL, FLT_A3_Hw, FLT_B1_LM, FLT_B2_Hw, FLT_B3_J, FLT_C2_LM, FLT_C3_Kw, FLT_C4_H

[SPECTEL2]
    requirement = *
    dtype = str
    [[drange]]
        enum = FLT_SS10, FLT_SS20

[SRCTYPE]
    requirement = *
    dtype = str
    [[drange]]
        enum = POINT_SOURCE, COMPACT_SOURCE, EXTENDED_SOURCE, OTHER, UNKNOWN

[TABLE_MS]
    requirement = *
    dtype = float
    [[drange]]
        min = 0

[ZA_START]
    requirement = *
    dtype = float
    [[drange]]
        min = 0
        max = 90
</pre></div>
</div>
</section>
<section id="appendix-c-calibration-data-generation">
<h2>Appendix C: Calibration Data Generation<a class="headerlink" href="#appendix-c-calibration-data-generation" title="Permalink to this heading">¶</a></h2>
<p>The FLITECAM Redux pipeline requires several kinds of auxiliary reference
calibration files, listed in <a class="reference internal" href="#flitecam-auxiliary"><span class="std std-numref">Table 13</span></a>.  Some of these
are produced by tools packaged with the pipeline.  This section describes the
procedures used to produce these auxiliary files.</p>
<section id="instrumental-response-curve">
<h3>Instrumental Response Curve<a class="headerlink" href="#instrumental-response-curve" title="Permalink to this heading">¶</a></h3>
<p>As described above, instrumental response
curves are automatically produced for each spectrum with
OBSTYPE = STANDARD_TELLURIC.  For use in calibrating science spectra,
response curves from multiple observations must be combined together.</p>
<p>For appropriate combination, input response curves must share the same
grism, slit, and detector bias setting.</p>
<p>Matching response curves may be scaled, to account for variations in slit
loss or model accuracy, then are generally combined together with a robust
weighted mean statistic.  The combined curve is smoothed with a Gaussian
of width 2 pixels, to reduce artificial artifacts.  Averaged response curves
for each grism and slit combination are usually produced for each
flight series, and stored for pipeline use in the standard location for
the instrument package (<em>data/grism/response</em>).</p>
<p>The scaling, combination, and smoothing of instrument response curves is
implemented as a final step in the pipeline for grism standards.
After individual <em>response_spectrum</em> files (*RSP*.fits) are grouped
appropriately, the final step in the pipeline can be run on each group to
produce the average <em>instrument_response</em> file (*IRS*.fits).</p>
<section id="id10">
<h4>Useful Parameters<a class="headerlink" href="#id10" title="Permalink to this heading">¶</a></h4>
<p>Below are some useful parameters for combining response spectra.</p>
<ul>
<li><p><strong>Combine Response</strong></p>
<blockquote>
<div><ul>
<li><p>Scaling Parameters</p>
<blockquote>
<div><ul class="simple">
<li><p><em>Scaling method</em>: If ‘median’, all spectra are scaled to the median
of the flux stack.  If ‘highest’, all spectra are scaled to the
spectrum with the highest median value.  If ‘lowest’, all spectra
are scaled to the spectrum with the lowest median value.  If
‘index’, all spectra are scaled to the spectrum indicated in the
<em>Index</em> parameter, below.  If ‘none’, no scaling is applied before
combination.</p></li>
<li><p><em>Index of spectrum to scale to</em>: If <em>Scaling method</em> is ‘index’, set
this value to the index of the spectrum to scale.  Indices start
at zero and refer to the position in the input file list.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Combination Parameters</p>
<blockquote>
<div><ul class="simple">
<li><p><em>Combine apertures</em>: For multi-aperture data, it may be useful
to produce a separate response curve for each aperture.  Select
this option to combine them into a single reponse curve instead.</p></li>
<li><p><em>Combination method</em>: Mean is default; median may also be useful
for some input data.</p></li>
<li><p><em>Weight by errors</em>: If set, the average of the data will be
weighted by the variance. Ignored for method=median.</p></li>
<li><p><em>Robust combination</em>: If set, data will be sigma-clipped before
combination for mean or median methods.</p></li>
<li><p><em>Outlier rejection threshold (sigma)</em>: The sigma-clipping threshold
for robust combination methods, in units of sigma (standard deviation).</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Smoothing Parameters</p>
<ul class="simple">
<li><p><em>Smoothing Gaussian FWHM</em>: Full-width-half-max for the Gaussian
kernel used for smoothing the final response spectrum, specified
in pixels.</p></li>
</ul>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
</section>
<section id="wavelength-calibration-map">
<h3>Wavelength Calibration Map<a class="headerlink" href="#wavelength-calibration-map" title="Permalink to this heading">¶</a></h3>
<section id="calibration-principles">
<h4>Calibration Principles<a class="headerlink" href="#calibration-principles" title="Permalink to this heading">¶</a></h4>
<p>Grism wavelength and spatial calibrations are stored together in a
single image extension in a FITS file, where the first plane is the wavelength
calibration and the second is the spatial calibration.  The images should match
the dimensions of the raw data arrays, assigning a wavelength value in um
and a slit position in arcsec to every raw pixel.</p>
<p>These calibration files are generally derived from specialized calibration
data.  Wavelength calibration is best derived from images for which strong
emission or absorption lines fill the whole image, from top to bottom, and
evenly spaced from left to right.  Sky data may be used for this purpose
for some of the grism passbands; lab data may be more appropriate for others.
Raw data should be cleaned and averaged or summed to produce an image with as
high a signal-to-noise ratio in the spectroscopic lines as possible.</p>
<p>After preprocessing, the spectroscopic lines must be identified with specific
wavelengths from a priori knowledge, then they must be re-identified with a
centroiding algorithm at as many places across the array as possible.  The
identified positions can then be fit with a smooth 2D surface, which provides
the wavelength value in microns at any pixel, accounting for any optical
distortions as needed.</p>
<p>In principle, the spatial calibration proceeds similarly.  Spatial
calibrations are best derived from identifiable spectral continuua that
fill the whole array from left to right, evenly spaced from top to bottom.
Most commonly, special observations of a spectroscopic standard are taken,
placing the source at multiple locations in the slit.  These spectroscopic
traces are identified then re-fit across the array.  The identified positions
are again fit with a smooth 2D surface to provide the spatial position in
arcseconds up the slit at any pixel.  This calibration can then be used to
correct for spatial distortions, in the same way that the wavelength
calibration is used to rectify distortions along the wavelength axis.</p>
</section>
<section id="pipeline-interface">
<h4>Pipeline Interface<a class="headerlink" href="#pipeline-interface" title="Permalink to this heading">¶</a></h4>
<p>The input data for calibration tasks is generally raw FITS
files, containing spectroscopic data.  In order to perform calibration steps
instead of the standard spectroscopic pipeline, the pipeline interface
requires a user-provided flag, either in an input configuration file, or
on the command line, as for example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux_pipe -c wavecal=True /path/to/fits/files
</pre></div>
</div>
<p>for a wavelength calibration reduction or:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux_pipe -c spatcal=True /path/to/fits/files
</pre></div>
</div>
<p>for a spatial calibration reduction.</p>
<p>The first steps in either reduction mode are the same pre-processing steps
used in the standard pipeline reduction.
The stacking steps have optional parameters that allow for
the input data to be summed instead of subtracted (for calibration from
sky lines), or to be summed instead of averaged (for combining multiple
spectral traces into a single image).</p>
<p>Thereafter, the <em>wavecal</em> reduction performs the following steps.  Each step
has a number of tunable parameters; see below for parameter descriptions.</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Make Profiles</strong>: a spatial profile is generated from the
unrectified input image.</p></li>
<li><p><strong>Extract First Spectrum</strong>: an initial spectrum is extracted from
a single aperture, via a simple sum over a specified number of rows.</p></li>
<li><p><strong>Identify Lines</strong>: spectrosopic lines specified in an input list are
identified in the extracted spectrum, via Gaussian fits near guess
positions derived from user input or previous wavelength calibrations.</p></li>
<li><p><strong>Reidentify Lines</strong>: new spectra are extracted from the image at
locations across the array, and lines successfully identified in the
initial spectrum are attempted to be re-identified in each new spectrum.</p></li>
<li><p><strong>Fit Lines</strong>: all input line positions and their assumed wavelength
values are fit with a low-order polynomial surface.  The fit surface
is saved to disk as the wavelength calibration file.</p></li>
<li><p><strong>Verify Rectification</strong>: the derived wavelength calibration is applied
to the input image, to verify that correctly rectifies the spectral
image.</p></li>
</ul>
</div></blockquote>
<p>After preprocessing, the <em>spatcal</em> reduction performs similar steps:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Make Profiles</strong>: a spatial profile is generated from the
unrectified input image.</p></li>
<li><p><strong>Locate Apertures</strong>: spectral apertures are identified from the spatial
profile, either manually or automatically.</p></li>
<li><p><strong>Trace Continuum</strong>: spectrosopic continuuum positions are fit in
steps across the array, for each identified aperture.</p></li>
<li><p><strong>Fit Traces</strong>: all aperture trace positions are fit with a low-order
polynomial surface.  The fit surface is saved to disk as the spatial
calibration file.</p></li>
<li><p><strong>Verify Rectification</strong>: the derived spatial calibration is applied
to the input image, to verify that correctly rectifies the spectral
image.</p></li>
</ul>
</div></blockquote>
<p>Intermediate data can also be saved after any of these steps, and can be
later loaded and used as a starting point for subsequent steps, just as in
the standard spectroscopic pipeline.  Parameter settings can also be saved
in a configuration file, for later re-use or batch processing.</p>
<p>Wavelength and spatial calibrations generally require different pre-processing
steps, or different input data altogether, so they cannot be generated at the
same time.  The pipeline interface will allow a previously generated wavelength
or spatial calibration file to be combined together with the new one in the
final input.  Optional previous spatial calibration input is provided to the
<em>wavecal</em> process in the <strong>Fit Lines</strong> step; optional previous wavelength
calibration input is provided to the  <em>spatcal</em> process in the <strong>Fit Traces</strong>
step.  If a previously generated file is not provided, the output file will
contain simulated data in the spatial or wavelength plane, as appropriate.</p>
</section>
<section id="reference-data">
<h4>Reference Data<a class="headerlink" href="#reference-data" title="Permalink to this heading">¶</a></h4>
<p>Line lists for wavelength calibration are stored in the standard reference
data directory for the instrument package
(<em>data/grism/line_lists</em>).  In these lists,
commented lines (beginning with ‘#’) are used for display only; uncommented
lines are attempted to be fit.  Initial guesses for the pixel position of
the line may be taken from a previous wavelength calibration, or from a
low-order fit to wavelength/position pairs input by the user.  Default
wavelength calibration files and line lists may be set by date, in the usual
way (see <em>data/grism/caldefault.txt</em>).</p>
<p>Spatial calibration uses only the assumed slit height in pixels and arcsec
as input data, as stored in the reference files in
<em>data/grism/order_mask</em>.  These values are not expected to change over time.</p>
</section>
<section id="display-tools">
<h4>Display Tools<a class="headerlink" href="#display-tools" title="Permalink to this heading">¶</a></h4>
<p>The pipeline incorporates several display tools for diagnostic purposes.
In addition to the DS9 display of the input and intermediate FITS files,
spatial profiles and extracted spectra are displayed in separate windows,
as in the standard spectroscopic pipeline. Identified lines for <em>wavecal</em>
are marked in the spectral display window (<a class="reference internal" href="#flitecam-wavecal-plots"><span class="std std-numref">Fig. 63</span></a>);
identified apertures for <em>spatcal</em> are marked in the spatial profile window
(<a class="reference internal" href="#flitecam-spatcal-plots"><span class="std std-numref">Fig. 64</span></a>).  Fit positions
and lines of constant wavelength or spatial position are displayed as
DS9 regions.  These region files are
also saved to disk, for later analysis.  Finally, after the line or trace
positions have been fit, a plot of the residuals, against X and Y position
is displayed in a separate window (<a class="reference internal" href="#flitecam-wavecal-residuals"><span class="std std-numref">Fig. 65</span></a>
and <a class="reference internal" href="#flitecam-spatcal-residuals"><span class="std std-numref">Fig. 66</span></a>). This plot is also saved to disk,
as a PNG file.</p>
</section>
<section id="id11">
<h4>Useful Parameters<a class="headerlink" href="#id11" title="Permalink to this heading">¶</a></h4>
<p>Some key parameters used specifically for the calibration modes are listed
below.  See above for descriptions of parameters for the steps shared with
the standard pipeline.</p>
<section id="wavecal-mode">
<h5>Wavecal Mode<a class="headerlink" href="#wavecal-mode" title="Permalink to this heading">¶</a></h5>
<ul>
<li><p><strong>Stack Dithers</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><em>Ignore dither information from header</em>: This option allows all
input dithers to be combined together, regardless of the dither
information in the header.  This option may be useful in generating
a high signal-to-noise image for wavelength identification.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Extract First Spectrum</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><em>Save extracted 1D spectra</em>: If set, a 1D spectrum is saved to disk
in Spextool format.  This may be useful for identifying line locations
in external interactive tools like xvspec (in the IDL Spextool package).</p></li>
<li><p><em>Aperture location method</em>: If ‘auto’, the most significant peak
in the spatial profile is selected as the initial spectrum region,
and the aperture radius is determined from the FWHM of the peak.
If ‘fix to center’, the center pixel of the slit is used as the
aperture location.  If ‘fix to input’, the value specified as the
aperture position is used as the aperture location.</p></li>
<li><p><em>Polynomial order for spectrum detrend</em>: If set to an integer 0
or higher, the extracted spectrum will be fit with a low order
polynomial, and this fit will be subtracted from the spectrum.  This
option may be useful to flatten a spectrum with a a strong trend,
which can otherwise interfere with line fits.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Identify Lines</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><em>Wave/space calibration file</em>: A previously generated wavelength
calibration file, to use for generating initial guesses of line
positions.  If a significant shift is expected from the last wavelength
calibration, the ‘Guess’ parameters below should be used instead.</p></li>
<li><p><em>Line list</em>: List of wavelengths to fit in the extracted spectrum.
Wavelengths should be listed, one per line, in microns.  If commented
out with a ‘#’, the line will be displayed in the spectrum as a dotted
line, but a fit to it will not be attempted.</p></li>
<li><p><em>Line type</em>: If ‘absorption’, only concave lines will be expected.  If
‘emission’, only convex lines are expected.  If ‘either’, concave and
convex lines may be fit.  Fit results for faint lines are generally
better if either ‘absorption’ or ‘emission’ can be specified.</p></li>
<li><p><em>Fit window</em>: Window (in pixels) around the guess position used as the
fitting data.  Smaller windows may result in more robust fits for faint
lines, if the guess positions are sufficiently accurate.</p></li>
<li><p><em>Expected line width (pixel)</em>: FWHM expected for the fit lines.</p></li>
<li><p><em>Guess wavelengths</em>: Comma-separated list of wavelengths for known
lines in the extracted spectrum.  If specified, must match the list
provided for <em>Guess wavelength position</em>, and the <em>Wave/space calibration
file</em> will be ignored.  If two values are provided, they will be fit with
a first-order polynomial to provide wavelength position guesses for
fitting. Three or more values will be fit with a second-order polynomial.</p></li>
<li><p><em>Guess wavelength position</em>: Comma-separated list of pixel positions for
known lines in the image.  Must match the provided <em>Guess wavelengths</em>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Reidentify Lines</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><em>Save extracted 1D spectra</em>: If set, all extracted spectra are saved to
disk in Spextool format, for more detailed inspection and analysis.</p></li>
<li><p><em>Aperture location method</em>: If ‘step up slit’, apertures will be placed
at regular intervals up the slit, with step size specified in <em>Step size</em>
and radius specified in <em>Aperture radius</em>.  If ‘fix to input’, then
apertures will be at the locations specified by <em>Aperture position</em>
and radius specified in <em>Aperture radius</em>.  If ‘auto’, apertures will
be automatically determined from the spatial profile.</p></li>
<li><p><em>Number of auto apertures</em>: If <em>Aperture location method</em> is ‘auto’,
this many apertures will be automatically located.</p></li>
<li><p><em>Aperture position</em>: Comma-separated list of aperture positions in pixels.
Apertures in multiple input files may also be specified, using
semi-colons to separate file input.
If <em>Aperture location method</em> is ‘auto’, these will be used as starting
points.  If ‘fix to input’, they will be used directly.</p></li>
<li><p><em>Aperture radius</em>: Width of the extracted aperture, in pixels.  The
radius may be larger than the step, allowing for overlapping spectra.
This may help get higher S/N for extracted spectra in sky frames.</p></li>
<li><p><em>Polynomial order for spectrum detrend</em>: As for the Extract First Spectrum
step, setting this parameter to an integer 0 or higher will detrend
it.  If detrending is used for the earlier step, it is recommended
for this one as well.</p></li>
<li><p><em>Fit window</em>: Window (in pixels) around the guess position used as the
fitting data.  The guess position used is the position in the initial
spectrum, so this window must be wide enough to allow for any curvature
in the line.</p></li>
<li><p><em>Signal-to-noise requirement</em>: Spectral S/N value in sigma, below
which a fit will not be attempted at that line position in that
extracted spectrum.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Fit Lines</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><em>Fit order for X</em>: Polynomial surface fit order in the X direction.
Orders 2-4 are recommended.</p></li>
<li><p><em>Fit order for Y</em>: Polynomial surface fit order in the Y direction.
Orders 2-4 are recommended.</p></li>
<li><p><em>Weight by line height</em>: If set, the surface fit will be weighted
by the height of the line at the fit position.  This can be useful
if there is a good mix of strong and weak lines across the array.
If there is an imbalance of strong and weak lines across the array,
this option may throw the fit off at the edges.</p></li>
<li><p><em>Spatial calibration file</em>: If provided, the spatial calibration plane
in the specified file will be combined with the wavelength fit to
produce the output calibration file (*WCL*.fits).  The default is the
wavelength calibration file from the previous series.  If not provided,
a simulated flat spatial calibration will be produced and attached to
the output calibration file.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="spatcal-mode">
<h5>Spatcal Mode<a class="headerlink" href="#spatcal-mode" title="Permalink to this heading">¶</a></h5>
<p>Aperture location and continuum tracing follow the standard spectroscopic
method, with the exception that units are all in pixels rather than
arcseconds.  See above for descriptions of the parameters for the
Locate Apertures and Trace Continuum steps.</p>
<p>See the <em>wavecal</em> mode descriptions, above, for useful parameters for
the Stack and Stack Dithers steps.</p>
<ul>
<li><p><strong>Fit Trace Positions</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><em>Fit order for X</em>: Polynomial surface fit order in the X direction.
Orders 2-4 are recommended.</p></li>
<li><p><em>Fit order for Y</em>: Polynomial surface fit order in the Y direction.
Orders 2-4 are recommended.</p></li>
<li><p><em>Weight by profile height</em>: If set, the surface fit will be weighted
by the height of the aperture in the spatial map at the fit position.</p></li>
<li><p><em>Wavelength calibration file</em>: If provided, the wavelength calibration
plane in the specified file will be combined with the spatial fit to
produce the output calibration file (*SCL*.fits).  The default is the
wavelength calibration file from the previous series.  If not provided,
pixel positions will be stored in the wavelength calibration plane in
the output file.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
</section>
</section>
<section id="slit-correction-image">
<h3>Slit Correction Image<a class="headerlink" href="#slit-correction-image" title="Permalink to this heading">¶</a></h3>
<p>The response spectra used to flux-calibrate spectroscopic
data encode variations in instrument response in the spectral dimension,
but do not account for variations in response in the spatial dimension. For
compact sources, spatial response variations have minimal impact on the
extracted 1D spectrum, but for extended targets or SLITSCAN observations, they
should be corrected for.</p>
<p>To do so, the pipeline divides out a flat field, called a slit correction
image, that contains normalized variations in response in the spatial
dimension only.</p>
<p>These slit correction images can be derived from wavelength-rectified
sky frames, as follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Median spectra are extracted at regular positions across the frame.</p></li>
<li><p>All spectra are divided by the spectrum nearest the center of
the slit.</p></li>
<li><p>The normalized spectra are fit with a low-order polynomial to derive
smooth average response variations across the full array.</p></li>
</ol>
</div></blockquote>
<p>The fit surface is the slit correction image.  It is stored as a single
extension FITS image, and can be provided to the standard spectroscopic
pipeline at the Make Profiles step.  These images should be regenerated
whenever the wavelength and spatial calibrations are updated, since the slit
correction image matches the rectified dimensions of the spectral data,
not the raw dimensions.</p>
<section id="id12">
<h4>Pipeline Interface<a class="headerlink" href="#id12" title="Permalink to this heading">¶</a></h4>
<p>Similar to the <em>wavecal</em> and <em>spatcal</em> modes described above, the pipeline
provides a <em>slitcorr</em> mode to produce slit correction images starting from
raw FITS files.  This mode can be invoked with a configuration flag:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux_pipe -c slitcorr=True /path/to/fits/files
</pre></div>
</div>
<p>The pre-processing steps in <em>slitcorr</em> reduction mode are the same as in the
standard pipeline reduction, except that the default for the stacking steps
is to add all chop/nod frames and average all input files, to produce a
high-quality sky frame.  Rectification and spatial profile generation also
proceeds as usual, using the latest available wavelength calibration file.</p>
<p>Thereafter, the <em>slitcorr</em> reduction performs the following steps.  Each step
has a number of tunable parameters; see below for parameter descriptions.</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Locate Apertures</strong>: a number of apertures are spaced evenly
across the slit.</p></li>
<li><p><strong>Extract Median Spectra</strong>: flux data is median-combined at each
wavelength position for each aperture.</p></li>
<li><p><strong>Normalize Response</strong>: median spectra are divided by the spectrum
nearest the center of the slit.  The 2D flux image is similarly
normalized, for reference.</p></li>
<li><p><strong>Make Slit Correction</strong>: the normalized spectra are fit with a
low-order polynomial to produce a smooth slit correction surface
that matches the rectified data dimensions.</p></li>
</ul>
</div></blockquote>
<p>Intermediate data can also be saved after any of these steps, and can be
later loaded and used as a starting point for subsequent steps, just as in
the standard spectroscopic pipeline.  Parameter settings can also be saved
in a configuration file, for later re-use or batch processing.</p>
</section>
<section id="id13">
<h4>Useful Parameters<a class="headerlink" href="#id13" title="Permalink to this heading">¶</a></h4>
<p>Some key parameters used specifically for the <em>slitcorr</em> mode are listed
below.  See above for descriptions of parameters for the steps shared with
the standard pipeline.</p>
<ul>
<li><p><strong>Locate Apertures</strong></p>
<ul class="simple">
<li><p><em>Number of apertures</em>: For this mode, apertures are evenly spaced
across the array.  Specify the desired number of apertures. The
radius for each aperture is automatically assigned to not overlap
with its neighbors.</p></li>
</ul>
</li>
<li><p><strong>Extract Median Spectra</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><em>Save extracted 1D spectra</em>: If set, all extracted spectra are saved to
disk in a FITS file in Spextool format, for inspection.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Normalize Response</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><em>Save extracted 1D spectra</em>: Save normalized spectra to disk in
Spextool format.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Make Slit Correction</strong></p>
<blockquote>
<div><ul>
<li><p>General Parameters</p>
<blockquote>
<div><ul class="simple">
<li><p><em>Fit method</em>: If ‘2D’, a single surface is fit to all the normalized
spectral data, producing a smooth low-order polynomial surface.  If
‘1D’, polynomial fits are performed in the y-direction only, at
each wavelength position, then are smoothed in the x-direction
with a uniform (boxcar) filter.  The 1D option may preserve
higher-order response variations in the x-direction; the 2D option
will produce a smoother surface.</p></li>
<li><p><em>Weight by spectral error</em>: If set, the polynomial fits will be
weighted by the error propagated for the normalized median spectra.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Parameters for 2D fit</p>
<blockquote>
<div><ul class="simple">
<li><p><em>Fit order for X</em>: Polynomial surface fit order in the X direction.
Orders 2-4 are recommended.</p></li>
<li><p><em>Fit order for Y</em>: Polynomial surface fit order in the Y direction.
Orders 2-4 are recommended.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Parameters for 1D fit</p>
<blockquote>
<div><ul class="simple">
<li><p><em>Fit order for Y</em>: Polynomial fit order in the Y direction.
Orders 2-4 are recommended.</p></li>
<li><p><em>Smoothing window for X</em>: Boxcar width for smoothing in X direction,
in pixels.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<figure class="align-default" id="flitecam-wavecal-plots">
<img alt="The Redux GUI window, several spectral plot displays with lines marked, and a DS9 window showing a spectral image." src="../../../_images/wavecal_plots.png" />
<figcaption>
<p><span class="caption-number">Fig. 63 </span><span class="caption-text">Wavecal mode reduction and diagnostic plots.</span><a class="headerlink" href="#flitecam-wavecal-plots" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="flitecam-spatcal-plots">
<img alt="GUI window, spatial profile plot display, and a DS9 window with a spectral image." src="../../../_images/spatcal_plots.png" />
<figcaption>
<p><span class="caption-number">Fig. 64 </span><span class="caption-text">Spatcal mode reduction and diagnostic plots.</span><a class="headerlink" href="#flitecam-spatcal-plots" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="flitecam-wavecal-residuals">
<img alt="An image marked with positions and vertical fit lines and a plot window showing fit residuals in X and Y." src="../../../_images/wavecal_residuals.png" />
<figcaption>
<p><span class="caption-number">Fig. 65 </span><span class="caption-text">Wavecal mode fit surface and residuals.</span><a class="headerlink" href="#flitecam-wavecal-residuals" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="flitecam-spatcal-residuals">
<img alt="An image marked with positions and horizontal fit lines and a plot window showing fit residuals in X and Y." src="../../../_images/spatcal_residuals.png" />
<figcaption>
<p><span class="caption-number">Fig. 66 </span><span class="caption-text">Spatcal mode fit surface and residuals.</span><a class="headerlink" href="#flitecam-spatcal-residuals" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>
</section>
<section id="appendix-d-change-notes-for-the-flitecam-pipeline">
<span id="flitecam-change-notes"></span><h2>Appendix D: Change notes for the FLITECAM pipeline<a class="headerlink" href="#appendix-d-change-notes-for-the-flitecam-pipeline" title="Permalink to this heading">¶</a></h2>
<section id="significant-changes">
<h3>Significant changes<a class="headerlink" href="#significant-changes" title="Permalink to this heading">¶</a></h3>
<p>Below are listed the most significant changes for the FLITECAM pipeline
over its history, highlighting impacts to science data products.
See the data handbooks or user manuals associated with each release
for more information.</p>
<p>All pipeline versions prior to v2.0.0 were implemented in IDL;
v2.0.0 and later were implemented in Python.  An early predecessor to the
FLITECAM Redux pipeline, called FDRP/FSpextool, was also released for
FLITECAM reductions in 2013, but no data in the SOFIA archive remains
that was processed with this pipeline.</p>
<p>For previously processed data, check the PIPEVERS keyword in the
FITS header to determine the pipeline version used.</p>
<section id="flitecam-redux-v2-0-0-2021-09-24">
<h4>FLITECAM Redux v2.0.0 (2021-09-24)<a class="headerlink" href="#flitecam-redux-v2-0-0-2021-09-24" title="Permalink to this heading">¶</a></h4>
<p><em>User manual: Rev. B</em></p>
<section id="all-modes">
<h5>All modes<a class="headerlink" href="#all-modes" title="Permalink to this heading">¶</a></h5>
<ul class="simple">
<li><p>Full reimplementation of the IDL pipeline into Python 3.</p></li>
</ul>
</section>
<section id="imaging">
<h5>Imaging<a class="headerlink" href="#imaging" title="Permalink to this heading">¶</a></h5>
<ul class="simple">
<li><p>Data formats change significantly.  Imaging products now separate
flux, error, and exposure map into separate FITS image extensions,
rather than storing them as a 3D cube in the primary extension.</p></li>
</ul>
</section>
<section id="spectroscopy">
<h5>Spectroscopy<a class="headerlink" href="#spectroscopy" title="Permalink to this heading">¶</a></h5>
<ul class="simple">
<li><p>Data formats change significantly.  Images and spectra are stored
in the same FITS file, under separate extensions.  Final 1D spectra
(CMB files, PRODTYPE=combined_spectrum) are still stored in the
same format as before; the spectrum corresponds to the SPECTRAL_FLUX
extension in the COA (PRODTYPE=coadded_spectrum) file.</p></li>
</ul>
</section>
</section>
<section id="flitecam-redux-v1-2-0-2017-12-15">
<h4>FLITECAM Redux v1.2.0 (2017-12-15)<a class="headerlink" href="#flitecam-redux-v1-2-0-2017-12-15" title="Permalink to this heading">¶</a></h4>
<p><em>User manual: Rev. A</em></p>
<section id="id14">
<h5>Imaging<a class="headerlink" href="#id14" title="Permalink to this heading">¶</a></h5>
<ul class="simple">
<li><p>Flux calibration procedure revised to separate telluric correction
from flux calibration.  Telluric correction is now performed on a
file-by-file basis, for better accuracy, after registration.  The
REG file is no longer saved by default; it is replaced by a TEL file
which is telluric-corrected but not flux calibration.  The final
calibration factor is still applied at the end of the pipeline, making
a single CAL file.  The CALFCTR stored in the header is now the
calibration factor at the reference altitude and zenith angle; it no
longer includes the telluric correction factor.  The latter value is
stored in the new keyword TELCORR.</p></li>
<li><p>Image registration default set to use the WCS for most image shifts,
instead of centroid or cross-correlation algorithms.</p></li>
</ul>
</section>
</section>
<section id="flitecam-redux-v1-1-0-2016-09-20">
<h4>FLITECAM Redux v1.1.0 (2016-09-20)<a class="headerlink" href="#flitecam-redux-v1-1-0-2016-09-20" title="Permalink to this heading">¶</a></h4>
<p><em>User manual: Rev. A</em></p>
<section id="id15">
<h5>Imaging<a class="headerlink" href="#id15" title="Permalink to this heading">¶</a></h5>
<ul class="simple">
<li><p>Flux calibration factors are now applied to data arrays to
convert them to physical units (Jy).  The calibrated data product
has file code CAL (PRODTYPE=calibrated).  COA files are no longer
designated Level 3, even if their headers contain calibration
factors.</p></li>
</ul>
</section>
<section id="id16">
<h5>Spectroscopy<a class="headerlink" href="#id16" title="Permalink to this heading">¶</a></h5>
<ul class="simple">
<li><p>Grism calibration incorporated into the pipeline, using stored
instrumental response files, similar to the FORCAST grism calibration
process.</p></li>
</ul>
</section>
</section>
<section id="flitecam-redux-v1-0-3-2015-10-06">
<h4>FLITECAM Redux v1.0.3 (2015-10-06)<a class="headerlink" href="#flitecam-redux-v1-0-3-2015-10-06" title="Permalink to this heading">¶</a></h4>
<p><em>User manual: Rev. -</em></p>
<section id="id17">
<h5>All modes<a class="headerlink" href="#id17" title="Permalink to this heading">¶</a></h5>
<ul class="simple">
<li><p>Minor bug fixes for filename handling and batch processing.</p></li>
</ul>
</section>
</section>
<section id="flitecam-redux-v1-0-2-2015-09-03">
<h4>FLITECAM Redux v1.0.2 (2015-09-03)<a class="headerlink" href="#flitecam-redux-v1-0-2-2015-09-03" title="Permalink to this heading">¶</a></h4>
<p><em>User manual: Rev. -</em></p>
<section id="id18">
<h5>Imaging<a class="headerlink" href="#id18" title="Permalink to this heading">¶</a></h5>
<ul class="simple">
<li><p>Improvements to the flat generation procedures.</p></li>
</ul>
</section>
</section>
<section id="flitecam-redux-v1-0-1-2015-05-14">
<h4>FLITECAM Redux v1.0.1 (2015-05-14)<a class="headerlink" href="#flitecam-redux-v1-0-1-2015-05-14" title="Permalink to this heading">¶</a></h4>
<p><em>User manual: Rev. -</em></p>
<section id="id19">
<h5>All modes<a class="headerlink" href="#id19" title="Permalink to this heading">¶</a></h5>
<ul class="simple">
<li><p>EXPTIME keyword updated to track total nominal on-source integration time.</p></li>
<li><p>ASSC_AOR keyword added to track all input AOR-IDs.</p></li>
</ul>
</section>
<section id="id20">
<h5>Imaging<a class="headerlink" href="#id20" title="Permalink to this heading">¶</a></h5>
<ul class="simple">
<li><p>Separate flat and sky files accommodated.</p></li>
<li><p>Flux calibration incorporated into pipeline, rather than applied as a
separate step.</p></li>
</ul>
</section>
</section>
<section id="flitecam-redux-v1-0-0-2015-01-23">
<h4>FLITECAM Redux v1.0.0 (2015-01-23)<a class="headerlink" href="#flitecam-redux-v1-0-0-2015-01-23" title="Permalink to this heading">¶</a></h4>
<p><em>User manual: Rev. -</em></p>
<section id="id21">
<h5>All modes<a class="headerlink" href="#id21" title="Permalink to this heading">¶</a></h5>
<ul class="simple">
<li><p>Integrated FLITECAM imaging algorithms (FDRP) with Spextool spectral
extraction algorithms, in a standard pipeline interface (Redux).</p></li>
</ul>
</section>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">FLITECAM Redux User’s Manual</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#si-observing-modes-supported">SI Observing Modes Supported</a><ul>
<li><a class="reference internal" href="#flitecam-instrument-information">FLITECAM instrument information</a></li>
<li><a class="reference internal" href="#flitecam-observing-techniques">FLITECAM observing techniques</a></li>
</ul>
</li>
<li><a class="reference internal" href="#algorithm-description">Algorithm Description</a><ul>
<li><a class="reference internal" href="#overview-of-data-reduction-steps">Overview of data reduction steps</a></li>
<li><a class="reference internal" href="#reduction-algorithms">Reduction algorithms</a><ul>
<li><a class="reference internal" href="#imaging-steps">Imaging steps</a><ul>
<li><a class="reference internal" href="#correct-for-detector-nonlinearity">Correct for detector nonlinearity</a></li>
<li><a class="reference internal" href="#clip-image-and-clean-bad-pixels">Clip image and clean bad pixels</a></li>
<li><a class="reference internal" href="#correct-gain">Correct gain</a></li>
<li><a class="reference internal" href="#subtract-background">Subtract background</a></li>
<li><a class="reference internal" href="#register-images">Register images</a></li>
<li><a class="reference internal" href="#correct-for-atmospheric-transmission">Correct for atmospheric transmission</a></li>
<li><a class="reference internal" href="#coadd-multiple-observations">Coadd multiple observations</a></li>
<li><a class="reference internal" href="#calibrate-flux">Calibrate flux</a></li>
<li><a class="reference internal" href="#mosaic">Mosaic</a></li>
</ul>
</li>
<li><a class="reference internal" href="#spectroscopy-reduction-algorithms">Spectroscopy Reduction algorithms</a><ul>
<li><a class="reference internal" href="#image-processing">Image Processing</a></li>
<li><a class="reference internal" href="#stack-common-dithers">Stack common dithers</a></li>
<li><a class="reference internal" href="#rectify-spectral-image">Rectify spectral image</a></li>
<li><a class="reference internal" href="#flitecam-set-apertures">Identify apertures</a></li>
<li><a class="reference internal" href="#spectral-extraction-and-merging">Spectral extraction and merging</a></li>
<li><a class="reference internal" href="#calibrate-flux-and-correct-for-atmospheric-transmission">Calibrate flux and correct for atmospheric transmission</a></li>
<li><a class="reference internal" href="#combine-multiple-observations">Combine multiple observations</a></li>
<li><a class="reference internal" href="#response-spectra">Response spectra</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#other-resources">Other Resources</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flux-calibration">Flux calibration</a><ul>
<li><a class="reference internal" href="#imaging-flux-calibration">Imaging Flux Calibration</a><ul>
<li><a class="reference internal" href="#reduction-steps">Reduction steps</a></li>
<li><a class="reference internal" href="#color-corrections">Color corrections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#spectrophotometric-flux-calibration">Spectrophotometric Flux Calibration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-products">Data products</a><ul>
<li><a class="reference internal" href="#filenames">Filenames</a></li>
<li><a class="reference internal" href="#pipeline-products">Pipeline Products</a></li>
<li><a class="reference internal" href="#data-format">Data Format</a></li>
</ul>
</li>
<li><a class="reference internal" href="#grouping-level-1-data-for-processing">Grouping LEVEL_1 data for processing</a></li>
<li><a class="reference internal" href="#configuration-and-execution">Configuration and execution</a><ul>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#external-requirements">External Requirements</a></li>
<li><a class="reference internal" href="#source-code-installation">Source Code Installation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#input-data">Input data</a></li>
<li><a class="reference internal" href="#automatic-mode-execution">Automatic Mode Execution</a></li>
<li><a class="reference internal" href="#manual-mode-execution">Manual Mode Execution</a><ul>
<li><a class="reference internal" href="#basic-workflow">Basic Workflow</a></li>
<li><a class="reference internal" href="#display-features">Display Features</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flitecam-reduction">FLITECAM Reduction</a><ul>
<li><a class="reference internal" href="#imaging-reduction">Imaging Reduction</a><ul>
<li><a class="reference internal" href="#useful-parameters">Useful Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#grism-reduction">Grism Reduction</a><ul>
<li><a class="reference internal" href="#id9">Useful Parameters</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#data-quality-assessment">Data quality assessment</a></li>
<li><a class="reference internal" href="#appendix-a-sample-configuration-files">Appendix A: Sample configuration files</a></li>
<li><a class="reference internal" href="#appendix-b-required-input-keywords">Appendix B: Required input keywords</a></li>
<li><a class="reference internal" href="#appendix-c-calibration-data-generation">Appendix C: Calibration Data Generation</a><ul>
<li><a class="reference internal" href="#instrumental-response-curve">Instrumental Response Curve</a><ul>
<li><a class="reference internal" href="#id10">Useful Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#wavelength-calibration-map">Wavelength Calibration Map</a><ul>
<li><a class="reference internal" href="#calibration-principles">Calibration Principles</a></li>
<li><a class="reference internal" href="#pipeline-interface">Pipeline Interface</a></li>
<li><a class="reference internal" href="#reference-data">Reference Data</a></li>
<li><a class="reference internal" href="#display-tools">Display Tools</a></li>
<li><a class="reference internal" href="#id11">Useful Parameters</a><ul>
<li><a class="reference internal" href="#wavecal-mode">Wavecal Mode</a></li>
<li><a class="reference internal" href="#spatcal-mode">Spatcal Mode</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#slit-correction-image">Slit Correction Image</a><ul>
<li><a class="reference internal" href="#id12">Pipeline Interface</a></li>
<li><a class="reference internal" href="#id13">Useful Parameters</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix-d-change-notes-for-the-flitecam-pipeline">Appendix D: Change notes for the FLITECAM pipeline</a><ul>
<li><a class="reference internal" href="#significant-changes">Significant changes</a><ul>
<li><a class="reference internal" href="#flitecam-redux-v2-0-0-2021-09-24">FLITECAM Redux v2.0.0 (2021-09-24)</a><ul>
<li><a class="reference internal" href="#all-modes">All modes</a></li>
<li><a class="reference internal" href="#imaging">Imaging</a></li>
<li><a class="reference internal" href="#spectroscopy">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flitecam-redux-v1-2-0-2017-12-15">FLITECAM Redux v1.2.0 (2017-12-15)</a><ul>
<li><a class="reference internal" href="#id14">Imaging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flitecam-redux-v1-1-0-2016-09-20">FLITECAM Redux v1.1.0 (2016-09-20)</a><ul>
<li><a class="reference internal" href="#id15">Imaging</a></li>
<li><a class="reference internal" href="#id16">Spectroscopy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flitecam-redux-v1-0-3-2015-10-06">FLITECAM Redux v1.0.3 (2015-10-06)</a><ul>
<li><a class="reference internal" href="#id17">All modes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flitecam-redux-v1-0-2-2015-09-03">FLITECAM Redux v1.0.2 (2015-09-03)</a><ul>
<li><a class="reference internal" href="#id18">Imaging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flitecam-redux-v1-0-1-2015-05-14">FLITECAM Redux v1.0.1 (2015-05-14)</a><ul>
<li><a class="reference internal" href="#id19">All modes</a></li>
<li><a class="reference internal" href="#id20">Imaging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flitecam-redux-v1-0-0-2015-01-23">FLITECAM Redux v1.0.0 (2015-01-23)</a><ul>
<li><a class="reference internal" href="#id21">All modes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../../../_sources/manuals/flitecam/users/users.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>