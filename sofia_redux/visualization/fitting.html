<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Fitting Curves to Data &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    
    <script src="../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <link rel="icon" href="../../_static/redux.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Reference Spectral Data" href="reference.html" />
    <link rel="prev" title="Models" href="models.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="reference.html" title="Reference Spectral Data">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="models.html" title="Models">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="index.html" accesskey="U">sofia_redux.visualization: The Eye of SOFIA</a> &#187;</li>
      
      <li>Fitting Curves to Data</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="fitting-curves-to-data">
<span id="fitting"></span><h1>Fitting Curves to Data<a class="headerlink" href="#fitting-curves-to-data" title="Permalink to this heading">¶</a></h1>
<p>A common desire when exploring data is to fit some kind of line to the data,
and the Eye of SOFIA obliges. Through keyboard shortcuts, the user can
select a range of data and have a simple two component model fit to the
selection. The fit is overplotted on the data for a quick check on if the fit
worked, while the parameters of the fit are displayed in a separate window,
where they can be saved to file.</p>
<p>The fitting methods are found the the
<a class="reference internal" href="../../api/sofia_redux.visualization.display.pane.Pane.html#sofia_redux.visualization.display.pane.Pane" title="sofia_redux.visualization.display.pane.Pane"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pane</span></code></a> class
(described in more
detail <a class="reference internal" href="plotting.html#plotting"><span class="std std-ref">Plotting</span></a>). The process of fitting data requires interacting
with both the data and the GUI. Only the <code class="docutils literal notranslate"><span class="pre">Pane</span></code> object has easy access to
both. Additionally, if the data has been altered in any way from its original
values read from the FITS file (such as changing units), then only the
<code class="docutils literal notranslate"><span class="pre">Pane</span></code> object has access to the data with the correct values.</p>
<p>The kinds of curves available to fit to data are shown in
<a class="reference internal" href="#available-fits"><span class="std std-ref">Models Available for Curve Fitting</span></a>. All models include fitting a baseline model to the data
(linear model for spectra, plane for an image). The baseline improves the
quality of the fit as the curve itself no longer has to account for any
background and can focus more the feature of interest.</p>
<table class="docutils align-default" id="available-fits">
<caption><span class="caption-number">Table 41 </span><span class="caption-text">Models Available for Curve Fitting</span><a class="headerlink" href="#available-fits" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Data Type</p></th>
<th class="head"><p>Model</p></th>
<th class="head"><p>Available</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="4"><p>Spectrum</p></td>
<td><p>1D Gaussian</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>1D Moffat</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>Lorentz</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>Linear</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>Image</p></td>
<td><p>2D Gaussian</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>2D Moffat</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>Sersic</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>Planar</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<section id="selecting-data">
<h2>Selecting Data<a class="headerlink" href="#selecting-data" title="Permalink to this heading">¶</a></h2>
<p>The first step to fitting a curve to data is to select the data to be fit.
The process is initialized by pressing the “F” key, setting the figure to
selection mode. This uses the same methods as the zooming process to reduce
the limits of the plot. While in selection mode the Eye will record the data
coordinates of any place the user clicks. When two coordinates are recorded
the selection mode ends and the <em>x</em>-coordinates of the points are passed to
the <code class="docutils literal notranslate"><span class="pre">Pane</span></code> object for fitting. The <em>y</em>-coordinates of the points are not
used. Currently there are no non-interactive methods for selecting the data
range.</p>
</section>
<section id="method">
<span id="fitting-methods"></span><h2>Method<a class="headerlink" href="#method" title="Permalink to this heading">¶</a></h2>
<p>Once the data range has been selected it is passed to the <code class="docutils literal notranslate"><span class="pre">perform_fit</span></code>
method of the <code class="docutils literal notranslate"><span class="pre">Pane</span></code> class, where it determines which kind of model to fit
to the data, which determines which fitting method gets called. The first
step is to select the subsample of data to apply the curve fitting algorithm
to. For each order in each dataset loaded in the pane, all <em>x</em> data within the
<em>x</em>-axis limits along with the corresponding <em>y</em> data are retrieved. The
<em>y</em>-axis limits are not used. Only data points where both the <em>x</em> and <em>y</em>
values are not NaN are used for for fitting.</p>
<p>Once the subset is ready it is used to create a rough initial guess for the
curve parameters. For example, a Gaussian fit has <em>amplitude</em>, <em>mean</em>, and
<em>stddev</em> parameters. The <em>amplitude</em> is initialized to the <em>y</em> value in the
middle pixel less the median <em>y</em> value, the <em>mean</em> is initialized to the <em>x</em>
value in the middle pixel, and <em>sigma</em> is initialized to <span class="math notranslate nohighlight">\(1/3\)</span> of the
width of the <em>x</em> window.  Additionally, bounds to the parameters are set to
speed up the curve fit. For a Gaussian all paramters are allowed to span the
set of real numbers except for the <em>mean</em>, which is restricted to lie within
the <em>x</em> window, and the <em>sigma</em>, which is restricted to positive values less
than the width of the <em>x</em> window.</p>
<p>With the initial values set the curve models can be initialized. The Eye uses
curve models from the <code class="xref py py-class docutils literal notranslate"><span class="pre">astropy.modeling</span></code> module. All curves fit to
data are a composite of the requested curve and a baseline curve. For
example, fitting a Gaussian to a spectrum feature would result in fitting a
a combined
<code class="xref py py-class docutils literal notranslate"><span class="pre">Gaussian1D</span></code> and
<code class="xref py py-class docutils literal notranslate"><span class="pre">Linear1D</span></code> model.</p>
<p>The actual fitting is done with scipy’s
<code class="xref py py-class docutils literal notranslate"><span class="pre">curve_fit</span></code> function
. While <code class="xref py py-class docutils literal notranslate"><span class="pre">astropy.modeling</span></code> models have built-in fitting routines, they
tend
to be unreliable. The <code class="xref py py-class docutils literal notranslate"><span class="pre">scipy</span></code> routines produce more consistently good
fits.
However if errors are encountered while fitting, the error is logged and the
dataset is skipped. If no errors were raised, the fitted curve is then
displayed.</p>
</section>
<section id="displaying-results">
<span id="fitting-display"></span><h2>Displaying Results<a class="headerlink" href="#displaying-results" title="Permalink to this heading">¶</a></h2>
<p>The results of a curve fit are displayed in two ways. First the curve itself
is plotted over the data for visual inspection on the quality of fit. Second
the parameters of all fits are displayed in a separate window.</p>
<p>Plotting the curve for a 1D fit involves plotting two distinct lines. The
first is the fitted curve itself. The second is a vertical line located at
the fit’s centroid. Both of these artists are added to the <code class="docutils literal notranslate"><span class="pre">Gallery</span></code> class
as described in <a class="reference internal" href="drawing.html#gallery"><span class="std std-ref">Gallery</span></a>. An example is shown in
<a class="reference internal" href="#spectrum-with-fit"><span class="std std-ref">Spectrum with Fit</span></a>.</p>
<p>The separate window is controlled by the
<a class="reference internal" href="../../api/sofia_redux.visualization.display.fitting_results.FittingResults.html#sofia_redux.visualization.display.fitting_results.FittingResults" title="sofia_redux.visualization.display.fitting_results.FittingResults"><code class="xref py py-class docutils literal notranslate"><span class="pre">FittingResults</span></code></a>
class.
The window is a simple QtTable widget that lists the details of all fits
performed, as outlined in <a class="reference internal" href="#fit-parameters"><span class="std std-ref">Curve Fit Parameters Displayed</span></a>. An example is shown in
<a class="reference internal" href="#results-table"><span class="std std-ref">Results window</span></a>.
If the fitting method is invoked an additional time, the parameters
of the new fit are appended to the end of the table. The table can be cleared
of all results with the “Clear Table” button. Additionally the table can be
written to a CSV file with the “Save Table” button. If one or more rows are
selected when the “Save Table” button is pressed only the selected rows
will be written to file.</p>
<table class="docutils align-default" id="fit-parameters">
<caption><span class="caption-number">Table 42 </span><span class="caption-text">Curve Fit Parameters Displayed</span><a class="headerlink" href="#fit-parameters" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>filename</p></td>
<td><p>Name of FITS file</p></td>
</tr>
<tr class="row-odd"><td><p>order</p></td>
<td><p>Spectral order curve was fit to</p></td>
</tr>
<tr class="row-even"><td><p>x_field</p></td>
<td><p>Data field on <em>x</em>-axis (e.g. “wavepos”)</p></td>
</tr>
<tr class="row-odd"><td><p>y_field</p></td>
<td><p>Data field on <em>y</em>-axis (e.g. “spectral_flux”)</p></td>
</tr>
<tr class="row-even"><td><p>mean</p></td>
<td><p>Centroid of <code class="docutils literal notranslate"><span class="pre">Gaussian1D</span></code> fit</p></td>
</tr>
<tr class="row-odd"><td><p>stddev</p></td>
<td><p>Sigma of <code class="docutils literal notranslate"><span class="pre">Gaussian1D</span></code> fit</p></td>
</tr>
<tr class="row-even"><td><p>amplitude</p></td>
<td><p>Peak value of <code class="docutils literal notranslate"><span class="pre">Gaussian1D</span></code> fit.</p></td>
</tr>
<tr class="row-odd"><td><p>baseline</p></td>
<td><p>Value of <code class="docutils literal notranslate"><span class="pre">Linear1D</span></code> fit at “mean”</p></td>
</tr>
<tr class="row-even"><td><p>base_intercept</p></td>
<td><p><em>y</em>-intercept of <code class="docutils literal notranslate"><span class="pre">Linear1D</span></code> fit</p></td>
</tr>
<tr class="row-odd"><td><p>base_slope</p></td>
<td><p>Slope of <code class="docutils literal notranslate"><span class="pre">Linear1D</span></code> fit</p></td>
</tr>
<tr class="row-even"><td><p>lower_limit</p></td>
<td><p>Lower limit of <em>x</em>-coordinates of the fitting window</p></td>
</tr>
<tr class="row-odd"><td><p>upper_limit</p></td>
<td><p>Upper limit of <em>x</em>-coordinates of the fitting window</p></td>
</tr>
</tbody>
</table>
<figure class="align-center" id="spectrum-with-fit">
<a class="reference internal image-reference" href="../../_images/spectrum_with_fit.png"><img alt="Gaussian fit to spectrum." src="../../_images/spectrum_with_fit.png" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 134 </span><span class="caption-text">Eye of SOFIA displaying FORCAST grism data with a Gaussian
fit to a feature.</span><a class="headerlink" href="#spectrum-with-fit" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-center" id="results-table">
<a class="reference internal image-reference" href="../../_images/fitting_results_table.png"><img alt="Gaussian fit to spectrum." src="../../_images/fitting_results_table.png" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 135 </span><span class="caption-text">Parameters for a Gaussian fit to a feature in a FORCAST grism
dataset.</span><a class="headerlink" href="#results-table" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Fitting Curves to Data</a><ul>
<li><a class="reference internal" href="#selecting-data">Selecting Data</a></li>
<li><a class="reference internal" href="#method">Method</a></li>
<li><a class="reference internal" href="#displaying-results">Displaying Results</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../../_sources/sofia_redux/visualization/fitting.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>