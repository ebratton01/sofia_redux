<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sofia_redux.instruments.flitecam.calcvar &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/plot_directive.css" />
    
    <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../../_static/copybutton.js"></script>
    <link rel="icon" href="../../../../_static/redux.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sofia_redux.instruments.flitecam.calcvar</h1><div class="highlight"><pre>
<span></span># Licensed under a 3-clause BSD style license - see LICENSE.rst

from astropy import log
from astropy.io import fits
import numpy as np

__all__ = [&#39;calcvar&#39;]


<div class="viewcode-block" id="calcvar"><a class="viewcode-back" href="../../../../api/sofia_redux.instruments.flitecam.calcvar.calcvar.html#sofia_redux.instruments.flitecam.calcvar.calcvar">[docs]</a>def calcvar(data, header):
    &quot;&quot;&quot;
    Calculate read and poisson noise from raw FLITECAM images.

    The variance is calculated using the procedure outlined by
    Vacca et al. (2004). As such this procedure is appropriate
    for data read using M/CDS (Multiple / correlated double
    sampling; Fowler sampling). The standard deviation (error) can
    then be calculated by taking the square root of the variance array.

    Parameters
    ----------
    data : numpy.ndarray
        Linearity corrected image array.
    header : astropy.io.fits.Header
        Raw image header.

    Returns
    -------
    numpy.ndarray
        Image array with the same dimensions as the input raw image
        containing the calculated variance.
    &quot;&quot;&quot;
    if not isinstance(data, np.ndarray) or len(data.shape) != 2:
        log.error(&quot;Must provide valid data array&quot;)
        return

    if not isinstance(header, fits.header.Header):
        log.error(&quot;Must provide valid header&quot;)
        return

    # FLITECAM constants, provided by instrument PI
    gain = 7.1
    rms_readnoise = 43.0

    # time keywords from header
    itime = header.get(&#39;ITIME&#39;)
    coadds = header.get(&#39;COADDS&#39;)
    ndr = header.get(&#39;NDR&#39;)
    readtime = header.get(&#39;TABLE_MS&#39;)

    if None in [itime, coadds, ndr, readtime]:
        log.error(&quot;Missing time keywords in header&quot;)
        return

    readtime /= 1000.
    datavar = np.abs(data) / (gain * ndr * coadds**2 * itime**2)
    crtn = 1. - (readtime * (ndr**2 - 1.) / (3. * itime * ndr))
    readnoise_var = (2. * rms_readnoise**2) / (ndr * coadds
                                               * gain**2 * itime**2.)

    var = datavar * crtn + readnoise_var

    return var</div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>