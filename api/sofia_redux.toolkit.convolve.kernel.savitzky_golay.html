<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>savitzky_golay &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="icon" href="../_static/redux.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="KernelConvolve" href="sofia_redux.toolkit.convolve.kernel.KernelConvolve.html" />
    <link rel="prev" title="convolve" href="sofia_redux.toolkit.convolve.kernel.convolve.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="sofia_redux.toolkit.convolve.kernel.KernelConvolve.html" title="KernelConvolve">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="sofia_redux.toolkit.convolve.kernel.convolve.html" title="convolve">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../sofia_redux/index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../manuals/exes/developers/developers.html" accesskey="U">EXES Redux Developer’s Manual</a> &#187;</li>
      
      <li>savitzky_golay</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="savitzky-golay">
<h1>savitzky_golay<a class="headerlink" href="#savitzky-golay" title="Permalink to this heading">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="sofia_redux.toolkit.convolve.kernel.savitzky_golay">
<span class="sig-prename descclassname"><span class="pre">sofia_redux.toolkit.convolve.kernel.</span></span><span class="sig-name descname"><span class="pre">savitzky_golay</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_error</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">robust</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxiter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignorenans</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/toolkit/convolve/kernel.html#savitzky_golay"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.toolkit.convolve.kernel.savitzky_golay" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply a least-squares (Savitzky-Golay) polynomial filter</p>
<p>Convenience wrapper for toolkit.convolve.kernel.SavgolConvolve</p>
<p>Any NaN or False “mask” values will be interpolated over before
filtering.  Error will be propagated correctly and will account
for interpolation over masked/NaN values or outliers removed during
“robust” iteration.</p>
<p>Arguments are supplied in the following order:
[x0, x1, … xn], values, window, [optional parameters]</p>
<p>where x are dimension coordinates supplied in the same order
as the axes of values.  Therefore, if you supplied arguments
in the order x, y, z then you should expect the zeroth axis
of z to relate to the x-coordinates and the first axis of z
to relate to the y-coordinates.  This is contrary to standard
numpy (row (y), col (x)) ordering.  For consistency with numpy,
one would supply the arguments in the y, x, z order.</p>
<p>The x0, x1,… independent values do not need to be supplied,
and instead, the features of values will be used to generate
a regular grid of coordinates.  Be aware however that the
independent variables are used to rescale window widths if
“scale” is set to True, and also used for linear interpolation
over masked, NaN, or identified outliers (if “robust”).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>args</strong><span class="classifier">(ndim + 2)-tuple or 2-tuple</span></dt><dd><ul class="simple">
<li><p>args[-1] contains the filtering window width.  This
should be a positive integer greater than order and less
than the size of the image.</p></li>
<li><p>args[-2] contains the dependent variables as an array
of shape (shape).  If independent variables were supplied,
(shape) must match across args[:ndim + 1].  Otherwise, the
dimension and shape is determined by args[-2].</p></li>
<li><p>args[:ndim] contain the independent variables.  These are
used for interpolation purposes or “scale” and should be of
size (shape).  However, they do not need to be specified if
interpolation is being carried out on a regular grid.  In this
case, the user should just supply the dependent variables as an
array of the correct dimension and shape.</p></li>
</ul>
</dd>
<dt><strong>order</strong><span class="classifier">int, optional</span></dt><dd><p>Order of polynomial to use in designing the filter.  Higher
orders produce sharper features.</p>
</dd>
<dt><strong>error</strong><span class="classifier">float or array_like of float (shape), optional</span></dt><dd><p>Dependent variable errors to propagate</p>
</dd>
<dt><strong>mask</strong><span class="classifier">array_like or bool (shape), optional</span></dt><dd><p>Mask indicating good (True) and bad (False) samples.  Bad values
will not be included in the fit and will be replaced with linear
interpolation prior to filtering.</p>
</dd>
<dt><strong>do_error</strong><span class="classifier">bool, optional</span></dt><dd><p>If True, return the propagated error in addition to the filtered
data.</p>
</dd>
<dt><strong>robust</strong><span class="classifier">int or float, optional</span></dt><dd><p>If &gt; 0, taken as the sigma threshold above which to identify
outliers.  Outliers are those identified as
abs(x_i - x_med) / MAD &gt; “robust”
where x is the residual of (data - fit) x_med is the median, MAD
is the median absolute deviation defined as
1.482 * median(abs(x_i - x_med)).  The fit will be iterated upon
until the set of identified outliers does not change, or any
change in the relative RMS is less than “eps”, or “maxiter”
iterations have occured.</p>
</dd>
<dt><strong>eps</strong><span class="classifier">float, optional</span></dt><dd><p>The limit of fractional check in RMS if “robust” is &gt; 0</p>
</dd>
<dt><strong>maxiter</strong><span class="classifier">int, optional</span></dt><dd><p>The maximum number iterations if “robust” is &gt; 0</p>
</dd>
<dt><strong>model</strong><span class="classifier">bool, optional</span></dt><dd><p>If set, return the fitting model with lots of nice little
methods and statistics to play with.</p>
</dd>
<dt><strong>scale</strong><span class="classifier">bool, optional</span></dt><dd><p>If True, scale “window” to the average spacing between samples
over each dimension.  Note that this replaces “width” in the
old IDL version.  This option should not be used if working in
multiple non-orthogonal features, as average spacing per
dimension is taken as the average separation between ordered
dimensional coordinates.</p>
</dd>
<dt><strong>ignorenans</strong><span class="classifier">bool, optional</span></dt><dd><p>If True (default and highly recommended), NaNs will be removed
and interpolated over.</p>
</dd>
<dt><strong>kwargs</strong><span class="classifier">dict, optional.</span></dt><dd><p>Optional keywords and values that would be passed into
scipy.signal.savgol_filter.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>filtered_data</strong><span class="classifier">numpy.ndarray of numpy.float64 (shape) or Model</span></dt><dd><p>The filtered data or an instance of toolkit.base.Model.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Edge conditions are handled differently according to whether the
data is one dimensional or not.  If it is, then extrapolation is
permitted.  However, extrapolation is not permitted in features
of &gt; 2.  In these cases, everything should work as expected
unless the corner samples are NaN.  Interpolation is not possible
and NaNs will be applied to the filtered array according to
width/2 of the window centered on the corner NaN.</p>
<p>Also note, the IDL version “robustsg” was only 1-dimensional and
savitzky_golay will perform exactly the same in this case.</p>
<p class="rubric">Examples</p>
<p>Generate coefficients for cubic-polynomial with a window of 5</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtered</span> <span class="o">=</span> <span class="n">savitzky_golay</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="o">/</span><span class="mi">35</span><span class="p">,</span> <span class="mi">12</span><span class="o">/</span><span class="mi">35</span><span class="p">,</span> <span class="mi">17</span><span class="o">/</span><span class="mi">35</span><span class="p">,</span> <span class="mi">12</span><span class="o">/</span><span class="mi">35</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="o">/</span><span class="mi">35</span><span class="p">])</span>
</pre></div>
</div>
<p>2-dimensional example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[:</span><span class="mi">11</span><span class="p">,</span> <span class="p">:</span><span class="mi">11</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Coordinates are inferred if not supplied</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">filtered1</span> <span class="o">=</span> <span class="n">savitzky_golay</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtered2</span> <span class="o">=</span> <span class="n">savitzky_golay</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">filtered1</span><span class="p">,</span> <span class="n">filtered2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filtered3</span> <span class="o">=</span> <span class="n">savitzky_golay</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">filtered1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># window = (5, 5) x, y pixels</span>
<span class="go">25</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">filtered3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># window = (11, 5) x, y, pixels</span>
<span class="go">55</span>
</pre></div>
</div>
<p>Note that in the last case, scale scaled the x window width
to 11 pixels since the average spacing in x is 0.5.  i.e. a
window width of 1 is equal to 2 x-pixels.  Therefore, the window
is expanded to 2 * 5 = 10, and then an extra pixel is added on
to ensure that the filter is centered (odd number of pixels).</p>
</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">savitzky_golay</a><ul>
<li><a class="reference internal" href="#sofia_redux.toolkit.convolve.kernel.savitzky_golay"><code class="docutils literal notranslate"><span class="pre">savitzky_golay()</span></code></a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/sofia_redux.toolkit.convolve.kernel.savitzky_golay.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>