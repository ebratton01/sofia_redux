<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>combine_nods &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="icon" href="../_static/redux.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="correct_lambda" href="sofia_redux.instruments.fifi_ls.correct_wave_shift.correct_lambda.html" />
    <link rel="prev" title="combine_extensions" href="sofia_redux.instruments.fifi_ls.combine_nods.combine_extensions.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="sofia_redux.instruments.fifi_ls.correct_wave_shift.correct_lambda.html" title="correct_lambda">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="sofia_redux.instruments.fifi_ls.combine_nods.combine_extensions.html" title="combine_extensions">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../sofia_redux/index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../manuals/fifils/developers/developers.html" accesskey="U">FIFI-LS Redux Developer’s Manual</a> &#187;</li>
      
      <li>combine_nods</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="combine-nods">
<h1>combine_nods<a class="headerlink" href="#combine-nods" title="Permalink to this heading">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="sofia_redux.instruments.fifi_ls.combine_nods.combine_nods">
<span class="sig-prename descclassname"><span class="pre">sofia_redux.instruments.fifi_ls.combine_nods.</span></span><span class="sig-name descname"><span class="pre">combine_nods</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filenames</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offbeam</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b_nod_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nearest'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">write</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/fifi_ls/combine_nods.html#combine_nods"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.fifi_ls.combine_nods.combine_nods" title="Permalink to this definition">¶</a></dt>
<dd><p>Combine nods of ramp-fitted, chop-subtracted data.</p>
<p>Writes a single FITS file to disk for each A nod found.  Each
HDU list contains n_san binary table extensions, each containing
DATA and STDDEV data cubes, each 5x5x18.  The output filename is
created from the input filename, with the suffix ‘CSB’, ‘RP0’ or
‘RP1’ replaced with ‘NCM’, and with input file numbers numbers
concatenated.  Unless specified, the output directory is the same
as the input files.</p>
<p>Input files should have been generated by <code class="xref py py-obj docutils literal notranslate"><span class="pre">subtract_chops</span></code>, or
<code class="xref py py-obj docutils literal notranslate"><span class="pre">fit_ramps</span></code> (for total power mode, which has no chops).</p>
<p>The procedure is:</p>
<blockquote>
<div><ol class="arabic">
<li><p>Read header information from each extension in each of the
input files, making lists of A data and B data, with relevant
metadata (dither) position, date/time observed (DATE-OBS),
inductosyn position, channel, nod style).</p></li>
<li><p>Loop though all A data to find matching B data</p>
<blockquote>
<div><p>a. asymmetric nod style: find closest B nod in time with the
same channel and inductosyn position.  Dither position does
not have to match, B data can be used more than once, and
data must be subtracted rather than added.</p>
<p>b. symmetric nod style: find closest B nod in time with the
same channel, inductosyn position, and dither position. Each
B nod can only be used once, since it contains a source
observation, and data must be added rather than subtracted.</p>
</div></blockquote>
</li>
</ol>
<p>3. After addition or subtraction, create a FITS file and write
results to disk.</p>
</div></blockquote>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>filenames</strong><span class="classifier">array_like of str</span></dt><dd><p>File paths to the data to be combined</p>
</dd>
<dt><strong>offbeam</strong><span class="classifier">bool, optional</span></dt><dd><p>If True, swap ‘A’ nods with ‘B’ nods and the following
associated keywords: DLAM_MAP &lt;-&gt; DLAM_OFF,
DBET_MAP &lt;-&gt;  DBET_OFF. This option cannot be used with
OTF-mode A nods.</p>
</dd>
<dt><strong>b_nod_method</strong><span class="classifier">{‘nearest’, ‘average’, ‘interpolate’}, optional</span></dt><dd><p>For asymmetric, data this option controls how the nearest B nods
are combined. The ‘nearest’ option takes only the nearest B nod
in time.  The ‘average’ option averages the nearest before and
after B nods.  The ‘interpolate’ option linearly interpolates the
nearest before and after B nods to the time of the A data.</p>
</dd>
<dt><strong>outdir</strong><span class="classifier">str, optional</span></dt><dd><p>Directory path to write output.  If None, output files
will be written to the same directory as the input files.</p>
</dd>
<dt><strong>write</strong><span class="classifier">bool, optional</span></dt><dd><p>If True, write to disk and return the path to the output
file.  If False, return the HDUL.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl>
<dt>pandas.DataFrame</dt><dd><p>The output pandas dataframe contains a huge variety of
information indexed by original filename.  The combined
A-B FITS data are located in the ‘chdul’ column.  Note that
only A nod files contain combined data in this ‘chdul’
column.  For example, in order to extract combined FITS
data, one could issue the command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>df = combine_nods(filenames)
combined_hduls = df[df[&#39;nodbeam&#39;] == &#39;A&#39;][&#39;chdul&#39;]
</pre></div>
</div>
<p>In order to extract rows from the dataframe that were not
combined issue the command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>not_combined = df[(df[&#39;nodbeam&#39;] == &#39;A&#39;) &amp; (df[&#39;chdul&#39;] == None)]
</pre></div>
</div>
<p>files are considered ‘combined’ if at least one A extension was
combined for an A-nod file.  A true signifier of whether an
extension was combined (both A and B nod files) can be found in the
‘combined’ column as a list of bools, one for each extension.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">combine_nods</a><ul>
<li><a class="reference internal" href="#sofia_redux.instruments.fifi_ls.combine_nods.combine_nods"><code class="docutils literal notranslate"><span class="pre">combine_nods()</span></code></a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/sofia_redux.instruments.fifi_ls.combine_nods.combine_nods.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>