<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>EXES Redux User’s Manual &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    
    <script src="../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <link rel="icon" href="../../../_static/redux.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="FIFI-LS Redux User’s Manual" href="../../fifils/users/users.html" />
    <link rel="prev" title="SOFIA Redux" href="../../../sofia_redux/index.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="../../fifils/users/users.html" title="FIFI-LS Redux User’s Manual">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="../../../sofia_redux/index.html" title="SOFIA Redux">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../../../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../../../sofia_redux/index.html" accesskey="U">SOFIA Redux</a> &#187;</li>
      
      <li>EXES Redux User’s Manual</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="exes-redux-user-s-manual">
<h1>EXES Redux User’s Manual<a class="headerlink" href="#exes-redux-user-s-manual" title="Permalink to this heading">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>The SI Pipeline Users Manual (OP10) is intended for use by both SOFIA
Science Center staff during routine data processing and analysis, and
also as a reference for General Investigators (GIs) and archive users to
understand how the data in which they are interested was processed. This
manual is intended to provide all the needed information to execute the
SI Level 2 Pipeline, flux calibrate the results, and assess the data
quality of the resulting products. It will also provide a description of
the algorithms used by the pipeline and both the final and intermediate
data products.</p>
<p>A description of the current pipeline capabilities, testing results,
known issues, and installation procedures are documented in the SI
Pipeline Software Version Description Document (SVDD, SW06, DOCREF). The
overall Verification and Validation (V&amp;V) approach can be found in the
Data Processing System V&amp;V Plan (SV01-2232). Both documents can be
obtained from the SOFIA document library in Windchill.</p>
<p>This manual applies to EXES Redux version 3.0.0.</p>
</section>
<section id="si-observing-modes-supported">
<h2>SI Observing Modes Supported<a class="headerlink" href="#si-observing-modes-supported" title="Permalink to this heading">¶</a></h2>
<section id="exes-observing-techniques">
<h3>EXES observing techniques<a class="headerlink" href="#exes-observing-techniques" title="Permalink to this heading">¶</a></h3>
<p>EXES is a mid-infrared instrument, which implies that its observations
must be taken with care in order to remove the effects of the spatially
and temporally variable sky background. Unlike some other mid-infrared
instruments, EXES does not make use of the chopping secondary mirror,
but it does use telescope nods to alternate the object observation with
a sky observation.</p>
<p>EXES has four basic nod patterns: stare, nod-on-slit, nod-off-slit, and
map. The stare mode is simply a continuous observation of a source, with
no telescope offsets to sky. This mode is primarily used for testing,
rather than for science observations. In either of the nodding modes,
the telescope moves in order to take frames at two different positions
(the A position and the B position). For nod-along-slit mode, the frames
alternate between placing the source at the bottom and top of the slit.
This mode can be used for relatively compact sources (FWHM less than a
quarter of the slit). For nod-off-slit mode, the frames alternate
between the source and a patch of blank sky. This mode is useful for
extended sources or crowded fields. Sky background for either nodding
mode is removed by subtracting the two adjacent nod beams. Typically,
EXES does a BA nod pattern, so that the nod pair is every second frame
minus the previous frame. In map mode, the telescope starts in blank
sky, then steps the source across the slit, and then returns to blank
sky. The sky frames are averaged together to reduce their noise, and
then subtracted from each source frame. This mode is used to map
extended sources.</p>
<p>Before each observation sequence, EXES takes a series of calibration
frames: typically a dark frame and a spectrum of a blackbody in the same
configuration as the science observation. The dark frame is
subtracted from the black frame, and the difference is used as a flat
field for the 2D object spectrum. The black frame is also used to
determine the edges of the orders in cross-dispersed modes.</p>
</section>
<section id="exes-instrument-configurations">
<h3>EXES instrument configurations<a class="headerlink" href="#exes-instrument-configurations" title="Permalink to this heading">¶</a></h3>
<p>EXES is a spectroscopic instrument that uses a slit to provide a spatial
dimension and gratings to provide a spectral dimension. EXES has two
gratings used for science: the echelle grating and the echelon. The
echelle grating, used alone, produces single-order long-slit spectra. The
Medium resolution configuration for EXES uses the echelle grating as the primary
disperser at angles 30-65 degrees; the Low resolution configuration uses
the echelle grating at angles less than 30 degrees. When the echelon
grating is used as the primary disperser and the echelle grating is used
as a secondary disperser, EXES produces multi-order, cross-dispersed
spectra. In this configuration, the wavelength coverage and the number
of orders is determined by the echelle angle. The High-Medium resolution
configuration uses an echelle angle of 30-65 degrees. The High-Low
resolution configuration uses an angle of less than 30 degrees.</p>
<p>The slit height and width for all modes can be varied depending on the
observational needs, although the length is limited in the
cross-dispersed modes by the requirement that echelon orders must not
overlap.</p>
<p>EXES also has an imaging configuration, but it is used primarily
for testing and for acquiring targets for spectroscopic observations. It
is not used for science and will not be addressed in this document.</p>
</section>
</section>
<section id="algorithm-description">
<h2>Algorithm Description<a class="headerlink" href="#algorithm-description" title="Permalink to this heading">¶</a></h2>
<section id="overview-of-data-reduction-steps">
<h3>Overview of data reduction steps<a class="headerlink" href="#overview-of-data-reduction-steps" title="Permalink to this heading">¶</a></h3>
<p>This section will describe, in general terms, the major algorithms that
the EXES Redux pipeline uses to reduce an EXES observation.</p>
<p>See <a class="reference internal" href="#exes-flowchart"><span class="std std-numref">Fig. 1</span></a> for a flowchart of the processing steps used
by the pipeline.</p>
<figure class="align-default" id="exes-flowchart">
<img alt="Flowchart of processing steps for EXES data with cartoon depictions of all steps.  Under &quot;Reformat data&quot;: correct nonlinearity, coadd readout frames.  Under &quot;Make calibration files&quot;: process flat field.  Under &quot;Correct for background and instrumental response&quot;: despike, debounce, subtract sky, flat correct, clean bad pixels.  Under &quot;Rectify and combine spectral images&quot;: undistort, coadd frames.  Under &quot;Extract and combine expectra&quot;: identify apertures, extract spectra, combine spectra." src="../../../_images/exes_flowchart.png" />
<figcaption>
<p><span class="caption-number">Fig. 1 </span><span class="caption-text">Processing steps for EXES data.</span><a class="headerlink" href="#exes-flowchart" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="reduction-algorithms">
<h3>Reduction algorithms<a class="headerlink" href="#reduction-algorithms" title="Permalink to this heading">¶</a></h3>
<p>The following subsections detail each of the data reduction pipeline
steps:</p>
<blockquote>
<div><ul class="simple">
<li><p>Correct nonlinearity and coadd readout frames</p></li>
<li><p>Process flat field</p></li>
<li><p>Correct outliers (despike)</p></li>
<li><p>Correct optical shifts (debounce)</p></li>
<li><p>Subtract sky</p></li>
<li><p>Flat correct</p></li>
<li><p>Clean bad pixels</p></li>
<li><p>Rectify spectral orders (undistort)</p></li>
<li><p>Coadd frames</p></li>
<li><p>Identify apertures</p></li>
<li><p>Extract spectra</p></li>
<li><p>Combine multiple spectra</p></li>
</ul>
</div></blockquote>
<section id="correct-nonlinearity-and-coadd-readout-frames">
<h4>Correct nonlinearity and coadd readout frames<a class="headerlink" href="#correct-nonlinearity-and-coadd-readout-frames" title="Permalink to this heading">¶</a></h4>
<p>Raw EXES data is stored in FITS image files, as a 3D data cube in which
each plane corresponds to a digitized readout of the array.
Readouts can be destructive or non-destructive. The readout method can
vary for EXES, so the pattern of readout actions used for a particular
observation is recorded in the OTPAT header keyword. The value for OTPAT
is a combination of the letters S, T, N, D, and C, each with a digit
afterwards. The letters have the following meaning:</p>
<ul class="simple">
<li><p>S = spin (no reset, no digitization). This action effectively
increases the integration time.</p></li>
<li><p>T = trash (reset, no digitization). This action resets the array
without storing the previous value.</p></li>
<li><p>N = non-destructive read (no reset, but digitized). This action
stores the current value of the array.</p></li>
<li><p>D = destructive read (reset and digitization). This action stores the
current value, and resets the array.</p></li>
<li><p>C = coadd (reset and digitization). This action coadds previous reads
in hardware and resets the array.</p></li>
</ul>
<p>The digit after each letter gives the number of times the action was
taken, minus one. For example: S0 is one spin, N3 is four
non-destructive reads.</p>
<p>The pattern listed in the OTPAT can then be repeated any number of times
(<span class="math notranslate nohighlight">\(n_{pat}\)</span>), so that the final number of frames in the raw file is
<span class="math notranslate nohighlight">\(n_{pat} (n_{nd} + n_d)\)</span>,
where <span class="math notranslate nohighlight">\(n_{nd}\)</span> is the number of nondestructive reads and
<span class="math notranslate nohighlight">\(n_d\)</span> is the number of destructive reads per pattern.</p>
<p>Since near-infrared detectors do not have completely linear responses to
incoming flux, each frame in the raw file may optionally be corrected for
nonlinearity before proceeding. The nonlinearity coefficients for EXES
were determined by taking a series of nondestructive flat exposures,
followed by a single destructive read. Each readout was subtracted from
a bias frame, then the resulting counts in each pixel were fit with a
polynomial. The linearity correction algorithm reads in these polynomial
coefficients from a 3D array and uses them to calculate a correction
factor for each pixel in each raw readout. Pixels with counts below the
bias level, or above the maximum value used to calculate the
nonlinearity coefficients at that pixel, have no correction applied.</p>
<p>After linearity correction, in order to create a usable estimate of the
input flux, the non-destructive and destructive reads must be combined
in a way that maximizes the signal-to-noise. The EXES pipeline currently
has support for combining frames taken with the patterns listed in the
following subsections. Equations for the net signal and the associated
variance come from Vacca et. al., 2004 (see <a class="reference internal" href="#exes-resources"><span class="std std-ref">Other Resources</span></a>).
After this initial calculation of the variance for each image pixel, the
variance plane is propagated along with the image through all pipeline
steps.</p>
<p>After the frames for each pattern are combined according to the
algorithms below, the pipeline checks whether multiple patterns were
taken at the same nod position. This is recorded in the header keyword
NINT. If NINT is greater than 1, then NINT coadded patterns are averaged
together before proceeding.  Optionally, one or more of the initial
patterns may be discarded before averaging.</p>
<figure class="align-default" id="exes-raw-frames">
<img alt="Left: square frame with small hatching patterns. Middle: diagonal dark lines, overlaid with hatching patterns. Right: diagonal bright lines, no hatching patterns." src="../../../_images/raw_frames.png" />
<figcaption>
<p><span class="caption-number">Fig. 2 </span><span class="caption-text">Sample raw frames in nod-off-slit, High-Medium configuration: a
pedestal image (left), a final destructive read (middle), and
the Fowler coadd (right).  The bright spectrum is visible as a
dark line in the final raw readout and a bright line in the coadd.</span><a class="headerlink" href="#exes-raw-frames" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<section id="all-destructive-mode">
<h5>All destructive mode<a class="headerlink" href="#all-destructive-mode" title="Permalink to this heading">¶</a></h5>
<p>In this mode, each frame is a destructive read. There may be spins in
between reads to increase integration time, but there are no
non-destructive reads. In this case, the flux is simply the read signal
(<em>s</em>), minus a standard bias frame (<em>b</em>) stored on disk, subtracted
from a zero value (<em>z</em>), corresponding to a dark current, and divided by
the integration time (<span class="math notranslate nohighlight">\(\Delta t\)</span>) and the pre-amp gain factor
(<span class="math notranslate nohighlight">\(g_p\)</span>):</p>
<div class="math notranslate nohighlight">
\[I_{net} = z - \frac{(s - b)}{\Delta t\ g_p}.\]</div>
<p>The dark current is typically zero for EXES.</p>
<p>The variance associated with this readout mode is the Poisson noise
(first term) plus the readout noise (second term):</p>
<div class="math notranslate nohighlight">
\[V = \frac{I_{net}}{g\ \Delta t} + \frac{{\sigma_{read}}^{2}}{g^2\ {\Delta t}^{2}},\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma_{read}\)</span> is the read noise, and <em>g</em> is the gain factor (to
convert from ADU to electrons).</p>
<p>This readout mode may optionally be used for any readout pattern, ignoring
the non-destructive reads and using the final destructive read only.</p>
</section>
<section id="fowler-mode">
<h5>Fowler mode<a class="headerlink" href="#fowler-mode" title="Permalink to this heading">¶</a></h5>
<p>In this mode, a number of non-destructive reads are taken at the
beginning of the integration, the array integrates for a while, then a
number of non-destructive reads and a single destructive read are taken
at the end of the integration. The initial reads are averaged together
to estimate the “pedestal” level; the final reads are averaged together
to estimate the total signal. The pedestal is then subtracted from the
total signal to get the net signal. We then subtract the negative signal
from a zero value (<em>z</em>) and divide by the pre-amp gain factor (<span class="math notranslate nohighlight">\(g_p\)</span>)
and the integration time (<span class="math notranslate nohighlight">\(\Delta t\)</span>, the time between the first pedestal read
and the first signal read). The net flux is then:</p>
<div class="math notranslate nohighlight">
\[I_{net} = z - \frac{1}{n_r\ \Delta t\ g_p} \left( \sum_{i=1}^{n_r} s_i - \sum_{i=1}^{n_r}p_i \right).\]</div>
<p>We assume that the number of reads (<span class="math notranslate nohighlight">\(n_r\)</span>) is the same for the pedestal
and the signal.</p>
<p>The variance associated with this readout mode is:</p>
<div class="math notranslate nohighlight">
\[V = \frac{I_{net}}{g\ \Delta t}\left( 1 - \frac{\delta t \left( {n_r}^{2} - 1 \right)}{3\ \Delta t\ n_r} \right) + \frac{2\ {\sigma_{read}}^2}{g^2\ {\Delta t}^2\ n_r}.\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\delta t\)</span> is the frame time, <span class="math notranslate nohighlight">\(\sigma_{read}\)</span> is the read noise, and <em>g</em> is
the gain factor to convert from ADU to electrons.</p>
<p>Sample OTPAT values for Fowler mode look like this:</p>
<ul class="simple">
<li><p><strong>N0 D0</strong>: a single non-destructive/destructive pair. This is the minimal
Fowler case: the first read is the pedestal, the second read is the
signal. There are 2 frames per pattern.</p></li>
<li><p><strong>N3 S15 N2 D0</strong>: a Fowler 4 set. This set comprises 4 non-destructive
reads, 16 spins to increase the integration time, 3 non-destructive
reads, and a destructive read. There are 8 frames per pattern.</p></li>
</ul>
</section>
<section id="sample-up-the-ramp-mode">
<h5>Sample-up-the-ramp mode<a class="headerlink" href="#sample-up-the-ramp-mode" title="Permalink to this heading">¶</a></h5>
<p>In this mode, non-destructive reads are taken at even intervals
throughout the integration. The count values for all reads are fit with
a straight line; the slope of this line gives the net flux. As with the
other modes, we then subtract from the zero value and divide by the
pre-amp gain and the integration time. The net flux for the
evenly-sampled case is calculated as:</p>
<div class="math notranslate nohighlight">
\[I_{net} = z - \frac{12}{n_r\ \left( n_r + 1 \right) \Delta t\ g_p} \left( \sum_{i = 1}^{n_r} s_{i}\left\lbrack i - \frac{n_{r} + 1}{2} \right\rbrack \right),\]</div>
<p>where <span class="math notranslate nohighlight">\(n_r\)</span> is the total number of reads (non-destructive and
destructive).</p>
<p>The variance associated with this readout mode is:</p>
<div class="math notranslate nohighlight">
\[V = \frac{6\ I_{net} \left( {n_r}^2 + 1 \right)}{5\ g\ \Delta t\ n_r\ \left( n_r + 1 \right)} + \frac{12\ {\sigma_{read}}^{2} \left( n_r - 1 \right)}{g^2\ {\Delta t}^2\ n_r\ \left( n_r + 1 \right)}.\]</div>
<p>Sample OTPAT values for sample-up-the-ramp mode look like this:</p>
<ul class="simple">
<li><p><strong>N0 S3 N0 S3 N0 S3 D0</strong>: Sample-up-the-ramp with 4 spins in between each
non-destructive read, ending with a destructive read. There are 4
frames per pattern.</p></li>
</ul>
</section>
<section id="coadding">
<h5>Coadding<a class="headerlink" href="#coadding" title="Permalink to this heading">¶</a></h5>
<p>If the OT pattern contains a coadd (C), it is treated as a destructive
read for which the appropriate combination has already been done. That
is, if the pattern indicates Fowler mode, for example, the intensity is
simply calculated as for a destructive read:</p>
<div class="math notranslate nohighlight">
\[I_{net} = z - \frac{s}{\Delta t\ g_p},\]</div>
<p>but the variance is calculated from the net intensity as for the Fowler
mode, above.</p>
</section>
</section>
<section id="process-flat-field">
<h4>Process flat field<a class="headerlink" href="#process-flat-field" title="Permalink to this heading">¶</a></h4>
<p>Each EXES reduction requires a flat observation taken in the same mode
as the science data. The instrument configuration (eg. HIGH_MED or
MEDIUM), central wavenumber, slit height, slit width, and grating angle
must all match. This flat observation is used to correct for spectral
and spatial instrumental gain variations, and to calibrate the source
intensity of the science observation.</p>
<p>The flat observation consists of an observation of a blackbody in
EXES’s calibration box (<em>black</em>) and a dark frame (<em>dark</em>). If the
blackbody’s temperature is known, then dividing the sky-subtracted science
frame by <em>black-dark</em>, normalized by the blackbody function, gives a calibrated
intensity as follows (Lacy et. al., 2002, see <a class="reference internal" href="#exes-resources"><span class="std std-ref">Other Resources</span></a>).</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}S_{\nu}(black-dark) &amp;= B_{\nu}(T_{black})\ R_{\nu}\\S_{\nu}(obj-sky) &amp;\approx I_{\nu}(obj)\ R_{\nu}\\I_{\nu}(obj) &amp;\approx S_{\nu}(obj-sky)\ \frac{B_{\nu}(T_{black})}{S_{\nu}(black-dark)}\end{aligned}\end{align} \]</div>
<p>where <span class="math notranslate nohighlight">\(S_{\nu}\)</span> is the measured signal, <span class="math notranslate nohighlight">\(B_{\nu}(T)\)</span>
is the blackbody function at temperature <em>T</em>, and <span class="math notranslate nohighlight">\(R_{\nu}\)</span>
is the instrumental responsivity. The master flat frame produced by
the EXES pipeline, therefore, is the blackbody function calculated at the
temperature recorded in the flat frame’s header (BB_TEMP) and the central
wavenumber for the observation (WAVENO0), divided by
<em>black-dark</em> (<a class="reference internal" href="#exes-flat-frames"><span class="std std-numref">Fig. 3</span></a>). <a class="footnote-reference brackets" href="#fn-correct-calibration" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-correct-calibration" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>The flat value as derived is an approximation to the calibration
function for all data in the spectrum: the true value depends
slightly on the wavenumber value for each pixel in the spectrum. In
pipeline version 3.0.0 and later, a correction for this wavenumber
dependence is applied directly to the 2D spectral data, immediately
following the undistort pipeline step.</p>
</aside>
</aside>
<p>In all instrument configurations, the <em>black</em> frame is also used to
determine an illumination mask that defines the good pixels for
extraction. In the cross-dispersed modes, the <em>black</em> frame is further
used to determine the edges of the orders for extraction and to check
the optical distortion parameters. The pipeline cleans and undistorts
the <em>black</em> frame, takes its derivative, then performs a 2D FFT of the
resulting image to determine the spacing and orientation of the orders
on the array. In particular, the value of <span class="math notranslate nohighlight">\(k_{rot}\)</span>, the angle of the
order rotation, is adjusted automatically at this step: it is calculated
from the characteristics of the FFT, then used to recompute the
undistortion of the <em>black</em> frame, and redo the FFT, until the value of
<span class="math notranslate nohighlight">\(k_{rot}\)</span> converges, or 5 iterations are reached. This process must be
closely monitored: if the <em>black</em> frame has insufficient signal, or the
optical parameters used to calculate the distortion correction are
insufficiently accurate, the spacing and rotation angle may be wrongly
calculated at this step. These values can be manually overridden in
parameters for the pipeline if necessary.</p>
<p>The distortion parameters and order definitions, as determined from the
<em>black</em> frame, are written to the header of the master flat, to be used
in later reduction steps.</p>
<figure class="align-default" id="exes-flat-frames">
<img alt="Left: square frame with wide diagonal stripes of variable illumination. Right: diagonal stripes, overlaid with flat patches at top and lower middle of the square.  The flat patches in the Right image correspond to dark areas in the Left image." src="../../../_images/flat_frames.png" />
<figcaption>
<p><span class="caption-number">Fig. 3 </span><span class="caption-text">Sample flat in High-Medium configuration. The left image is the
black frame; the right image is the final processed flat frame.
Unilluminated regions are set to zero in the final frame.</span><a class="headerlink" href="#exes-flat-frames" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="despike">
<h4>Despike<a class="headerlink" href="#despike" title="Permalink to this heading">¶</a></h4>
<p>After coadding the raw frames to make A and B nod frames, the pipeline
attempts to identify and correct spikes (outlier data points) in the
individual images. All A frames are compared, and any pixels with values
greater than a threshold number of standard deviations from the mean
value across the other frames are replaced with that mean value. B
frames are similarly compared with each other. The threshold for
identifying spikes is a tunable parameter; the default value is 20
sigma. Also in the despike step, frames with significantly different
overall background levels (“trashed” frames) may be identified
automatically and removed from subsequent reduction. It is common, for
example, for the first frame to look significantly different from the
rest of the frames. In this case, leaving out this frame may improve the
signal-to-noise of the final result.</p>
<p>Optionally, all input files may be combined at the despike step, prior to
performing the outlier analysis.  If the background levels do not differ
significantly from one file to the next, this option can help perform
better despiking on short or truncated observations.</p>
</section>
<section id="debounce">
<h4>Debounce<a class="headerlink" href="#debounce" title="Permalink to this heading">¶</a></h4>
<p>After despiking, there is an optional step called debouncing, which may
help alleviate the effects of small optics shifts (“bounces”) between
the nod beams. If there is a slight mismatch in the order placement on
the array, it can lead to poor background subtraction when the nods are
subtracted. In the debouncing algorithm, each nod pair is undistorted,
then the B nod is shifted slightly in the spatial direction and
differenced with the A nod. The shift direction that results in a
minimum squared difference (summed over the spectral direction) is used
as the bounce direction. The amplitude of the shift is controlled by the
bounce parameter, which should be set to a number whose absolute value
is between 0 and 1 (typically 0.1). If the bounce parameter is set to a
positive number, only the above shift (the first-derivative bounce) will
be corrected. If the bounce parameter is set to a negative value (e.g.
-0.1), the debouncing algorithm will also attempt to fix the
second-derivative bounce by smoothing the A or B nod slightly; the
amount of smoothing is also controlled by the absolute value of the
bounce parameter. Note that if the observed source is too near the edge
of the order, it may confuse the debouncing algorithm; in this case, it
is usually best to turn debouncing off (i.e. set the bounce parameter to
0). The default is not to use the debounce algorithm.</p>
</section>
<section id="subtract-sky">
<h4>Subtract sky<a class="headerlink" href="#subtract-sky" title="Permalink to this heading">¶</a></h4>
<p>In either nod-on-slit or nod-off-slit mode, each B nod is subtracted
from each adjacent A nod (<a class="reference internal" href="#exes-nodsub"><span class="std std-numref">Fig. 4</span></a>). This step usually removes most of the
background emission from the image, but if there were changes in the sky
level between the two nod frames, there may still be some residual sky
signal. For the nod-off-slit mode, this residual signal can be estimated
and corrected for before subtracting the nods, by subtracting a weighted
fraction of the B data from the A data. The weighting is chosen to
minimize the squared difference between the A and B nods. For the
nod-on-slit mode, the mean background at each wavelength may be
subtracted after nod subtraction and distortion correction, so that the
wavelengths align with columns in the image. The pipeline performs this
step immediately before coadding, if desired.</p>
<figure class="align-default" id="exes-nodsub">
<img alt="Left: square frame with bright diagonal stripes.  The source stands out from the background as a single bright spectral trace. Right: square frame with bright and dark diagonal stripes. The source is nodded on array, so appears as a positive (bright) and negative (dark) spectral trace in each order." src="../../../_images/nodsub.png" />
<figcaption>
<p><span class="caption-number">Fig. 4 </span><span class="caption-text">Background subtracted frames in nod-off-slit (left) and nod-on-slit (right),
in High-Medium configuration.</span><a class="headerlink" href="#exes-nodsub" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>For the mapping mode, each of the steps across the source is treated as
an A frame. The three sky frames taken at the end of the map are
averaged together and this average is subtracted from each A frame
(<a class="reference internal" href="#exes-mapsub"><span class="std std-numref">Fig. 5</span></a>). This mode is usually used for extended sources that
fill the entire slit, in which case there is no way to estimate or correct
for any residual background remaining after sky subtraction. The three sky
frames at the end of the map can be part of the map (without science target
signal) or dedicated sky positions away from the source.</p>
<figure class="align-default" id="exes-mapsub">
<img alt="Square frame with wide bright diagonal stripes." src="../../../_images/mapsub.png" />
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">Background subtracted image in High-Medium configuration with map
mode.  The extended source fills the entire slit.</span><a class="headerlink" href="#exes-mapsub" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="flat-correct">
<h4>Flat correct<a class="headerlink" href="#flat-correct" title="Permalink to this heading">¶</a></h4>
<p>After background subtraction, each science frame is multiplied by the
processed flat calibration frame, described above. This has the effect
of both correcting the science frame for instrumental response and
calibrating it to intensity units.</p>
</section>
<section id="clean-bad-pixels">
<h4>Clean bad pixels<a class="headerlink" href="#clean-bad-pixels" title="Permalink to this heading">¶</a></h4>
<p>In this step, bad pixels are identified and corrected. Bad pixels may
first be identified in a bad pixel mask, provided by the instrument
team. In this FITS image, pixels that are known to be bad are marked
with a value of 0; good pixels are marked with a value of 1.
Alternately, bad pixels may be identified from their noise
characteristics: if the error associated with a pixel is
greater than a threshold value (by default: 20) times the mean error
for the frame, then it is marked as a bad pixel. Unlike the
despike algorithm, which identifies outliers by comparing separate
frames, outliers in this algorithm are identified by comparing the
values within a single frame.</p>
<p>Bad pixels may be corrected by using neighboring good values to linearly
interpolate over the bad ones. The search for good pixels checks first
in the y-direction, then in the x-direction. If good pixels cannot be
identified within a 10-pixel radius, then the bad pixel will not be
corrected.  Alternately, bad pixels may be flagged for later handling
by setting their values to NaN.  In this case, bad pixels are ignored
in later coaddition and extraction steps.</p>
<p>Note that bad pixels may also be fixed or ignored in the spectral
extraction process, so it is not critical to correct all bad pixels at
this stage.</p>
</section>
<section id="undistort">
<h4>Undistort<a class="headerlink" href="#undistort" title="Permalink to this heading">¶</a></h4>
<p>Next, the pipeline corrects the image for optical distortion, resampling
the image onto a regular grid of spatial and spectral elements. The EXES
distortion correction uses knowledge of the optical design of the
instrument, as well as data recorded in the header of the observation,
to calculate and correct for the optical distortion in each observation.</p>
<p>The optical parameters used to calculate the distortion correction are
listed in the table below. Most of these parameters should not change,
or should change rarely, so they have default values listed in
configuration tables available to the pipeline (the <em>.dat</em> files listed
below). Values in the <em>tortparm.dat</em> configuration table tend to change
over time, as the instrument is adjusted, so their defaults vary by
date. Some of the distortion parameters must come from the headers and
do not have default values. One parameter is tuned at run-time
(<em>krot</em>), and one must be manually optimized by the user (<em>waveno0</em>).</p>
<table class="docutils align-default" id="id4">
<caption><span class="caption-number">Table 1 </span><span class="caption-text">Optical distortion parameters.</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Default
value</strong></p></th>
<th class="head"><p><strong>Source</strong></p></th>
<th class="head"><p><strong>Comment</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>hrfl</em></p></td>
<td><p>(varies by
date)</p></td>
<td><p><em>tortparm.dat</em></p></td>
<td><p>High
resolution
chamber focal
length</p></td>
</tr>
<tr class="row-odd"><td><p><em>xdfl</em></p></td>
<td><p>(varies by
date)</p></td>
<td><p><em>tortparm.dat</em></p></td>
<td><p>Assumed
cross-
dispersed
focal length</p></td>
</tr>
<tr class="row-even"><td><p><em>slitrot</em></p></td>
<td><p>(varies by
date)</p></td>
<td><p><em>tortparm.dat</em></p></td>
<td><p>Slit rotation</p></td>
</tr>
<tr class="row-odd"><td><p><em>detrot</em></p></td>
<td><p>(varies by
date)</p></td>
<td><p><em>tortparm.dat</em></p></td>
<td><p>Detector
rotation</p></td>
</tr>
<tr class="row-even"><td><p><em>hrr</em></p></td>
<td><p>(varies by
date)</p></td>
<td><p><em>tortparm.dat</em></p></td>
<td><p>R number for
echelon
grating</p></td>
</tr>
<tr class="row-odd"><td><p><em>brl</em></p></td>
<td><p>0.00</p></td>
<td><p><em>tortparm.dat</em></p></td>
<td><p>Barrel
distortion
parameter</p></td>
</tr>
<tr class="row-even"><td><p><em>x0brl</em></p></td>
<td><p>0.00</p></td>
<td><p><em>tortparm.dat</em></p></td>
<td><p>X-coordinate
for the center
of the barrel
distortion</p></td>
</tr>
<tr class="row-odd"><td><p><em>y0brl</em></p></td>
<td><p>0.00</p></td>
<td><p><em>tortparm.dat</em></p></td>
<td><p>Y-coordinate
for the center
of the barrel
distortion</p></td>
</tr>
<tr class="row-even"><td><p><em>hrg</em></p></td>
<td><p>-0.015</p></td>
<td><p><em>headerdef.dat</em></p></td>
<td><p>Gamma (out of
plane) angle
for the
echelon
grating
(radians)</p></td>
</tr>
<tr class="row-odd"><td><p><em>xdg</em></p></td>
<td><p>0.033</p></td>
<td><p><em>headerdef.dat</em></p></td>
<td><p>Gamma angle
for
cross-
dispersion
grating
(radians)</p></td>
</tr>
<tr class="row-even"><td><p><em>xdlrdgr</em></p></td>
<td><p>0.001328</p></td>
<td><p><em>headerdef.dat</em></p></td>
<td><p>Low resolution
groove spacing
(cm)</p></td>
</tr>
<tr class="row-odd"><td><p><em>xdmrdgr</em></p></td>
<td><p>0.003151</p></td>
<td><p><em>headerdef.dat</em></p></td>
<td><p>Medium
resolution
groove spacing
(cm)</p></td>
</tr>
<tr class="row-even"><td><p><em>pixelwd</em></p></td>
<td><p>0.0025</p></td>
<td><p><em>headerdef.dat</em></p></td>
<td><p>Pixel width</p></td>
</tr>
<tr class="row-odd"><td><p><em>waveno0</em></p></td>
<td><p>(none)</p></td>
<td><p>Header keyword
WAVENO0</p></td>
<td><p>Planned
central
wavenumber</p></td>
</tr>
<tr class="row-even"><td><p><em>echelle</em></p></td>
<td><p>(none)</p></td>
<td><p>Header keyword
ECHELLE</p></td>
<td><p>Echelle
grating angle
(deg)</p></td>
</tr>
<tr class="row-odd"><td><p><em>krot</em></p></td>
<td><p>(varies by
date)</p></td>
<td><p><em>tortparm.dat</em>
/</p>
<p>Optimized at
run-time</p>
</td>
<td><p>Rotation
between
chambers</p></td>
</tr>
</tbody>
</table>
<p>Several of these parameters are then combined or recalculated before
being used in the distortion correction. The cross-dispersed R number
(<em>xdr</em>) is calculated from the groove spacing (<em>xdlrdgr</em> or <em>xdmrdgr</em>),
the grating angle (<em>echelle</em>), and the central wavenumber (<em>waveno0</em>).
The expected order spacing for cross-dispersed modes is calculated from the
cross-dispersed R number (<em>xdr</em>), the cross-dispersed focal length
(<em>xdfl</em>), the pixel width (<em>pixelwd</em>), and the echelon gamma angle
(<em>hrg</em>). The order spacing and the rotation angle (<em>krot</em>) are optimized
for cross-dispersed modes when the calibration frame is processed, as
described above.</p>
<p>The distortion correction equations calculate undistorted coordinates by
correcting for the following effects for the cross-dispersed modes:</p>
<ul class="simple">
<li><p>slit skewing within orders due to the echelon “smile” (<em>hrg, hrr,
slitrot</em>)</p></li>
<li><p>nonlinearity of the echelon spectrum (<em>hrr, pixelwd, hrfl</em>)</p></li>
<li><p>skewing by spectrum rotation on the detector due to the angle between
the chambers, and the cross-dispersion smile (<em>xdg, xdr, krot,
pixelwd, xdfl, hrfl, hrr</em>)</p></li>
<li><p>nonlinearity of the cross-dispersion spectrum (<em>xdr, pixelwd, xdfl</em>)</p></li>
<li><p>barrel distortion (<em>brl, x0brl, y0brl</em>)</p></li>
</ul>
<p>For the long-slit modes, the distortion correction accounts for:</p>
<ul class="simple">
<li><p>skewing by the cross-dispersion smile (<em>xdg, xdr, slitrot, pixelwd,
xdfl</em>)</p></li>
<li><p>nonlinearity of the cross-dispersion spectrum (<em>xdr, pixelwd, xdfl</em>)</p></li>
<li><p>barrel distortion (<em>brl, x0brl, y0brl</em>)</p></li>
</ul>
<p>When the undistorted coordinates have been calculated, the 2D science
image is interpolated from raw <em>(x,y)</em> pixel coordinates onto these
coordinates. By default, a cubic interpolation is used that closely
approximates a sinc interpolation function; bilinear interpolation is
also available.</p>
<p>After distortion correction, the spatial and spectral
elements should be aligned with the columns and rows of the image
(<a class="reference internal" href="#exes-undistorted"><span class="std std-numref">Fig. 6</span></a>). For both long-slit and cross-dispersed modes,
the x-axis is the dispersion axis and the y-axis is the
spatial axis.  Values outside the illuminated areas for each spectral order
are set to NaN.</p>
<figure class="align-default" id="exes-undistorted">
<img alt="Left: square frame with many horizontal bright stripes. Right: square frame with two horizontal stripes, one dark and one bright." src="../../../_images/undistorted.png" />
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">Undistorted images in High-Medium configuration (left) and
Medium configuration (right).</span><a class="headerlink" href="#exes-undistorted" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="coadd-frames">
<h4>Coadd frames<a class="headerlink" href="#coadd-frames" title="Permalink to this heading">¶</a></h4>
<p>The final step in the image processing prior to spectral extraction is
coadding of the background-subtracted, undistorted frames
(<a class="reference internal" href="#exes-coadded"><span class="std std-numref">Fig. 7</span></a>). If desired,
coaddition can be skipped, and individual spectra can be extracted from
each frame, to be combined later. For faint sources, however, coaddition
of the 2D image is recommended, for more accurate extraction.</p>
<p>Prior to coadding, the spectra can be shifted in the spatial direction
to account for slight shifts in the position of the object in the slit
between nod pairs. The shift is calculated by creating a template of the
spectrum from all frames, averaged in the spectral direction, and
cross-correlating each frame with the template.</p>
<p>By default, the pipeline weights all input frames by their correlation
with this spectral template, so that if a frame is unusually noisy, or
missed a nod, or had some other error, it will not contribute
significantly to the coadded frame. However, it is possible to force the
pipeline to use an unweighted coadd, if desired, or to explicitly identify
frames for exclusion from the coadd.</p>
<p>The pipeline typically only coadds frames within a single file.  Optionally,
it may instead coadd frames from all files.  This action is performed as
an robust mean across all input frames, with or without weighting by the
associated error image.  In cases where the target has not moved across the
array between input files, this option may help increase signal-to-noise
prior to extraction.</p>
<figure class="align-default" id="exes-coadded">
<img alt="Square frame with many horizontal bright stripes." src="../../../_images/coadded.png" />
<figcaption>
<p><span class="caption-number">Fig. 7 </span><span class="caption-text">Coadded image in High-Medium configuration.</span><a class="headerlink" href="#exes-coadded" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="exes-set-apertures">
<span id="identify-apertures"></span><h4>Identify apertures<a class="headerlink" href="#exes-set-apertures" title="Permalink to this heading">¶</a></h4>
<p>In order to aid in spectral extraction, the pipeline constructs a smoothed
model of the relative intensity of the target spectrum at each spatial
position, for each wavelength. This spatial profile is used to compute
the weights in optimal extraction or to fix bad pixels in standard
extraction (see next section). Also, the pipeline uses the median profile,
collapsed along the wavelength axis, to define the extraction
parameters.</p>
<p>To construct the spatial profile, the pipeline first subtracts the median
signal from each column in the rectified spectral image to remove the residual
background.  The intensity in this image in column <em>i</em> and row <em>j</em> is given by</p>
<div class="math notranslate nohighlight">
\[O_{ij} = f_{i}P_{ij}\]</div>
<p>where <span class="math notranslate nohighlight">\(f_i\)</span> is the total intensity of the spectrum at
wavelength <em>i</em>, and <span class="math notranslate nohighlight">\(P_{ij}\)</span> is the spatial profile at column <em>i</em>
and row <em>j</em>. To get the spatial profile <span class="math notranslate nohighlight">\(P_{ij}\)</span>, we must
approximate the intensity <span class="math notranslate nohighlight">\(f_i\)</span>. To do so, the pipeline computes a
median over the wavelength dimension (columns) of the order image to get a
first-order approximation of the median spatial profile at each row
<span class="math notranslate nohighlight">\(P_j\)</span>. Assuming that</p>
<div class="math notranslate nohighlight">
\[O_{ij} \approx c_{i}P_{j},\]</div>
<p>the pipeline uses a linear least-squares algorithm to fit <span class="math notranslate nohighlight">\(P_j\)</span> to
<span class="math notranslate nohighlight">\(O_{ij}\)</span> and thereby determine the coefficients <span class="math notranslate nohighlight">\(c_i\)</span>. These
coefficients are then used as the first-order approximation to <span class="math notranslate nohighlight">\(f_i\)</span>:
the resampled order image <span class="math notranslate nohighlight">\(O_{ij}\)</span> is divided by <span class="math notranslate nohighlight">\(f_i\)</span> to derive
<span class="math notranslate nohighlight">\(P_{ij}\)</span>.  The pipeline then fits a low-order polynomial along the
columns at each spatial point <em>s</em> in order to smooth the profile and
thereby increase its signal-to-noise. The coefficients of these fits can
then be used to determine the value of <span class="math notranslate nohighlight">\(P_{ij}\)</span> at any column <em>i</em> and
spatial point <em>j</em> (see <a class="reference internal" href="#exes-profile"><span class="std std-numref">Fig. 8</span></a>, left). The median of <span class="math notranslate nohighlight">\(P_{ij}\)</span>
along the wavelength axis generates the median spatial profile, <span class="math notranslate nohighlight">\(P_j\)</span>
(see <a class="reference internal" href="#exes-profile"><span class="std std-numref">Fig. 8</span></a>, right).</p>
<figure class="align-default" id="exes-profile">
<img alt="Left: 3D surface in slit position vs. wavelength vs. flux.  Right: 1D plot of slit position vs. flux." src="../../../_images/spatial_profile.png" />
<figcaption>
<p><span class="caption-number">Fig. 8 </span><span class="caption-text">Spatial model and median spatial profile, for the Medium configuration image
in <a class="reference internal" href="#exes-undistorted"><span class="std std-numref">Fig. 6</span></a>.  The spatial model image here
is rotated for comparison with the profile plot: the y-axis is
along the bottom of the surface plot; the x-axis is along the left.</span><a class="headerlink" href="#exes-profile" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The pipeline then uses the median spatial profile to identify extraction
apertures for the source. The aperture centers can be identified
automatically by iteratively finding local maxima in the absolute value
of the spatial profile, or can be specified directly by the user.  By
default, a single aperture is expected and defined for nod-off-slit mode;
two apertures are expected for nod-along-slit mode.</p>
<p>Besides the aperture centers, the pipeline also specifies a PSF radius,
corresponding to the distance from the center at which the flux from the
source falls to zero. By default, this value is automatically determined from the
width of a Gaussian fit to the peak in the median spatial profile, as</p>
<div class="math notranslate nohighlight">
\[R_{psf} = 2.15 \cdot \text{FWHM}.\]</div>
<p>For optimal extraction, the pipeline also identifies a smaller aperture
radius, to be used as the integration region:</p>
<div class="math notranslate nohighlight">
\[R_{ap} = 0.7 \cdot \text{FWHM}.\]</div>
<p>This value should give close to optimal signal-to-noise for a Moffat or
Gaussian profile.  The pipeline also attempts to specify background regions
outside of any extraction apertures, for fitting and removing the residual
sky signal.  All aperture parameters may be optionally overridden by the
pipeline user.</p>
</section>
<section id="extract-spectra">
<h4>Extract spectra<a class="headerlink" href="#extract-spectra" title="Permalink to this heading">¶</a></h4>
<p>The spectral extraction algorithms used by the pipeline offer two
different extraction methods, depending on the nature of the target
source. For point sources, the pipeline uses an optimal extraction
algorithm, described at length in the Spextool paper (see the
<a class="reference internal" href="#exes-resources"><span class="std std-ref">Other Resources</span></a> section, below, for a reference).
For extended sources, the pipeline uses a standard summing extraction.</p>
<p>In either method, before extracting a spectrum, the pipeline first uses
any identified background regions to find the residual sky background
level. For each column in the 2D image, it fits a low-order
polynomial to the values in the specified regions, as a function of
slit position. This polynomial determines the wavelength-dependent
sky level (<span class="math notranslate nohighlight">\(B_{ij}\)</span>) to be subtracted from the spectrum
(<span class="math notranslate nohighlight">\(D_{ij}\)</span>).</p>
<section id="standard-extraction">
<h5>Standard extraction<a class="headerlink" href="#standard-extraction" title="Permalink to this heading">¶</a></h5>
<p>The standard extraction method uses values from the spatial profile image
(<span class="math notranslate nohighlight">\(P_{ij}\)</span>) to replace bad pixels and outliers, then sums the flux
from all pixels contained within the PSF radius. The flux at column
<em>i</em> is then:</p>
<div class="math notranslate nohighlight">
\[f_{i,\text{sum}} = \sum_{j=j_1}^{j_2}(D_{ij} - B_{ij})\]</div>
<p>where <span class="math notranslate nohighlight">\(j_1\)</span> and <span class="math notranslate nohighlight">\(j_2\)</span> are the upper and lower limits of the extraction
aperture (in pixels):</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}j_1 &amp;= t - R_{PSF}\\j_2 &amp;= t + R_{PSF}\end{aligned}\end{align} \]</div>
<p>given the aperture center (<em>t</em>). This extraction method is the only algorithm
available for extended sources.</p>
</section>
<section id="optimal-extraction">
<h5>Optimal extraction<a class="headerlink" href="#optimal-extraction" title="Permalink to this heading">¶</a></h5>
<p>Point sources may occasionally benefit from using standard extraction,
but optimal extraction generally produces higher signal-to-noise ratios
for these targets. This method works by weighting each pixel in the
extraction aperture by how much of the target’s flux it contains.
The pipeline first normalizes the spatial profile by the sum of the spatial
profile within the PSF radius defined by the user:</p>
<div class="math notranslate nohighlight">
\[P_{ij}^{'} = P_{ij} \Big/ \sum_{j=j_1}^{j_2}P_{ij}.\]</div>
<p><span class="math notranslate nohighlight">\(P_{ij}^{'}\)</span> now represents the fraction of the total flux from
the target that is contained within pixel <em>(i,j)</em>, so that
<span class="math notranslate nohighlight">\((D_{ij} - B_{ij}) / P_{ij}^{'}\)</span> is a set of <em>j</em> independent
estimates of the total flux at column <em>i</em>. The pipeline does a weighted
average of these estimates, where the weight depends on the pixel’s
variance and the normalized profile value. Then, the flux at column <em>i</em> is:</p>
<div class="math notranslate nohighlight">
\[f_{i,\text{opt}} = \frac{\sum_{j=j_3}^{j_4}{M_{ij}P_{ij}^{'}(D_{ij} - B_{ij}) \big/ (V_{D_{ij}} + V_{B_{ij}})}}{\sum_{j=j_3}^{j_4}{M_{ij}{P_{ij}^{'}}^{2} \big/ (V_{D_{ij}} + V_{B_{ij}})}}\]</div>
<p>where <span class="math notranslate nohighlight">\(M_{ij}\)</span> is a bad pixel mask and <span class="math notranslate nohighlight">\(j_3\)</span>
and <span class="math notranslate nohighlight">\(j_4\)</span> are the upper and lower limits given by the aperture radius:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}j_3 &amp;= t - R_{ap}\\j_4 &amp;= t + R_{ap}\end{aligned}\end{align} \]</div>
<p>Note that bad pixels are simply ignored, and outliers will have little
effect on the average because of the weighting scheme.</p>
<p>The variance for the standard spectroscopic extraction is a simple sum of the
variances in each pixel within the aperture. For the optimal extraction
algorithm, the variance on the <span class="math notranslate nohighlight">\(i^{th}\)</span> pixel in the extracted spectrum
is calculated as:</p>
<div class="math notranslate nohighlight">
\[V_{i} = \sum_{j=j_3}^{j_4} \frac{M_{ij}}{{P_{ij}^{'}}^2 V_{ij}}\]</div>
<p>where <span class="math notranslate nohighlight">\(P_{ij}^{'}\)</span> is the scaled spatial profile, <span class="math notranslate nohighlight">\(M_{ij}\)</span> is
a bad pixel mask, <span class="math notranslate nohighlight">\(V_{ij}\)</span> is the variance at each background-subtracted
pixel, and the sum is over all spatial pixels <span class="math notranslate nohighlight">\(j\)</span> within the aperture
radius. The error spectrum for 1D spectra is the square root of the
variance.</p>
</section>
<section id="wavelength-calibration">
<h5>Wavelength calibration<a class="headerlink" href="#wavelength-calibration" title="Permalink to this heading">¶</a></h5>
<p>Wavelength calibration for EXES is calculated from the grating equation,
using the optical parameters and central wavenumber for the observation.
It is stored as a calibration map identifying the
wavenumber for each column in each spectral order.</p>
<p>The wavelength calibration is expected to be good to within one pixel of
dispersion, if the central wavenumber is accurate. To refine the
wavelength solution, the pipeline allows the user to identify a single
spectral feature in the extracted spectrum. Using this feature, the
central wavenumber is recalculated and the calibration is
adjusted to match. However, the distortion correction also depends on
the central wavenumber, so if the recalculated value is significantly
different from the assumed value, the reduction should be repeated with
the new value to ensure an accurate distortion correction and dispersion
solution.</p>
</section>
</section>
<section id="combine-multiple-spectra">
<h4>Combine multiple spectra<a class="headerlink" href="#combine-multiple-spectra" title="Permalink to this heading">¶</a></h4>
<p>The final pipeline step is the combination of multiple spectra of the same
source, from separate observations, apertures, and orders.  For all
configurations, the individual extracted 1D spectra for each order are
combined with a robust weighted mean, by default.</p>
<p>For cross-dispersed configurations, the pipeline performs an
automatic merge of the spectra from all orders. This algorithm uses the
signal-to-noise ratio in overlapping regions to determine which pixels
to exclude, and performs a weighted mean of any remaining overlapping
regions. Artifacts near the edges of orders may optionally be manually
trimmed before the merge.</p>
</section>
</section>
<section id="other-resources">
<span id="exes-resources"></span><h3>Other Resources<a class="headerlink" href="#other-resources" title="Permalink to this heading">¶</a></h3>
<p>For more information on the reduction algorithms used in the EXES
package, adapted from the TEXES pipeline, see the TEXES paper:</p>
<blockquote>
<div><p><a class="reference external" href="http://arxiv.org/pdf/astro-ph/0110521v1.pdf">TEXES: A Sensitive High-Resolution Grating Spectrograph for the
Mid-Infrared</a>, J.H.
Lacy, M.J. Richter, T.K. Greathouse, D.T. Jaffe and Q. Zhu (2002, PASP
114, 153)</p>
</div></blockquote>
<p>For more information on the reduction algorithms used in FSpextool, see
the Spextool papers:</p>
<blockquote>
<div><p><a class="reference external" href="http://irtfweb.ifa.hawaii.edu/~spex/Spextool.pdf">Spextool: A Spectral Extraction Package for SpeX, a 0.8-5.5 Micron
Cross-Dispersed
Spectrograph</a>,
Michael C. Cushing, William D. Vacca and John T. Rayner (2004, PASP
116, 362).</p>
<p><a class="reference external" href="http://irtfweb.ifa.hawaii.edu/~spex/Telluric.pdf">A Method of Correcting Near-Infrared Spectra for Telluric
Absorption</a>,
William D. Vacca, Michael C. Cushing and John T. Rayner(2003, PASP 115,
389).</p>
<p><a class="reference external" href="http://irtfweb.ifa.hawaii.edu/~spex/Nonlinearity.pdf">Nonlinearity Corrections and Statistical Uncertainties Associated with
Near-Infrared
Arrays</a>,
William D. Vacca, Michael C. Cushing and John T. Rayner (2004, PASP
116, 352).</p>
</div></blockquote>
</section>
</section>
<section id="flux-calibration">
<h2>Flux calibration<a class="headerlink" href="#flux-calibration" title="Permalink to this heading">¶</a></h2>
<p>EXES spectra are calibrated to physical intensity units
(<span class="math notranslate nohighlight">\(erg/s/cm^2/sr/cm^{-1}\)</span>) when they are multiplied by the
blackbody-normalized calibration frame. This process does not
account for residual atmospheric effects.  These may be corrected
by dividing by a telluric standard spectrum, or a model of the
atmosphere.</p>
<p>Following the coaddition of 2D spectral images from each nod pair, a
conversion factor is applied to convert the units to integrated flux units
of Jy per spatial pixel for 2D images. Extraction performed on these images
sums over spatial pixels, resulting in units of Jy for all 1D spectra. To
derive a surface brightness value from 1D spectra, such as Jy/arcsec,
refer to the aperture width in the FITS header (PSFRADn, for order
n = 01, 02, 03…).</p>
<p>Please note that the absolute flux calibration for EXES targets may require
additional corrections for slit loss, instrument response, poorly determined
background levels, or other systematic effects.</p>
</section>
<section id="data-products">
<h2>Data products<a class="headerlink" href="#data-products" title="Permalink to this heading">¶</a></h2>
<section id="filenames">
<h3>Filenames<a class="headerlink" href="#filenames" title="Permalink to this heading">¶</a></h3>
<p>EXES output files are named according to the convention:</p>
<blockquote>
<div><p>FILENAME = <em>F[flight]_EX_SPE_AOR-ID_SPECTEL1SPECTEL2_type_FN1[-FN2][_SN]</em>.fits</p>
</div></blockquote>
<p>where <em>flight</em> is the SOFIA flight number, <em>EX</em> is the instrument
identifier, <em>SPE</em> specifies that it is a spectral file, <em>AOR-ID</em> is the
AOR identifier for the observation, <em>SPECTEL1SPECTEL2</em> are the
keywords specifying the spectral elements used, <em>type</em> is the three-letter
identifier for the product type (listed in the table below), and <em>FN1</em> is the
file number corresponding to the input file. <em>FN1-FN2</em> is used if there
are multiple input files for a single output file, where <em>FN1</em> is the file
number of the first input file and <em>FN2</em> is the file number of the last
input file.  If the output file corresponds to a single frame of the
input file, there may also be a trailing serial number (<em>SN</em>) that identifies
the input frame associated with the output file.</p>
</section>
<section id="pipeline-products">
<h3>Pipeline Products<a class="headerlink" href="#pipeline-products" title="Permalink to this heading">¶</a></h3>
<p>The following table lists all intermediate products generated by the pipeline
for EXES spectral modes, in the order in which they are produced.
<a class="footnote-reference brackets" href="#fn-exes-pipeprod" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>  The product type
is stored in the FITS headers under the keyword PRODTYPE. By default,
the <em>readouts_coadded</em>, <em>flat</em>, <em>undistorted</em>, <em>coadded</em>, <em>spectra</em>,
<em>spectra_1d</em>, <em>coadded_spectrum</em>, <em>combined_spectrum_1d</em>,
<em>orders_merged</em>, and <em>orders_merged_1d</em> products are saved.</p>
<p>For calibration purposes, it is often useful to set pipeline parameters to
skip nod subtraction and extract a sky spectrum rather than a science spectrum.
Data products reduced in this mode have separate product types, with ‘sky_’
prepended to the standard product name, and file codes that begin with the
letter ‘S’.</p>
<p>For most observation modes, the pipeline additionally produces an image in PNG
format, intended to provide a quick-look preview of the data contained in
the final product.  These auxiliary products may be distributed to observers
separately from the FITS file products.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-exes-pipeprod" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Earlier versions of this pipeline (before v3.0.0) produced different
sets of default products.  Refer to earlier revisions of this manual
for complete information.</p>
</aside>
</aside>
<table class="longtable docutils align-default" id="exes-prod">
<caption><span class="caption-number">Table 2 </span><span class="caption-text">Intermediate and final data products for EXES reductions</span><a class="headerlink" href="#exes-prod" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 11.5%" />
<col style="width: 12.8%" />
<col style="width: 12.8%" />
<col style="width: 12.8%" />
<col style="width: 9.0%" />
<col style="width: 9.0%" />
<col style="width: 32.1%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Step</strong></p></th>
<th class="head"><p><strong>Data type</strong></p></th>
<th class="head"><p><strong>PRODTYPE</strong></p></th>
<th class="head"><p><strong>PROCSTAT</strong></p></th>
<th class="head"><p><strong>Code</strong></p></th>
<th class="head"><p><strong>Saved</strong></p></th>
<th class="head"><p><strong>Extensions</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">Coadd Readouts</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">readouts_</div>
<div class="line">coadded</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">RDC</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, MASK</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Make Flat</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">flat_</div>
<div class="line">appended</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FTA</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, MASK,</div>
<div class="line">FLAT, FLAT_ERROR,</div>
<div class="line">FLAT_ILLUMINATION</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Make Flat</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">flat</div>
</div>
</td>
<td><div class="line-block">
<div class="line">flat</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLT</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLAT, FLAT_ERROR,</div>
<div class="line">TORT_FLAT,</div>
<div class="line">TORT_FLAT_ERROR,</div>
<div class="line">ILLUMINATION,</div>
<div class="line">WAVECAL, SPATCAL,</div>
<div class="line">ORDER_MASK</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Despike</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">despiked</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">DSP</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, MASK,</div>
<div class="line">FLAT, FLAT_ERROR,</div>
<div class="line">FLAT_ILLUMINATION</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Debounce</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">debounced</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">DBC</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, MASK,</div>
<div class="line">FLAT, FLAT_ERROR,</div>
<div class="line">FLAT_ILLUMINATION</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Subtract Nods</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">nods_</div>
<div class="line">subtracted</div>
<div class="line">or</div>
<div class="line">sky_nods_</div>
<div class="line">subtracted</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">NSB</div>
<div class="line">or SNS</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, MASK,</div>
<div class="line">FLAT, FLAT_ERROR,</div>
<div class="line">FLAT_ILLUMINATION</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Flat Correct</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">flat_</div>
<div class="line">corrected</div>
<div class="line">or</div>
<div class="line">sky_flat_</div>
<div class="line">corrected</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FTD</div>
<div class="line">or SFT</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, MASK,</div>
<div class="line">FLAT, FLAT_ERROR,</div>
<div class="line">FLAT_ILLUMINATION</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Clean Bad Pixels</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">cleaned</div>
<div class="line">or</div>
<div class="line">sky_cleaned</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">CLN</div>
<div class="line">or SCN</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, MASK,</div>
<div class="line">FLAT, FLAT_ERROR,</div>
<div class="line">FLAT_ILLUMINATION</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Undistort</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">undistorted</div>
<div class="line">or</div>
<div class="line">sky_</div>
<div class="line">undistorted</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">UND</div>
<div class="line">or SUN</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, MASK,</div>
<div class="line">FLAT, FLAT_ERROR,</div>
<div class="line">FLAT_ILLUMINATION,</div>
<div class="line">WAVECAL, SPATCAL,</div>
<div class="line">ORDER_MASK</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Correct Calibration</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">calibration_</div>
<div class="line">corrected</div>
<div class="line">or</div>
<div class="line">sky_</div>
<div class="line">calibration_</div>
<div class="line">corrected</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">CCR</div>
<div class="line">or SCR</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, MASK,</div>
<div class="line">FLAT, FLAT_ERROR,</div>
<div class="line">FLAT_ILLUMINATION,</div>
<div class="line">WAVECAL, SPATCAL,</div>
<div class="line">ORDER_MASK</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Coadd Pairs</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">coadded</div>
<div class="line">or sky_coadded</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">COA</div>
<div class="line">or SCO</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, MASK,</div>
<div class="line">FLAT, FLAT_ERROR,</div>
<div class="line">FLAT_ILLUMINATION,</div>
<div class="line">WAVECAL, SPATCAL,</div>
<div class="line">ORDER_MASK</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Convert Units</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">calibrated</div>
<div class="line">or</div>
<div class="line">sky_calibrated</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">CAL</div>
<div class="line">or SCL</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, MASK,</div>
<div class="line">FLAT, FLAT_ERROR,</div>
<div class="line">FLAT_ILLUMINATION,</div>
<div class="line">WAVECAL, SPATCAL,</div>
<div class="line">ORDER_MASK</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Make Profiles</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">rectified_</div>
<div class="line">image</div>
<div class="line">or</div>
<div class="line">sky_</div>
<div class="line">rectified_</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">RIM</div>
<div class="line">or SRM</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, MASK,</div>
<div class="line">FLAT, WAVECAL, SPATCAL,</div>
<div class="line">FLAT_ILLUMINATION,</div>
<div class="line"><br /></div>
<div class="line">For each order n:</div>
<div class="line">FLUX_ORDER_n</div>
<div class="line">ERROR_ORDER_n</div>
<div class="line">FLAT_ORDER_n</div>
<div class="line">BADMASK_ORDER_n</div>
<div class="line">WAVEPOS_ORDER_n</div>
<div class="line">SLITPOS_ORDER_n</div>
<div class="line">SPATIAL_MAP_ORDER_n</div>
<div class="line">SPATIAL_PROFILE_ORDER_n</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Locate Apertures</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">apertures_</div>
<div class="line">located</div>
<div class="line">or</div>
<div class="line">sky_</div>
<div class="line">apertures_</div>
<div class="line">located</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LOC</div>
<div class="line">or SLC</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, MASK,</div>
<div class="line">FLAT, WAVECAL, SPATCAL,</div>
<div class="line">ORDER_MASK</div>
<div class="line"><br /></div>
<div class="line">For each order n:</div>
<div class="line">FLUX_ORDER_n</div>
<div class="line">ERROR_ORDER_n</div>
<div class="line">FLAT_ORDER_n</div>
<div class="line">BADMASK_ORDER_n</div>
<div class="line">WAVEPOS_ORDER_n</div>
<div class="line">SLITPOS_ORDER_n</div>
<div class="line">SPATIAL_MAP_ORDER_n</div>
<div class="line">SPATIAL_PROFILE_ORDER_n</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Set Apertures</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">apertures_</div>
<div class="line">set</div>
<div class="line">or</div>
<div class="line">sky_</div>
<div class="line">apertures_</div>
<div class="line">set</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">APS</div>
<div class="line">or SAP</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, MASK,</div>
<div class="line">FLAT, WAVECAL, SPATCAL,</div>
<div class="line">ORDER_MASK</div>
<div class="line"><br /></div>
<div class="line">For each order n:</div>
<div class="line">FLUX_ORDER_n</div>
<div class="line">ERROR_ORDER_n</div>
<div class="line">FLAT_ORDER_n</div>
<div class="line">BADMASK_ORDER_n</div>
<div class="line">WAVEPOS_ORDER_n</div>
<div class="line">SLITPOS_ORDER_n</div>
<div class="line">SPATIAL_MAP_ORDER_n</div>
<div class="line">SPATIAL_PROFILE_ORDER_n</div>
<div class="line">APERTURE_MASK_ORDER_n</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Subtract</div>
<div class="line">Background</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image</div>
</div>
</td>
<td><div class="line-block">
<div class="line">background_</div>
<div class="line">subtracted</div>
<div class="line">or</div>
<div class="line">sky_</div>
<div class="line">background_</div>
<div class="line">subtracted</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">BGS</div>
<div class="line">or SBG</div>
</div>
</td>
<td><div class="line-block">
<div class="line">N</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, MASK,</div>
<div class="line">FLAT, WAVECAL, SPATCAL,</div>
<div class="line">ORDER_MASK</div>
<div class="line"><br /></div>
<div class="line">For each order n:</div>
<div class="line">FLUX_ORDER_n</div>
<div class="line">ERROR_ORDER_n</div>
<div class="line">FLAT_ORDER_n</div>
<div class="line">BADMASK_ORDER_n</div>
<div class="line">WAVEPOS_ORDER_n</div>
<div class="line">SLITPOS_ORDER_n</div>
<div class="line">SPATIAL_MAP_ORDER_n</div>
<div class="line">SPATIAL_PROFILE_ORDER_n</div>
<div class="line">APERTURE_MASK_ORDER_n</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Extract Spectra</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image;</div>
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">spectra</div>
<div class="line">or</div>
<div class="line">sky_</div>
<div class="line">spectra</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SPM</div>
<div class="line">or SSM</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR, MASK,</div>
<div class="line">FLAT, WAVECAL, SPATCAL,</div>
<div class="line">ORDER_MASK,</div>
<div class="line">TRANSMISSION</div>
<div class="line"><br /></div>
<div class="line">For each order n:</div>
<div class="line">FLUX_ORDER_n</div>
<div class="line">ERROR_ORDER_n</div>
<div class="line">FLAT_ORDER_n</div>
<div class="line">BADMASK_ORDER_n</div>
<div class="line">WAVEPOS_ORDER_n</div>
<div class="line">SLITPOS_ORDER_n</div>
<div class="line">SPATIAL_MAP_ORDER_n</div>
<div class="line">SPATIAL_PROFILE_ORDER_n</div>
<div class="line">APERTURE_MASK_ORDER_n</div>
<div class="line">SPECTRAL_FLUX_ORDER_n</div>
<div class="line">SPECTRAL_ERROR_ORDER_n</div>
<div class="line">TRANSMISSION_ORDER_n</div>
<div class="line">RESPONSE_ORDER_n</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Extract Spectra</div>
</div>
</td>
<td><div class="line-block">
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">spectra_1d</div>
<div class="line">or</div>
<div class="line">sky_</div>
<div class="line">spectra_1d</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">SPC</div>
<div class="line">or SSP</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Combine Spectra</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image;</div>
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">coadded_</div>
<div class="line">spectrum</div>
<div class="line">or</div>
<div class="line">sky_</div>
<div class="line">coadded_</div>
<div class="line">spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">COM</div>
<div class="line">or SCM</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR,</div>
<div class="line">TRANSMISSION</div>
<div class="line"><br /></div>
<div class="line">For each order n:</div>
<div class="line">FLUX_ORDER_n</div>
<div class="line">ERROR_ORDER_n</div>
<div class="line">WAVEPOS_ORDER_n</div>
<div class="line">SPECTRAL_FLUX_ORDER_n</div>
<div class="line">SPECTRAL_ERROR_ORDER_n</div>
<div class="line">TRANSMISSION_ORDER_n</div>
<div class="line">RESPONSE_ORDER_n</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Combine Spectra</div>
</div>
</td>
<td><div class="line-block">
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">combined_</div>
<div class="line">spectrum_1d</div>
<div class="line">or</div>
<div class="line">sky_</div>
<div class="line">combined_</div>
<div class="line">spectrum_1d</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">CMB</div>
<div class="line">or SCS</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Refine Wavecal</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image;</div>
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">wavecal_</div>
<div class="line">refined</div>
<div class="line">or</div>
<div class="line">sky_</div>
<div class="line">wavecal_</div>
<div class="line">refined</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">WRF</div>
<div class="line">or SWR</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR,</div>
<div class="line">TRANSMISSION</div>
<div class="line"><br /></div>
<div class="line">For each order n:</div>
<div class="line">FLUX_ORDER_n</div>
<div class="line">ERROR_ORDER_n</div>
<div class="line">WAVEPOS_ORDER_n</div>
<div class="line">SPECTRAL_FLUX_ORDER_n</div>
<div class="line">SPECTRAL_ERROR_ORDER_n</div>
<div class="line">TRANSMISSION_ORDER_n</div>
<div class="line">RESPONSE_ORDER_n</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Refine Wavecal</div>
</div>
</td>
<td><div class="line-block">
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">wavecal_</div>
<div class="line">refined_1d</div>
<div class="line">or</div>
<div class="line">sky_</div>
<div class="line">wavecal_</div>
<div class="line">refined_1d</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_2</div>
</div>
</td>
<td><div class="line-block">
<div class="line">WRS</div>
<div class="line">or SWS</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Merge Orders</div>
</div>
</td>
<td><div class="line-block">
<div class="line">2D spectral</div>
<div class="line">image;</div>
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">orders_</div>
<div class="line">merged</div>
<div class="line">or</div>
<div class="line">sky_orders_</div>
<div class="line">merged</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_3</div>
</div>
</td>
<td><div class="line-block">
<div class="line">MRM</div>
<div class="line">or SMM</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX, ERROR,</div>
<div class="line">WAVEPOS, SPECTRAL_FLUX,</div>
<div class="line">SPECTRAL_ERROR,</div>
<div class="line">TRANSMISSION, RESPONSE</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Merge Orders</div>
</div>
</td>
<td><div class="line-block">
<div class="line">1D spectrum</div>
</div>
</td>
<td><div class="line-block">
<div class="line">orders_</div>
<div class="line">merged_1d</div>
<div class="line">or</div>
<div class="line">sky_orders_</div>
<div class="line">merged_1d</div>
</div>
</td>
<td><div class="line-block">
<div class="line">LEVEL_3</div>
</div>
</td>
<td><div class="line-block">
<div class="line">MRD</div>
<div class="line">or SMD</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Y</div>
</div>
</td>
<td><div class="line-block">
<div class="line">FLUX</div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="data-format">
<h3>Data Format<a class="headerlink" href="#data-format" title="Permalink to this heading">¶</a></h3>
<p>All files produced by the pipeline are multi-extension FITS
files (except for the <em>spectra_1d</em>, <em>combined_spectrum_1d</em>, and
<em>orders_merged_1d</em> products: see below). <a class="footnote-reference brackets" href="#fn-exes-dataprod" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>
The flux image is stored in the primary header-data unit (HDU);
its associated error image is stored in extension 1, with EXTNAME=ERROR.</p>
<p>In spectroscopic products, the SLITPOS and WAVEPOS extensions give the
spatial (rows) and spectral (columns) coordinates, respectively, for
rectified images for each order.  These coordinates may also be derived from
the WCS in the primary header.  WAVEPOS also indicates the wavenumber
coordinates for 1D extracted spectra.</p>
<p>Intermediate spectral products may contain SPATIAL_MAP and SPATIAL_PROFILE
extensions.  These contain the spatial map and median spatial profile,
described in the <a class="reference internal" href="#exes-set-apertures"><span class="std std-ref">Identify apertures</span></a> section, above.  They may also contain
an APERTURE_MASK extension with the spectral aperture
definitions, also described in the <a class="reference internal" href="#exes-set-apertures"><span class="std std-ref">Identify apertures</span></a> section.</p>
<p>Final spectral products contain SPECTRAL_FLUX and SPECTRAL_ERROR extensions:
these are the extracted 1D spectrum and associated uncertainty.  They
also contain TRANSMISSION and RESPONSE extensions for reference, containing
a model of the atmospheric transmission at the extracted wavenumber values
and an extraction of the flat calibration data at the science aperture
locations, respectively.</p>
<p>The <em>spectra_1d</em>, <em>combined_spectrum_1d</em>, and <em>orders_merged_1d</em> products
are one-dimensional spectra, stored in Spextool format, as rows of data in
the primary extension.  If there were multiple orders in the intermediate
spectra (e.g. the High-Medium configuration) or multiple apertures selected
(e.g. for the nod-on-slit mode), then the spectrum for each aperture and
order is stacked into a different plane.</p>
<p>For these spectra, the first row is the wavenumber (<span class="math notranslate nohighlight">\(cm^{-1}\)</span>), the second
is the intensity (<span class="math notranslate nohighlight">\(erg/s/cm^2/sr/cm^{-1}\)</span>), the third is the error
(<span class="math notranslate nohighlight">\(erg/s/cm^2/sr/cm^{-1}\)</span>), the fourth is
the estimated fractional atmospheric transmission spectrum, and the fifth
is a reference response spectrum (<span class="math notranslate nohighlight">\(ct/(erg/s/cm^2/sr/cm^{-1})\)</span>).
These rows correspond directly to the WAVEPOS, SPECTRAL_FLUX, SPECTRAL_ERROR,
TRANSMISSION, and RESPONSE extensions in the <em>spectra</em>, <em>coadded_spectrum</em>, or
<em>orders_merged</em> products.</p>
<p>The final uncertainties in calibrated images and spectra contain
only the estimated statistical uncertainties due to the noise in the
image or the extracted spectrum. Any systematic uncertainties due to the
reduction or calibration process are not recorded.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fn-exes-dataprod" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>In earlier versions of this pipeline (prior to v3.0.0), all image products
were 3D arrays of data, where the first half of the planes were the image
frames and the second half of the planes were the variances associated with
each pixel in each image frame. All spectral products were
in the Spextool format described above.</p>
</aside>
</aside>
</section>
</section>
<section id="grouping-level-1-data-for-processing">
<h2>Grouping LEVEL_1 data for processing<a class="headerlink" href="#grouping-level-1-data-for-processing" title="Permalink to this heading">¶</a></h2>
<p>For EXES spectroscopy modes, there are three kinds of data: darks, flats, and
sources. Flats and darks are required for all reductions, as they are used
to calibrate the data, correct for instrumental response, and identify
the edges of the slit. Dark frames should be taken near in time to the
flat frame.  Flat frames should have the same instrument
configuration, slit height, slit width, and grating angle as the science
observation. In order for separate science files to be
grouped together, these same conditions apply, and they should
additionally share a common target and be taken with the same nodding
mode.</p>
<p>These requirements translate into a set of FITS header keywords
that must match in order for a set of data to be usefully reduced
together: see the table below for a listing of these
keywords.  All match requirements apply to science targets; flat
exceptions are noted.</p>
<p>Note that data grouping must be carried out before the pipeline is run.
The pipeline expects all inputs to be reduced together as a single data
set.</p>
<table class="docutils align-default" id="exes-group">
<caption><span class="caption-number">Table 3 </span><span class="caption-text">Grouping criteria</span><a class="headerlink" href="#exes-group" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Keyword</strong></p></th>
<th class="head"><p><strong>Datatype</strong></p></th>
<th class="head"><p><strong>Match Criterion</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>INSTCFG</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>SPECTEL1</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>SPECTEL2</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>SLIT</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>ECHELLE</strong></p></td>
<td><p>FLT</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>SDEG</strong></p></td>
<td><p>FLT</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>WAVENO0</strong></p></td>
<td><p>FLT</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-odd"><td><p><strong>MISSN-ID</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact</p></td>
</tr>
<tr class="row-even"><td><p><strong>ALTI_STA</strong></p></td>
<td><p>FLT</p></td>
<td><p>+/- 500</p></td>
</tr>
<tr class="row-odd"><td><p><strong>ALTI_END</strong></p></td>
<td><p>FLT</p></td>
<td><p>+/- 500</p></td>
</tr>
<tr class="row-even"><td><p><strong>ZA_START</strong></p></td>
<td><p>FLT</p></td>
<td><p>+/- 2.5</p></td>
</tr>
<tr class="row-odd"><td><p><strong>ZA_END</strong></p></td>
<td><p>FLT</p></td>
<td><p>+/- 2.5</p></td>
</tr>
<tr class="row-even"><td><p><strong>OBSTYPE</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact (unless flat)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>OBJECT</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact (unless flat)</p></td>
</tr>
<tr class="row-even"><td><p><strong>INSTMODE</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact (unless flat)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>PLANID</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact (unless flat)</p></td>
</tr>
<tr class="row-even"><td><p><strong>AOR-ID (optional)</strong></p></td>
<td><p>STR</p></td>
<td><p>Exact (unless flat)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="configuration-and-execution">
<h2>Configuration and execution<a class="headerlink" href="#configuration-and-execution" title="Permalink to this heading">¶</a></h2>
<section id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h3>
<p>The EXES pipeline is written entirely in Python.  The pipeline is
platform independent and has been tested on Linux, Mac OS X, and Windows
operating systems.  Running the pipeline requires a minimum of 16GB RAM,
or equivalent-sized swap file.</p>
<p>The pipeline is comprised of five modules within the <code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux</span></code> package:
<code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.instruments.exes</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.pipeline</span></code>,
<code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.calibration</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.spectroscopy</span></code>,
<code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.toolkit</span></code>, and <code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.visualization</span></code>.
The <code class="xref py py-obj docutils literal notranslate"><span class="pre">exes</span></code> module provides the data processing
algorithms specific to EXES, with supporting libraries from the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">toolkit</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">calibration</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">spectroscopy</span></code>, and <code class="xref py py-obj docutils literal notranslate"><span class="pre">visualization</span></code>
modules.  The <code class="xref py py-obj docutils literal notranslate"><span class="pre">pipeline</span></code> module provides interactive and batch interfaces
to the pipeline algorithms.</p>
<section id="external-requirements">
<h4>External Requirements<a class="headerlink" href="#external-requirements" title="Permalink to this heading">¶</a></h4>
<p>To run the pipeline for any mode, Python 3.8 or
higher is required, as well as the following packages: numpy, scipy,
matplotlib, pandas, astropy, configobj, numba, bottleneck, joblib,
and photutils.
Some display functions for the graphical user interface (GUI)
additionally require the PyQt5, pyds9, and regions packages.
All required external packages are available to install via the
pip or conda package managers.  See the Anaconda environment file
(environment.yml), or the pip requirements file (requirements.txt)
distributed with <code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux</span></code> for up-to-date version requirements.</p>
<p>Running the pipeline interactively also requires an installation of
SAO DS9 for FITS image display. See <a class="reference external" href="http://ds9.si.edu/">http://ds9.si.edu/</a> for download
and installation instructions.  The <em>ds9</em> executable
must be available in the PATH environment variable for the pyds9
interface to be able to find and control it.  Please note that pyds9
is not available on the Windows platform.</p>
</section>
<section id="source-code-installation">
<h4>Source Code Installation<a class="headerlink" href="#source-code-installation" title="Permalink to this heading">¶</a></h4>
<p>The source code for the EXES pipeline maintained by the SOFIA Data
Processing Systems (DPS) team can be obtained directly from the
DPS, or from the external
<a class="reference external" href="https://github.com/SOFIA-USRA/sofia_redux">GitHub repository</a>.
This repository contains all needed configuration
files, auxiliary files, and Python code to run the pipeline on EXES
data in any observation mode.</p>
<p>After obtaining the source code, install the package with
the command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>python setup.py install
</pre></div>
</div>
<p>from the top-level directory.</p>
<p>Alternately, a development installation may be performed from inside the
directory with the command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pip install -e .
</pre></div>
</div>
<p>After installation, the top-level pipeline interface commands should
be available in the PATH.  Typing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux
</pre></div>
</div>
<p>from the command line should launch the GUI interface, and:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux_pipe -h
</pre></div>
</div>
<p>should display a brief help message for the command line interface.</p>
</section>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading">¶</a></h3>
<p>For EXES algorithms, default parameter values are defined by the
Redux object that interfaces to them. These values may be overridden
manually for each step, while running in interactive mode. They may also
be overridden by an input parameter file, in INI format, in either
interactive or automatic mode. See Appendix A for an example of an input
parameter file, which contains the current defaults for all parameters.</p>
</section>
<section id="input-data">
<h3>Input data<a class="headerlink" href="#input-data" title="Permalink to this heading">¶</a></h3>
<p>Redux takes as input raw EXES FITS data files, which are image cubes
composed of 1024 x 1024 pixel image arrays. The number of frames per raw
data cube depends on the readout mode used to acquire the data. The FITS
headers contain data acquisition and observation parameters and,
combined with the pipeline configuration files, comprise the information
necessary to complete all steps of the data reduction process. Some critical
keywords are required to be present in the raw data in order to perform a
successful grouping, reduction, and ingestion into the SOFIA archive.
See the header configuration file in Appendix B for a full list of these
keywords.</p>
<p>It is assumed that the input data have been successfully grouped before
beginning reduction: EXES Redux considers all input files in a reduction to
be part of a single homogeneous reduction group, to be reduced together
with the same parameters. At least one input flat file, either raw or
previously processed, is required to complete any reduction.</p>
</section>
<section id="automatic-mode-execution">
<h3>Automatic Mode Execution<a class="headerlink" href="#automatic-mode-execution" title="Permalink to this heading">¶</a></h3>
<p>The DPS pipeline infrastructure runs a pipeline on previously-defined
reduction groups as a fully-automatic black box. To do so, it creates an
input manifest (<em>infiles.txt</em>) that contains relative paths to the input
files (one per line). The command-line interface to the
pipeline is run as:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux_pipe infiles.txt
</pre></div>
</div>
<p>The command-line interface will read in the specified input files, use
their headers to determine the observation mode, and accordingly
the steps to run and any intermediate files to save. Output files are
written to the current directory, from which the pipeline was called.
After reduction is complete, the script will generate an output manifest
(<em>outfiles.txt</em>) containing the relative paths to all output FITS files
generated by the pipeline.</p>
<p>Optionally, in place of a manifest file, file paths to input files may
be directly specified on the command line.  Input files may be raw
FITS files, or may be intermediate products previously produced
by the pipeline.  For example, this command will complete the reduction
for a set of FITS files in the current directory, previously reduced
through the calibration step of the pipeline:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux_pipe *CAL*.fits
</pre></div>
</div>
<p>To customize batch reductions from the command line, the <em>redux_pipe</em> interface
accepts a configuration file on the command line.  This file may contain
any subset of the full configuration file, specifying any non-default
parameters for pipeline steps.  An output directory for pipeline products
and the terminal log level may also be set on the command line.</p>
<p>The full set of optional command-line parameters accepted by the <em>redux_pipe</em>
interface are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-h, --help            show this help message and exit
-c CONFIG, --configuration CONFIG
                      Path to Redux configuration file.
-o OUTDIR, --out OUTDIR
                      Path to output directory.
-l LOGLEVEL, --loglevel LOGLEVEL
                      Log level.
</pre></div>
</div>
</section>
<section id="manual-mode-execution">
<h3>Manual Mode Execution<a class="headerlink" href="#manual-mode-execution" title="Permalink to this heading">¶</a></h3>
<p>In manual mode, the pipeline may be run interactively, via a graphical
user interface (GUI) provided by the Redux package.  The GUI is launched by
the command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>redux
</pre></div>
</div>
<p>entered at the terminal prompt (<a class="reference internal" href="#exes-startup"><span class="std std-numref">Fig. 9</span></a>).  The GUI allows
output directory specification, but it may write initial or temporary
files to the current directory, so it is recommended to start the
interface from a location to which the user has write privileges.</p>
<p>From the command line, the <em>redux</em> interface accepts an optional config file
(<em>-c</em>) or log level specification (<em>-l</em>), in the same way the <em>redux_pipe</em>
command does.  Any pipeline parameters provided to the interface in a
configuration file will be used to set default values; they will still be
editable from the GUI.</p>
<figure class="align-default" id="exes-startup">
<img alt="Startup screen showing a white outline of an airplane with an open telescope door on a blue background showing faint spiral arms and stylized white stars overlaid." src="../../../_images/startup.png" />
<figcaption>
<p><span class="caption-number">Fig. 9 </span><span class="caption-text">Redux GUI startup.</span><a class="headerlink" href="#exes-startup" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<section id="basic-workflow">
<h4>Basic Workflow<a class="headerlink" href="#basic-workflow" title="Permalink to this heading">¶</a></h4>
<p>To start an interactive reduction, select a set of input files, using
the File menu (<strong>File-&gt;Open New Reduction</strong>). This will bring up a file
dialog window (see <a class="reference internal" href="#exes-open-new"><span class="std std-numref">Fig. 10</span></a>). All files selected will be reduced
together as a single reduction set.</p>
<p>Redux will decide the appropriate reduction steps from the input files,
and load them into the GUI, as in <a class="reference internal" href="#exes-reduction-steps"><span class="std std-numref">Fig. 11</span></a>.</p>
<figure class="align-default" id="exes-open-new">
<img alt="File system dialog window showing selected filenames." src="../../../_images/open_new.png" />
<figcaption>
<p><span class="caption-number">Fig. 10 </span><span class="caption-text">Open new reduction.</span><a class="headerlink" href="#exes-open-new" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="exes-reduction-steps">
<img alt="GUI window showing reduction steps with Edit and Run buttons. A log window is displayed with text messages from a reduction." src="../../../_images/reduction_steps.png" />
<figcaption>
<p><span class="caption-number">Fig. 11 </span><span class="caption-text">Sample reduction steps. Log output from the pipeline is
displayed in the <strong>Log</strong> tab.</span><a class="headerlink" href="#exes-reduction-steps" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Each reduction step has a number of parameters that can be edited
before running the step. To examine or edit these parameters,
click the <strong>Edit</strong> button next to the step name to bring up the
parameter editor for that step (<a class="reference internal" href="#exes-parameters"><span class="std std-numref">Fig. 12</span></a>). Within the
parameter editor, all values may be edited.  Click <strong>OK</strong> to save the
edited values and close the window. Click <strong>Reset</strong> to restore any
edited values to their last saved values.  Click <strong>Restore Defaults</strong>
to reset all values to their stored defaults.
Click <strong>Cancel</strong> to discard all changes to the parameters and
close the editor window.</p>
<figure class="align-default" id="exes-parameters">
<img alt="An Edit Parameters dialog window, showing various selection widgets." src="../../../_images/parameters.png" />
<figcaption>
<p><span class="caption-number">Fig. 12 </span><span class="caption-text">Sample parameter editor for a pipeline step.</span><a class="headerlink" href="#exes-parameters" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The current set of parameters can be displayed, saved to a file,
or reset all at once using the <strong>Parameters</strong> menu. A previously
saved set of parameters can also be restored for use with the
current reduction (<strong>Parameters -&gt; Load Parameters</strong>).</p>
<p>After all parameters for a step have been examined and set to the
user’s satisfaction, a processing step can be run on all loaded
files either by clicking <strong>Step</strong>, or the <strong>Run</strong> button next to the
step name. Each processing step must be run in order, but if a
processing step is selected in the <strong>Step through:</strong> widget,
then clicking <strong>Step</strong> will treat all steps up through the selected
step as a single step and run them all at once. When a step has
been completed, its buttons will be grayed out and inaccessible.
It is possible to undo one previous step by clicking <strong>Undo</strong>.
All remaining steps can be run at once by clicking <strong>Reduce</strong>.
After each step, the results of the processing may be displayed
in a data viewer. After running a pipeline step or reduction,
click <strong>Reset</strong> to restore the reduction to the initial state,
without resetting parameter values.</p>
<p>Files can be added to the reduction set (<strong>File -&gt; Add Files</strong>) or
removed from the reduction set (<strong>File -&gt; Remove Files</strong>), but
either action will reset the reduction for all loaded files.
Select the <strong>File Information</strong> tab to display a table of information
about the currently loaded files (<a class="reference internal" href="#exes-file-info"><span class="std std-numref">Fig. 13</span></a>).</p>
<figure class="align-default" id="exes-file-info">
<img alt="A table display showing filenames and FITS keyword values." src="../../../_images/file_info.png" />
<figcaption>
<p><span class="caption-number">Fig. 13 </span><span class="caption-text">File information table.</span><a class="headerlink" href="#exes-file-info" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="display-features">
<h4>Display Features<a class="headerlink" href="#display-features" title="Permalink to this heading">¶</a></h4>
<p>The Redux GUI displays images for quality analysis and display (QAD)
in the DS9 FITS viewer.  DS9 is a standalone image display
tool with an extensive feature set.  See the SAO DS9 site
(<a class="reference external" href="http://ds9.si.edu/">http://ds9.si.edu/</a>) for more usage information.</p>
<p>After each pipeline step completes, Redux may load the produced images
into DS9.  Some display options may be customized directly in DS9;
some commonly used options are accessible from the Redux interface, in the
<strong>Data View</strong> tab (<a class="reference internal" href="#exes-data-view"><span class="std std-numref">Fig. 14</span></a>).</p>
<figure class="align-default" id="exes-data-view">
<img alt="Data viewer settings with various widgets and buttons to control display parameters and analysis tools." src="../../../_images/data_view.png" />
<figcaption>
<p><span class="caption-number">Fig. 14 </span><span class="caption-text">Data viewer settings and tools.</span><a class="headerlink" href="#exes-data-view" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>From the Redux interface, the <strong>Display Settings</strong> can be used to:</p>
<ul class="simple">
<li><p>Set the FITS extension to display (<strong>First</strong>, or edit to enter
a specific extension), or specify that all extensions should
be displayed in a cube or in separate frames.</p></li>
<li><p>Lock individual frames together, in image or WCS coordinates.</p></li>
<li><p>Lock cube slices for separate frames together, in image or
WCS coordinates.</p></li>
<li><p>Set the image scaling scheme.</p></li>
<li><p>Set a default color map.</p></li>
<li><p>Zoom to fit image after loading.</p></li>
<li><p>Tile image frames, rather than displaying a single frame at a
time.</p></li>
</ul>
<p>Changing any of these options in the Data View tab will cause the
currently displayed data to be reloaded, with the new options.
Clicking <strong>Reset Display Settings</strong> will revert any edited options
to the last saved values.  Clicking <strong>Restore Default Display Settings</strong>
will revert all options to their default values.</p>
<p>In the <strong>QAD Tools</strong> section of the <strong>Data View</strong> tab, there are
several additional tools available.</p>
<p>Clicking the <strong>ImExam</strong> button
(scissors icon) launches an event loop in DS9.  After launching it,
bring the DS9 window forward, then use the keyboard to perform interactive
analysis tasks:</p>
<ul class="simple">
<li><p>Type ‘a’ over a source in the image to perform photometry at the
cursor location.</p></li>
<li><p>Type ‘p’ to plot a pixel-to-pixel comparison of all frames at the
cursor location.</p></li>
<li><p>Type ‘s’ to compute statistics and plot a histogram of the data
at the cursor location.</p></li>
<li><p>Type ‘c’ to clear any previous photometry results or active plots.</p></li>
<li><p>Type ‘h’ to print a help message.</p></li>
<li><p>Type ‘q’ to quit the ImExam loop.</p></li>
</ul>
<p>The photometry settings (the image window considered, the model fit,
the aperture sizes, etc.) may be customized in the <strong>Photometry Settings</strong>.
Plot settings (analysis window size, shared plot axes, etc.) may be
customized in the <strong>Plot Settings</strong>.
After modifying these settings, they will take effect only for new
apertures or plots (use ‘c’ to clear old ones first).  As for the display
settings, the reset button will revert to the last saved values
and the restore button will revert to default values.
For the pixel-to-pixel and histogram plots, if the cursor is contained within
a previously defined DS9 region (and the <code class="xref py py-obj docutils literal notranslate"><span class="pre">regions</span></code> package is installed),
the plot will consider only pixels within the region.  Otherwise, a window
around the cursor is used to generate the plot data.  Setting the window
to a blank value in the plot settings will use the entire image.</p>
<p>Clicking the <strong>Header</strong> button (magnifying glass icon) from the
<strong>QAD Tools</strong> section opens a new window that displays headers
from currently loaded FITS files in text form (<a class="reference internal" href="#exes-headers"><span class="std std-numref">Fig. 15</span></a>).
The extensions displayed depends on the extension
setting selected (in <strong>Extension to Display</strong>).  If a particular extension is
selected, only that header will be displayed.  If all extensions
are selected (either for cube or multi-frame display), all extension
headers will be displayed.  The buttons at the bottom of the window
may be used to find or filter the header text, or generate a table
of header keywords.  For filter or table display, a comma-separated
list of keys may be entered in the text box.</p>
<p>Clicking the <strong>Save Current Settings</strong> button (disk icon) from the
<strong>QAD Tools</strong> section saves all current display and photometry
settings for the current user.  This allows the user’s settings to
persist across new Redux reductions, and to be loaded when Redux
next starts up.</p>
<figure class="align-default" id="exes-headers">
<img alt="A dialog window showing a sample FITS header in plain text." src="../../../_images/headers.png" />
<figcaption>
<p><span class="caption-number">Fig. 15 </span><span class="caption-text">QAD FITS header viewer.</span><a class="headerlink" href="#exes-headers" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="exes-reduction">
<h3>EXES Reduction<a class="headerlink" href="#exes-reduction" title="Permalink to this heading">¶</a></h3>
<p>EXES data reduction with Redux follows the data reduction flowchart
in <a class="reference internal" href="#exes-flowchart"><span class="std std-numref">Fig. 1</span></a>. At each step, Redux attempts to determine
automatically the correct action, given the input data and default
parameters, but each step can be customized as needed.</p>
<section id="image-processing">
<h4>Image Processing<a class="headerlink" href="#image-processing" title="Permalink to this heading">¶</a></h4>
<p>The early steps of the EXES pipeline are straightforward: the 2D images
are processed to remove instrument and sky artifacts and calibrate to
physical units.  Their associated variances and reference data are propagated
alongside the modified image in intermediate data products.</p>
</section>
<section id="spectroscopic-processing">
<h4>Spectroscopic Processing<a class="headerlink" href="#spectroscopic-processing" title="Permalink to this heading">¶</a></h4>
<section id="extraction-steps">
<h5>Extraction Steps<a class="headerlink" href="#extraction-steps" title="Permalink to this heading">¶</a></h5>
<p>Spectral extraction with Redux is slightly more complicated than
image processing. The pipeline breaks down the spectral extraction algorithms
into five separate reduction steps to give more control over the extraction
process. These steps are:</p>
<ul class="simple">
<li><p>Make Profiles: Generate a smoothed model of the relative distribution
of the flux across the slit (the spatial profile). After this step is
run, a separate display window showing a plot of the spatial profile
for each order appears.</p></li>
<li><p>Locate Apertures: Use the spatial profile to identify spectra to extract.
By default for most configurations, Redux attempts to automatically
identify sources, but they can also be manually identified by entering a
guess position to fit near, or a fixed position, in the parameters.
Aperture locations are plotted in the profile window.</p></li>
<li><p>Set Apertures: Identify the data to extract from the spatial profile.
This is done automatically by default, but all aperture
parameters can be overridden manually in the parameters for this
step.  Aperture radii and background regions are plotted in the
profile window (see <a class="reference internal" href="#exes-profile-plot"><span class="std std-numref">Fig. 16</span></a>).</p></li>
<li><p>Subtract Background: Residual background is fit and removed for
each column in the 2D image, using background regions specified
in the Set Apertures step.</p></li>
<li><p>Extract Spectra: Extract one-dimensional spectra from the
identified apertures. By default, Redux will attempt optimal extraction for
most configurations. The method can be overridden in the parameters
for this step.</p></li>
</ul>
<p>EXES has a number of configurations for which either the source is too
extended or the slit is too short to treat the target as a compact source.
In particular, for high-low mode (unless nod-on-slit), for observations that
are marked as extended sources (SRCTYPE=EXTENDED_SOURCE), or for sky spectra
the default parameters are modified to:</p>
<ul class="simple">
<li><p>turn off median level subtraction in the spatial profile generation</p></li>
<li><p>place a single aperture position at the center of the slit</p></li>
<li><p>set the aperture radius to extract the full slit</p></li>
<li><p>turn off background subtraction</p></li>
<li><p>use standard extraction instead of optimal.</p></li>
</ul>
<p>These defaults may still be overridden in the parameters for each step.</p>
</section>
<section id="spectral-displays">
<h5>Spectral Displays<a class="headerlink" href="#spectral-displays" title="Permalink to this heading">¶</a></h5>
<p>Extracted spectra are displayed in an interactive plot window, for
data analysis and visualization (see <a class="reference internal" href="#exes-spectral-plot"><span class="std std-numref">Fig. 17</span></a>).</p>
<p>The spectral display tool has a number of useful features and controls.
See <a class="reference internal" href="#exes-eye-controls-image"><span class="std std-numref">Fig. 18</span></a> and the table below for a quick summary.</p>
<table class="longtable docutils align-default" id="id5">
<caption><span class="caption-number">Table 4 </span><span class="caption-text">Spectral Viewer controls</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 30.0%" />
<col style="width: 30.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Feature</strong></p></th>
<th class="head"><p><strong>Control</strong></p></th>
<th class="head"><p><strong>Keyboard shortcut</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Load new FITS file</p></td>
<td><p><em>File Choice -&gt; Add File</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Remove loaded FITS file</p></td>
<td><p><em>File Choice -&gt;</em>
<em>Remove File</em></p></td>
<td><p>Press <em>delete</em> in the
<em>File Choice</em> panel</p></td>
</tr>
<tr class="row-even"><td><p>Plot selected file</p></td>
<td><p><em>File Choice -&gt;</em>
<em>(double-click)</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Add a new plot window (pane)</p></td>
<td><p><em>Panes -&gt;</em>
<em>Add Pane</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Remove a pane</p></td>
<td><p><em>Panes -&gt;</em>
<em>Remove Pane</em></p></td>
<td><p>Press <em>delete</em> in the
<em>Panes</em> panel, or in
the plot window</p></td>
</tr>
<tr class="row-odd"><td><p>Show or hide a plot</p></td>
<td><p><em>Panes -&gt; Pane # -&gt;</em>
<em>File name -&gt; Enabled</em>,
or click the <em>Hide all</em>/
<em>Show all</em> button</p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Display a different X or Y
field (e.g. spectral error,
transmission, or response)</p></td>
<td><p><em>Axis -&gt;</em>
<em>X Property</em> or
<em>Y Property</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Overplot a different Y axis
field (e.g. spectral error,
transmission, or response)</p></td>
<td><p><em>Axis -&gt;</em>
<em>Overplot -&gt; Enabled</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Change X or Y units</p></td>
<td><p><em>Axis -&gt;</em>
<em>X Unit</em> or
<em>Y Unit</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Change X or Y scale</p></td>
<td><p><em>Axis -&gt;</em>
<em>X Scale</em> or <em>Y Scale</em>
<em>-&gt; Linear</em> or <em>Log</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Interactive zoom</p></td>
<td><p><em>Axis -&gt; Zoom</em>:
<em>X</em>, <em>Y</em>, <em>Box</em>,
then click in the plot
to set the limits; or
<em>Reset</em> to reset the
limits to default.</p></td>
<td><p>In the plot window,
press <em>x</em>, <em>y</em>, or
<em>z</em> to start zoom mode
in x-direction,
y-direction, or box
mode, respectively.
Click twice on the
plot to set the new
limits.  Press <em>w</em>
to reset the plot
limits to defaults.</p></td>
</tr>
<tr class="row-odd"><td><p>Fit a spectral feature</p></td>
<td><p>–</p></td>
<td><p>In the plot window,
press <em>f</em> to start
the fitting mode.
Click twice on the
plot to set the data
limits to fit.</p></td>
</tr>
<tr class="row-even"><td><p>Change the feature or baseline
fit model</p></td>
<td><p><em>Analysis -&gt; Feature,</em>
<em>Background</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Load a spectral line list for
overplot display</p></td>
<td><p><em>Analysis -&gt; Reference</em>
<em>Data: Open, Load List</em></p>
<p>Select a one- or two-
column text file
containing wavelengths in
microns and (optionally)
labels for the values.
Columns may be comma,
space, or ‘|’ separated.</p>
</td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Clear zoom or fit mode</p></td>
<td><p>–</p></td>
<td><p>In the plot window,
press <em>c</em> to clear
guides and return to
default display mode.</p></td>
</tr>
<tr class="row-odd"><td><p>Change the plot color cycle</p></td>
<td><p><em>Plot -&gt;
Color cycle -&gt;
Accessible</em>, <em>Spectral</em>
or <em>Tableau</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Change the plot type</p></td>
<td><p><em>Plot -&gt; Plot type -&gt;
Step</em>, <em>Line</em>, or
<em>Scatter</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>Change the plot display options</p></td>
<td><p><em>Plot -&gt;
Show markers</em>,
<em>Show errors</em>,
<em>Show grid</em>, or
<em>Dark mode</em></p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>Display the cursor position</p></td>
<td><p><em>Cursor panel</em> -&gt;
Check <em>Cursor Location</em>
for a quick display or
press <em>Popout</em> for full
information</p></td>
<td><p>–</p></td>
</tr>
</tbody>
</table>
<figure class="align-default" id="exes-profile-plot">
<img alt="A display window with a profile plot and lines marking the aperture." src="../../../_images/profile_plot.png" />
<figcaption>
<p><span class="caption-number">Fig. 16 </span><span class="caption-text">Aperture location automatically identified and over-plotted
on the spatial profile.  The cyan line indicates the aperture center.
Green lines indicate the integration aperture for optimal extraction,
dark blue lines indicate the PSF radius (the point at which the flux
goes to zero), and red lines indicate background regions.</span><a class="headerlink" href="#exes-profile-plot" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="exes-spectral-plot">
<img alt="A GUI window showing a spectral plot, in Wavepos (cm-1) vs. Spectral_flux (erg/cm2 k s sr)." src="../../../_images/spectral_plot.png" />
<figcaption>
<p><span class="caption-number">Fig. 17 </span><span class="caption-text">Final extracted spectrum, displayed in an interactive plot window.</span><a class="headerlink" href="#exes-spectral-plot" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="exes-eye-controls-image">
<img alt="A GUI window showing a spectral plot and various buttons and widgets to control the plot display." src="../../../_images/eye_controls.png" />
<figcaption>
<p><span class="caption-number">Fig. 18 </span><span class="caption-text">Control panels for the spectral viewer are located to the left and
below the plot window.  Click the arrow icons to show or collapse
them.</span><a class="headerlink" href="#exes-eye-controls-image" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="useful-parameters">
<h4>Useful Parameters<a class="headerlink" href="#useful-parameters" title="Permalink to this heading">¶</a></h4>
<p>Some key parameters for all reduction steps are listed below.</p>
<p>In addition to the specified parameters, the output from each step may
be optionally saved by selecting the ‘save’ parameter.</p>
<ul>
<li><p><strong>Load Data</strong>:</p>
<ul class="simple">
<li><p><em>Abort reduction for invalid headers</em>: By default, Redux will abort the
reduction if the input header keywords do not meet requirements. Unset
this option to attempt the reduction anyway.</p></li>
<li><p><em>Extract sky spectrum</em>: If set, the subsequent reduction will be
treated as a sky extraction, for calibration purposes, rather than
a science extraction.  This will set the dark subtraction option in
the Subtract Nods step, the ‘fix to center’ option in Locate Apertures,
‘extract the full slit’ option in Set Apertures, ‘skip background
subtraction’ in Subtract Background, and extraction method: ‘standard’
in Extract Spectra.  All output filenames and product types at and after
the Subtract Nods step will be modified (see <a class="reference internal" href="#exes-prod"><span class="std std-numref">Table 2</span></a>).</p></li>
<li><p><em>Central wavenumber</em>: If the central wavenumber is known more precisely
than the value in the WAVENO0 keyword, enter it here to use it in
the distortion correction calculations and wavelength calibration.
This value will be filled in automatically at the end of a
reduction, if the Refine Wavecal step modifies the central
wavenumber, so that the reduction may be reset and re-run with the
new parameter.</p></li>
<li><p><em>HR focal length</em>: This distortion parameter may be adjusted to
tune the dispersion solution for cross-dispersed spectra. Reducing
HRFL decreases the wavenumber of the left end of the order.</p></li>
<li><p><em>XD focal length</em>: This distortion parameter may be adjusted to
tune the dispersion solution for long-slit spectra. Reducing XDFL
decreases the wavenumber of the left end of the order for a
correctly identified central wavenumber. This parameter may also
be adjusted to tune the predicted spacing between orders in
cross-dispersed mode. In this case, increasing XDFL increases the
predicted spacing.</p></li>
<li><p><em>Slit rotation</em>: This distortion parameter may be adjusted to tune
the slit skewing, to correct for spectral features that appear
tilted across an order. For cross-dispersed modes, increasing the
slit rotation angle rotates the lines clockwise in the undistorted
image. For long-slit modes, decreasing the slit rotation angle
rotates the lines clockwise in the undistorted image.</p></li>
<li><p><em>Detector rotation</em>: This parameter may be adjusted to change
the detector rotation from the default value.</p></li>
<li><p><em>HRR</em>: This parameter may be adjusted to change the R number for
the echelon grating.</p></li>
<li><p><em>Ambient temperature for the flat mirror</em>: Set to override the
default ambient temperature for the flat mirror. Typical default is 290K.</p></li>
<li><p><em>Emissivity for the flat mirror</em>: Set to override the default
emissivity fraction for the flat mirror. Typical default is 0.1.</p></li>
</ul>
</li>
<li><p><strong>Coadd Readouts</strong>:</p>
<ul>
<li><p>General Parameters</p>
<ul class="simple">
<li><p><em>Readout algorithm</em>: Set the readout mode.  The default is
‘Last destructive only’, indicating
that only the final destructive read should be used, regardless of
readout pattern.  ‘First/last’ will use the first
non-destructive read and the last destructive; ‘Second/penultimate’
will use the second and second-to-last frames.
‘Default for read mode’ will attempt to choose the best read mode
for the readout pattern used (typically Fowler mode).</p></li>
<li><p><em>Apply linear correction</em>: If set, a standard linearity correction
will be applied.</p></li>
<li><p><em>Correct odd/even row gains</em>: If set, gain offsets between odd and
even rows will be fit and removed.</p></li>
</ul>
</li>
<li><p>Integration Handling Parameters</p>
<blockquote>
<div><ul class="simple">
<li><p><em>Science files: toss first integrations</em>:
If set to 0, all integration sets will be used.
If set to 1 or 2, that many integrations will be discarded from the
beginning of the raw input science files.</p></li>
<li><p><em>Flat files: toss first integrations</em>:
If set to 0, all integration sets will be used.
If set to 1 or 2, that many integrations will be discarded from the
beginning of the raw input flat files.</p></li>
<li><p><em>Dark files: toss first integrations</em>:
If set to 0, all integration sets will be used.
If set to 1 or 2, that many integrations will be discarded from the
beginning of the raw input dark files.</p></li>
<li><p><em>Copy integrations instead of tossing</em>: If set, “tossed” integrations
will be replaced with frames from the next B nod instead of discarded.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</li>
<li><p><strong>Make Flat</strong>:</p>
<ul>
<li><p>General Parameters</p>
<ul class="simple">
<li><p><em>Save flat as separate file</em>: The standard output from this step is the
science files with flat planes attached.  If this option is set,
the flat information is additionally saved to a separate FITS file.
This flat file may be used in place of raw flat files for future
data reductions with the same instrument configuration.</p></li>
</ul>
</li>
<li><p>Order Edge Determination Parameters</p>
<ul class="simple">
<li><p><em>Threshold factor</em>: This value defines the illumination threshold
for a flat, which determines where the edges of cross-dispersed
orders are placed. Enter a number between 0 and 1. If the pipeline
reports that it can not determine order edges, increasing the
threshold slightly, to widen the gaps between orders, may help.</p></li>
<li><p><em>Optimize rotation angle</em>: Unset this option to prevent the
pipeline from using the 2D FFT of the edge-enhanced flat to try to
determine the best rotation angle (<em>krot</em>).</p></li>
<li><p><em>Edge enhancement method</em>: Depending on the noise and illumination
characteristics of the input flat, it may work better to take the
2D FFT of the squared derivative or the Sobel filtered image,
rather than the derivative, of the flat. Use the drop-list to
select an alternate algorithm.</p></li>
<li><p><em>Starting rotation angle</em>: Enter a number here to use as the
starting value for <em>krot</em>. If not set, the starting value will be
taken from the default parameters in configuration tables.</p></li>
<li><p><em>Predicted spacing</em>: Enter a value here, in pixels, to use as the
predicted spacing for cross-dispersed orders. This number will be
used as a first guess for the spacing parameter in the fit to the
2D FFT, overriding the value calculated from header parameters.</p></li>
</ul>
</li>
<li><p>Order Edge Override Parameters</p>
<blockquote>
<div><ul class="simple">
<li><p><em>Bottom pixel for undistorted order</em>: For medium and low configurations,
specifying a value here sets the bottom edge of the order mask to
this value.</p></li>
<li><p><em>Top pixel for undistorted order</em>: Sets the top edge of the order mask
to this value (medium and low only).</p></li>
<li><p><em>Starting pixel for undistorted order</em>: Sets the left edge of
all orders in the order mask to this value.</p></li>
<li><p><em>Ending pixel for undistorted order</em>: Sets the right edges of
all orders in the order mask to this value.</p></li>
<li><p><em>Custom cross-dispersed order mask</em>: Select a file to directly define
cross-dispersed order edges (bottom, top, start, and end).  There
should be one line for each order with edge values specified as
white-space separated integers (B T S E), starting with the top-most
order (largest B/T). Values are post-distortion correction and rotation,
so that B/T are y values and S/E are x values, zero-indexed.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</li>
<li><p><strong>Despike</strong>:</p>
<ul class="simple">
<li><p><em>Combine all files before despike</em>: If set, all planes from all files
will be combined into a single file before computing outlier statistics.
Input data will be treated as a single file for all subsequent steps.</p></li>
<li><p><em>Ignore beam designation</em>: If set, all frames are used for computing
outlier statistics, rather than comparing A nods and B nods separately.</p></li>
<li><p><em>Spike factor</em>: Enter a value for the threshold for a pixel to be
considered a spike. This value is multiplied by the standard
deviation of the pixel across all frames: e.g. a value of 20 marks
pixels with values over 20 sigma as bad pixels.</p></li>
<li><p><em>Mark trashed frames for exclusion</em>: If set, frames that
have significantly more noise compared to the rest will be identified
and excluded from future processing. These frames will not be
spike-corrected.</p></li>
<li><p><em>Propagate NaN values</em>: If set, spiky pixels will be replaced with NaN
values.  If not, they will be replaced with the average value from the
remaining frames.</p></li>
</ul>
</li>
<li><p><strong>Debounce</strong>:</p>
<ul class="simple">
<li><p><em>Bounce factor</em>: Enter a number to use as the amplitude of the
bounce correction. A value of 0 means no bounce correction will be
applied. Values greater than 0 apply the first derivative bounce
(shifting) only. Values less than 0 also apply the second
derivative bounce (smoothing). Typical nonzero values are 0.1 or
-0.1.</p></li>
<li><p><em>Spectral direction</em> If set, the bounce correction will be applied
in the spectral direction instead of the spatial direction.</p></li>
</ul>
</li>
<li><p><strong>Subtract Nods</strong>:</p>
<ul class="simple">
<li><p><em>Skip nod subtraction</em>: If set, this option will cause the
pipeline to continue without performing nod-subtraction. This
option may be used to extract reference sky spectra.</p></li>
<li><p><em>Subtract residual sky</em>: This option applies only to nod-off-slit
mode. If set, it will attempt to remove any residual sky
signal before subtracting pairs. This option will remove any
average continuum value along the slit; if this is not desired,
background regions should be set at the time of extraction instead.</p></li>
<li><p><em>Dark subtraction</em>: If set, nod subtraction will be skipped and
a dark frame will be subtracted from all planes instead.  The
dark file must have been loaded into the reduction with the raw
data or attached to an input processed flat.  If no dark is available,
the step will fall back to skipping nod subtraction. This option may
produce cleaner reference sky spectra than simply skipping nod
subtraction.</p></li>
</ul>
</li>
<li><p><strong>Flat Correct</strong>:</p>
<ul class="simple">
<li><p><em>Skip flat correction</em>: If set, the data will not be multiplied by
the flat.  This option is primarily used for testing.</p></li>
</ul>
</li>
<li><p><strong>Clean Bad Pixels</strong>:</p>
<ul class="simple">
<li><p><em>Bad pixel threshold</em>: Enter a value for the threshold for a pixel
to be considered a bad pixel. This value is multiplied by the
standard deviation of all good pixels in the frame.</p></li>
<li><p><em>Propagate NaN values</em>: If set, bad pixels are replaced with NaN and
ignored in future processing steps.  If not set, bad pixels are
interpolated over.</p></li>
</ul>
</li>
<li><p><strong>Undistort</strong>:</p>
<ul class="simple">
<li><p><em>Interpolation method</em>: Two interpolation methods are available for
performing the distortion correction.  ‘Cubic convolution’ replicates
the behavior of the IDL interpolate function in the original pipeline,
implementing a 2D separable parametric cubic convolution, with the
edge-preserving parameter alpha set to -0.5 to mimic sinc interpolation.
‘Piecewise spline’ implements polynomial spline interpolation of
specified order; cubic by default.</p></li>
<li><p><em>Spline order</em>: Sets the polynomial order for piecewise spline
interpolation.  May be 0-5, where 0 is nearest value, 1 is linear,
and 3 is cubic interpolation.</p></li>
<li><p><em>Set unilluminated pixels to NaN</em>: If set, unilluminated areas of the
flat field and order edges are set to NaN.</p></li>
</ul>
</li>
<li><p><strong>Correct Calibration</strong>:</p>
<ul class="simple">
<li><p><em>Skip calibration correction</em>: If set, no calibration correction will
be performed.  This option is primarily used for testing.</p></li>
</ul>
</li>
<li><p><strong>Coadd Pairs</strong>:</p>
<ul class="simple">
<li><p><em>Save modified frames before coadd</em>: If set, modified input data
is saved to disk for inspection, prior to coadding.  The output
FITS file has file code COI and PRODTYPE = ‘coadd_input’.</p></li>
<li><p><em>Subtract residual sky</em>: If set, the mean value at each wavelength
bin will be subtracted to remove any residual sky noise. This option
applies only to nod-on-slit mode.</p></li>
<li><p><em>Shift before coadd</em>: Set to attempt to shift spectra in the
spatial direction to align with each other before coadding.</p></li>
<li><p><em>Shift method</em>: Select whether to maximize the signal or the
signal-to-noise when determining the spatial shift.</p></li>
<li><p><em>Skip coadd</em>: Check to skip coadding images and instead extract
separate spectra from each frame. If selected, each frame will be
treated as a separate file after this step. For map mode, coadding
is skipped by default.</p></li>
<li><p><em>Coadd all files</em>: If set, all input files will be coadded together,
as if they were in a single file.</p></li>
<li><p><em>Exclude pairs</em>: Enter comma-separated numbers to identify
specific nod-subtracted frames to exclude from the coadd. For
example, entering <em>1,4,7</em> will exclude the first, fourth, and
seventh frame from the coadd. If multiple files are loaded, lists
for each file may be entered, separated by a semi-colon. For
example, <em>1,4;;3,10</em> will exclude the first and fourth frames for
the first file and the third and tenth for the third file.</p></li>
<li><p><em>Robust threshold</em>: Set to a number greater than zero to enable
outlier rejection before coadding.  The threshold value is the
number of standard deviations away from the median for which a value
is rejected.</p></li>
<li><p><em>Weighting method</em>: Set to ‘uniform weights’ to use equal
weights for all input frames.  Otherwise, select ‘weight by flat’
to weight frames, using the flat illumination to determine good data,
or ‘weight by variance’ to use the variance plane to identify good data.</p></li>
<li><p><em>Override weights</em>: Enter comma-separated numbers to directly
specify weight values for each input frame. Separate lists for
multiple files with a semi-colon. If provided, the weighting method
parameter is ignored.</p></li>
</ul>
</li>
<li><p><strong>Convert units</strong>:</p>
<ul class="simple">
<li><p><em>Skip unit conversion</em>: If set, no flux unit conversion will
be performed.  This option is primarily used for testing.</p></li>
<li><p><em>Additional calibration scaling</em>: If provided, this factor is multiplied
into all flux extensions, for additional a priori calibration correction
to the flux scale.  This may be used to account for any known
multiplicative systematic effects.</p></li>
<li><p><em>Additional calibration offset</em>: If provided, this factor is added
into all flux extensions after scaling, for additional a priori
calibration correction to the flux zero level.  This may be used to
account for any known additive systematic effects.</p></li>
</ul>
</li>
<li><p><strong>Make Profiles</strong>:</p>
<ul class="simple">
<li><p><em>Row fit order</em>: Typically a fourth-order polynomial fit is used
to calculate the smooth spatial profile. Occasionally, a higher or
lower order fit may give better results.</p></li>
<li><p><em>Subtract median background</em>: If set, the median level of the
smoothed spatial profile will be subtracted to remove residual
background from the total extracted flux.
This option is off by default for some modes (e.g. high-low data, sky spectra).
For other data, this option is appropriate as long as the slit is
dominated by background, rather than source flux. If the spatial profile
dips below zero at any point (other than for a negative spectrum), this
option should be deselected.</p></li>
</ul>
</li>
<li><p><strong>Locate Apertures</strong></p>
<ul class="simple">
<li><p><em>Aperture location method</em>: If ‘auto’, the strongest Gaussian peak(s) in the
spatial profile will be selected, with an optional starting guess
(<em>Aperture position</em>, below).  If ‘fix to input’, the value in the
<em>Aperture position</em> parameter will be used without refinement.
If ‘fix to center’, the center of the slit will be used.  ‘Fix to center’
is default for some modes (high-low data,sky spectra); otherwise ‘auto’ is default.</p></li>
<li><p><em>Number of auto apertures</em>: Set this parameter
to 1 to automatically find the single brightest source, or 2 to find the
two brightest sources, etc. Sources may be positive or negative.</p></li>
<li><p><em>Aperture position</em>: Enter a guess value for the aperture to use as a
starting point for method = ‘auto’, or a fixed value to use as the
aperture center for method = ‘fix to input’. Values are in arcseconds
up the slit (refer to the spatial profile). Separate multiple
apertures for a single file by commas;
separate values for multiple files by semi-colons. For example,
<em>3,8;2,7</em> will look for two apertures in each of two files, near
3” and 8” in the first image and 2” and 7” in the second image. If
there are multiple files loaded, but only one aperture list is
given, the aperture parameters will be used for all images.</p></li>
<li><p><em>Expected aperture FWHM (arcsec)</em>: Gaussian FWHM estimate for spatial
profile fits, to determine peaks.</p></li>
<li><p><em>Exclude orders</em>: Enter comma-separated numbers to identify
specific orders to exclude from spectral extraction.</p></li>
</ul>
</li>
<li><p><strong>Set Apertures</strong>:</p>
<ul class="simple">
<li><p><em>Extract the full slit</em>: If set, all other parameters are ignored,
and the PSF radius will be set to include the full slit.</p></li>
<li><p><em>Refit apertures for FWHM</em>: The spatial FWHM for the aperture is used
to determine the aperture and PSF radii, unless they are directly
specified.  If this parameter is set, the profile will be re-fit with
a Gaussian to determine the FWHM.  If it is not set, the value
determined or set in the Locate Apertures step is used (stored
as APFWHM01 in the FITS header).</p></li>
<li><p><em>Aperture sign</em>: Enter either 1 or -1 to skip the
automatic determination of the aperture sign from the spatial
profile. If the value is -1, the spectrum will be multiplied by
-1. Separate multiple apertures by commas; separate values for
multiple files by semi-colons. If a single value is specified,
it will be applied to all apertures.</p></li>
<li><p><em>Aperture radius</em>: Enter a radius in arcsec to skip the
automatic determination of the aperture radius from the profile
FWHM. Separate multiple apertures by commas; separate values for
multiple files by semi-colons. If a single value is specified,
it will be applied to all apertures.</p></li>
<li><p><em>PSF radius</em>: Enter a radius in arcsec to skip the
automatic determination of the PSF radius from the profile
FWHM. Separate multiple apertures by commas; separate values for
multiple files by semi-colons. If a single value is specified,
it will be applied to all apertures.</p></li>
<li><p><em>Background regions</em>: Enter a range in arcsec to use as the
background region, skipping automatic background determination.
For example, <em>0-1,8-10</em> will use the regions
between 0” and 1” and between 8” and 10” to determine the
background level to subtract in extraction. Values are for the
full image, rather than for a particular aperture.  Separate
values for multiple files with semi-colons.</p></li>
<li><p><em>Override aperture start</em>: Enter an aperture start location in arcsec.
If set, and aperture end is also specified, this parameter overrides
all other settings, including the starting aperture position.</p></li>
<li><p><em>Override aperture end</em>: Enter an aperture end location in arcsec.
If set, and aperture start is also specified, this parameter overrides
all other settings, including the starting aperture position.</p></li>
</ul>
</li>
<li><p><strong>Subtract Background</strong></p>
<ul class="simple">
<li><p><em>Skip background subtraction</em>: Set to skip calculating and removing
residual background. If no background regions were set, background
subtraction will be automatically skipped.</p></li>
<li><p><em>Background fit order</em>: Set to a number greater than or equal to
zero for the polynomial order of the fit to the background
regions.</p></li>
<li><p><em>Bad pixel threshold</em>: Set to a value greater than or equal to zero
to modify the robust threshold in the background fit.</p></li>
</ul>
</li>
<li><p><strong>Extract Spectra</strong></p>
<ul class="simple">
<li><p><em>Save extracted 1D spectra</em>: If set, the extracted spectra will
be saved to disk in Spextool format (file code SPC,
PRODTYPE = spectra_1d).</p></li>
<li><p><em>Extraction method</em>: The default is to use
standard extraction for EXTENDED_SOURCE, high-low data, and sky spectra;
optimal extraction otherwise. Standard extraction may be necessary for
some faint sources.</p></li>
<li><p><em>Use median profile instead of spatial map</em>: By default, the pipeline uses a
wavelength-dependent spatial map for extraction, but this
method may give poor results if the signal-to-noise
in the profile is low. Set this option to use the median spatial
profile across all wavelengths instead.</p></li>
<li><p><em>Use spatial profile to fix bad pixels</em>: The pipeline usually
uses the spatial profile to attempt to interpolate over bad pixels during
standard extraction, and in the output 2D image for either extraction
method. Occasionally, this may result in a failed extraction.
Unset this options to extract the spectra without bad pixel correction.</p></li>
<li><p><em>Bad pixel threshold</em>: Enter a value for the threshold for a pixel
to be considered a bad pixel. This value is multiplied by the
standard deviation of all good pixels in the aperture at each
wavelength bin.</p></li>
<li><p><em>ATRAN directory</em>: This parameter specifies the location of a
library of ATRAN FITS files to use.  If blank or set to a directory
that does not exist, the default files provided with the pipeline
will be used.</p></li>
<li><p><em>ATRAN file</em>: This parameter is used to directly override the ATRAN data
to attach to the output spectrum, for reference. If blank, the default ATRAN
file on disk will be used. Set to a valid FITS file path to override the
default ATRAN file with a new one.</p></li>
</ul>
</li>
<li><p><strong>Combine Spectra</strong>:</p>
<ul class="simple">
<li><p>General Parameters</p>
<ul>
<li><p><em>Combination method</em>: Mean is the default for all data; median
may also be useful for some input data.</p></li>
<li><p><em>Weight by errors</em>: If set, the average of the data will be
weighted by the errors. Ignored for method=median.</p></li>
</ul>
</li>
<li><p>1-2D Combination Parameters</p>
<ul>
<li><p><em>Combine apertures</em>: If unset, spectra from separate files
will be combined, but separate apertures will remain separate in
the output file.</p></li>
<li><p><em>Robust combination</em>: If set, data will be sigma-clipped before
combination for mean or median methods.</p></li>
<li><p><em>Outlier rejection threshold (sigma)</em>: The sigma-clipping threshold
for robust combination methods, in units of sigma (standard deviation).</p></li>
<li><p><em>Maximum sigma-clipping iterations</em>: The maximum number of rounds to
use in outlier rejection.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Refine Wavecal</strong>:</p>
<ul class="simple">
<li><p><em>Order number for identified line</em>: Enter an integer order number
containing the identified spectral feature.</p></li>
<li><p><em>Identify line</em>: Enter the pixel position of the spectral feature
to use for refining the calibration.</p></li>
<li><p><em>Identify wavenumber</em>: Enter the calibrated wavenumber of the identified
spectral feature.</p></li>
</ul>
</li>
<li><p><strong>Merge Orders</strong>:</p>
<ul class="simple">
<li><p>General Parameters</p>
<ul>
<li><p><em>ATRAN directory</em>: This parameter specifies the location of a
library of ATRAN FITS files to use.  If blank or set to a directory
that does not exist, the default files provided with the pipeline
will be used.</p></li>
<li><p><em>ATRAN file</em>: This parameter is used to directly override the ATRAN file
to attach to the output spectrum, for reference. If blank, the default ATRAN
file on disk will be used. Set to a valid FITS file path to override the
default ATRAN file with a new one.</p></li>
</ul>
</li>
<li><p>Trimming Parameters</p>
<ul>
<li><p><em>Regions to trim before merge</em>: Specified regions will be set to NaN
before merging. Specify as semi-colon separated lists of order number :
wavenumber regions. For example, “1:780-785,786-787;2:801.5-802.3” will
trim 2 regions from order 1 and 1 region from order 2.</p></li>
</ul>
</li>
<li><p>Merging Parameters</p>
<ul>
<li><p><em>Selection threshold</em>: By default, pixels in overlapping regions
are used if their signal-to-noise ratio is greater than 0.1 times
the maximum signal-to-noise in the order. Increasing or decreasing
this value may reduce artifacts like discontinuous jumps or
excessively noisy overlap regions.  Set to 0 to turn off.</p></li>
<li><p><em>S/N statistic to compare</em>: Sets the signal-to-noise statistic
for use in rejecting pixels in overlapping regions.  Default is
‘max’; ‘mean’ or ‘median’ may give more robust results in some cases.</p></li>
<li><p><em>Apply selection threshold to noise only</em>: If set, the S/N statistic
is computed from 1/noise only. This may be useful if there are
large outliers in signal with low computed noise.</p></li>
<li><p><em>Use local standard deviation for noise thresholding</em>: If set, the
input error spectrum is ignored and a sliding standard deviation
calculation is used in its place for S/N thresholding.</p></li>
<li><p><em>Radius for local standard deviation</em>: Sets the window size for the
sliding standard deviation calculation, in pixels.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Make Spectral Map</strong></p>
<ul class="simple">
<li><p><em>Normalize spectrum before plotting</em>: If set, the spectrum will be
divided by its median value.</p></li>
<li><p><em>Flux scale for plot</em>: Specify a low and high percentile value
for the spectral flux scale, e.g. [0,99].  If set to [0, 100],
Matplotlib defaults are used.</p></li>
<li><p><em>Fraction of outer wavelengths to ignore</em>:  Used to block edge effects
for noisy spectral orders. Set to 0 to include all wavelengths in
the plot.</p></li>
<li><p><em>Overplot transmission</em>: If set, the atmospheric transmission spectrum
will be displayed in the spectral plot.</p></li>
<li><p><em>Overplot error range</em>: If set, the error spectrum is plotted as a
range overlay.</p></li>
<li><p><em>Color map</em>: Color map for the spectral plot colors.  Any valid Matplotlib
color map name may be specified.</p></li>
<li><p><em>Overplot color</em>: Color for the transmission spectrum over plot.
Any valid Matplotlib color value may be specified.</p></li>
<li><p><em>Watermark text</em>: If set to a non-empty string, the text will be
added to the lower-right of the image as a semi-transparent watermark.</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>
<section id="data-quality-assessment">
<h2>Data quality assessment<a class="headerlink" href="#data-quality-assessment" title="Permalink to this heading">¶</a></h2>
<p>After the pipeline has been run on a set of input data, the output
products should be checked to ensure that the data has been properly
reduced:</p>
<ul class="simple">
<li><p>Check the output to the terminal or the log for warnings or
errors. Non-fatal warnings will be prepended with the string
<em>WARNING</em>. Fatal errors will be prepended with the string <em>ERROR</em>.</p></li>
<li><p>Check that the expected files were written to disk: there should, at
a minimum, be a coadded 2D image (<em>COA</em>) and an extracted spectrum
(<em>MRD)</em>.</p></li>
<li><p>Look at the reduced image. Check that the distortion correction
appears to have been calculated and applied correctly: order edges
and spectral lines should appear to be aligned with the image columns
and rows. If they are not, there may be a problem with the flat or
with the optical parameters used.</p></li>
<li><p>Look at the intermediate extracted spectra in the spectral viewer. The spectra
from positive and negative apertures should look similar. Spectra
from separate observations of the same source in the same mode should
look similar.</p></li>
<li><p>Compare the signal-to-noise in the extracted spectrum to the reduced
image. If the target seems bright in the reduced image, but the
spectrum looks noisy, it may be that the aperture centers were not
defined correctly.</p></li>
<li><p>Check the aperture parameters recorded in the pipeline output and in
the output file headers. The calculated aperture and PSF radii should
have similar values for all apertures. The aperture centers for each
order should also be similar in cross-dispersed spectra.</p></li>
<li><p>Check the extracted spectra for excessive outliers. Most bad pixels
should be removed in the extraction process. If they are not, it may
be helpful to use the median spatial profile, set the bad pixel
threshold lower, or manually trim noisy regions.</p></li>
</ul>
</section>
<section id="appendix-a-sample-configuration-file">
<h2>Appendix A: Sample configuration file<a class="headerlink" href="#appendix-a-sample-configuration-file" title="Permalink to this heading">¶</a></h2>
<p>Below is a sample EXES Redux parameter override file in INI format.
If present, the parameter value overrides the default defined by the EXES
reduction object. If not present, the default value will be used.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Redux parameters for EXES instrument in Spectroscopy mode
# Pipeline: EXES_REDUX v3_0_0
[1: load_data]
    abort = True
    sky_spec = False
    cent_wave = &quot;&quot;
    hrfl = &quot;&quot;
    xdfl = &quot;&quot;
    slit_rot = &quot;&quot;
    det_rot = &quot;&quot;
    hrr = &quot;&quot;
[2: coadd_readouts]
    save = True
    lin_corr = False
    toss_integrations = 0
    algorithm = Last destructive only
    refpix_bpm = default
[3: make_flat]
    save = False
    save_flat = True
    threshold = 0.15
    opt_rot = True
    edge_method = Derivative
    start_rot = &quot;&quot;
    predict_spacing = &quot;&quot;
    bottom_pix = &quot;&quot;
    top_pix = &quot;&quot;
    start_pix = &quot;&quot;
    end_pix = &quot;&quot;
    custom_wavemap = &quot;&quot;
[4: despike]
    save = False
    combine_all = False
    spike_fac = 20.0
    mark_trash = False
[5: debounce]
    save = False
    bounce_fac = 0.0
    spec_direction = False
[6: subtract_nods]
    save = False
    skip_nod = False
    subtract_sky = False
    subtract_dark = False
[7: flat_correct]
    save = False
    skip_flat = False
[8: clean_badpix]
    save = False
    bp_threshold = 20.0
    propagate_nan = True
[9: undistort]
    save = True
[10: correct_calibration]
    save = False
[11: coadd_pairs]
    save = True
    save_intermediate = False
    subtract_sky = False
    shift = False
    shift_method = Maximize signal-to-noise
    skip_coadd = False
    coadd_all_files = False
    exclude_pairs = &quot;&quot;
    weight_method = Weight by flat
    threshold = 8.0
[12: make_profiles]
    save = False
    fit_order = 4
    bg_sub = True
[13: locate_apertures]
    save = False
    method = auto
    num_aps = 1
    input_position = &quot;&quot;
    fwhm = 3.0
    exclude_orders = &quot;&quot;
[14: set_apertures]
    save = False
    full_slit = False
    refit = True
    apsign = &quot;&quot;
    aprad = &quot;&quot;
    psfrad = &quot;&quot;
    bgr = &quot;&quot;
    ap_start = &quot;&quot;
    ap_end = &quot;&quot;
[15: subtract_background]
    save = False
    skip_bg = False
    bg_fit_order = 0
    threshold = 4.0
[16: extract_spectra]
    save = True
    save_1d = True
    method = optimal
    use_profile = False
    fix_bad = True
    threshold = 5.0
    atrandir = $DPS_SHARE/calibrations/ATRAN/fits
    atranfile = &quot;&quot;
[17: combine_spectra]
    save = False
    method = mean
    weighted = True
    combine_aps = True
    robust = True
    threshold = 8.0
    maxiters = 5
[18: refine_wavecal]
    interactive = False
    identify_order = &quot;&quot;
    identify_line = &quot;&quot;
    identify_waveno = &quot;&quot;
[19: merge_orders]
    save = True
    threshold = 0.15
    trim = False
    trim_regions = &quot;&quot;
    atrandir = $DPS_SHARE/calibrations/ATRAN/fits
    atranfile = &quot;&quot;
[20: specmap]
    normalize = True
    scale = 0, 100
    ignore_outer = 0.0
    atran_plot = True
    error_plot = True
    colormap = plasma
    overplot_color = gray
    watermark = &quot;&quot;
</pre></div>
</div>
</section>
<section id="appendix-b-required-header-keywords">
<h2>Appendix B: Required Header Keywords<a class="headerlink" href="#appendix-b-required-header-keywords" title="Permalink to this heading">¶</a></h2>
<p>Sample EXES configuration file, typically located in
<em>sofia_redux/instruments/exes/data/header/headerdef.dat</em>. Values marked with
a Y in the <em>reqd?</em> column are keywords required to be present in input data.
They must meet the type and range requirements listed for grouping and data
reduction to be successful.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#
# This table lists keywords, allowed values, and defaults for
# all keywords to be written to output files.  Keywords
# required to be present in input files for correct data
# processing are marked with a &#39;Y&#39;. A &#39;.&#39; in min, max, or enum
# means no requirement.  Some output keywords have defaults
# defined in other configuration files
#
# keyword  reqd?  default  type    min    max    enum
#-----------------------------------------------------------------
ADDTIME      N    -9999.   float   0.     .      .
AIRSPEED     N    -9999.   float   .      .      .
ALTI_STA     Y    -9999.   float   -60000 60000. .
ALTI_END     Y    -9999.   float   -60000 60000. .
AOR_ID       Y    UNKNOWN  string  .      .      .
AOT_ID       N    UNKNOWN  string  .      .      .
ASSC_AOR     N    UNKNOWN  string  .      .      .
ASSC_MSN     N    UNKNOWN  string  .      .      .
ASSC_OBS     N    UNKNOWN  string  .      .      .
BB_TEMP      Y    273.16   float   1      9999.  .
BEAMTIME     N    0.0      float   .      .      .
BNU_T        N    -9999.   float   .      .      .
BOUNCE       N    0.0      float   .      .      .
BPM          N    UNKNOWN  string  .      .      .
BRL          N    -9999.   float   .      .      .
CARDMODE     N    BLKSKY   string  .      .      NONE|BLK|SKY|SHINY|BLKSKY|BLKSHINY|BLKOBJ|OBJ
CHOPPING     N    F        bool    .      .      .
CREATOR      N    UNKNOWN  string  .      .      .
CUMTIME      N    -9999.   float   0.     .      .
DARKVAL      N    0.       float   0.     .      .
DATAPATH     N    UNKNOWN  string  .      .      .
DATASRC      Y    UNKNOWN  string  .      .      ASTRO|CALIBRATION|LAB|TEST|OTHER|FIRSTPOINT
DATATYPE     N    UNKNOWN  string  .      .      IMAGE|SPECTRAL|OTHER
DATE         N    UNKNOWN  string  .      .      .
DATE-OBS     Y    UNKNOWN  string  .      .      .
DEPLOY       N    UNKNOWN  string  .      .      .
DETECTOR     N    UNKNOWN  string  .      .      .
DETROT       N    -9999.   float   .      .      .
DETSEC       N    UNKNOWN  string  .      .      .
DETSIZE      N    UNKNOWN  string  .      .      .
DITHER       N    F        bool    .      .      .
DRKFILE      N    UNKNOWN  string  .      .      .
DTHINDEX     N    -9999    int     .      .      .
DTHNPOS      N    -9999    int     .      .      .
DTHOFFS      N    -9999.   float   .      .      .
DTHPATT      N    UNKNOWN  string  .      .      3-POINT|5-POINT|9-POINT|CUSTOM
ECHELLE      Y    60.0     float   -35.   70.    .
ECTPAT       Y    UNKNOWN  string  .      .      .
EFL          N    -9999.   float   .      .      .
EFL0         N    -9999.   float   .      .      .
EPERADU      Y    75.0     float   1.     9999.  .
EQUINOX      N    -9999.   float   .      .      .
EXCLUDE      N    None     string  .      .      .
EXPTIME      N    -9999.   float   0.     .      .
FBC-STAT     N    UNKNOWN  string  .      .      FBC_OFF|FBC_QS|FBC_DY|FBC_ON
FDATE        N    0.0      float   0.     9999.  .
FILENAME     Y    UNKNOWN  string  .      .      .
FILENUM      N    .        string  .      .      .
FILEREV      N    UNKNOWN  string  .      .      .
FLIGHTLG     N    UNKNOWN  string  .      .      .
FOCUS_EN     N    -9999.   float   -5000  5000   .
FOCUS_ST     N    -9999.   float   -5000  5000   .
FRAMETIM     Y    1.0      float   0.     9999.  .
GRATANGL     N    0.0      float   -360.  360.   .
GRDSPEED     N    -9999.   float   .      .      .
HEADING      N    -9999.   float   .      .      .
HEADSTAT     N    UNKNOWN  string  .      .      ORIGINAL|UNKNOWN|CORRECTED|ERROR|MODIFIED
HRDGR        N    0.7588   float   .      .      .
HRFL         N    -9999.   float   .      .      .
HRFL0        N    -9999.   float   .      .      .
HRG          N    -0.015   float   .      .      .
HRR          N    -9999.   float   .      .      .
IMAGEID      N    -9999    int     0      .      .
INSTCFG      Y    UNKNOWN  string  .      .      HI-MED|MED|HI-LO|LO|CAM|PUP|HIMED|HILOW|LOW|CAMERA|HIGH_MED|HIGH_LOW|MEDIUM|HIGH-MED|HIGH-LOW
INSTMODE     Y    UNKNOWN  string  .      .      STARE|NOD_ON_SLIT|NOD_OFF_SLIT|MAP
INSTRUME     Y    EXES     string  .      .      EXES|TEXES
KROT         N    -9999.   float   .      .      .
KWDICT       N    UNKNOWN  string  .      .      .
LASTREW      N    UNKNOWN  string  .      .      .
LAT_STA      N    -9999.   float   .      .      .
LAT_END      N    -9999.   float   .      .      .
LINFILE      N    UNKNOWN  string  .      .      .
LO_LIM       N    0.0      float   .      .      .
LON_STA      N    -9999.   float   .      .      .
LON_END      N    -9999.   float   .      .      .
MAPCRSYS     N    UNKNOWN  string  .      .      EQUATORIAL|GALACTIC|ECLIPTIC|USER
MAPINTX      N    -9999.   float   .      .      .
MAPINTY      N    -9999.   float   .      .      .
MAPNXPOS     N    -9999    int     .      .      .
MAPNYPOS     N    -9999    int     .      .      .
MAPPING      N    F        bool    .      .      .
MCCSMODE     N    UNKNOWN  string  .      .      .
MISSN-ID     Y    UNKNOWN  string  .      .      .
NBELOW       N    -9999    int     0      .      .
NAIF_ID      N    .        int     .      .      .
NEXP         N    -9999    int     1      .      .
NFRAME       N    -9999    int     1      .      .
NINT         Y    1        int     1      .      .
NODAMP       N    -9999.   float   .      .      .
NODANGLE     N    -9999.   float   -180   180    .
NODBEAM      N    UNKNOWN  string  .      .      .
NODCRSYS     N    UNKNOWN  string  .      .      ERF|ECRF|GALRF|TARF|FPIRF|FFIRF|WFIRF|SIRF|USER
NODDING      N    F        bool    .      .      .
NODN         N    -9999    int     .      .      .
NODPATT      N    UNKNOWN  string  .      .      ABBA|AB|CUSTOM
NODSETL      N    -9999.   float   .      .      .
NODSTYLE     N    UNKNOWN  string  .      .      NMC|NPC|C2NC2|CUSTOM
NODTIME      N    -9999.   float   .      .      .
NORDERS      N    -9999    int     0      9999   .
NSPAT        N    1024     int     0      1025   .
NSPEC        N    1024     int     0      1025   .
NSUM         N    1        int     0      9999   .
NT           N    1024     int     0      1024   .
OBJECT       Y    UNKNOWN  string  .      .      .
OBS_ID       Y    UNKNOWN  string  .      .      .
OBSDEC       N    -9999.   float   -90.   90.    .
OBSERVER     N    UNKNOWN  string  .      .      .
OBSRA        N    -9999.   float   0.     24.    .
OBSTYPE      Y    UNKNOWN  string  .      .      OBJECT|STANDARD_FLUX|STANDARD_TELLURIC|LAMP|FLAT|DARK|BIAS|SKY
OMEGAP       N    -9999.   float   .      .      .
OPERATOR     N    UNKNOWN  string  .      .      .
ORDR_B       N    UNKNOWN  string  .      .      .
ORDR_T       N    UNKNOWN  string  .      .      .
ORDR_S       N    UNKNOWN  string  .      .      .
ORDR_E       N    UNKNOWN  string  .      .      .
ORIGIN       N    UNKNOWN  string  .      .      .
OTPAT        Y    UNKNOWN  string  .      .      .
PAGAIN       Y    1.0      float   0.     9999.  .
PINHOLE      N    0        int     -1     2      .
PIPELINE     N    UNKNOWN  string  .      .      .
PIPEVERS     N    UNKNOWN  string  .      .      .
PIXELWD      N    0.0025   float   0.     9999.  .
PIXSCAL      N    -9999.   float   .      .      .
PKGPATH      N    UNKNOWN  string  .      .      .
PLANID       Y    UNKNOWN  string  .      .      .
PLTSCALE     N    -9999.   float   .      .      .
PROCSTAT     Y    UNKNOWN  string  .      .      .
PRODTYPE     N    UNKNOWN  string  .      .      .
RAWFNAME     N    .        string  .      .      .
READNOIS     N    30.      float   0.     9999.  .
RESOLUN      N    -9999.   float   .      .      .
SATVAL       N    16000.   float   0.     65536  .
SCANNING     N    F        bool    .      .      .
SDEG         Y    180.     float   -45.   405.   .
SIBS_X       N    -9999    int     .      .      .
SIBS_Y       N    -9999    int     .      .      .
SLIT         Y    UNKNOWN  string  .      .      .
SLITOFF      N    -0.3     float   .      .      .
SLITROT      N    -9999.   float   .      .      .
SLITVAL      N    -9999.   float   .      .      .
SLITWID      N    -9999.   float   .      .      .
SPACING      N    -9999.   float   .      .      .
SPECTEL1     Y    UNKNOWN  string  .      .      .
SPECTEL2     Y    UNKNOWN  string  .      .      .
SPIKEFAC     N    20.0     float   0.     9999.  .
SRCTYPE      Y    UNKNOWN  string  .      .      POINT_SOURCE|EXTENDED_SOURCE|OTHER|UNKNOWN
STDFAC       N    20.0     float   0.     9999.  .
SUBARRNO     N    -9999    int     .      .      .
TELCONF      N    UNKNOWN  string  .      .      .
TELDEC       N    -9999.   float   -90.   90.    .
TELEL        N    -9999.   float   0.     90.    .
TELEQUI      N    UNKNOWN  string  .      .      .
TELESCOP     N    UNKNOWN  string  .      .      .
TELLOS       N    -9999.   float   -180   180    .
TELRA        N    -9999.   float   0.     24.    .
TELVPA       N    -9999.   float   0.     360.   .
TELXEL       N    -9999.   float   -90.   90.    .
TEMP_OUT     N    -9999.   float   .      .      .
TEMPPRI1     N    -9999.   float   -273.  .      .
TEMPPRI2     N    -9999.   float   -273.  .      .
TEMPPRI3     N    -9999.   float   -273.  .      .
TEMPSEC1     N    -9999.   float   .      .      .
THRFAC       N    0.5      float   0.     1.001  .
TRACERR      N    F        bool    .      .      .
TRACKANG     N    -9999.   float   .      .      .
TRACMODE     N    UNKNOWN  string  .      .      OFF|CENTROID|ROF|LIMB| OFFSET|ROF+OFFSET|CENTROID+INERTIAL|ROF+INERTIAL|OFFSET+INERTIAL|ROF+OFFSET+INERTIAL
TRASH        N    100.0    float   .      .      .
TSC-STAT     N    UNKNOWN  string  .      .      .
UP_LIM       N    11000.0  float   .      .      .
UTCSTART     N    UNKNOWN  string  .      .      .
UTCEND       N    UNKNOWN  string  .      .      .
WAVECENT     Y    0.0      float   0.     .      .
WAVENO0      Y    0.0      float   0.     .      .
WNO0         N    -9999.   float   0.     .      .
WVZ_STA      N    -9999.   float   0.     .      .
WVZ_END      N    -9999.   float   0.     .      .
X0BRL        N    -9999.   float   .      .      .
XD0          N    0.0      float   .      .      .
XDDELTA      N    0.0235   float   .      .      .
XDDGR        N    -9999.   float   .      .      .
XDFL         N    -9999.   float   .      .      .
XDFL0        N    -9999.   float   .      .      .
XDG          N     0.033   float   .      .      .
XDLRDGR      N    0.001328 float   .      .      .
XDMRDGR      N    0.003151 float   .      .      .
XDR          N    -9999.   float   .      .      .
XORDER1      N    0.0      float   0.     1024   .
Y0BRL        N    -9999.   float   .      .      .
ZA_START     Y    -9999.   float   -99999 90.    .
ZA_END       Y    -9999.   float   -99999 90.    .
</pre></div>
</div>
</section>
<section id="appendix-b-change-notes-for-the-exes-pipeline">
<span id="exes-change-notes"></span><h2>Appendix B: Change notes for the EXES pipeline<a class="headerlink" href="#appendix-b-change-notes-for-the-exes-pipeline" title="Permalink to this heading">¶</a></h2>
<section id="significant-changes">
<h3>Significant changes<a class="headerlink" href="#significant-changes" title="Permalink to this heading">¶</a></h3>
<p>Below are listed the most significant changes for the EXES pipeline
over its history, highlighting impacts to science data products.
See the data handbooks or user manuals associated with each release
for more information.</p>
<p>All pipeline versions prior to v3.0.0 were implemented in IDL;
v3.0.0 and later were implemented in Python.  For previously processed data,
check the PIPEVERS keyword in the FITS header to determine the pipeline
version used.</p>
<section id="exes-redux-v3-0-0-2022-12-13">
<h4>EXES Redux v3.0.0 (2022-12-13)<a class="headerlink" href="#exes-redux-v3-0-0-2022-12-13" title="Permalink to this heading">¶</a></h4>
<p><em>User manual: Rev. E</em></p>
<ul class="simple">
<li><p>Full reimplementation of the IDL pipeline into Python 3.</p></li>
<li><p>All intermediate and final data products were revised to separate
flux, error, and calibration information into separate extensions in
the output FITS files.</p></li>
<li><p>Added a calibration correction step to account for wavenumber dependence
in the blackbody calibration.  Additionally, modified blackbody calibration
to account for an extra contribution from flat mirror reflection.</p></li>
<li><p>Added conversion to flux units (Jy/pixel for 2D images; Jy for 1D spectra)
as a separate step, following nod-pair coaddition.</p></li>
<li><p>Allowed despike comparison to be performed across all input files for
better statistics in truncated observations.</p></li>
<li><p>Allowed NaN propagation for bad pixel identification, rather than
requiring immediate interpolation.</p></li>
<li><p>Cross-dispersed data are rotated to align spectra with image rows
immediately after distortion correction, prior to coaddition and extraction.</p></li>
<li><p>Added a reference response spectrum, extracted from flat data at the
same location as the science and attached to 1D spectral products as a
5th row.</p></li>
<li><p>Added handling for resolution value configuration tables for
cross-dispersed modes.</p></li>
<li><p>Replaced ATRAN reference atmospheric spectra with Planetary Spectrum
Generator (PSG) model files.</p></li>
<li><p>Time keywords EXPTIME, INTTIME, and TOTTIME were revised to reflect
nominal on-source time, integration time, and total elapsed time,
respectively.</p></li>
</ul>
</section>
<section id="exes-redux-v2-2-0-2022-04-06">
<h4>EXES Redux v2.2.0 (2022-04-06)<a class="headerlink" href="#exes-redux-v2-2-0-2022-04-06" title="Permalink to this heading">¶</a></h4>
<p><em>User manual: Rev. D</em></p>
<ul class="simple">
<li><p>Added HRR and DETROT to distortion correction parameters in configuration
files, so that the defaults can be overridden by date.</p></li>
<li><p>Fixed a bug in integration tossing in the initial read and coadd, in the
case where a single valid integration remains after tossing bad ones.</p></li>
</ul>
</section>
<section id="exes-redux-v2-1-0-2021-11-22">
<h4>EXES Redux v2.1.0 (2021-11-22)<a class="headerlink" href="#exes-redux-v2-1-0-2021-11-22" title="Permalink to this heading">¶</a></h4>
<p><em>User manual: Rev. C</em></p>
<ul class="simple">
<li><p>Designated separate product names and types for sky spectra to avoid
overwriting science products.</p></li>
<li><p>Added additional support for intermediate reductions, including sky
spectrum products and undistorted files.</p></li>
<li><p>Added capability to compose flat fields from separate subarrays (rasters).</p></li>
<li><p>Modified assumed plate scale by mode to more accurately reflect anamorphic
magnification effects for cross-dispersed modes.</p></li>
</ul>
</section>
<section id="exes-redux-v2-0-0-2021-10-21">
<h4>EXES Redux v2.0.0 (2021-10-21)<a class="headerlink" href="#exes-redux-v2-0-0-2021-10-21" title="Permalink to this heading">¶</a></h4>
<p><em>User manual: Rev. B</em></p>
<ul class="simple">
<li><p>Adopted EXES PI team version for SOFIA DPS support as a facility class
instrument.</p></li>
<li><p>Modified NAIF ID handling to not write default -9999 value for sidereal
targets.</p></li>
<li><p>Added option to coadd frames across all files with outlier rejection.</p></li>
<li><p>Added ASSC_MSN keyword to track all input mission IDs and ASSC_OBS
to track all input OBS-IDs.</p></li>
<li><p>Removed a scaling factor in the coadd step, originally intended for
unit conversion and flux conservation, that was historically inconsistently
applied to flux and variance planes.</p></li>
</ul>
</section>
<section id="exes-redux-v1-6-0-2019-04-02">
<h4>EXES Redux v1.6.0 (2019-04-02)<a class="headerlink" href="#exes-redux-v1-6-0-2019-04-02" title="Permalink to this heading">¶</a></h4>
<p><em>User manual: Rev. A</em></p>
<ul class="simple">
<li><p>Added handling for darks to allow for black-dark flat generation method</p></li>
<li><p>Added option to reject 1 or 2 initial readout patterns before readout coadd</p></li>
<li><p>Added option to use only destructive frames for readout coadds</p></li>
<li><p>Modified options to allow manual selection of bad pixel masks</p></li>
<li><p>Allowed manual overrides for the edges of order masks</p></li>
<li><p>Added option to debounce in the spectral direction, as well as the spatial</p></li>
<li><p>Added manual options to set asymmetric apertures with start and end values</p></li>
<li><p>Added options to subtract a dark frame instead of nods, for sky emission
spectra</p></li>
</ul>
</section>
<section id="exes-redux-v1-0-2-2015-07-17">
<h4>EXES Redux v1.0.2 (2015-07-17)<a class="headerlink" href="#exes-redux-v1-0-2-2015-07-17" title="Permalink to this heading">¶</a></h4>
<p><em>User manual: Rev. A</em></p>
<ul class="simple">
<li><p>Modified nonlinearity correction to allow for a lower-limit plane in the
coefficient reference file.</p></li>
</ul>
</section>
<section id="exes-redux-v1-0-1-2015-05-14">
<h4>EXES Redux v1.0.1 (2015-05-14)<a class="headerlink" href="#exes-redux-v1-0-1-2015-05-14" title="Permalink to this heading">¶</a></h4>
<p><em>User manual: Rev. -</em></p>
<ul class="simple">
<li><p>Added ASSC_AOR keyword to track all input AOR-IDs.</p></li>
<li><p>Attached reference atmospheric transmission data to spectra.</p></li>
<li><p>Improved wavelength calibration.</p></li>
</ul>
</section>
<section id="exes-redux-v1-0-0-2015-03-17">
<h4>EXES Redux v1.0.0 (2015-03-17)<a class="headerlink" href="#exes-redux-v1-0-0-2015-03-17" title="Permalink to this heading">¶</a></h4>
<p><em>User manual: Rev. -</em></p>
<ul class="simple">
<li><p>Initial release.</p></li>
</ul>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">EXES Redux User’s Manual</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#si-observing-modes-supported">SI Observing Modes Supported</a><ul>
<li><a class="reference internal" href="#exes-observing-techniques">EXES observing techniques</a></li>
<li><a class="reference internal" href="#exes-instrument-configurations">EXES instrument configurations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#algorithm-description">Algorithm Description</a><ul>
<li><a class="reference internal" href="#overview-of-data-reduction-steps">Overview of data reduction steps</a></li>
<li><a class="reference internal" href="#reduction-algorithms">Reduction algorithms</a><ul>
<li><a class="reference internal" href="#correct-nonlinearity-and-coadd-readout-frames">Correct nonlinearity and coadd readout frames</a><ul>
<li><a class="reference internal" href="#all-destructive-mode">All destructive mode</a></li>
<li><a class="reference internal" href="#fowler-mode">Fowler mode</a></li>
<li><a class="reference internal" href="#sample-up-the-ramp-mode">Sample-up-the-ramp mode</a></li>
<li><a class="reference internal" href="#coadding">Coadding</a></li>
</ul>
</li>
<li><a class="reference internal" href="#process-flat-field">Process flat field</a></li>
<li><a class="reference internal" href="#despike">Despike</a></li>
<li><a class="reference internal" href="#debounce">Debounce</a></li>
<li><a class="reference internal" href="#subtract-sky">Subtract sky</a></li>
<li><a class="reference internal" href="#flat-correct">Flat correct</a></li>
<li><a class="reference internal" href="#clean-bad-pixels">Clean bad pixels</a></li>
<li><a class="reference internal" href="#undistort">Undistort</a></li>
<li><a class="reference internal" href="#coadd-frames">Coadd frames</a></li>
<li><a class="reference internal" href="#exes-set-apertures">Identify apertures</a></li>
<li><a class="reference internal" href="#extract-spectra">Extract spectra</a><ul>
<li><a class="reference internal" href="#standard-extraction">Standard extraction</a></li>
<li><a class="reference internal" href="#optimal-extraction">Optimal extraction</a></li>
<li><a class="reference internal" href="#wavelength-calibration">Wavelength calibration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#combine-multiple-spectra">Combine multiple spectra</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-resources">Other Resources</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flux-calibration">Flux calibration</a></li>
<li><a class="reference internal" href="#data-products">Data products</a><ul>
<li><a class="reference internal" href="#filenames">Filenames</a></li>
<li><a class="reference internal" href="#pipeline-products">Pipeline Products</a></li>
<li><a class="reference internal" href="#data-format">Data Format</a></li>
</ul>
</li>
<li><a class="reference internal" href="#grouping-level-1-data-for-processing">Grouping LEVEL_1 data for processing</a></li>
<li><a class="reference internal" href="#configuration-and-execution">Configuration and execution</a><ul>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#external-requirements">External Requirements</a></li>
<li><a class="reference internal" href="#source-code-installation">Source Code Installation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#input-data">Input data</a></li>
<li><a class="reference internal" href="#automatic-mode-execution">Automatic Mode Execution</a></li>
<li><a class="reference internal" href="#manual-mode-execution">Manual Mode Execution</a><ul>
<li><a class="reference internal" href="#basic-workflow">Basic Workflow</a></li>
<li><a class="reference internal" href="#display-features">Display Features</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exes-reduction">EXES Reduction</a><ul>
<li><a class="reference internal" href="#image-processing">Image Processing</a></li>
<li><a class="reference internal" href="#spectroscopic-processing">Spectroscopic Processing</a><ul>
<li><a class="reference internal" href="#extraction-steps">Extraction Steps</a></li>
<li><a class="reference internal" href="#spectral-displays">Spectral Displays</a></li>
</ul>
</li>
<li><a class="reference internal" href="#useful-parameters">Useful Parameters</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#data-quality-assessment">Data quality assessment</a></li>
<li><a class="reference internal" href="#appendix-a-sample-configuration-file">Appendix A: Sample configuration file</a></li>
<li><a class="reference internal" href="#appendix-b-required-header-keywords">Appendix B: Required Header Keywords</a></li>
<li><a class="reference internal" href="#appendix-b-change-notes-for-the-exes-pipeline">Appendix B: Change notes for the EXES pipeline</a><ul>
<li><a class="reference internal" href="#significant-changes">Significant changes</a><ul>
<li><a class="reference internal" href="#exes-redux-v3-0-0-2022-12-13">EXES Redux v3.0.0 (2022-12-13)</a></li>
<li><a class="reference internal" href="#exes-redux-v2-2-0-2022-04-06">EXES Redux v2.2.0 (2022-04-06)</a></li>
<li><a class="reference internal" href="#exes-redux-v2-1-0-2021-11-22">EXES Redux v2.1.0 (2021-11-22)</a></li>
<li><a class="reference internal" href="#exes-redux-v2-0-0-2021-10-21">EXES Redux v2.0.0 (2021-10-21)</a></li>
<li><a class="reference internal" href="#exes-redux-v1-6-0-2019-04-02">EXES Redux v1.6.0 (2019-04-02)</a></li>
<li><a class="reference internal" href="#exes-redux-v1-0-2-2015-07-17">EXES Redux v1.0.2 (2015-07-17)</a></li>
<li><a class="reference internal" href="#exes-redux-v1-0-1-2015-05-14">EXES Redux v1.0.1 (2015-05-14)</a></li>
<li><a class="reference internal" href="#exes-redux-v1-0-0-2015-03-17">EXES Redux v1.0.0 (2015-03-17)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../../../_sources/manuals/exes/users/users.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>