<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>StepPrepare &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="icon" href="../_static/redux.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="StepRegion" href="sofia_redux.instruments.hawc.steps.stepregion.StepRegion.html" />
    <link rel="prev" title="StepPolVec" href="sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="sofia_redux.instruments.hawc.steps.stepregion.StepRegion.html" title="StepRegion">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.html" title="StepPolVec">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../sofia_redux/index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../manuals/hawc/developers/developers.html" accesskey="U">HAWC+ DRP Developer’s Manual</a> &#187;</li>
      
      <li>StepPrepare</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="stepprepare">
<h1>StepPrepare<a class="headerlink" href="#stepprepare" title="Permalink to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sofia_redux.instruments.hawc.steps.stepprepare.</span></span><span class="sig-name descname"><span class="pre">StepPrepare</span></span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepprepare.html#StepPrepare"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="sofia_redux.instruments.hawc.stepparent.StepParent.html#sofia_redux.instruments.hawc.stepparent.StepParent" title="sofia_redux.instruments.hawc.stepparent.StepParent"><code class="xref py py-class docutils literal notranslate"><span class="pre">StepParent</span></code></a></p>
<p>Prepare input file for processing.</p>
<p>This step separates the flux column into separate columns
for R and T arrays. It may also fill in missing columns,
and reformat or rename existing columns to conventions expected
by subsequent pipeline steps.</p>
<p>Currently steprepare assumes the input array has dimensions 64 x
41, and just splits it into two 32 x 41 sub-arrays which are
named ‘R Array’ (columns 1-32) and ‘T Array’ (columns 33-64) in the
output file. If a column named ‘Chop Offset’ is not present in the
input data, it is created, replicating the column given in the
parameter ‘chpoff’. If a column named ‘HWP Angle’ is not present,
then it is generated by multiplying the ‘hwpcounts’ column by a
conversion factor obtained from the parameter ‘hwpconv’.</p>
<p>Input for this step is a raw FITS file, containing the primary
HDU (with only the header), the Configuration HDU, and a binary
table (‘Timestream’) containing the arrays, chop and HWP
signals, etc. The output for this step is the same as the input,
with the original flux array removed and ‘R Array’, ‘T Array’ columns
added in its place.</p>
<p class="rubric">Methods Summary</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.read_pixscal" title="sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.read_pixscal"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read_pixscal</span></code></a>()</p></td>
<td><p>Read a pixel scale value from the parameters.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.run" title="sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.run"><code class="xref py py-obj docutils literal notranslate"><span class="pre">run</span></code></a>()</p></td>
<td><p>Run the data reduction algorithm.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.setup" title="sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.setup"><code class="xref py py-obj docutils literal notranslate"><span class="pre">setup</span></code></a>()</p></td>
<td><p>Set parameters and metadata for the pipeline step.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Methods Documentation</p>
<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.read_pixscal">
<span class="sig-name descname"><span class="pre">read_pixscal</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepprepare.html#StepPrepare.read_pixscal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.read_pixscal" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a pixel scale value from the parameters.</p>
<p>The parameters are expected to be defined as a list, with
one entry for each HAWC band. The correct value for the
input data is selected from the list.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt>float</dt><dd><p>The pixel scale.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepprepare.html#StepPrepare.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the data reduction algorithm.</p>
<p>Because this step is single-in, single-out (SISO),
self.datain must be a DataFits object. The output
is also a DataFits object, stored in self.dataout.</p>
<p>The process is:</p>
<ol class="arabic simple">
<li><p>Read the input data table.</p></li>
<li><p>Split the flux array into R and T subarrays.</p></li>
<li><p>Rename columns specified in the ‘colrename’ parameter.</p></li>
<li><p>Remove any columns specified in the ‘coldelete’ parameter.</p></li>
<li><p>Add any columns necessary from a housekeeping data file.</p></li>
<li><p>Calculate chop and nod offsets and HWP angles as necessary.</p></li>
<li><p>Shift metadata columns to match flux samples if necessary.</p></li>
<li><p>Store the data. Input data is modified in place.</p></li>
</ol>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.setup">
<span class="sig-name descname"><span class="pre">setup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepprepare.html#StepPrepare.setup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Set parameters and metadata for the pipeline step.</p>
<p>Output files have PRODTYPE = ‘prepare’, and are named with
the step abbreviation ‘PRE’.</p>
<p>Parameters defined for this step are:</p>
<dl class="simple">
<dt>detcounts<span class="classifier">str</span></dt><dd><p>Name of the table column containing the detector flux
values for R/T arrays. Usually set to ‘SQ1 Feedback’.</p>
</dd>
<dt>hwpcounts<span class="classifier">str</span></dt><dd><p>Name of the table column containing the HWP counts
(only used if column ‘HWP Angle’ is not present).</p>
</dd>
<dt>hwpconv<span class="classifier">float</span></dt><dd><p>Value to convert hwpcounts to HWP Angle
(only used if column ‘HWP Angle’ is not present).</p>
</dd>
<dt>labmode<span class="classifier">bool</span></dt><dd><p>If set, data is assumed to be missing header keywords
and data columns for on-sky data. These columns are filled
in with default values to allow processing to continue.</p>
</dd>
<dt>replacenod<span class="classifier">bool</span></dt><dd><p>If set, the ‘Nod Offset’ column will be replaced by
a calculation based on RA/DEC. If not set, the original
column will be used. replacenod=True is recommended.</p>
</dd>
<dt>chpoffsofiars<span class="classifier">bool</span></dt><dd><p>If set, the ‘Chop Offset’ column will be calculated from
the SofiaChopR/S columns.</p>
</dd>
<dt>colrename<span class="classifier">str</span></dt><dd><p>List of data columns to rename, as a ‘|’ separated string.
The format is: ‘oldname1-&gt;newname1|oldname2-&gt;newname2|…’.</p>
</dd>
<dt>coldelete<span class="classifier">list of str</span></dt><dd><p>List of data columns to delete.</p>
</dd>
<dt>pixscalist<span class="classifier">list of float</span></dt><dd><p>List of PIXSCAL values, one for each HAWC waveband. Used
to write a FITS header keyword.</p>
</dd>
<dt>traceshift<span class="classifier">int</span></dt><dd><p>Number of samples to shift the data by. If non-zero, all
columns except Timestamp, R Array, and T Array will by
shifted by this amount, in order to align the instrument
readouts with the metadata.</p>
</dd>
<dt>removedropouts<span class="classifier">bool</span></dt><dd><p>If set, data dropouts (with RA = Dec = 0) will be removed
from the file.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">StepPrepare</a><ul>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare"><code class="docutils literal notranslate"><span class="pre">StepPrepare</span></code></a><ul>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.read_pixscal"><code class="docutils literal notranslate"><span class="pre">StepPrepare.read_pixscal()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.run"><code class="docutils literal notranslate"><span class="pre">StepPrepare.run()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.setup"><code class="docutils literal notranslate"><span class="pre">StepPrepare.setup()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>