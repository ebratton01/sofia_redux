<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>flag_weights &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="icon" href="../_static/redux.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="get_typical_gain_magnitude" href="sofia_redux.scan.channels.channel_numba_functions.get_typical_gain_magnitude.html" />
    <link rel="prev" title="Configuration" href="../sofia_redux/scan/scan_configuration.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="sofia_redux.scan.channels.channel_numba_functions.get_typical_gain_magnitude.html" title="get_typical_gain_magnitude">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="../sofia_redux/scan/scan_configuration.html" title="Configuration">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../sofia_redux/index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../sofia_redux/scan/index.html" accesskey="U">sofia_redux.scan: Scan Mode Algorithms for SOFIA Pipelines</a> &#187;</li>
      
      <li>flag_weights</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="flag-weights">
<h1>flag_weights<a class="headerlink" href="#flag-weights" title="Permalink to this heading">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="sofia_redux.scan.channels.channel_numba_functions.flag_weights">
<span class="sig-prename descclassname"><span class="pre">sofia_redux.scan.channels.channel_numba_functions.</span></span><span class="sig-name descname"><span class="pre">flag_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channel_gain</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel_weight</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel_dof</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel_flags</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_weight</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_weight</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_flag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof_flag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sensitivity_flag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_weight</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/scan/channels/channel_numba_functions.html#flag_weights"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.scan.channels.channel_numba_functions.flag_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Flag channels according to degrees-of-freedom and weight.</p>
<p>Channels will be flagged with the DOF (degrees-of-freedom) flag if its
degrees-of-freedom is &lt;= 0, or unflagged otherwise.  Channels will also
be flagged for sensitivity if:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>wg2 &lt; m * min_weight
wg2 &gt; m * max_weight
</pre></div>
</div>
<p>where wg2 = channel_weight * channel_gain^2, and:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>m = exp(inner_80_percent_mean(ln(1 + wg2))) - 1
</pre></div>
</div>
<p>Channels that fall within the above range are likewise unflagged for
sensitivity.  Any channels that are fully or partially marked with the
exclude flag will not be included in the mean calculation, but may have
flags set.  The sum of wg2 for all zero flagged channels will be returned.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>channel_gain</strong><span class="classifier">numpy.ndarray (float)</span></dt><dd><p>The gains for each channel of shape (n_channels,).</p>
</dd>
<dt><strong>channel_weight</strong><span class="classifier">numpy.ndarray (float)</span></dt><dd><p>The weights for each channel of shape (n_channels,).  Weights are
equivalent to 1/variance.</p>
</dd>
<dt><strong>channel_dof</strong><span class="classifier">numpy.ndarray (float)</span></dt><dd><p>The degrees-of-freedom for each channel of shape (n_channels,).</p>
</dd>
<dt><strong>channel_flags</strong><span class="classifier">numpy.ndarray (int)</span></dt><dd><p>The flags for each channel of shape (n_channels,).  Flags will be
updated in place.</p>
</dd>
<dt><strong>min_weight</strong><span class="classifier">float</span></dt><dd><p>The minimum acceptable (1/variance) weight value.</p>
</dd>
<dt><strong>max_weight</strong><span class="classifier">float</span></dt><dd><p>The maximum acceptable (1/variance) weight value.</p>
</dd>
<dt><strong>exclude_flag</strong><span class="classifier">int</span></dt><dd><p>An integer flag marking channel flag types that should be excluded from
the flagging, or overall weight/gain calculation.</p>
</dd>
<dt><strong>dof_flag</strong><span class="classifier">int</span></dt><dd><p>The integer marking channels flagged as having insufficient degrees-of-
freedom.</p>
</dd>
<dt><strong>sensitivity_flag</strong><span class="classifier">int</span></dt><dd><p>The integer marking channels flagged as having unacceptable weight
(variance) values based on whether it falls outside the <code class="xref py py-obj docutils literal notranslate"><span class="pre">min_weight</span></code> to
<code class="xref py py-obj docutils literal notranslate"><span class="pre">max_weight</span></code> range.</p>
</dd>
<dt><strong>default_weight</strong><span class="classifier">float</span></dt><dd><p>The default weight value for channels.  Any channel with a weight value
equivalent to the default value will not be flagged or included in
any calculations, as channels with this weight value will not have been
processed due to other factors.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>n_points, weight_sum, channel_flags</strong><span class="classifier">int, float, numpy.ndarray (int)</span></dt><dd><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">n_points</span></code> are the number of channels that have valid <code class="xref py py-obj docutils literal notranslate"><span class="pre">dof</span></code> values,
are not excluded by <code class="xref py py-obj docutils literal notranslate"><span class="pre">exclude_flag</span></code>, and have positive non-default weight
values.  <code class="xref py py-obj docutils literal notranslate"><span class="pre">weight_sum</span></code> is sum(weight * gain^2) for all zero-flagged
channels (following unflagging), and <code class="xref py py-obj docutils literal notranslate"><span class="pre">channel_flags</span></code> are the updated
channel flags.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">flag_weights</a><ul>
<li><a class="reference internal" href="#sofia_redux.scan.channels.channel_numba_functions.flag_weights"><code class="docutils literal notranslate"><span class="pre">flag_weights()</span></code></a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/sofia_redux.scan.channels.channel_numba_functions.flag_weights.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>