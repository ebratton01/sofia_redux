<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>derive_tort &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="icon" href="../_static/redux.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="despike" href="sofia_redux.instruments.exes.despike.despike.html" />
    <link rel="prev" title="derasterize" href="sofia_redux.instruments.exes.derasterize.derasterize.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="sofia_redux.instruments.exes.despike.despike.html" title="despike">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="sofia_redux.instruments.exes.derasterize.derasterize.html" title="derasterize">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../sofia_redux/index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../manuals/exes/developers/developers.html" accesskey="U">EXES Redux Developer’s Manual</a> &#187;</li>
      
      <li>derive_tort</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="derive-tort">
<h1>derive_tort<a class="headerlink" href="#derive-tort" title="Permalink to this heading">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="sofia_redux.instruments.exes.derive_tort.derive_tort">
<span class="sig-prename descclassname"><span class="pre">sofia_redux.instruments.exes.derive_tort.</span></span><span class="sig-name descname"><span class="pre">derive_tort</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">header</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxiter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'deriv'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_wavemap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">top_pixel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bottom_pixel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_pixel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_pixel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/exes/derive_tort.html#derive_tort"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.exes.derive_tort.derive_tort" title="Permalink to this definition">¶</a></dt>
<dd><p>Derive distortion parameters and identify orders and illuminated regions.</p>
<p>The input flat is first undistorted (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tort</span></code>) using default parameters.
For cross-dispersed data, the distortion is tested and (optionally)
optimized by doing the following:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Enhance the edges in the image, using <code class="xref py py-obj docutils literal notranslate"><span class="pre">edge_method</span></code>.</p></li>
<li><p>Take the 2D FFT of the resulting image.</p></li>
<li><p>Use the power maxima in the FFT image to determine the
order spacing.</p></li>
<li><p>Calculate the rotation angle from the FFT.</p></li>
<li><p>If the angle is not close to zero, use it to correct the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">krot</span></code> parameter and redo the distortion correction by
reiterating this algorithm.</p></li>
</ol>
</div></blockquote>
<p>This process must be closely monitored: if the flat frame has
insufficient signal, or the optical parameters used to calculate the
distortion correction are insufficiently accurate, the spacing and
rotation angle may be wrongly calculated at this step.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>data</strong><span class="classifier">numpy.ndarray</span></dt><dd><p>2D image [nspec, nspat], typically a blackbody flat frame.</p>
</dd>
<dt><strong>header</strong><span class="classifier">fits.Header</span></dt><dd><p>FITS header for the flat file containing distortion parameters.</p>
</dd>
<dt><strong>maxiter</strong><span class="classifier">int, optional</span></dt><dd><p>The maximum number of iterations to use while optimizing distortion
parameters.</p>
</dd>
<dt><strong>fixed</strong><span class="classifier">bool, optional</span></dt><dd><p>If True, will not attempt to optimize distortion parameters.</p>
</dd>
<dt><strong>edge_method</strong><span class="classifier">{‘deriv’, ‘sqderiv’, ‘sobel’}, optional</span></dt><dd><p>Sets the edge enhancement method for optimizing the cross-dispersed
distortion parameters.  May be one derivative (‘deriv’),
squared derivative (‘sqderiv’), or Sobel (‘sobel’).</p>
</dd>
<dt><strong>custom_wavemap</strong><span class="classifier">str or bool, optional</span></dt><dd><p>Filename for a text file containing explicit order edges for a
cross-dispersed mode, as whitespace-separated integers indicating
bottom, top, left, and right edges for each order (one per line).
If set, it is used to directly set the order mask for a
cross-dispersed mode. If set to a value other than a string or
None, a ‘customWVM.dat’ file is expected in the current directory.</p>
</dd>
<dt><strong>top_pixel</strong><span class="classifier">int, optional</span></dt><dd><p>If provided, is used to directly set the top edge of the order.
Used for single-order modes only (medium, low); ignored for
cross-dispersed modes.</p>
</dd>
<dt><strong>bottom_pixel</strong><span class="classifier">int, optional</span></dt><dd><p>If provided, is used to directly set the bottom edge of the order.
Used for single-order modes only (medium, low); ignored for
cross-dispersed modes.</p>
</dd>
<dt><strong>start_pixel</strong><span class="classifier">int, optional</span></dt><dd><p>If provided, is used to directly set the left edge of all orders.
May be used for either single-order or cross-dispersed modes.</p>
</dd>
<dt><strong>end_pixel</strong><span class="classifier">int, optional</span></dt><dd><p>If provided, is used to directly set the right edge of all orders.
May be used for either single-order or cross-dispersed modes.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>tortdata, tortillum</strong><span class="classifier">2-tuple of numpy.ndarray</span></dt><dd><p>Undistorted flat data and illumination array. Both have shape
[nspec, nspat].  The illumination array contains integer values with
1 = illuminated, 0 = unilluminated, -1 = pixel that
does not correspond to any region in the raw frame (after
distortion correction).</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">derive_tort</a><ul>
<li><a class="reference internal" href="#sofia_redux.instruments.exes.derive_tort.derive_tort"><code class="docutils literal notranslate"><span class="pre">derive_tort()</span></code></a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/sofia_redux.instruments.exes.derive_tort.derive_tort.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>