<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>initial_search &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="icon" href="../_static/redux.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="get_background_fit" href="sofia_redux.toolkit.fitting.fitpeaks1d.get_background_fit.html" />
    <link rel="prev" title="get_search_model" href="sofia_redux.toolkit.fitting.fitpeaks1d.get_search_model.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="sofia_redux.toolkit.fitting.fitpeaks1d.get_background_fit.html" title="get_background_fit">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="sofia_redux.toolkit.fitting.fitpeaks1d.get_search_model.html" title="get_search_model">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../sofia_redux/index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../manuals/exes/developers/developers.html" accesskey="U">EXES Redux Developer’s Manual</a> &#187;</li>
      
      <li>initial_search</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="initial-search">
<h1>initial_search<a class="headerlink" href="#initial-search" title="Permalink to this heading">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="sofia_redux.toolkit.fitting.fitpeaks1d.initial_search">
<span class="sig-prename descclassname"><span class="pre">sofia_redux.toolkit.fitting.fitpeaks1d.</span></span><span class="sig-name descname"><span class="pre">initial_search</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fitter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npeaks=1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xpeak_parname=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ypeak_parname=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baseline_func=&lt;function</span> <span class="pre">medabs_baseline&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">guess_func=&lt;function</span> <span class="pre">guess_xy_mad&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">guess=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fitopts=None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/toolkit/fitting/fitpeaks1d.html#initial_search"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.toolkit.fitting.fitpeaks1d.initial_search" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an initial search for peaks in the data</p>
<p>The procedure is:</p>
<ol class="arabic">
<li><p>Take the original (x, y) data and optionally modify it
to some form where it is easier to fit a more accurate peak.  In
the default case, the median is subtracted from y before taking
the absolute value.  At this stage we do not typically fit the
background level so instead try to center most of the data
around zero and then take the absolute value.  This is sensible
for stable baselines with positive and negative peaks, but
may not be so for other flavours of data.  Different baseline
removal and data modification functions may be specified with
the <code class="xref py py-obj docutils literal notranslate"><span class="pre">baseline_func</span></code> argument.</p></li>
<li><p>Start a loop of <code class="xref py py-obj docutils literal notranslate"><span class="pre">npeaks</span></code> iterations.  On each interation:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Identify the most prominent peak in the modified y data.
This is done via the <code class="xref py py-obj docutils literal notranslate"><span class="pre">guess_func</span></code> function.  In the default
case this simply finds the (x, y) position of the maximum
<code class="xref py py-obj docutils literal notranslate"><span class="pre">y</span></code> value.  Optionally, the user may parse in specified
<code class="xref py py-obj docutils literal notranslate"><span class="pre">x</span></code> values using the <code class="xref py py-obj docutils literal notranslate"><span class="pre">guess</span></code> argument.</p></li>
<li><p>Fit the data to the search model using the x and y guesses
obtained in the previous step.</p></li>
<li><p>Store the parameters obtained from the fit, then subtract
a fit of the peak from the data and begin the next iteration.
If successful, the most prominent peak was removed and we
can move on to fitting the next most prominent peak.</p></li>
</ol>
</div></blockquote>
</li>
<li><p>After <code class="xref py py-obj docutils literal notranslate"><span class="pre">npeaks</span></code> iterations take the <code class="xref py py-obj docutils literal notranslate"><span class="pre">x</span></code> values of the fit and
use interpolation to get an estimate of <code class="xref py py-obj docutils literal notranslate"><span class="pre">y</span></code> on the original
unmodified data set.  This y estimate is added to the
other stored peak parameters which are then used as a more
accurate starting point for a refined search later.</p></li>
</ol>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl>
<dt><strong>fitter</strong><span class="classifier">fitting object</span></dt><dd><p>Typically a “solver” from scipy.optimize or astropy.modeling
that performs the function:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fitted_model = solver(model, x, y)
</pre></div>
</div>
</dd>
<dt><strong>model</strong><span class="classifier">astropy.modeling.Fittable1DModel</span></dt><dd><p>The model to fit.  Typically from <a class="reference internal" href="sofia_redux.toolkit.fitting.fitpeaks1d.get_search_model.html#sofia_redux.toolkit.fitting.fitpeaks1d.get_search_model" title="sofia_redux.toolkit.fitting.fitpeaks1d.get_search_model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_search_model</span></code></a>.</p>
</dd>
<dt><strong>x</strong><span class="classifier">array_like of float</span></dt><dd><p>(N,) array of independent data to fit</p>
</dd>
<dt><strong>y</strong><span class="classifier">array_like of float</span></dt><dd><p>(N,) array of dependent data to fit</p>
</dd>
<dt><strong>xpeak_parname</strong><span class="classifier">str, optional</span></dt><dd><p>Name of the parameter in the peak model governing the location
of the peak along the x-axis.  If None, will attempt to autodetect.</p>
</dd>
<dt><strong>ypeak_parname</strong><span class="classifier">str, optional</span></dt><dd><p>Name of the parameter in the peak model governing the location
of the peak along the y-axis.  If None, will attempt to autodetect.</p>
</dd>
<dt><strong>npeaks</strong><span class="classifier">int, optional</span></dt><dd><p>The number of peaks to find</p>
</dd>
<dt><strong>guess_func</strong><span class="classifier">function</span></dt><dd><p>A function of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>x_guess, y_guess = guess_func(x, y_modified)
</pre></div>
</div>
<p>Here x_guess and y_guess are the x (position) and y (amplitude)
estimates of the most prominent peak in the data.  Here we use
the output from <code class="xref py py-obj docutils literal notranslate"><span class="pre">baseline_func</span></code> as the dependent values which
allows the user to do things such as smoothing, filtering, or
whatever other ideas they may have.  The default function,
<a class="reference internal" href="sofia_redux.toolkit.fitting.fitpeaks1d.guess_xy_mad.html#sofia_redux.toolkit.fitting.fitpeaks1d.guess_xy_mad" title="sofia_redux.toolkit.fitting.fitpeaks1d.guess_xy_mad"><code class="xref py py-obj docutils literal notranslate"><span class="pre">guess_xy_mad</span></code></a> simply finds the x and y coordinate of the
maximum value in y_modified.</p>
</dd>
<dt><strong>guess</strong><span class="classifier">array_like of float, optional</span></dt><dd><p>An array where each element gives a guess at an initial
<code class="xref py py-obj docutils literal notranslate"><span class="pre">x</span></code> position for the peak.  If there are less guesses than
<code class="xref py py-obj docutils literal notranslate"><span class="pre">npeaks</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">guess_func</span></code> will be used after the inital guesses
have been taken.  If there are more guesses than <code class="xref py py-obj docutils literal notranslate"><span class="pre">npeaks</span></code>, then
only guess[:npeaks] will be used.</p>
</dd>
<dt><strong>baseline_func</strong><span class="classifier">function, optional</span></dt><dd><p>A function of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>y_modified, baseline = baseline_func(x, y)
</pre></div>
</div>
<p>Here y_modified may be the original <code class="xref py py-obj docutils literal notranslate"><span class="pre">y</span></code> data, or the <code class="xref py py-obj docutils literal notranslate"><span class="pre">y</span></code> data
modified such that the combination of <code class="xref py py-obj docutils literal notranslate"><span class="pre">model</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">solver</span></code> is
able to identify peaks.  In the default case, the <a class="reference internal" href="sofia_redux.toolkit.fitting.fitpeaks1d.medabs_baseline.html#sofia_redux.toolkit.fitting.fitpeaks1d.medabs_baseline" title="sofia_redux.toolkit.fitting.fitpeaks1d.medabs_baseline"><code class="xref py py-obj docutils literal notranslate"><span class="pre">medabs_baseline</span></code></a>
function is used which returns y_modified = abs(y - median(y))
and baseline = y - median(y).</p>
</dd>
<dt><strong>fitopts</strong><span class="classifier">dict, optional</span></dt><dd><p>Optional arguments to pass into the solver at runtime.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>numpy.ndarray of numpy.float64</dt><dd><p>(npeaks, n_parameters)  array of the initial guesses for the
model parameters of each peak.  Note that this contains the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">peak</span></code> only portion of parameters and not the filtering
parameters of the optional <code class="xref py py-obj docutils literal notranslate"><span class="pre">box_model</span></code> that may have been
appended to the peak model at <a class="reference internal" href="sofia_redux.toolkit.fitting.fitpeaks1d.get_search_model.html#sofia_redux.toolkit.fitting.fitpeaks1d.get_search_model" title="sofia_redux.toolkit.fitting.fitpeaks1d.get_search_model"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_search_model</span></code></a>.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">initial_search</a><ul>
<li><a class="reference internal" href="#sofia_redux.toolkit.fitting.fitpeaks1d.initial_search"><code class="docutils literal notranslate"><span class="pre">initial_search()</span></code></a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/sofia_redux.toolkit.fitting.fitpeaks1d.initial_search.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>