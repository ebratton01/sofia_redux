<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>StepPolVec &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="icon" href="../_static/redux.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="StepPrepare" href="sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.html" />
    <link rel="prev" title="StepPolMap" href="sofia_redux.instruments.hawc.steps.steppolmap.StepPolMap.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="sofia_redux.instruments.hawc.steps.stepprepare.StepPrepare.html" title="StepPrepare">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="sofia_redux.instruments.hawc.steps.steppolmap.StepPolMap.html" title="StepPolMap">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../sofia_redux/index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../manuals/hawc/developers/developers.html" accesskey="U">HAWC+ DRP Developer’s Manual</a> &#187;</li>
      
      <li>StepPolVec</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="steppolvec">
<h1>StepPolVec<a class="headerlink" href="#steppolvec" title="Permalink to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sofia_redux.instruments.hawc.steps.steppolvec.</span></span><span class="sig-name descname"><span class="pre">StepPolVec</span></span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/steppolvec.html#StepPolVec"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="sofia_redux.instruments.hawc.stepparent.StepParent.html#sofia_redux.instruments.hawc.stepparent.StepParent" title="sofia_redux.instruments.hawc.stepparent.StepParent"><code class="xref py py-class docutils literal notranslate"><span class="pre">StepParent</span></code></a></p>
<p>Calculate polarization vectors.</p>
<p>This step uses the Stokes parameter images and associated
errors and covariances to compute the percent polarization
and angle for each pixel. It also computes the debiased
polarization and the rotated angle (for B-field directions).
These values are all stored in a FITS table extension named
‘Pol Data’.</p>
<p>The input for this step is a DataFits object with images:
STOKES I, ERROR I, STOKES Q, STOKES U, COVAR Q I, COVAR U I,
COVAR Q U. This step is typically run after
<code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.instruments.hawc.steps.StepMerge</span></code>.</p>
<p>Output for this step contains the same image frames as the input
files, plus a table with the polarization vectors for each
pixel (POL DATA). Images of these data are also added as separate
extensions. The added extensions are named: PERCENT POL,
DEBIASED PERCENT POL, ERROR PERCENT POL, POL ANGLE, ROTATED POL
ANGLE, ERROR POL ANGLE, POL FLUX, ERROR POL FLUX, DEBIASED POL FLUX.
Finally, the PROCSTAT header keyword will be updated to LEVEL_4
after this step.</p>
<p class="rubric">Notes</p>
<p>The standard equations are used to convert from Stokes
parameters to polarization percentage and angle:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\theta = \frac{90}{\pi} arctan\Big(\frac{U}{Q}\Big)\]</div>
<div class="math notranslate nohighlight">
\[\sigma_\theta = \frac{90}{\pi (Q^2 + U^2)}
\sqrt{(U\sigma_Q)^2 +
      (Q\sigma_U)^2 - 2 Q U \sigma_{QU}}.\]</div>
</div></blockquote>
<p>The percent polarization (<span class="math notranslate nohighlight">\(p\)</span>) and its error are calculated as</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[p = 100 \sqrt{\Big(\frac{Q}{I}\Big)^2
+ \Big(\frac{U}{I}\Big)^2}\]</div>
<div class="math notranslate nohighlight">
\[\sigma_p = \frac{100}{I} \sqrt{\frac{1}{(Q^2 + U^2)}
\Big[(Q \sigma_Q)^2
     + (U \sigma_U)^2 + 2 Q U \sigma_{QU}\Big]
+ \Big[\Big(\frac{Q}{I}\Big)^2
       + \Big(\frac{U}{I}\Big)^2\Big]
\sigma_I^2 - 2 \frac{Q}{I}\sigma_{QI}
- 2 \frac{U}{I} \sigma_{UI}}.\]</div>
</div></blockquote>
<p>The debiased polarization percentage (<span class="math notranslate nohighlight">\(p'\)</span>)is also calculated, as:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[p' = \sqrt{p^2 - \sigma_p^2}.\]</div>
</div></blockquote>
<p>The polarization efficiency provided in the ‘eff’ parameter is
applied to the Q and U values (and their associated errors and
covariances) after calculating <span class="math notranslate nohighlight">\(\theta\)</span>, but before calculating
percent polarization.</p>
<p class="rubric">Methods Summary</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.read_eff" title="sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.read_eff"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read_eff</span></code></a>()</p></td>
<td><p>Read an efficiency value from the parameters.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.run" title="sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.run"><code class="xref py py-obj docutils literal notranslate"><span class="pre">run</span></code></a>()</p></td>
<td><p>Run the data reduction algorithm.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.setup" title="sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.setup"><code class="xref py py-obj docutils literal notranslate"><span class="pre">setup</span></code></a>()</p></td>
<td><p>Set parameters and metadata for the pipeline step.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Methods Documentation</p>
<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.read_eff">
<span class="sig-name descname"><span class="pre">read_eff</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/steppolvec.html#StepPolVec.read_eff"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.read_eff" title="Permalink to this definition">¶</a></dt>
<dd><p>Read an efficiency value from the parameters.</p>
<p>The parameters are expected to be defined as a list, with
one entry for each HAWC band.  The correct value for the
input data is selected from the list.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt>float</dt><dd><p>The polarization efficiency.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/steppolvec.html#StepPolVec.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the data reduction algorithm.</p>
<p>Because this step is single-in, single-out (SISO),
self.datain must be a DataFits object.  The output
is also a DataFits object, stored in self.dataout.</p>
<p>The process is:</p>
<ol class="arabic simple">
<li><p>Compute polarization vector magnitude and direction.
Propagate errors accordingly.</p></li>
<li><p>Store the data in tables and images.</p></li>
</ol>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.setup">
<span class="sig-name descname"><span class="pre">setup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/steppolvec.html#StepPolVec.setup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Set parameters and metadata for the pipeline step.</p>
<p>Output files have PRODTYPE = ‘polvec’, and are named with
the step abbreviation ‘VEC’.</p>
<p>Parameters defined for this step are:</p>
<dl class="simple">
<dt>eff<span class="classifier">list of float</span></dt><dd><p>Telescope + instrument polarization efficiency. One
value per HAWC waveband.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">StepPolVec</a><ul>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec"><code class="docutils literal notranslate"><span class="pre">StepPolVec</span></code></a><ul>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.read_eff"><code class="docutils literal notranslate"><span class="pre">StepPolVec.read_eff()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.run"><code class="docutils literal notranslate"><span class="pre">StepPolVec.run()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.setup"><code class="docutils literal notranslate"><span class="pre">StepPolVec.setup()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/sofia_redux.instruments.hawc.steps.steppolvec.StepPolVec.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>