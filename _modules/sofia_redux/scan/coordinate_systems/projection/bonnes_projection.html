<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sofia_redux.scan.coordinate_systems.projection.bonnes_projection &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/plot_directive.css" />
    
    <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../../../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../../../_static/copybutton.js"></script>
    <link rel="icon" href="../../../../../_static/redux.ico"/>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../../../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../../../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../../../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../../../../index.html" accesskey="U">Module code</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sofia_redux.scan.coordinate_systems.projection.bonnes_projection</h1><div class="highlight"><pre>
<span></span># Licensed under a 3-clause BSD style license - see LICENSE.rst

from astropy import units
import numpy as np

from sofia_redux.scan.coordinate_systems.projection.spherical_projection \
    import SphericalProjection
from sofia_redux.scan.coordinate_systems.spherical_coordinates import \
    SphericalCoordinates
from sofia_redux.scan.coordinate_systems.coordinate_2d import Coordinate2D

__all__ = [&#39;BonnesProjection&#39;]


<div class="viewcode-block" id="BonnesProjection"><a class="viewcode-back" href="../../../../../api/sofia_redux.scan.coordinate_systems.projection.bonnes_projection.BonnesProjection.html#sofia_redux.scan.coordinate_systems.projection.bonnes_projection.BonnesProjection">[docs]</a>class BonnesProjection(SphericalProjection):

    def __init__(self):
        &quot;&quot;&quot;
        Initialize a Bonne spherical projection.

        The Bonne projection is a pseudo-canonical equal-area projection
        designed to maintain accurate shapes of areas along the central
        meridian (y0) and standard parallel (theta1).  Distortion is noticeable
        from this region, so it is best used to map &quot;T&quot;-shaped regions.

        Notes
        -----
        By default, the theta1 parameter (standard parallel) is set to zero.
        As such, forward and reverse projections will be inconsistent as
        cot(0) is undefined.  Therefore, the user should always make sure to
        explicitly set theta 1.   If a Bonne projection is required at
        theta1=0 (equator), the global sinusoidal projection should be used
        instead.
        &quot;&quot;&quot;
        super().__init__()
        self._theta_1 = 0.0 * units.Unit(&#39;radian&#39;)
        self._y0 = 0.0 * units.Unit(&#39;radian&#39;)

<div class="viewcode-block" id="BonnesProjection.get_fits_id"><a class="viewcode-back" href="../../../../../api/sofia_redux.scan.coordinate_systems.projection.bonnes_projection.BonnesProjection.html#sofia_redux.scan.coordinate_systems.projection.bonnes_projection.BonnesProjection.get_fits_id">[docs]</a>    @classmethod
    def get_fits_id(cls):
        &quot;&quot;&quot;
        Return the FITS ID for the projection.

        Returns
        -------
        str
        &quot;&quot;&quot;
        return &quot;BON&quot;</div>

<div class="viewcode-block" id="BonnesProjection.get_full_name"><a class="viewcode-back" href="../../../../../api/sofia_redux.scan.coordinate_systems.projection.bonnes_projection.BonnesProjection.html#sofia_redux.scan.coordinate_systems.projection.bonnes_projection.BonnesProjection.get_full_name">[docs]</a>    @classmethod
    def get_full_name(cls):
        &quot;&quot;&quot;
        Return the full name of the projection.

        Returns
        -------
        str
        &quot;&quot;&quot;
        return &quot;Bonne&#39;s Projection&quot;</div>

    @property
    def theta1(self):
        &quot;&quot;&quot;
        Return the theta1 angle.

        The theta1 angle is the standard parallel of the projection (line with
        no distortion on the projection).

        Returns
        -------
        units.Quantity
        &quot;&quot;&quot;
        return self._theta_1

    @theta1.setter
    def theta1(self, value):
        &quot;&quot;&quot;
        Set the theta1 angle.

        The theta1 angle is the standard parallel of the projection (line with
        no distortion on the projection).  Note that setting theta1 also sets
        the native reference latitude to the same value, and the central
        meridian (y0) to:

            y0 = theta1 + cot(theta1)

        Parameters
        ----------
        value : units.Quantity

        Returns
        -------
        None
        &quot;&quot;&quot;
        self.set_theta_1(value)

    @property
    def y0(self):
        &quot;&quot;&quot;
        Return the y0 angle.

        The y0 defines the central meridian of the Bonne projection.

        Returns
        -------
        units.Quantity
        &quot;&quot;&quot;
        return self._y0

    @y0.setter
    def y0(self, value):
        &quot;&quot;&quot;
        Set the y0 value.

        The y0 defines the central meridian of the Bonne projection.

        Parameters
        ----------
        value : units.Quantity

        Returns
        -------
        None
        &quot;&quot;&quot;
        if not isinstance(value, units.Quantity) or (
                value.unit == units.dimensionless_unscaled):
            self._y0 = value * units.Unit(&#39;radian&#39;)
        else:
            self._y0 = value

<div class="viewcode-block" id="BonnesProjection.set_theta_1"><a class="viewcode-back" href="../../../../../api/sofia_redux.scan.coordinate_systems.projection.bonnes_projection.BonnesProjection.html#sofia_redux.scan.coordinate_systems.projection.bonnes_projection.BonnesProjection.set_theta_1">[docs]</a>    def set_theta_1(self, value):
        &quot;&quot;&quot;
        Set the theta_1 value.

        The theta 1 parameter in the Bonne projection is the standard parallel
        (line where there is no distortion in the map projection).  For this
        projection, setting theta1 sets the projection native reference
        latitude to the same value, and the central meridian (y0) to:

           y0 = theta1 + cot(theta1)

        Parameters
        ----------
        value : units.Quantity

        Returns
        -------
        None
        &quot;&quot;&quot;
        if value == self.theta1:
            return
        self._theta_1 = value
        self.native_reference.set_y(self.theta1)
        dy = (1.0 / np.tan(self.theta1)) * units.Unit(&#39;radian&#39;)
        self.y0 = self.theta1 + dy</div>

<div class="viewcode-block" id="BonnesProjection.get_phi_theta"><a class="viewcode-back" href="../../../../../api/sofia_redux.scan.coordinate_systems.projection.bonnes_projection.BonnesProjection.html#sofia_redux.scan.coordinate_systems.projection.bonnes_projection.BonnesProjection.get_phi_theta">[docs]</a>    def get_phi_theta(self, offset, phi_theta=None):
        &quot;&quot;&quot;
        Return the phi_theta coordinates for the Bonne projection.

        The phi and theta coordinates refer to the inverse projection
        (deprojection) of projected offsets to the native pole.  phi is
        the deprojected longitude, and theta is the deprojected latitude of
        the offsets.  For the Bonne projection, phi and theta are given by:

            dy = y0 - y
            r = sign(theta1) * sqrt(x^2 + dy^2)
            a = arctan(x, dy)

            theta = y0 - r
            phi = a * r / cos(theta)

        where y0 is the central meridian and theta1 is the standard parallel.

        Parameters
        ----------
        offset : Coordinate2D
        phi_theta : SphericalCoordinates, optional
            An optional output coordinate system in which to place the results.

        Returns
        -------
        coordinates : SphericalCoordinates
        &quot;&quot;&quot;
        if phi_theta is None:
            phi_theta = SphericalCoordinates(unit=&#39;degree&#39;)

        x, y = self.offset_to_xy_radians(offset)

        r = np.hypot(x, self.y0 - y)
        if self.theta1 &lt; 0:
            r = -r

        theta = self.y0 - r
        a = np.arctan2(x, self.y0 - y)
        phi_theta.set_y(theta)

        phi = (a * r / phi_theta.cos_lat).decompose().value
        phi = phi * units.Unit(&#39;radian&#39;)
        phi_theta.set_x(phi)
        return phi_theta</div>

<div class="viewcode-block" id="BonnesProjection.get_offsets"><a class="viewcode-back" href="../../../../../api/sofia_redux.scan.coordinate_systems.projection.bonnes_projection.BonnesProjection.html#sofia_redux.scan.coordinate_systems.projection.bonnes_projection.BonnesProjection.get_offsets">[docs]</a>    def get_offsets(self, theta, phi, offsets=None):
        &quot;&quot;&quot;
        Get the offsets given theta and phi.

        Takes the theta (latitude) and phi (longitude) coordinates about the
        celestial pole and converts them to offsets from a reference position.
        For the Bonne projection these are given by:

            r = y0 - theta
            a = phi * cos(theta) / r
            dx = r * sin(a)
            dy = y0 - (r * cos(a))

        where y0 is the central meridian.

        Parameters
        ----------
        theta : units.Quantity
            The theta angle (latitude about the celestial pole).
        phi : units.Quantity
            The phi angle (longitude about the celestial pole).
        offsets : Coordinate2D, optional
            An optional coordinate system in which to place the results.

        Returns
        -------
        offsets : Coordinate2D
        &quot;&quot;&quot;
        if offsets is None:
            offsets = Coordinate2D(unit=&#39;degree&#39;)

        phi, theta = self.phi_theta_to_radians(phi, theta)
        r = self.y0 - theta
        a = phi * np.cos(theta) / r
        a = a.decompose().value * units.Unit(&#39;radian&#39;)

        x = r * np.sin(a)
        y = self.y0 - r * np.cos(a)
        offsets.set([x, y])
        return offsets</div>

<div class="viewcode-block" id="BonnesProjection.parse_header"><a class="viewcode-back" href="../../../../../api/sofia_redux.scan.coordinate_systems.projection.bonnes_projection.BonnesProjection.html#sofia_redux.scan.coordinate_systems.projection.bonnes_projection.BonnesProjection.parse_header">[docs]</a>    def parse_header(self, header, alt=&#39;&#39;):
        &quot;&quot;&quot;
        Parse and apply a FITS header to the projection.

        Parameters
        ----------
        header : fits.Header
            The FITS header to parse.
        alt : str, optional
            The alternate FITS system.

        Returns
        -------
        None
        &quot;&quot;&quot;
        super().parse_header(header, alt=alt)
        name = f&#39;{self.get_latitude_parameter_prefix()}1{alt}&#39;
        if name in header:
            self.set_theta_1(header[name] * units.Unit(&#39;degree&#39;))</div>

<div class="viewcode-block" id="BonnesProjection.edit_header"><a class="viewcode-back" href="../../../../../api/sofia_redux.scan.coordinate_systems.projection.bonnes_projection.BonnesProjection.html#sofia_redux.scan.coordinate_systems.projection.bonnes_projection.BonnesProjection.edit_header">[docs]</a>    def edit_header(self, header, alt=&#39;&#39;):
        &quot;&quot;&quot;
        Edit a FITS header with the projection information.

        Parameters
        ----------
        header : fits.Header
            The FITS header to edit.
        alt : str, optional
            The alternate FITS system.

        Returns
        -------
        None
        &quot;&quot;&quot;
        super().edit_header(header, alt=alt)
        name = f&#39;{self.get_latitude_parameter_prefix()}1{alt}&#39;
        header[name] = (self.theta1.to(&#39;degree&#39;).value,
                        &quot;Theta1 parameter for Bonne&#39;s projection&quot;)</div></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>