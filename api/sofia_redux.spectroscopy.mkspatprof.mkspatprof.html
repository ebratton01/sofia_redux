<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>mkspatprof &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="icon" href="../_static/redux.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="radvel" href="sofia_redux.spectroscopy.radvel.radvel.html" />
    <link rel="prev" title="mkapmask" href="sofia_redux.spectroscopy.mkapmask.mkapmask.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="sofia_redux.spectroscopy.radvel.radvel.html" title="radvel">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="sofia_redux.spectroscopy.mkapmask.mkapmask.html" title="mkapmask">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../sofia_redux/index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../manuals/exes/developers/developers.html" accesskey="U">EXES Redux Developer’s Manual</a> &#187;</li>
      
      <li>mkspatprof</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="mkspatprof">
<h1>mkspatprof<a class="headerlink" href="#mkspatprof" title="Permalink to this heading">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="sofia_redux.spectroscopy.mkspatprof.mkspatprof">
<span class="sig-prename descclassname"><span class="pre">sofia_redux.spectroscopy.mkspatprof.</span></span><span class="sig-name descname"><span class="pre">mkspatprof</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rectimg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atran</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atmosthresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bgsub</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ndeg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">robust</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth_sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_fit_profile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/spectroscopy/mkspatprof.html#mkspatprof"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.spectroscopy.mkspatprof.mkspatprof" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct average spatial profiles.</p>
<p>Each order should already be resampled onto a uniform grid.
For each order, the median background is subtracted on a column by
column basis.  The median spatial profile is then created.  If the
user passes atran and atmosthresh, then pixels that have atmospheric
transmission below atmosthresh are ignored. The median spatial
profile is then used to normalize the image. 2D polynomial coefficients
are then derived on a row by row basis, and used to construct a
2D spatial map.</p>
<p>Outputs from this function (median profile and spatial map)
are required for all further reduction steps (setting apertures,
tracing continua, and extracting spectra).  The value for rectimg
comes from the output of <a class="reference internal" href="../sofia_redux/spectroscopy/index.html#module-sofia_redux.spectroscopy.rectify" title="sofia_redux.spectroscopy.rectify"><code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.spectroscopy.rectify</span></code></a>.
Atmospheric data (atran) and all other parameters are instrument
dependent.</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl>
<dt><strong>rectimg</strong><span class="classifier">dict</span></dt><dd><p>As returned by <a class="reference internal" href="../sofia_redux/spectroscopy/index.html#module-sofia_redux.spectroscopy.rectify" title="sofia_redux.spectroscopy.rectify"><code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.spectroscopy.rectify</span></code></a> with integer keys
indicating the order. The values are dictionaries with keys as
follows:</p>
<blockquote>
<div><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">&quot;image&quot;</span></code></dt><dd><p>numpy.ndarray (ns, nw)
Rectified image array (required)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&quot;wave&quot;</span></code></dt><dd><p>numpy.ndarray (nw,)
Wave coordinates along image axis=1 (required)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&quot;spatial&quot;</span></code></dt><dd><p>numpy.ndarray (ns,)
Spatial coordinates along image axis=0 (required)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&quot;mask&quot;</span></code></dt><dd><p>numpy.ndarray (ns, nw)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&quot;pixsum&quot;</span></code></dt><dd><p>numpy.ndarray (ns, nw)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&quot;variance&quot;</span></code></dt><dd><p>numpy.ndarray (ns, nw)</p>
</dd>
</dl>
</div></blockquote>
</dd>
<dt><strong>atran</strong><span class="classifier">numpy.ndarray, optional</span></dt><dd><p>(2, Ndata) array where atran[0, :] gives the wavelengths for
atmospheric transmission and atran[1, :] gives the atmospheric
transmission.</p>
</dd>
<dt><strong>atmosthresh</strong><span class="classifier">float, optional</span></dt><dd><p>The transmission (0 -&gt; 1) below which data are ignored.</p>
</dd>
<dt><strong>bgsub</strong><span class="classifier">bool, optional</span></dt><dd><p>If True, the median background level is subtracted from the profile.
It may be useful to set this to False when using a mode with a
short slit.</p>
</dd>
<dt><strong>orders</strong><span class="classifier">array_like of int, optional</span></dt><dd><p>List or order numbers, ordered from the bottom to the top of the
image.  If not provided, order numbers will be derived from a
sorted list of all order numbers in the order_mask.</p>
</dd>
<dt><strong>ndeg</strong><span class="classifier">int, optional</span></dt><dd><p>The degree of the polynomial row fits.</p>
</dd>
<dt><strong>robust</strong><span class="classifier">float, optional</span></dt><dd><p>The robust threshold for polynomial row fits.</p>
</dd>
<dt><strong>smooth_sigma</strong><span class="classifier">float, optional</span></dt><dd><p>If greater than 0, the fit profile will be smoothed by a Gaussian
with this width.</p>
</dd>
<dt><strong>return_fit_profile</strong><span class="classifier">bool, optional</span></dt><dd><p>If set, a fit profile with dimensions (ns,nw) will be returned
as well as the median profile. This spatial map is required
for optimal extraction steps.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>median_profile</strong><span class="classifier">dict</span></dt><dd><dl class="simple">
<dt>order (int) -&gt; profile (numpy.ndarray)</dt><dd><p>(n_spatial, 2) spatial profile where profile[:, 0] = spatial
coordinate and profile[:, 1] = median spatial profile.</p>
</dd>
</dl>
</dd>
<dt><strong>fit_profile</strong><span class="classifier">dict, optional</span></dt><dd><p>order (int) -&gt; profile (numpy.ndarray)
(n_spatial, n_wave) profile from fit coefficients.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">mkspatprof</a><ul>
<li><a class="reference internal" href="#sofia_redux.spectroscopy.mkspatprof.mkspatprof"><code class="docutils literal notranslate"><span class="pre">mkspatprof()</span></code></a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/sofia_redux.spectroscopy.mkspatprof.mkspatprof.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>