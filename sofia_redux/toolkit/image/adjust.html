<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Translation and Rotation &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    
    <script src="../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <link rel="icon" href="../../../_static/redux.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Image Combination" href="combine.html" />
    <link rel="prev" title="Image Algorithms (sofia_redux.toolkit.image)" href="index.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="combine.html" title="Image Combination">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="index.html" title="Image Algorithms (sofia_redux.toolkit.image)">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../../../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../../index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../index.html" >sofia_redux.toolkit: Shared Utilities for SOFIA Pipelines</a> &#187;</li>
      <li><a href="index.html" accesskey="U">Image Algorithms (<code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.toolkit.image</span></code>)</a> &#187;</li>
      
      <li>Translation and Rotation</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="translation-and-rotation">
<h1>Translation and Rotation<a class="headerlink" href="#translation-and-rotation" title="Permalink to this heading">¶</a></h1>
<p>Images can be shifted (<a class="reference internal" href="../../../api/sofia_redux.toolkit.image.adjust.shift.html#sofia_redux.toolkit.image.adjust.shift" title="sofia_redux.toolkit.image.adjust.shift"><code class="xref py py-func docutils literal notranslate"><span class="pre">shift()</span></code></a>), rotated (<a class="reference internal" href="../../../api/sofia_redux.toolkit.image.adjust.rotate.html#sofia_redux.toolkit.image.adjust.rotate" title="sofia_redux.toolkit.image.adjust.rotate"><code class="xref py py-func docutils literal notranslate"><span class="pre">rotate()</span></code></a>) using different
types of interpolation.  The interpolation method is specified by the <code class="xref py py-obj docutils literal notranslate"><span class="pre">order</span></code>
parameter which may take the following values:</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-number">Table 36 </span><span class="caption-text"><strong>Interpolation Methods</strong></span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 37.5%" />
<col style="width: 62.5%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">order</span></code></p></th>
<th class="head"><p>Method</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>Nearest Neighbor</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Linear (default)</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>Quadratic</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>Cubic</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>Quartic</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>Quintic</p></td>
</tr>
</tbody>
</table>
<section id="nan-handling">
<h2>NaN Handling<a class="headerlink" href="#nan-handling" title="Permalink to this heading">¶</a></h2>
<p>NaNs will be automatically accounted for in images.  This is easy to accomplish
using nearest-neighbor interpolation, but can get slightly complicated for
<code class="xref py py-obj docutils literal notranslate"><span class="pre">order</span> <span class="pre">&gt;=</span> <span class="pre">1</span></code>.</p>
<p>If NaNs are detected in the image, they must first replaced by a real float
value.  This replacement value is determined by the <code class="xref py py-obj docutils literal notranslate"><span class="pre">nan_interpolation</span></code>
parameter.  If <code class="xref py py-obj docutils literal notranslate"><span class="pre">nan_interpolation</span> <span class="pre">=</span> <span class="pre">None</span></code>, then NaN values will be replaced by
an interpolated value using the Clough-Tocher scheme (see
<code class="xref py py-func docutils literal notranslate"><span class="pre">image_naninterp()</span></code> and <code class="xref py py-func docutils literal notranslate"><span class="pre">clough_tocher_2dfunc()</span></code>).  Otherwise, the user
may set <code class="xref py py-obj docutils literal notranslate"><span class="pre">nan_interpolation</span></code> to any real float value.  The default value is
zero.</p>
<p>Following a shift or rotate, NaN values (or another float value set by the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">missing</span></code> parameter) are put back into the image at the new interpolated
location.  As a NaN may have been interpolated onto a fractional pixel
position (for example, 75% in one pixel, 25% in others), the <code class="xref py py-obj docutils literal notranslate"><span class="pre">missing_limit</span></code>
parameter is used to determine whether a pixel should be replaced by the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">missing</span></code> value.  For example, using the default value of <code class="xref py py-obj docutils literal notranslate"><span class="pre">missing_limit=0.5</span></code>,
if a NaN value occupies 50% or more of a pixel in the new interpolated
position, it will be replaced by <code class="xref py py-obj docutils literal notranslate"><span class="pre">missing</span></code> (default=NaN).</p>
<p>Note that the previous value determined by <code class="xref py py-obj docutils literal notranslate"><span class="pre">nan_interpolation</span></code> may be kept by
setting <code class="xref py py-obj docutils literal notranslate"><span class="pre">missing=None</span></code>.  However, any interpolated value that originated from
outside the bounds of the original image will be set to NaN in the output image
in this case.</p>
<p>The following plots show an image containing a NaN shifted by 0.75 pixels
in the x-direction.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sofia_redux.toolkit.image.adjust</span> <span class="kn">import</span> <span class="n">shift</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)[</span><span class="kc">None</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># shift the image by 0.75 pixels in the x-direction</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">default</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">nan_interpolation</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">no_fractional_nans</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">missing_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>                           <span class="n">nan_interpolation</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">replace_nans</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
<span class="gp">... </span>                     <span class="n">nan_interpolation</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># print a cross section of the new interpolated values</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shifted values: </span><span class="si">%s</span><span class="s2">-&gt;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">replace_nans</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="go">Shifted values: [0. 1. 2. 3. 4.]-&gt;[0.   0.25 1.25 2.25 3.25]</span>
</pre></div>
</div>
<p>Plotted below are the distribution of NaNs in the shifted image depending
on the settings.  Note that <code class="xref py py-obj docutils literal notranslate"><span class="pre">mode='nearest'</span></code> was used such that NaNs are
not inserted at <code class="xref py py-obj docutils literal notranslate"><span class="pre">x=0</span></code> due to boundary conditions.  The NaN boundary effect
can be seen on the two other shifted plots.</p>
<p>(<a class="reference download internal" download="" href="../../../_downloads/b1822f94507d3cff7fa5331e509ac3d9/adjust-1.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/e1b99482bae2be24bd00b30fcfa8a796/adjust-1.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/873de89f5c10fa9c01149067d57540f0/adjust-1.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/8b17862168263309c5a8e279e6be0f79/adjust-1.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="../../../_images/adjust-1.png" class="plot-directive" src="../../../_images/adjust-1.png" />
</figure>
</section>
<section id="example-of-shifting-and-rotating">
<h2>Example of Shifting and Rotating<a class="headerlink" href="#example-of-shifting-and-rotating" title="Permalink to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">imageio</span>
<span class="kn">from</span> <span class="nn">sofia_redux.toolkit.image.adjust</span> <span class="kn">import</span> <span class="n">shift</span><span class="p">,</span> <span class="n">rotate</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;imageio:camera.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">image</span> <span class="o">/=</span> <span class="n">image</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="c1"># pad so we don&#39;t cut off information during rotation</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

<span class="c1"># insert some NaN values (off with his head)</span>
<span class="n">image</span><span class="p">[</span><span class="mi">170</span><span class="p">:</span><span class="mi">260</span><span class="p">,</span> <span class="mi">300</span><span class="p">:</span><span class="mi">370</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="c1"># rotate then shift the image</span>
<span class="n">pivot</span> <span class="o">=</span> <span class="p">[</span><span class="mi">600</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>  <span class="c1"># rotate around this pixel</span>

<span class="c1"># rotate by 10 degrees around `pivot`</span>
<span class="c1"># set `missing_limit` to zero to skip NaN replacement by interpolation,</span>
<span class="c1"># and simply disallow any pixels containing part of an original NaN</span>
<span class="c1"># pixel.</span>
<span class="n">image_rotated</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">missing_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">)</span>

<span class="c1"># shift by 100 pixels in x and 145.5 pixels in y</span>
<span class="n">image_shifted</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">image_rotated</span><span class="p">,</span> <span class="p">[</span><span class="mf">145.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">missing_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Original Padded Image&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_rotated</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Rotated Image&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_shifted</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Rotated and Shifted Image&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="../../../_downloads/59c08823991424428fa160493e926e9e/adjust-2.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/099e2f9c8a2d9aca1135cdefabc85670/adjust-2.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/1ebfa3b0241791d4c550ef2fe85129d2/adjust-2.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/369d9b136fae9cc67ff7eacb98fabb2e/adjust-2.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="../../../_images/adjust-2.png" class="plot-directive" src="../../../_images/adjust-2.png" />
</figure>
<p>In the above example, the right-most image has been transformed by a rotation
(<a class="reference internal" href="../../../api/sofia_redux.toolkit.image.adjust.rotate.html#sofia_redux.toolkit.image.adjust.rotate" title="sofia_redux.toolkit.image.adjust.rotate"><code class="xref py py-func docutils literal notranslate"><span class="pre">rotate()</span></code></a>) followed by a translation (<a class="reference internal" href="../../../api/sofia_redux.toolkit.image.adjust.shift.html#sofia_redux.toolkit.image.adjust.shift" title="sofia_redux.toolkit.image.adjust.shift"><code class="xref py py-func docutils literal notranslate"><span class="pre">shift()</span></code></a>).  The NaN rectangle
has been inserted to demonstrate effective NaN handling using <code class="xref py py-obj docutils literal notranslate"><span class="pre">missing_limit=0</span></code>
to completely disallow any interpolation of NaNs.</p>
</section>
</section>
<section id="resizing-images">
<h1>Resizing Images<a class="headerlink" href="#resizing-images" title="Permalink to this heading">¶</a></h1>
<p>Images may be resized to a new size using <a class="reference internal" href="../../../api/sofia_redux.toolkit.image.adjust.frebin.html#sofia_redux.toolkit.image.adjust.frebin" title="sofia_redux.toolkit.image.adjust.frebin"><code class="xref py py-func docutils literal notranslate"><span class="pre">frebin()</span></code></a> and the
same interpolation methods already described for <a class="reference internal" href="../../../api/sofia_redux.toolkit.image.adjust.shift.html#sofia_redux.toolkit.image.adjust.shift" title="sofia_redux.toolkit.image.adjust.shift"><code class="xref py py-func docutils literal notranslate"><span class="pre">shift()</span></code></a> and
<a class="reference internal" href="../../../api/sofia_redux.toolkit.image.adjust.rotate.html#sofia_redux.toolkit.image.adjust.rotate" title="sofia_redux.toolkit.image.adjust.rotate"><code class="xref py py-func docutils literal notranslate"><span class="pre">rotate()</span></code></a>.  NaN handling is also achieved in the same manner.  However,
if the <code class="xref py py-obj docutils literal notranslate"><span class="pre">order</span></code> parameter is set to <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a> (default), nearest neighbor
interpolation will be used if the input array shape is an exact integer
multiple of the output array shape, i.e., shrinking the array by an integer
factor.  Otherwise, linear interpolation will be used.</p>
<p>The example below re-resizes a (5 x 5) image to (10 x 10) using both
nearest-neighbor and linear interpolation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sofia_redux.toolkit.image.adjust</span> <span class="kn">import</span> <span class="n">frebin</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">image</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span>

<span class="n">resized0</span> <span class="o">=</span> <span class="n">frebin</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">resized1</span> <span class="o">=</span> <span class="n">frebin</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Original Image </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">resized0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Nearest-Neighbor </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">resized0</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">resized1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Linear </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">resized1</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="../../../_downloads/5f8f791d5b23b1dfe7ab97bda73a220c/adjust-3.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/597084fa0b5bfd2c82fd6dcdd59cf767/adjust-3.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/10b804f30ba6fd0fad0afda6238bd666/adjust-3.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../../../_downloads/83ed6cc320da85dc2b52c9afb808aaa3/adjust-3.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="../../../_images/adjust-3.png" class="plot-directive" src="../../../_images/adjust-3.png" />
</figure>
</section>
<section id="degree-array-rotations">
<h1>90 Degree Array Rotations<a class="headerlink" href="#degree-array-rotations" title="Permalink to this heading">¶</a></h1>
<p>A functionally equivalent implementation of the IDL
<a class="reference external" href="https://www.harrisgeospatial.com/docs/ROTATE.html">rotate</a> function
(<a class="reference internal" href="../../../api/sofia_redux.toolkit.image.adjust.rotate90.html#sofia_redux.toolkit.image.adjust.rotate90" title="sofia_redux.toolkit.image.adjust.rotate90"><code class="xref py py-func docutils literal notranslate"><span class="pre">rotate90()</span></code></a>) can be used to rotate a 2 dimensional array by multiples
of 90 degrees and optionally apply a transpose operation.  The
<a class="reference internal" href="../../../api/sofia_redux.toolkit.image.adjust.unrotate90.html#sofia_redux.toolkit.image.adjust.unrotate90" title="sofia_redux.toolkit.image.adjust.unrotate90"><code class="xref py py-func docutils literal notranslate"><span class="pre">unrotate90()</span></code></a> is also available to perform the reverse operation.</p>
<p>The type of transform is governed by an integer (<code class="xref py py-obj docutils literal notranslate"><span class="pre">direction</span></code>) ranging from 0
to 7, whose effect is shown in the table below.</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Direction</p></th>
<th class="head"><p>Transpose?</p></th>
<th class="head"><p>AntiClockwise</p></th>
<th class="head"><p>X1</p></th>
<th class="head"><p>Y1</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>N</p></td>
<td><p>0</p></td>
<td><p>X0</p></td>
<td><p>Y0</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>N</p></td>
<td><p>90</p></td>
<td><p>-Y0</p></td>
<td><p>X0</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>N</p></td>
<td><p>180</p></td>
<td><p>-X0</p></td>
<td><p>-Y0</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>N</p></td>
<td><p>270</p></td>
<td><p>Y0</p></td>
<td><p>-X0</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>Y</p></td>
<td><p>0</p></td>
<td><p>Y0</p></td>
<td><p>X0</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>Y</p></td>
<td><p>90</p></td>
<td><p>-X0</p></td>
<td><p>Y0</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>Y</p></td>
<td><p>180</p></td>
<td><p>-Y0</p></td>
<td><p>-X0</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>Y</p></td>
<td><p>270</p></td>
<td><p>X0</p></td>
<td><p>-Y0</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The following examples show how rotate operates:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sofia_redux.toolkit.image.adjust</span> <span class="kn">import</span> <span class="n">rotate90</span><span class="p">,</span> <span class="n">unrotate90</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">xr1</span> <span class="o">=</span> <span class="n">rotate90</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Rotate 90 degrees anti-clockwise</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Original:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rotated 90 degrees:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">xr1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Transposed and rotated 90 degrees:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">xr5</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Original:
[[ 1  2  3  4]
 [ 5  6  7  8]
 [ 9 10 11 12]
 [13 14 15 16]]

Rotated 90 degrees:
[[13  9  5  1]
 [14 10  6  2]
 [15 11  7  3]
 [16 12  8  4]]

Transposed and rotated 90 degrees:
[[ 4  3  2  1]
 [ 8  7  6  5]
 [12 11 10  9]
 [16 15 14 13]]
</pre></div>
</div>
<p>Note, if a 1-dimensional array is rotated 90 degrees in either direction, it
is transformed to a 2-dimensional array to reproduce IDL results.  However,
a 2-dimensional (1, N) array will not be converted back to a 1 dimensional
array following the reverse operation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">xr1</span> <span class="o">=</span> <span class="n">rotate90</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">xu1</span> <span class="o">=</span> <span class="n">unrotate90</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Original </span><span class="si">%s</span><span class="s2">:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">x</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rotated 90 degrees </span><span class="si">%s</span><span class="s2">:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">xr1</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">xr1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Previous result unrotated </span><span class="si">%s</span><span class="s2">:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">xu1</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">xu1</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Original (4,):
[1 2 3 4]

Rotated 90 degrees (1, 4):
[[4 3 2 1]]

Previous result unrotated (1, 4):
[[1 2 3 4]]
</pre></div>
</div>
</section>
<section id="image-registration">
<h1>Image Registration<a class="headerlink" href="#image-registration" title="Permalink to this heading">¶</a></h1>
<p>The relative pixel offset between two images can be found using
<a class="reference internal" href="../../../api/sofia_redux.toolkit.image.adjust.register_image.html#sofia_redux.toolkit.image.adjust.register_image" title="sofia_redux.toolkit.image.adjust.register_image"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_image()</span></code></a>.  Phase cross-correlation using Fourier transforms is
used to determine these offsets.  The user may opt to supply an initial guess
(<code class="xref py py-obj docutils literal notranslate"><span class="pre">shift0</span></code>) of the offset in cases where the offset is large with repeating
structures in the image.  By default, the calculated offsets are accurate to
1 pixel.  This may be increased using the <code class="xref py py-obj docutils literal notranslate"><span class="pre">upsample</span></code> keyword which expands the
size of the image in the frequency domain.  Therefore, using <code class="xref py py-obj docutils literal notranslate"><span class="pre">upsample</span></code> will
increase the processing time.</p>
<p>The following example registers the pixel shift between two images to an
accuracy of 0.1 pixels by upsampling by a factor of 10:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">imageio</span>
<span class="kn">from</span> <span class="nn">sofia_redux.toolkit.image.adjust</span> <span class="kn">import</span> <span class="n">register_image</span><span class="p">,</span> <span class="n">shift</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;imageio:coins.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">image</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

<span class="n">offsets</span> <span class="o">=</span> <span class="p">[</span><span class="mf">12.3</span><span class="p">,</span> <span class="mf">45.6</span><span class="p">]</span>
<span class="n">offset_image</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">offsets</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">estimated_shift</span> <span class="o">=</span> <span class="n">register_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">offset_image</span><span class="p">,</span> <span class="n">upsample</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">estimated_shift</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[45.6 12.3]
</pre></div>
</div>
<p>Nate that the offset returned by <a class="reference internal" href="../../../api/sofia_redux.toolkit.image.adjust.register_image.html#sofia_redux.toolkit.image.adjust.register_image" title="sofia_redux.toolkit.image.adjust.register_image"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_image()</span></code></a> is given in the (x, y)
order, while <a class="reference internal" href="../../../api/sofia_redux.toolkit.image.adjust.shift.html#sofia_redux.toolkit.image.adjust.shift" title="sofia_redux.toolkit.image.adjust.shift"><code class="xref py py-func docutils literal notranslate"><span class="pre">shift()</span></code></a> uses axis order (y, x).  Please consider this
ordering discrepancy if using <a class="reference internal" href="../../../api/sofia_redux.toolkit.image.adjust.shift.html#sofia_redux.toolkit.image.adjust.shift" title="sofia_redux.toolkit.image.adjust.shift"><code class="xref py py-func docutils literal notranslate"><span class="pre">shift()</span></code></a> to correct a pixel offset
calculated using the above method.</p>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Translation and Rotation</a><ul>
<li><a class="reference internal" href="#nan-handling">NaN Handling</a></li>
<li><a class="reference internal" href="#example-of-shifting-and-rotating">Example of Shifting and Rotating</a></li>
</ul>
</li>
<li><a class="reference internal" href="#resizing-images">Resizing Images</a></li>
<li><a class="reference internal" href="#degree-array-rotations">90 Degree Array Rotations</a></li>
<li><a class="reference internal" href="#image-registration">Image Registration</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../../../_sources/sofia_redux/toolkit/image/adjust.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>