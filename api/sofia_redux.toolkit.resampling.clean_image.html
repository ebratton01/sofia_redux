<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>clean_image &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="icon" href="../_static/redux.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="convert_to_numba_list" href="sofia_redux.toolkit.resampling.convert_to_numba_list.html" />
    <link rel="prev" title="check_orders_without_bounds" href="sofia_redux.toolkit.resampling.check_orders_without_bounds.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="sofia_redux.toolkit.resampling.convert_to_numba_list.html" title="convert_to_numba_list">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="sofia_redux.toolkit.resampling.check_orders_without_bounds.html" title="check_orders_without_bounds">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../sofia_redux/index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../manuals/fifils/developers/developers.html" accesskey="U">FIFI-LS Redux Developer’s Manual</a> &#187;</li>
      
      <li>clean_image</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="clean-image">
<h1>clean_image<a class="headerlink" href="#clean-image" title="Permalink to this heading">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="sofia_redux.toolkit.resampling.clean_image">
<span class="sig-prename descclassname"><span class="pre">sofia_redux.toolkit.resampling.</span></span><span class="sig-name descname"><span class="pre">clean_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fix_order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">robust</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negthresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">leaf_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/toolkit/resampling/clean_image.html#clean_image"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.toolkit.resampling.clean_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Uses <a class="reference internal" href="sofia_redux.toolkit.resampling.ResamplePolynomial.html#sofia_redux.toolkit.resampling.ResamplePolynomial" title="sofia_redux.toolkit.resampling.ResamplePolynomial"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ResamplePolynomial</span></code></a> to correct NaNs in image and/or supplied in mask.</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl>
<dt><strong>image</strong><span class="classifier">array_like of float</span></dt><dd><p>(M, N) array of data values.  NaN values will automatically be
considered ‘bad’ and replaced.</p>
</dd>
<dt><strong>error</strong><span class="classifier">array_like of float, optional</span></dt><dd><p>(M, N) array of error (1-sigma) values
associated with the <code class="xref py py-obj docutils literal notranslate"><span class="pre">data</span></code> array.  <code class="xref py py-obj docutils literal notranslate"><span class="pre">error</span></code> will be used to
weight fits and also be propagated to the output error values.</p>
</dd>
<dt><strong>mask</strong><span class="classifier">array_like of bool, optional</span></dt><dd><p>(M, N) array of bool where True indicates a valid data point
that can be included the fitting and False indicates data points
that should be excluded from the fit and replaced.
Masked points will be reflected in the output counts array.</p>
</dd>
<dt><strong>window</strong><span class="classifier">array_like or float or int, optional</span></dt><dd><p>(2,) array or single float value specifying the maximum
euclidean distance of a data sample from a resampling point such
that it can be included in a local fit.  <code class="xref py py-obj docutils literal notranslate"><span class="pre">window</span></code> may be declared
for each feature.  For example, when fitting 2-dimensional (x, y)
data, a window of 1.0 would create a circular fitting window
around each resampling point, whereas a window of (1.0, 0.5)
would create an eliptical fitting window with a semi-major axis
of 1.0 in x and semi-minor axis of 0.5 in y.  If not supplied,
<code class="xref py py-obj docutils literal notranslate"><span class="pre">window</span></code> is calculated based on an estimate of the median
population density of the data for each feature.</p>
</dd>
<dt><strong>order</strong><span class="classifier">array_like or int, optional</span></dt><dd><p>(2,) array or single integer value specifying the
polynomial fit order for each feature.</p>
</dd>
<dt><strong>fix_order</strong><span class="classifier">bool, optional</span></dt><dd><p>In order for local polynomial fitting to occur, the default
requirement is that nsamples &gt;= (order + 1) ** 2,
where nsamples is the number of data samples within <code class="xref py py-obj docutils literal notranslate"><span class="pre">window</span></code>.
If <code class="xref py py-obj docutils literal notranslate"><span class="pre">fix_order</span></code> is True and this condition is not met, then
local fitting will be aborted for that point and a value of
<code class="xref py py-obj docutils literal notranslate"><span class="pre">cval</span></code> will be returned instead.  If <code class="xref py py-obj docutils literal notranslate"><span class="pre">fix_order</span></code> is False,
then <code class="xref py py-obj docutils literal notranslate"><span class="pre">order</span></code> will be reduced to the maximum value where this
condition can be met.  NOTE: this is only available if
<code class="xref py py-obj docutils literal notranslate"><span class="pre">order</span></code> is symmetrical. i.e. it was passed in as a single
integer to be applied across both x and y.  Otherwise, it is
unclear as to which dimension order should be reduced to meet
the condition.</p>
</dd>
<dt><strong>robust</strong><span class="classifier">float, optional</span></dt><dd><p>Specifies an outlier rejection threshold for <code class="xref py py-obj docutils literal notranslate"><span class="pre">data</span></code>.
A data point is identified as an outlier if:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|x_i - x_med|/MAD &gt; robust,
</pre></div>
</div>
<p>where x_med is the median,
and MAD is the Median Absolute Deviation defined as:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1.482 * median(|x_i - x_med|).
</pre></div>
</div>
</dd>
<dt><strong>negthresh</strong><span class="classifier">float, optional</span></dt><dd><p>Specifies a negative value rejection threshold such that
data &lt; (-stddev(data) * negthresh) will be excluded from
the fit.</p>
</dd>
<dt><strong>mode</strong><span class="classifier">str, optional</span></dt><dd><p>The type of check to perform on whether the sample distribution
for each resampling point is adequate to derive a polynomial fit.
Depending on <code class="xref py py-obj docutils literal notranslate"><span class="pre">order</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">fix_order</span></code>, if the distribution does
not meet the criteria for <code class="xref py py-obj docutils literal notranslate"><span class="pre">mode</span></code>, either the fit will be aborted,
returning a value of <code class="xref py py-obj docutils literal notranslate"><span class="pre">cval</span></code> or the fit order will be reduced.
Available modes are:</p>
<blockquote>
<div><ul class="simple">
<li><p>‘edges’: Require that there are <code class="xref py py-obj docutils literal notranslate"><span class="pre">order</span></code> samples in both
the negative and positive directions of each feature
from the resampling point.</p></li>
<li><p>‘counts’: Require that there are (order + 1) ** 2
samples within the <code class="xref py py-obj docutils literal notranslate"><span class="pre">window</span></code> of each resampling point.</p></li>
<li><p>‘extrapolate’: Attempt to fit regardless of the sample
distribution.</p></li>
</ul>
</div></blockquote>
<p>Note that ‘edges’ is the most robust mode as it ensures
that no singular values will be encountered during the
least-squares fitting of polynomial coefficients.</p>
</dd>
<dt><strong>leaf_size</strong><span class="classifier">int, optional</span></dt><dd><p>Number of points at which to switch to brute-force during the
ball tree query algorithm.  See <code class="xref py py-obj docutils literal notranslate"><span class="pre">sklearn.neighbours.BallTree</span></code>
for further details.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>cleaned_image, [variance_out], [counts]</strong><span class="classifier">n_tuple of numpy.ndarray (M, N)</span></dt><dd><p>See <a class="reference internal" href="sofia_redux.toolkit.resampling.ResamplePolynomial.html#sofia_redux.toolkit.resampling.ResamplePolynomial" title="sofia_redux.toolkit.resampling.ResamplePolynomial"><code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.toolkit.resampling.ResamplePolynomial</span></code></a></p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">clean_image</a><ul>
<li><a class="reference internal" href="#sofia_redux.toolkit.resampling.clean_image"><code class="docutils literal notranslate"><span class="pre">clean_image()</span></code></a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/sofia_redux.toolkit.resampling.clean_image.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>