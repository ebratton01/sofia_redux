<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>StepStokes &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="icon" href="../_static/redux.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="StepWcs" href="sofia_redux.instruments.hawc.steps.stepwcs.StepWcs.html" />
    <link rel="prev" title="StepStdPhotCal" href="sofia_redux.instruments.hawc.steps.stepstdphotcal.StepStdPhotCal.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="sofia_redux.instruments.hawc.steps.stepwcs.StepWcs.html" title="StepWcs">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="sofia_redux.instruments.hawc.steps.stepstdphotcal.StepStdPhotCal.html" title="StepStdPhotCal">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../sofia_redux/index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../manuals/hawc/developers/developers.html" accesskey="U">HAWC+ DRP Developer’s Manual</a> &#187;</li>
      
      <li>StepStokes</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="stepstokes">
<h1>StepStokes<a class="headerlink" href="#stepstokes" title="Permalink to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepstokes.StepStokes">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sofia_redux.instruments.hawc.steps.stepstokes.</span></span><span class="sig-name descname"><span class="pre">StepStokes</span></span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepstokes.html#StepStokes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepstokes.StepStokes" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="sofia_redux.instruments.hawc.stepparent.StepParent.html#sofia_redux.instruments.hawc.stepparent.StepParent" title="sofia_redux.instruments.hawc.stepparent.StepParent"><code class="xref py py-class docutils literal notranslate"><span class="pre">StepParent</span></code></a></p>
<p>Compute Stokes parameters for chop/nod polarimetry data.</p>
<p>This step derives Stokes I, Q, and U images with associated
uncertainties and covariances from R and T array images.
If the data only has one HWP angle, then only Stokes I is
computed.</p>
<p>Input for this step is a DataFits object, as produced by the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.instruments.hawc.steps.StepNodPolSub</span></code> pipeline step:
R-T and R+T images for each HWP angle, with associated errors, and
variance images for R and T arrays.</p>
<p>Output for this step contains the following image extensions:
STOKES I, ERROR I, STOKES Q, ERROR Q, STOKES U, ERROR U,
COVAR Q I, COVAR U I, COVAR Q U. Also, a table named TABLE DATA is
created, and BAD PIXEL MASK is copied from the input file.
For Nod-Pol data, the value of the initial HWP angle is saved as a
header keyword (HWPINIT), to be read by
<code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.instruments.hawc.steps.StepRotate</span></code>.</p>
<p class="rubric">Notes</p>
<p>Stokes I is computed by averaging the R+T signal over
all HWP angles (where N is the number of HWP angles):</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[I = \frac{1}{N} \sum_{\phi=1}^N (R+T)_{\phi}\]</div>
<div class="math notranslate nohighlight">
\[\sigma_I = \frac{1}{N}
\sqrt{\sum_{\phi=1}^N \sigma_{R+T,\phi}^2}.\]</div>
</div></blockquote>
<p>The associated uncertainty in I is generally propagated from the
previously calculated errors for R+T as above, but may be inflated by
the median of the standard deviation of the R+T values across the HWP
angles if necessary. In the most common case of four HWP angles at 0,
45, 22.5, and 67.5 degrees, Stokes Q and U are computed as:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[Q = \frac{1}{2} [(R-T)_{0} - (R-T)_{45}]\]</div>
<div class="math notranslate nohighlight">
\[U = \frac{1}{2} [(R-T)_{22.5} - (R-T)_{67.5}]\]</div>
</div></blockquote>
<p>where <span class="math notranslate nohighlight">\((R-T)_{\phi}\)</span> is the differential R-T flux at the HWP
angle <span class="math notranslate nohighlight">\(\phi\)</span>. Uncertainties in Q and U are propagated from the
input error values on R-T:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\sigma_Q = \frac{1}{2} \sqrt{\sigma_{R-T,0}^2
+ \sigma_{R-T,45}^2}\]</div>
<div class="math notranslate nohighlight">
\[\sigma_U = \frac{1}{2} \sqrt{\sigma_{R-T,22.5}^2
+ \sigma_{R-T,67.5}^2}.\]</div>
</div></blockquote>
<p>Covariances between the Stokes parameters are derived from the
variances in R and T as follows:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\sigma_{QI} = \frac{1}{8} [\sigma_{R,0}^2
- \sigma_{R,45}^2
- \sigma_{T,0}^2
+ \sigma_{T,45}^2]\]</div>
<div class="math notranslate nohighlight">
\[\sigma_{UI} = \frac{1}{8} [\sigma_{R,22.5}^2
- \sigma_{R,67.5}^2
- \sigma_{T,22.5}^2
+ \sigma_{T,67.5}^2]\]</div>
</div></blockquote>
<p>The covariance between Q and U (<span class="math notranslate nohighlight">\(\sigma_{QU}\)</span>) is zero at this
stage, since they are derived from data for different HWP angles.</p>
<p class="rubric">Methods Summary</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepstokes.StepStokes.run" title="sofia_redux.instruments.hawc.steps.stepstokes.StepStokes.run"><code class="xref py py-obj docutils literal notranslate"><span class="pre">run</span></code></a>()</p></td>
<td><p>Run the data reduction algorithm.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepstokes.StepStokes.setup" title="sofia_redux.instruments.hawc.steps.stepstokes.StepStokes.setup"><code class="xref py py-obj docutils literal notranslate"><span class="pre">setup</span></code></a>()</p></td>
<td><p>Set parameters and metadata for the pipeline step.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepstokes.StepStokes.stokes" title="sofia_redux.instruments.hawc.steps.stepstokes.StepStokes.stokes"><code class="xref py py-obj docutils literal notranslate"><span class="pre">stokes</span></code></a>(idx1, idx2, rmt_data, rmt_sigma, ...)</p></td>
<td><p>Compute stokes Q and U.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Methods Documentation</p>
<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepstokes.StepStokes.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepstokes.html#StepStokes.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepstokes.StepStokes.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the data reduction algorithm.</p>
<p>Because this step is single-in, single-out (SISO),
self.datain must be a DataFits object. The output
is also a DataFits object, stored in self.dataout.</p>
<p>The process is:</p>
<ol class="arabic simple">
<li><p>Compute Stokes I from R+T at all angles.
Propagate or recalculate errors on Stokes I.</p></li>
<li><p>Compute Stokes Q and U from R-T at angles separated
by 45 degrees.  Propagate associated errors
and covariances.</p></li>
</ol>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepstokes.StepStokes.setup">
<span class="sig-name descname"><span class="pre">setup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepstokes.html#StepStokes.setup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepstokes.StepStokes.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Set parameters and metadata for the pipeline step.</p>
<p>Output files have PRODTYPE = ‘scanstokes’, and are named with
the step abbreviation ‘STK’.</p>
<p>Parameters defined for this step are:</p>
<dl class="simple">
<dt>hwp_tol<span class="classifier">float</span></dt><dd><p>Tolerance for difference from expected values for HWP
angles. HWP angles for Stokes parameters must differ
by no more than 45 +/- hwp_tol degrees.</p>
</dd>
<dt>erri<span class="classifier">str</span></dt><dd><p>Inflation method for Stokes I errors.  May be
‘median’, ‘mean’, or ‘none’.</p>
</dd>
<dt>erripolmethod<span class="classifier">str</span></dt><dd><p>Method for calculating Stokes I error.  Options are
‘hwpstddev’, to compute them as a standard deviation
across the HWP angles, or ‘meansigma’, to propagate
them from the input errors (recommended).</p>
</dd>
<dt>removeR1stokesi<span class="classifier">bool</span></dt><dd><p>If set, the R1 subarray for Stokes I is removed from
the output.</p>
</dd>
<dt>override_hwp_order<span class="classifier">bool</span></dt><dd><p>If set, then the first two HWP angles will be used
for Q, last two for U, regardless of value.  This is
necessary in the case where the HWP value is incorrectly
recorded, but the HWP position as observed was correct.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepstokes.StepStokes.stokes">
<span class="sig-name descname"><span class="pre">stokes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">idx1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idx2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rmt_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rmt_sigma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r_var</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_var</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepstokes.html#StepStokes.stokes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepstokes.StepStokes.stokes" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute stokes Q and U.</p>
<p>The index parameters control which Stokes parameter image
is computed</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl>
<dt><strong>idx1</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a> of int</span></dt><dd><p>Index for angle 1.</p>
</dd>
<dt><strong>idx2</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a> of int</span></dt><dd><p>Index for angle 2.</p>
</dd>
<dt><strong>rmt_data</strong><span class="classifier">array-like</span></dt><dd><p>R - T flux data array. Should have three dimensions,
where the first dimension indexes the HWP angle.</p>
</dd>
<dt><strong>rmt_sigma</strong><span class="classifier">array-like.</span></dt><dd><p>R - T error data array. Dimensions should match rmt_data.</p>
</dd>
<dt><strong>r_var</strong><span class="classifier">array-like</span></dt><dd><p>Variance for the R array. Dimensions should match rmt_data.</p>
</dd>
<dt><strong>t_var</strong><span class="classifier">array-like</span></dt><dd><p>Variance for the T array. Dimensions should match rmt_data.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>stokes</strong><span class="classifier">array-like</span></dt><dd><p>The Stokes Q or U flux image.</p>
</dd>
<dt><strong>dstokes</strong><span class="classifier">array-like</span></dt><dd><p>The error on the Stokes Q or U flux.</p>
</dd>
<dt><strong>stokes_icov</strong><span class="classifier">array-like</span></dt><dd><p>The covariance on the Stokes Q or U image, with respect
to the Stokes I image.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">StepStokes</a><ul>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepstokes.StepStokes"><code class="docutils literal notranslate"><span class="pre">StepStokes</span></code></a><ul>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepstokes.StepStokes.run"><code class="docutils literal notranslate"><span class="pre">StepStokes.run()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepstokes.StepStokes.setup"><code class="docutils literal notranslate"><span class="pre">StepStokes.setup()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepstokes.StepStokes.stokes"><code class="docutils literal notranslate"><span class="pre">StepStokes.stokes()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/sofia_redux.instruments.hawc.steps.stepstokes.StepStokes.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>