<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>StepMkflat &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="icon" href="../_static/redux.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="StepNodPolSub" href="sofia_redux.instruments.hawc.steps.stepnodpolsub.StepNodPolSub.html" />
    <link rel="prev" title="StepMerge" href="sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="sofia_redux.instruments.hawc.steps.stepnodpolsub.StepNodPolSub.html" title="StepNodPolSub">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.html" title="StepMerge">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../sofia_redux/index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../manuals/hawc/developers/developers.html" accesskey="U">HAWC+ DRP Developer’s Manual</a> &#187;</li>
      
      <li>StepMkflat</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="stepmkflat">
<h1>StepMkflat<a class="headerlink" href="#stepmkflat" title="Permalink to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepmkflat.StepMkflat">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sofia_redux.instruments.hawc.steps.stepmkflat.</span></span><span class="sig-name descname"><span class="pre">StepMkflat</span></span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepmkflat.html#StepMkflat"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepmkflat.StepMkflat" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="sofia_redux.instruments.hawc.stepmoparent.StepMOParent.html#sofia_redux.instruments.hawc.stepmoparent.StepMOParent" title="sofia_redux.instruments.hawc.stepmoparent.StepMOParent"><code class="xref py py-class docutils literal notranslate"><span class="pre">StepMOParent</span></code></a>, <a class="reference internal" href="sofia_redux.instruments.hawc.steploadaux.StepLoadAux.html#sofia_redux.instruments.hawc.steploadaux.StepLoadAux" title="sofia_redux.instruments.hawc.steploadaux.StepLoadAux"><code class="xref py py-class docutils literal notranslate"><span class="pre">StepLoadAux</span></code></a></p>
<p>Create a flat file from internal calibrator data.</p>
<p>This step combines the internal calibrator observations
(INTCALs) taken adjacent to a science observation, then multiplies
by a master flat (skycal) to generate an observation flat
(OFT) file for each input group of INTCALs.  The skycal
file is generally a flat generated from a Chop-Scan observation
of a bright source, divided by its own associated INTCAL.
The INTCAL files are used to correct for temporal variations
in detector responsivity, caused by changes in bias, background
loading, and/or ADR control temperature; the skycal corrects for
more static detector pixel response variations.</p>
<p>Variances from the INTCAL files are also propagated into the
output flat files.</p>
<p>The input for this step is multiple demodulated files from
internal calibrator observations (CALMODE = ‘INT_CAL’ files),
demodulated using the ‘mode_intcal’ pipeline mode.  Thus mode
must set the following parameters for StepDemodulate:</p>
<ul class="simple">
<li><p><em>l0method</em> = RE</p></li>
<li><p><em>chopavg</em> = True</p></li>
<li><p><em>phasefile</em> = 0.0</p></li>
</ul>
<p>The output for this step is a normalized INTCAL, one per input
file, before combination and multiplication by the skycal.
As a side effect, the observation flat files are also written
to disk with product identifier ‘OFT’, in a folder designated
by the ‘flatoutfolder’ parameter. OFT files have R ARRAY GAIN,
T ARRAY GAIN, R ARRAY GAIN VAR, T ARRAY GAIN VAR, R BAD PIXEL
MASK, and T BAD PIXEL MASK image extensions.</p>
<p>The mode_intcal pipeline ending in StepMkFlat should be run before
the regular chop/nod pipeline to make the observation flats. Then, the
regular pipeline can be run, making sure that StepFlat is configured
to look in flatoutfolder for flatfiles, with the appropriate
fitkeys settings to make sure the correct flat is paired with the
observation.</p>
<p class="rubric">Methods Summary</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepmkflat.StepMkflat.run" title="sofia_redux.instruments.hawc.steps.stepmkflat.StepMkflat.run"><code class="xref py py-obj docutils literal notranslate"><span class="pre">run</span></code></a>()</p></td>
<td><p>Run the data reduction algorithm.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepmkflat.StepMkflat.setup" title="sofia_redux.instruments.hawc.steps.stepmkflat.StepMkflat.setup"><code class="xref py py-obj docutils literal notranslate"><span class="pre">setup</span></code></a>()</p></td>
<td><p>Set parameters and metadata for the pipeline step.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Methods Documentation</p>
<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepmkflat.StepMkflat.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepmkflat.html#StepMkflat.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepmkflat.StepMkflat.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the data reduction algorithm.</p>
<p>Because this step is multi-in, multi-out (MIMO),
self.datain must be a list of DataFits objects.  The output
is also a list of DataFits objects, stored in self.dataout.</p>
<p>The process is:</p>
<ol class="arabic simple">
<li><p>Read data from the INTCAL files.</p></li>
<li><p>For each file, flag outliers and normalize by the median
signal in the R and T arrays.</p></li>
<li><p>Identify groups of data by matching across the ‘groupkey’
parameter.</p></li>
<li><p>Identify and read the data from an auxiliary skycal file.</p></li>
<li><p>Mean-combine the normalized gain for each image in group.</p></li>
<li><p>Multiply the mean INTCAL images by the skycal master
flat.</p></li>
<li><p>Save resulting OFT files to disk, in ‘flatoutfolder’.</p></li>
</ol>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepmkflat.StepMkflat.setup">
<span class="sig-name descname"><span class="pre">setup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepmkflat.html#StepMkflat.setup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepmkflat.StepMkflat.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Set parameters and metadata for the pipeline step.</p>
<p>Output files have PRODTYPE = ‘mkflat’, and are named with
the step abbreviation ‘DCL’.</p>
<p>Parameters defined for this step are:</p>
<dl class="simple">
<dt>flatoutfolder<span class="classifier">str</span></dt><dd><p>Path for the folder to write flat files to.  May be
relative or absolute.  Set to an empty string to write to
the same folder as the input file.</p>
</dd>
<dt>groupkey<span class="classifier">str</span></dt><dd><p>Header keyword that must match across INTCAL files in
order to group them together.  Typically set to FILEGPID.</p>
</dd>
<dt>skip_start<span class="classifier">int</span></dt><dd><p>Chops to exclude from the beginning of the file.</p>
</dd>
<dt>skip_end<span class="classifier">int</span></dt><dd><p>Chops to exclude from the end of the file.</p>
</dd>
<dt>bad_dead<span class="classifier">float</span></dt><dd><p>Raw data threshold for dead pixels.</p>
</dd>
<dt>bad_ramping<span class="classifier">float</span></dt><dd><p>Raw data threshold for ramping pixels.</p>
</dd>
<dt>normstd<span class="classifier">float</span></dt><dd><p>Threshold to exclude pixels with high standard deviation.</p>
</dd>
<dt>ynormlowlim<span class="classifier">list of float</span></dt><dd><p>Threshold to exclude pixels with low normalized signal, given
for [R0, R1, T0].</p>
</dd>
<dt>ynormhighlim<span class="classifier">list of float</span></dt><dd><p>Threshold to exclude pixels with high normalized signal, given
for [R0, R1, T0].</p>
</dd>
<dt>ttor<span class="classifier">float</span></dt><dd><p>Scale factor for the T array to the R array.</p>
</dd>
<dt>scalfile<span class="classifier">str</span></dt><dd><p>Filename for auxiliary file(s). Can contain * and ?
wildcards to match multiple files to be selected using fitkeys.</p>
</dd>
<dt>bkupscal<span class="classifier">str</span></dt><dd><p>Back up filename for auxiliary file(s). Can contain *
and ? wildcards to match multiple files to be selected using
fitkeys.</p>
</dd>
<dt>scalfitkeys<span class="classifier">list of str</span></dt><dd><p>List of header keys that need to match the scal
data file.  These are only used if multiple files match
the input INTCAL file.</p>
</dd>
<dt>daterange<span class="classifier">float</span></dt><dd><p>If DATE-OBS is in scalfitkeys, files are matched within
this many days.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">StepMkflat</a><ul>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepmkflat.StepMkflat"><code class="docutils literal notranslate"><span class="pre">StepMkflat</span></code></a><ul>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepmkflat.StepMkflat.run"><code class="docutils literal notranslate"><span class="pre">StepMkflat.run()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepmkflat.StepMkflat.setup"><code class="docutils literal notranslate"><span class="pre">StepMkflat.setup()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/sofia_redux.instruments.hawc.steps.stepmkflat.StepMkflat.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>