<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>PolynomialTree &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="icon" href="../_static/redux.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Resample" href="sofia_redux.toolkit.resampling.Resample.html" />
    <link rel="prev" title="BaseGrid" href="sofia_redux.toolkit.resampling.BaseGrid.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="sofia_redux.toolkit.resampling.Resample.html" title="Resample">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="sofia_redux.toolkit.resampling.BaseGrid.html" title="BaseGrid">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../sofia_redux/index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../manuals/fifils/developers/developers.html" accesskey="U">FIFI-LS Redux Developer’s Manual</a> &#187;</li>
      
      <li>PolynomialTree</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="polynomialtree">
<h1>PolynomialTree<a class="headerlink" href="#polynomialtree" title="Permalink to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="sofia_redux.toolkit.resampling.PolynomialTree">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sofia_redux.toolkit.resampling.</span></span><span class="sig-name descname"><span class="pre">PolynomialTree</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">argument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">build_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'all'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fix_order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">leaf_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">40</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">large_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">distance_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/toolkit/resampling/tree/polynomial_tree.html#PolynomialTree"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.toolkit.resampling.PolynomialTree" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">BaseTree</span></code></p>
<p>Create a tree structure for use with the resampling algorithm.</p>
<p>The resampling tree is primarily responsible for deriving and
storing all independent variables necessary for polynomial fitting,
as well as allowing fast access to those variables that belong to
coordinates within a certain radius of a given point.</p>
<p>TREE STRUCTURE AND ACCESS</p>
<p>The tree itself is divided into N-dimensional blocks, each of which
is allocated a set of coordinates.  The width of these blocks should
correspond to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">window</span></code> (<span class="math notranslate nohighlight">\(\Omega\)</span>) defined in the resampling
algorithm, and coordinates should be scaled accordingly.  For example,
if the window radius is set to <span class="math notranslate nohighlight">\(\Omega=4\)</span> in (arbitrary) units
for the purposes of resampling 1-dimensional data, and the independent
values are:</p>
<blockquote>
<div><p>x = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</p>
</div></blockquote>
<p>They should be supplied to the tree as <span class="math notranslate nohighlight">\(x^\prime = x / \Omega\)</span>.</p>
<div class="math notranslate nohighlight">
\[x^\prime = \frac{x}{\Omega} =
    [0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2, 2.25, 2.5]\]</div>
<p>The tree defines blocks by grouping all coordinates with the same
floored values into a single block.  Therefore, in this case the tree
will contain 3 blocks.  The first contains [0.25, 0.5, 0.75], the
second contains [1, 1.25, 1.5, 1.75], and the third contains
[2, 2.25, 2.5].</p>
<p>The reasoning behind the whole tree structure is to allow for easy
extraction of all coordinates within range of a user supplied
coordinate.  This is done in two stages:  The first is to find out
which block the user supplied coordinate belongs to.  We can then
quickly narrow down the search by recognizing that coordinates in the
tree population inside the window region of the supplied coordinate
must either belong to the same block, or to immediately neighboring
blocks since each block of the tree is the same width as the window
radius.</p>
<p>Once all candidates have been identified, the next step is to keep
only those that are within a radius <span class="math notranslate nohighlight">\(\Omega\)</span> of the user supplied
coordinate.  This can be accomplished quickly using the ball-tree
algorithm (see <code class="xref py py-func docutils literal notranslate"><span class="pre">sklearn.neighbors.BallTree()</span></code>.</p>
<p>In practice, the resampling algorithm loops through each block of
the tree in parallel.  For each block, all user supplied coordinates
(points at which a fit is required) within that block, and all tree
members within the neighborhood (the block and all adjacent blocks
including diagonals) are evaluated in one step by the ball-tree
algorithm so that for each point, we quickly get all tree members
within that point’s window region.</p>
<p>POLYNOMIAL ORDER AND TERMS</p>
<p>The resampling tree is also responsible for deriving all polynomial
terms for the fit as well as mapping these terms to the derivative of
the function.  Please see <code class="xref py py-func docutils literal notranslate"><span class="pre">power_product()</span></code>,
<a class="reference internal" href="sofia_redux.toolkit.resampling.polynomial_exponents.html#sofia_redux.toolkit.resampling.polynomial_exponents" title="sofia_redux.toolkit.resampling.polynomial_exponents"><code class="xref py py-func docutils literal notranslate"><span class="pre">polynomial_exponents()</span></code></a>, and <a class="reference internal" href="sofia_redux.toolkit.resampling.polynomial_derivative_map.html#sofia_redux.toolkit.resampling.polynomial_derivative_map" title="sofia_redux.toolkit.resampling.polynomial_derivative_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">polynomial_derivative_map()</span></code></a>
for further details.  It is also possible to calculate terms for
a range of orders in the case where order may vary to accommodate
fits where insufficient samples are present.  To allow <a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.order" title="sofia_redux.toolkit.resampling.PolynomialTree.order"><code class="xref py py-obj docutils literal notranslate"><span class="pre">order</span></code></a> to
vary, set <code class="xref py py-obj docutils literal notranslate"><span class="pre">fix_order</span></code> to <a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>argument</strong><span class="classifier">numpy.ndarray (n_features, n_samples) or n-tuple</span></dt><dd><p>Either the independent coordinates of samples in n_features-space,
or the shape defining the skeleton of the tree.</p>
</dd>
<dt><strong>shape</strong><span class="classifier">n-tuple, optional</span></dt><dd><p>If coordinates were supplied with <code class="xref py py-obj docutils literal notranslate"><span class="pre">argument</span></code>, the shape of the
tree to build.  Otherwise, the shape will be determined from the
coordinate values in each dimension as
floor(max(coordinates[i])) + 1 for dimension i.</p>
</dd>
<dt><strong>build_type</strong><span class="classifier">str, optional</span></dt><dd><p>Must be one of {‘hood’, ‘balltree’, ‘all’, None}.  Defines the
type of tree structures to create.</p>
</dd>
<dt><strong>order</strong><span class="classifier">int or array_like (n_features,), optional</span></dt><dd><p>The symmetrical or asymmetrical orders respectively.  Symmetrical
orders are selected by supplying an integer to this parameter.</p>
</dd>
<dt><strong>fix_order</strong><span class="classifier">bool, optional</span></dt><dd><p>If <a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.order" title="sofia_redux.toolkit.resampling.PolynomialTree.order"><code class="xref py py-obj docutils literal notranslate"><span class="pre">order</span></code></a> is symmetrical, allow for a varying order in an attempt
to pass the order validation algorithm (the order can only
decrease).</p>
</dd>
<dt><strong>balltree_metric</strong><span class="classifier">str or sklearn.neighbors.DistanceMetric object</span></dt><dd><p>The distance metric to use for the tree. Default=’minkowski’ with
p=2 (that is, a euclidean metric). See the documentation of the
<code class="xref py py-func docutils literal notranslate"><span class="pre">sklearn.neighbors.DistanceMetric()</span></code> class for a list of
available metrics. ball_tree.valid_metrics gives a list of the
metrics which are valid for BallTree.</p>
</dd>
<dt><strong>leaf_size</strong><span class="classifier">int, optional</span></dt><dd><p>If <code class="xref py py-obj docutils literal notranslate"><span class="pre">build_type</span></code> was set to ‘all’ or ‘balltree’, defines the leaf
size of the BallTree.  Please see
<code class="xref py py-func docutils literal notranslate"><span class="pre">sklearn.neighbors.BallTree()</span></code> for further details.</p>
</dd>
<dt><strong>large_data</strong><span class="classifier">bool, optional</span></dt><dd><p>If <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>, indicates that this resampling algorithm will run on
a large set of data, and the ball tree should be created on
subsets of the data.</p>
</dd>
<dt><strong>distance_kwargs</strong><span class="classifier">dict, optional</span></dt><dd><p>Optional keyword arguments passed into
<code class="xref py py-func docutils literal notranslate"><span class="pre">sklearn.neighbors.DistanceMetric()</span></code>.  The default is to use
the “minkowski” definition with <code class="xref py py-obj docutils literal notranslate"><span class="pre">p=2</span></code>, i.e., the Euclidean
definition.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Attributes Summary</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.derivative_term_map" title="sofia_redux.toolkit.resampling.PolynomialTree.derivative_term_map"><code class="xref py py-obj docutils literal notranslate"><span class="pre">derivative_term_map</span></code></a></p></td>
<td><p>Returns mapping necessary to describe the 1st derivative of the tree.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.exponents" title="sofia_redux.toolkit.resampling.PolynomialTree.exponents"><code class="xref py py-obj docutils literal notranslate"><span class="pre">exponents</span></code></a></p></td>
<td><p>Return the polynomial exponents for the tree.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.order" title="sofia_redux.toolkit.resampling.PolynomialTree.order"><code class="xref py py-obj docutils literal notranslate"><span class="pre">order</span></code></a></p></td>
<td><p>Return the order of the polynomial for the tree.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.order_symmetry" title="sofia_redux.toolkit.resampling.PolynomialTree.order_symmetry"><code class="xref py py-obj docutils literal notranslate"><span class="pre">order_symmetry</span></code></a></p></td>
<td><p>Return whether the orders are symmetrical.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.order_varies" title="sofia_redux.toolkit.resampling.PolynomialTree.order_varies"><code class="xref py py-obj docutils literal notranslate"><span class="pre">order_varies</span></code></a></p></td>
<td><p>Return whether the order may be decreased.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.phi_terms_precalculated" title="sofia_redux.toolkit.resampling.PolynomialTree.phi_terms_precalculated"><code class="xref py py-obj docutils literal notranslate"><span class="pre">phi_terms_precalculated</span></code></a></p></td>
<td><p>Return whether the polynomial terms have been calculated.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Methods Summary</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.block_members" title="sofia_redux.toolkit.resampling.PolynomialTree.block_members"><code class="xref py py-obj docutils literal notranslate"><span class="pre">block_members</span></code></a>(block[, get_locations, get_terms])</p></td>
<td><p>Find all members within a single block.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.create_phi_terms_for" title="sofia_redux.toolkit.resampling.PolynomialTree.create_phi_terms_for"><code class="xref py py-obj docutils literal notranslate"><span class="pre">create_phi_terms_for</span></code></a>([block])</p></td>
<td><p>Create the phi terms on demand.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.estimate_max_bytes" title="sofia_redux.toolkit.resampling.PolynomialTree.estimate_max_bytes"><code class="xref py py-obj docutils literal notranslate"><span class="pre">estimate_max_bytes</span></code></a>(coordinates[, window, ...])</p></td>
<td><p>Estimate the maximum number of bytes required by the tree.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.hood_members" title="sofia_redux.toolkit.resampling.PolynomialTree.hood_members"><code class="xref py py-obj docutils literal notranslate"><span class="pre">hood_members</span></code></a>(center_block[, get_locations, ...])</p></td>
<td><p>Find all members within the neighborhood of a single block.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.precalculate_phi_terms" title="sofia_redux.toolkit.resampling.PolynomialTree.precalculate_phi_terms"><code class="xref py py-obj docutils literal notranslate"><span class="pre">precalculate_phi_terms</span></code></a>()</p></td>
<td><p>Calculates polynomial terms for the tree coordinates and order.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.set_order" title="sofia_redux.toolkit.resampling.PolynomialTree.set_order"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_order</span></code></a>(order[, fix_order])</p></td>
<td><p>Set the order(s) of polynomial fit for the resampling algorithm tree.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Attributes Documentation</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="sofia_redux.toolkit.resampling.PolynomialTree.derivative_term_map">
<span class="sig-name descname"><span class="pre">derivative_term_map</span></span><a class="headerlink" href="#sofia_redux.toolkit.resampling.PolynomialTree.derivative_term_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns mapping necessary to describe the 1st derivative of the tree.</p>
<p>The terms describing the derivative of a polynomial function should all
be present in the exponent terms of the tree, but need to be reordered
in a specific way and may also contain an additional coefficient.
Once the coefficients of the fit are known (c), the derivative of
feature k may be be calculated by:</p>
<blockquote>
<div><p>sum(h[k, 0] * c[h[k, 1]] * p[h[k, 2], k])</p>
</div></blockquote>
<p>where p are the exponent terms, and h is the map returned by this
property.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>mapping</strong><span class="classifier">numpy.ndarray (int)</span></dt><dd><p>An array of shape (n_features, 3, n_terms).</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sofia_redux.toolkit.resampling.PolynomialTree.exponents">
<span class="sig-name descname"><span class="pre">exponents</span></span><a class="headerlink" href="#sofia_redux.toolkit.resampling.PolynomialTree.exponents" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the polynomial exponents for the tree.</p>
<p>The polynomial exponents describe how the polynomial terms should be
calculated.  For example, the exponents [[0, 0], [1, 0], [2, 0],
[0, 1], [1, 1], [0, 2]] represent the equation:</p>
<blockquote>
<div><p>f(x, y) = c0 + c1.x + c2.x^2 + c3.y + c4.xy + c5.y^2</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt>numpy.ndarray (int)</dt><dd><p>An array of shape (n_exponents, n_features)</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sofia_redux.toolkit.resampling.PolynomialTree.order">
<span class="sig-name descname"><span class="pre">order</span></span><a class="headerlink" href="#sofia_redux.toolkit.resampling.PolynomialTree.order" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the order of the polynomial for the tree.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt>int or numpy.ndarray (int)</dt><dd><p>A scalar value if orders for each feature are identical, or an
array of values of shape (n_features,) if values are not identical.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sofia_redux.toolkit.resampling.PolynomialTree.order_symmetry">
<span class="sig-name descname"><span class="pre">order_symmetry</span></span><a class="headerlink" href="#sofia_redux.toolkit.resampling.PolynomialTree.order_symmetry" title="Permalink to this definition">¶</a></dt>
<dd><p>Return whether the orders are symmetrical.</p>
<p>Orders are considered symmetrical when the orders of each feature are
identical.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt>bool</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sofia_redux.toolkit.resampling.PolynomialTree.order_varies">
<span class="sig-name descname"><span class="pre">order_varies</span></span><a class="headerlink" href="#sofia_redux.toolkit.resampling.PolynomialTree.order_varies" title="Permalink to this definition">¶</a></dt>
<dd><p>Return whether the order may be decreased.</p>
<p>The order of the polynomial may be reduced if specifically set by the
user (fix_order=False) and the order is symmetrical.  In this case,
a subset of polynomial terms can be extracted from the original terms
to describe a lower order polynomial.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt>bool</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sofia_redux.toolkit.resampling.PolynomialTree.phi_terms_precalculated">
<span class="sig-name descname"><span class="pre">phi_terms_precalculated</span></span><a class="headerlink" href="#sofia_redux.toolkit.resampling.PolynomialTree.phi_terms_precalculated" title="Permalink to this definition">¶</a></dt>
<dd><p>Return whether the polynomial terms have been calculated.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt>bool</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<p class="rubric">Methods Documentation</p>
<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.toolkit.resampling.PolynomialTree.block_members">
<span class="sig-name descname"><span class="pre">block_members</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">block</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_locations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_terms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/toolkit/resampling/tree/polynomial_tree.html#PolynomialTree.block_members"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.toolkit.resampling.PolynomialTree.block_members" title="Permalink to this definition">¶</a></dt>
<dd><p>Find all members within a single block.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>block</strong><span class="classifier">int</span></dt><dd><p>The index of the block.</p>
</dd>
<dt><strong>get_locations</strong><span class="classifier">bool, optional</span></dt><dd><p>If <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>, return the coordinates of the hood members.</p>
</dd>
<dt><strong>get_terms</strong><span class="classifier">bool, optional</span></dt><dd><p>If <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>, return the calculated “phi” terms of hood members.  Note
that a polynomial order must have been set, and terms calculated.
See <a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.set_order" title="sofia_redux.toolkit.resampling.PolynomialTree.set_order"><code class="xref py py-func docutils literal notranslate"><span class="pre">PolynomialTree.set_order()</span></code></a>, and
<a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.precalculate_phi_terms" title="sofia_redux.toolkit.resampling.PolynomialTree.precalculate_phi_terms"><code class="xref py py-func docutils literal notranslate"><span class="pre">PolynomialTree.precalculate_phi_terms()</span></code></a> for further
information.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>members, [coordinates, terms]</dt><dd><p>members is a numpy.ndarray of int and shape (found_members,).
If <code class="xref py py-obj docutils literal notranslate"><span class="pre">get_locations</span></code> was set to <code class="xref py py-obj docutils literal notranslate"><span class="pre">True,</span></code> coordinates is of shape
(n_features, found_members).  If <code class="xref py py-obj docutils literal notranslate"><span class="pre">get_terms</span></code> was set to <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>,
terms is of shape (n_terms, found_members).</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.toolkit.resampling.PolynomialTree.create_phi_terms_for">
<span class="sig-name descname"><span class="pre">create_phi_terms_for</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">block</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/toolkit/resampling/tree/polynomial_tree.html#PolynomialTree.create_phi_terms_for"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.toolkit.resampling.PolynomialTree.create_phi_terms_for" title="Permalink to this definition">¶</a></dt>
<dd><p>Create the phi terms on demand.</p>
<p>If <code class="xref py py-obj docutils literal notranslate"><span class="pre">block</span></code> is None, creates the phi terms over all samples.  Otherwise,
creates phi terms for all samples in the neighborhood of <code class="xref py py-obj docutils literal notranslate"><span class="pre">block</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>block</strong><span class="classifier">int, optional</span></dt><dd><p>The block for which to create the phi terms.  If <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a> is
supplied, will calculate for all coordinates.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>hood_members</strong><span class="classifier">numpy.ndarray (int) or slice or None</span></dt><dd><p>The samples within the neighborhood of block, all indices or
<a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a> if not calculated.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.toolkit.resampling.PolynomialTree.estimate_max_bytes">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">estimate_max_bytes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coordinates</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">leaf_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">40</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">full_tree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/toolkit/resampling/tree/polynomial_tree.html#PolynomialTree.estimate_max_bytes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.toolkit.resampling.PolynomialTree.estimate_max_bytes" title="Permalink to this definition">¶</a></dt>
<dd><p>Estimate the maximum number of bytes required by the tree.</p>
<p>This includes pre-calculation of the phi terms for polynomial
representation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>coordinates</strong><span class="classifier">numpy.ndarray</span></dt><dd><p>The coordinates for the tree of shape (n_dimensions, n)</p>
</dd>
<dt><strong>window</strong><span class="classifier">int or float, optional</span></dt><dd><p>The size of the tree windows</p>
</dd>
<dt><strong>leaf_size</strong><span class="classifier">int, optional</span></dt><dd><p>The number of leaves used to construct the ball-tree</p>
</dd>
<dt><strong>full_tree</strong><span class="classifier">bool, optional</span></dt><dd><p>Calculate the maximum number of bytes if the full ball-tree is
pre-calculated.  Otherwise, calculates the size of a single
neighborhood sized ball-tree.</p>
</dd>
<dt><strong>order</strong><span class="classifier">int or numpy.ndarray (int), optional</span></dt><dd><p>The order of polynomial to fit as an integer for all dimensions or
an array of shape (n_dimensions,).</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>max_size</strong><span class="classifier">int</span></dt><dd><p>An upper limit for the maximum number of bytes used to construct
the tree.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.toolkit.resampling.PolynomialTree.hood_members">
<span class="sig-name descname"><span class="pre">hood_members</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">center_block</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_locations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_terms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/toolkit/resampling/tree/polynomial_tree.html#PolynomialTree.hood_members"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.toolkit.resampling.PolynomialTree.hood_members" title="Permalink to this definition">¶</a></dt>
<dd><p>Find all members within the neighborhood of a single block.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>center_block</strong><span class="classifier">int</span></dt><dd><p>The index of the block at the center of the neighborhood.</p>
</dd>
<dt><strong>get_locations</strong><span class="classifier">bool, optional</span></dt><dd><p>If <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>, return the coordinates of the hood members.</p>
</dd>
<dt><strong>get_terms</strong><span class="classifier">bool, optional</span></dt><dd><p>If <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>, return the calculated “phi” terms of hood members.  Note
that a polynomial order must have been set, and terms calculated.
See <a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.set_order" title="sofia_redux.toolkit.resampling.PolynomialTree.set_order"><code class="xref py py-func docutils literal notranslate"><span class="pre">PolynomialTree.set_order()</span></code></a>, and
<a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.precalculate_phi_terms" title="sofia_redux.toolkit.resampling.PolynomialTree.precalculate_phi_terms"><code class="xref py py-func docutils literal notranslate"><span class="pre">PolynomialTree.precalculate_phi_terms()</span></code></a> for further
information.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>members, [coordinates, terms]</dt><dd><p>members is a numpy.ndarray of int and shape (found_members,).
If <code class="xref py py-obj docutils literal notranslate"><span class="pre">get_locations</span></code> was set to <code class="xref py py-obj docutils literal notranslate"><span class="pre">True,</span></code> coordinates is of shape
(n_features, found_members).  If <code class="xref py py-obj docutils literal notranslate"><span class="pre">get_terms</span></code> was set to <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>,
terms is of shape (n_terms, found_members).</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.toolkit.resampling.PolynomialTree.precalculate_phi_terms">
<span class="sig-name descname"><span class="pre">precalculate_phi_terms</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/toolkit/resampling/tree/polynomial_tree.html#PolynomialTree.precalculate_phi_terms"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.toolkit.resampling.PolynomialTree.precalculate_phi_terms" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates polynomial terms for the tree coordinates and order.</p>
<p>Calculates the <span class="math notranslate nohighlight">\(\Phi\)</span> terms for the equation:</p>
<div class="math notranslate nohighlight">
\[f(\Phi) = \hat{c} \cdot \Phi\]</div>
<p>The polynomial terms are dependent on the tree coordinates, and the
order of polynomial fit.  Please see <a class="reference internal" href="sofia_redux.toolkit.resampling.polynomial_exponents.html#sofia_redux.toolkit.resampling.polynomial_exponents" title="sofia_redux.toolkit.resampling.polynomial_exponents"><code class="xref py py-func docutils literal notranslate"><span class="pre">polynomial_exponents()</span></code></a> for
a description on how terms are derived.</p>
<p>If the order is not fixed (i.e., is allowed to vary as marked by the
<a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.order_varies" title="sofia_redux.toolkit.resampling.PolynomialTree.order_varies"><code class="xref py py-obj docutils literal notranslate"><span class="pre">order_varies</span></code></a> attribute), a set of terms will be derived for all
orders up to the order defined by the user.  Please note that orders
may only vary if the order is “symmetrical” as defined in
<a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.set_order" title="sofia_redux.toolkit.resampling.PolynomialTree.set_order"><code class="xref py py-obj docutils literal notranslate"><span class="pre">PolynomialTree.set_order</span></code></a>.  In addition, a mapping relating terms to
derivatives of the fit is also created in the <a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.derivative_term_map" title="sofia_redux.toolkit.resampling.PolynomialTree.derivative_term_map"><code class="xref py py-obj docutils literal notranslate"><span class="pre">derivative_term_map</span></code></a>
attribute, details of which can be found in
<a class="reference internal" href="sofia_redux.toolkit.resampling.polynomial_derivative_map.html#sofia_redux.toolkit.resampling.polynomial_derivative_map" title="sofia_redux.toolkit.resampling.polynomial_derivative_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">polynomial_derivative_map()</span></code></a>.  When the order does vary, the
terms for order k are given as:</p>
<blockquote>
<div><dl class="simple">
<dt>tree.phi_terms[tree.order_term_indices[k]:</dt><dd><p>tree.order_term_indices[k+1]]</p>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt>None</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.toolkit.resampling.PolynomialTree.set_order">
<span class="sig-name descname"><span class="pre">set_order</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fix_order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/toolkit/resampling/tree/polynomial_tree.html#PolynomialTree.set_order"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.toolkit.resampling.PolynomialTree.set_order" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the order(s) of polynomial fit for the resampling algorithm tree.</p>
<p>In addition to declaring the desired order of polynomial fit, the user
may also opt to select an algorithm to validate the desired order of
fit is possible given a distribution of samples.  Please see
<code class="xref py py-func docutils literal notranslate"><span class="pre">resample_utils.check_orders()</span></code> for a full description of available
algorithms.</p>
<p>Throughout the resampling algorithm, orders are classified as either
“symmetrical” or “asymmetrical”.  An order is termed as symmetrical
if it is the same for all features of the polynomial fit.  i.e., the
maximum exponent for each feature in a polynomial equation will be
equal to the order.  For example, a 2-dimensional 2nd order polynomial
is of the form:</p>
<div class="math notranslate nohighlight">
\[f(x, y) = c_0 + c_1 x + c_2 x^2 + c_3 y + c_4 x y + c_5 y^2\]</div>
<p>where the maximum exponent for <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> in any
term is 2.</p>
<p>An order is considered “asymmetrical” if orders are not equal across
features or dimensions.  For example, a 2-dimensional polynomial with
an order of 1 in <span class="math notranslate nohighlight">\(x\)</span>, and 2 in <span class="math notranslate nohighlight">\(y\)</span> would have the form:</p>
<div class="math notranslate nohighlight">
\[f(x, y) = c_0 + c_1 x + c_2 y + c_3 x y + c_4 y^2\]</div>
<p>where the maximum exponent of <span class="math notranslate nohighlight">\(x\)</span> is 1, and the maximum exponent
of <span class="math notranslate nohighlight">\(y\)</span> is 2.</p>
<p>If orders are symmetrical, the user can allow the order to vary such
that it passes the order validation algorithm.  For instance, if only
2 samples exist for a 1-dimensional polynomial fit, and the user
requested a 2nd order polynomial fit, the resampling algorithm will
lower the order to 1, so that a fit can be performed (if the algorithm
worked by counting the number of available samples).  If orders are
asymmetrical, this option is not available and fits will be aborted
if they fail the order validation algorithm.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>order</strong><span class="classifier">int or array_like (n_features,)</span></dt><dd><p>The symmetrical or asymmetrical orders respectively.</p>
</dd>
<dt><strong>fix_order</strong><span class="classifier">bool, optional</span></dt><dd><p>If <a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.order" title="sofia_redux.toolkit.resampling.PolynomialTree.order"><code class="xref py py-obj docutils literal notranslate"><span class="pre">order</span></code></a> is symmetrical, allow for a varying order in an attempt
to pass the order validation algorithm (the order can only
decrease).</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>None</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">PolynomialTree</a><ul>
<li><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree"><code class="docutils literal notranslate"><span class="pre">PolynomialTree</span></code></a><ul>
<li><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.derivative_term_map"><code class="docutils literal notranslate"><span class="pre">PolynomialTree.derivative_term_map</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.exponents"><code class="docutils literal notranslate"><span class="pre">PolynomialTree.exponents</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.order"><code class="docutils literal notranslate"><span class="pre">PolynomialTree.order</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.order_symmetry"><code class="docutils literal notranslate"><span class="pre">PolynomialTree.order_symmetry</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.order_varies"><code class="docutils literal notranslate"><span class="pre">PolynomialTree.order_varies</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.phi_terms_precalculated"><code class="docutils literal notranslate"><span class="pre">PolynomialTree.phi_terms_precalculated</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.block_members"><code class="docutils literal notranslate"><span class="pre">PolynomialTree.block_members()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.create_phi_terms_for"><code class="docutils literal notranslate"><span class="pre">PolynomialTree.create_phi_terms_for()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.estimate_max_bytes"><code class="docutils literal notranslate"><span class="pre">PolynomialTree.estimate_max_bytes()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.hood_members"><code class="docutils literal notranslate"><span class="pre">PolynomialTree.hood_members()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.precalculate_phi_terms"><code class="docutils literal notranslate"><span class="pre">PolynomialTree.precalculate_phi_terms()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.toolkit.resampling.PolynomialTree.set_order"><code class="docutils literal notranslate"><span class="pre">PolynomialTree.set_order()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/sofia_redux.toolkit.resampling.PolynomialTree.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>