<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>StepDmdPlot &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="icon" href="../_static/redux.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="StepFlat" href="sofia_redux.instruments.hawc.steps.stepflat.StepFlat.html" />
    <link rel="prev" title="StepDmdCut" href="sofia_redux.instruments.hawc.steps.stepdmdcut.StepDmdCut.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="sofia_redux.instruments.hawc.steps.stepflat.StepFlat.html" title="StepFlat">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="sofia_redux.instruments.hawc.steps.stepdmdcut.StepDmdCut.html" title="StepDmdCut">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../sofia_redux/index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../manuals/hawc/developers/developers.html" accesskey="U">HAWC+ DRP Developer’s Manual</a> &#187;</li>
      
      <li>StepDmdPlot</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="stepdmdplot">
<h1>StepDmdPlot<a class="headerlink" href="#stepdmdplot" title="Permalink to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sofia_redux.instruments.hawc.steps.stepdmdplot.</span></span><span class="sig-name descname"><span class="pre">StepDmdPlot</span></span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepdmdplot.html#StepDmdPlot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="sofia_redux.instruments.hawc.stepparent.StepParent.html#sofia_redux.instruments.hawc.stepparent.StepParent" title="sofia_redux.instruments.hawc.stepparent.StepParent"><code class="xref py py-class docutils literal notranslate"><span class="pre">StepParent</span></code></a></p>
<p>Produce diagnostic plots for demodulated data.</p>
<p>This pipeline step produces a set of diagnostic plots from demodulated
chop/nod data. For data that are not from the internal calibrator,
the data is checked for possible door vignetting. For
data that are from the internal calibrator, images of phase
differences from expected values are displayed.</p>
<p>This step requires demodulated data as input, as produced by
the <code class="xref py py-obj docutils literal notranslate"><span class="pre">sofia_redux.instruments.hawc.steps.StepDemodulate</span></code> step.
The input table should include columns for Chop Mask and
Samples, RA, Dec, TrackErrAoi3, TrackErrAoi4,
and either CentroidAoi or SofiaHkTrkAoi; R array, R array Imag,
T array, T array Imag; CentroidExpMsec; HWP Angle, HWP Index and
Nod Index.</p>
<p>The output from this step is identical to the input. As a side
effect, a PNG file is saved to disk to the same base name as the input
file, with ‘DPL’ replacing the product type indicator.</p>
<p class="rubric">Methods Summary</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.calc_phase" title="sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.calc_phase"><code class="xref py py-obj docutils literal notranslate"><span class="pre">calc_phase</span></code></a>(real_part, imag_part, chop_freq, ...)</p></td>
<td><p>Calculate a phase image.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.get_gapindex" title="sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.get_gapindex"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_gapindex</span></code></a>(timeseries[, thresh])</p></td>
<td><p>Find indices of time gaps above a threshhold.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.run" title="sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.run"><code class="xref py py-obj docutils literal notranslate"><span class="pre">run</span></code></a>()</p></td>
<td><p>Run the data reduction algorithm.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.setup" title="sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.setup"><code class="xref py py-obj docutils literal notranslate"><span class="pre">setup</span></code></a>()</p></td>
<td><p>Set parameters and metadata for the pipeline step.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.sigma_mask" title="sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.sigma_mask"><code class="xref py py-obj docutils literal notranslate"><span class="pre">sigma_mask</span></code></a>(array[, sigma, iters])</p></td>
<td><p>Mask array along axis 0 using sigma-clipping and median.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Methods Documentation</p>
<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.calc_phase">
<span class="sig-name descname"><span class="pre">calc_phase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">real_part</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imag_part</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chop_freq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">user_freq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phaseref</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepdmdplot.html#StepDmdPlot.calc_phase"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.calc_phase" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate a phase image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>real_part</strong><span class="classifier">array-like</span></dt><dd><p>Array of real values.</p>
</dd>
<dt><strong>imag_part</strong><span class="classifier">array-like</span></dt><dd><p>Array of imaginary values.</p>
</dd>
<dt><strong>chop_freq</strong><span class="classifier">float</span></dt><dd><p>Chopper frequency of the data.</p>
</dd>
<dt><strong>user_freq</strong><span class="classifier">float</span></dt><dd><p>User-specified frequency.</p>
</dd>
<dt><strong>phaseref</strong><span class="classifier">astropy.units.Quantity with units of degrees, optional</span></dt><dd><p>If specified, subtract this reference phase.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>phase</strong><span class="classifier">array of astropy.units.Quantity with units of degrees</span></dt><dd><p>Phase in degrees, in range -180 deg to 180 deg.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.get_gapindex">
<span class="sig-name descname"><span class="pre">get_gapindex</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timeseries</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.12</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepdmdplot.html#StepDmdPlot.get_gapindex"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.get_gapindex" title="Permalink to this definition">¶</a></dt>
<dd><p>Find indices of time gaps above a threshhold.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>timeseries</strong><span class="classifier">array-like</span></dt><dd><p>Sorted array of times.</p>
</dd>
<dt><strong>thresh</strong><span class="classifier">float, optional</span></dt><dd><p>Threshold for determining a gap.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>gapindex</strong><span class="classifier">array-like of int</span></dt><dd><p>index at which to insert None values to indicate gaps</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepdmdplot.html#StepDmdPlot.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the data reduction algorithm.</p>
<p>This step is run as a single-in single-out (SISO) step:
self.datain should be a DataFits object, and output will also
be a single DataFits, stored in self.dataout.</p>
<p>The process is:</p>
<ol class="arabic simple">
<li><p>For all data types, plot the RA and Dec in one panel; TrackErrAoi3
and TrackErrAoi4 in another panel; HWP angle in yet another panel;
and the sigma-clipped data values of the user-specified detector
in the final panel. If present, CentroidAoi or SofiaHkTrkAoi are
used to indicate which of TrackErrAoi3 and TrackErrAoi4 are
active. Green shading indicates which samples will be passed by
StepDmdCut; for this purpose, this step reads the StepDmdCut
parameters from the configuration.</p></li>
<li><p>For all data not taken with the internal calibrator, calculate the
ratio of real to imaginary data in a 5x5 pixel box centered on the
user-specified pixel used for plotting. The signals are
sigma-clipped before the ratios of medians are computed. The
values are output in a table at the upper left corner of the plot.
If either the R ratio or T ratio exceeds the parameter
door_threshold, warnings are output to the plot and to the
logger that possible door vignetting may have occurred. In
separate panels, CentroidExpMsec, and both Nod Index and HWP
Index, are plotted.</p></li>
<li><p>For data taken with the internal calibrator, images of the
detector phase are plotted. If the ref_phase_file is
specified, it is subtracted from the calculated phases. The
algorithm includes these steps:</p>
<ul class="simple">
<li><p>Discard the first and last chops and any NaN values, then
calculate the mean along the first (time) axis of the R and T
arrays, for both real and imaginary signals.</p></li>
<li><p>For each of R and T, compute -arctan2(imaginary, real) and
convert to degrees.</p></li>
<li><p>Subtract the reference phase if it is provided.</p></li>
<li><p>Multiply by the ratio of 10.2 Hz to the value of ‘CHPFREQ’ in
the file header (about 3 Hz).</p></li>
<li><p>Add or subtract multiples of 360 degrees to put values in the
branch -180 degrees to +180 degrees</p></li>
</ul>
</li>
</ol>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.setup">
<span class="sig-name descname"><span class="pre">setup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepdmdplot.html#StepDmdPlot.setup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Set parameters and metadata for the pipeline step.</p>
<p>Output files have PRODTYPE = ‘dmdplot’, and are named with
the step abbreviation ‘DPL’.</p>
<p>Parameters defined for this step are:</p>
<dl class="simple">
<dt>door_threshold<span class="classifier">float</span></dt><dd><p>Ratio of real to imaginary median stds, for door
vignetting warnings.</p>
</dd>
<dt>detector_i<span class="classifier">int</span></dt><dd><p>i-location of detector pixel to plot.</p>
</dd>
<dt>detector_j<span class="classifier">int</span></dt><dd><p>j-location of detector pixel to plot.</p>
</dd>
<dt>data_sigma<span class="classifier">float</span></dt><dd><p>Value for sigma-clipping of detector data in computing
averages.</p>
</dd>
<dt>data_iters<span class="classifier">int</span></dt><dd><p>Number of iterations for sigma-clipping.</p>
</dd>
<dt>ref_phase_file<span class="classifier">str</span></dt><dd><p>Path to a FITS file containing reference phase values,
for comparison with CALMODE = INT_CAL data. Set to
‘0.0’ to skip the comparison.</p>
</dd>
<dt>user_freq<span class="classifier">float</span></dt><dd><p>Expected chop frequency for science data. Used to compute
phases in degrees from CALMODE = INT_CAL data.</p>
</dd>
<dt>phase_thresh<span class="classifier">float</span></dt><dd><p>Threshold for phase outliers. Values above this number
are ignored.</p>
</dd>
<dt>save_phase<span class="classifier">bool</span></dt><dd><p>If set, phase images are saved as FITS files to the
input base name with ‘PHS’ replacing the product type
indicator.</p>
</dd>
<dt>savefolder<span class="classifier">str</span></dt><dd><p>Folder to save plots to. An empty string indicates the
same folder as the input file.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.sigma_mask">
<span class="sig-name descname"><span class="pre">sigma_mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepdmdplot.html#StepDmdPlot.sigma_mask"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.sigma_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Mask array along axis 0 using sigma-clipping and median.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>array</strong><span class="classifier">array-like</span></dt><dd><p>Data array.</p>
</dd>
<dt><strong>sigma</strong><span class="classifier">float, optional</span></dt><dd><p>Threshold for sigma-clipping, with median.</p>
</dd>
<dt><strong>iters</strong><span class="classifier">int, optional</span></dt><dd><p>Number of iterations.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>msk_array</strong><span class="classifier">masked array</span></dt><dd><p>Masked array with mask from sigma-clipping.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">StepDmdPlot</a><ul>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot"><code class="docutils literal notranslate"><span class="pre">StepDmdPlot</span></code></a><ul>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.calc_phase"><code class="docutils literal notranslate"><span class="pre">StepDmdPlot.calc_phase()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.get_gapindex"><code class="docutils literal notranslate"><span class="pre">StepDmdPlot.get_gapindex()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.run"><code class="docutils literal notranslate"><span class="pre">StepDmdPlot.run()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.setup"><code class="docutils literal notranslate"><span class="pre">StepDmdPlot.setup()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.sigma_mask"><code class="docutils literal notranslate"><span class="pre">StepDmdPlot.sigma_mask()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/sofia_redux.instruments.hawc.steps.stepdmdplot.StepDmdPlot.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>