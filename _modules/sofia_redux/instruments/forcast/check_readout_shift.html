<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sofia_redux.instruments.forcast.check_readout_shift &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/plot_directive.css" />
    
    <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../../_static/copybutton.js"></script>
    <link rel="icon" href="../../../../_static/redux.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sofia_redux.instruments.forcast.check_readout_shift</h1><div class="highlight"><pre>
<span></span># Licensed under a 3-clause BSD style license - see LICENSE.rst

from astropy import log
from astropy.io import fits
import numpy as np

from sofia_redux.instruments.forcast.getpar import getpar

__all__ = [&#39;check_readout_shift&#39;]


<div class="viewcode-block" id="check_readout_shift"><a class="viewcode-back" href="../../../../api/sofia_redux.instruments.forcast.check_readout_shift.check_readout_shift.html#sofia_redux.instruments.forcast.check_readout_shift.check_readout_shift">[docs]</a>def check_readout_shift(data, header):
    &quot;&quot;&quot;
    Check data for 16 pixel shift

    Looks at specific bad pixel regions in raw data to try to detect
    16 pixel shift.  Procedure does not seem to work for XD or images
    of the slit because the background is too low for bad pixels to
    show contrast using STDDEV.

    Parameters
    ----------
    data : np.ndarray
    header : astropy.io.fits.header.Header

    Returns
    -------
    True if pixel shift is likely, False otherwise
    &quot;&quot;&quot;
    if not isinstance(data, np.ndarray):
        log.error(&quot;invalid data type: %s&quot; % type(data))
        return
    elif not isinstance(header, fits.header.Header):
        log.error(&quot;invalid header type: %s&quot; % type(header))
        return

    if len(data.shape) == 3:
        p1 = data[0]
    elif len(data.shape) == 2:
        p1 = data
    else:
        log.error(&quot;invalid data shape %s&quot; % repr(data.shape))
        return

    # bad pixel regions to test (x1, x2, y1, y2)
    sreg = [0, 2, 36, 75]
    lref = [47, 61, 178, 189]
    detchan = getpar(header, &#39;DETCHAN&#39;, default=None, dtype=str,
                     update_header=False, dripconf=False)
    reg = lref if detchan == &#39;LW&#39; else sreg

    # Always return False for cross-dispersed
    spectel1 = header.get(&#39;SPECTEL1&#39;, &#39;&#39;).strip().upper()
    spectel2 = header.get(&#39;SPECTEL2&#39;, &#39;&#39;).strip().upper()
    spectel = spectel2 if detchan == &#39;LW&#39; else spectel1
    if spectel in [&#39;FOR_XG063&#39;, &#39;FOR_XG111&#39;]:
        return False

    # Always return False for slit image
    slit = header.get(&#39;SLIT&#39;, &#39;&#39;).strip().upper()
    spec_opt = [&#39;FOR_XG063&#39;, &#39;FOR_XG111&#39;, &#39;FOR_G063&#39;, &#39;FOR_G111&#39;,
                &#39;FOR_G227&#39;, &#39;FOR_G329&#39;]
    if spectel not in spec_opt and slit not in [&#39;NONE&#39;, &#39;UNKNOWN&#39;]:
        log.debug(&quot;Check readout shift: Returning False for &quot;
                  &quot;slit, spectel = %s, %s&quot; % (slit, spectel))
        return False

    # Otherwise test bad pixel regions
    test1 = p1[reg[2]:reg[3], reg[0]:reg[1]]
    test2 = p1[reg[2]:reg[3], (reg[0] + 16):(reg[1] + 16)]

    # Use stdev insstead of mean for check -- test shows stdev
    # typically higher (10x in imaging, much less in spectra) in
    # region with bad pixels (so use 3X as check)
    badfac = 3.
    if np.nanstd(test2) &gt; (badfac * np.nanstd(test1)):
        return True
    else:
        return False</div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>