<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sofia_redux.instruments.forcast.background &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/plot_directive.css" />
    
    <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../../_static/copybutton.js"></script>
    <link rel="icon" href="../../../../_static/redux.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sofia_redux.instruments.forcast.background</h1><div class="highlight"><pre>
<span></span># Licensed under a 3-clause BSD style license - see LICENSE.rst

import statistics

import numpy as np

from sofia_redux.toolkit.utilities.fits import hdinsert, href, kref

__all__ = [&#39;background&#39;, &#39;mode&#39;]


<div class="viewcode-block" id="mode"><a class="viewcode-back" href="../../../../api/sofia_redux.instruments.forcast.background.mode.html#sofia_redux.instruments.forcast.background.mode">[docs]</a>def mode(data):
    &quot;&quot;&quot;
    Return the most common data point from discrete or nominal data

    If there is not exactly one most common value, the minimum value
    (of the most common values) will be returned.

    Parameters
    ----------
    data : numpy.ndarray

    Returns
    -------
    The most common value

    Raises
    ------
    ValueError
        If data is empty
    &quot;&quot;&quot;
    d = np.array(data).ravel()
    result = min(statistics.multimode(d))
    return result</div>


<div class="viewcode-block" id="background"><a class="viewcode-back" href="../../../../api/sofia_redux.instruments.forcast.background.background.html#sofia_redux.instruments.forcast.background.background">[docs]</a>def background(data, section, header=None, stat=None, mask=None):
    &quot;&quot;&quot;
    Calculate the background of the image

    Takes median or mode of good pixels in selected region

    Parameters
    ----------
    data : numpy.ndarray
        (nimage, ncol, nrow)
    section : tuple of (int or float) or list of (int or float)
        Data section to use.  Should have the format (X0, Y0, XDIM, YDIM)
        where X0, Y0 is the center of the section and XDIM, YDIM is the
        dimension of the section.
    header : astropy.io.fits.header.Header, optional
        Input header array to be updated with NLINSLEV (containing the
        background levels) and HISTORY keyworks
    stat : str, optional
        Statistic to use to calculate the background level (&#39;median&#39; or
        &#39;mode&#39;)
    mask : numpy.ndarray, optional
        (col, row) Illumination mask to indicate regions of the image to
        use in calculating the image (True = good)

    Returns
    -------
    numpy.ndarray
        (nimage) containing background levels for each input frame
    &quot;&quot;&quot;

    if len(section) != 4:
        raise ValueError(
            &quot;section should have the format (x0, y0, xdim, ydim)&quot;)

    ndim = len(data.shape)
    if ndim not in [2, 3]:
        return

    box_x = section[0] - section[2] / 2.0, section[0] + section[2] / 2.0
    box_y = section[1] - section[3] / 2.0, section[1] + section[3] / 2.0
    if ndim == 2:
        nplanes, (ny, nx) = 1, data.shape
    else:
        nplanes, ny, nx = data.shape

    if not isinstance(mask, np.ndarray):
        mask = np.full((ny, nx), True)
    mask = mask.astype(bool)

    y, x = np.meshgrid(*map(np.arange, mask.shape), indexing=&#39;ij&#39;)
    mask *= (x &gt; box_x[0]) &amp; (x &lt; box_x[1]) &amp; (y &gt; box_y[0]) &amp; (y &lt; box_y[1])
    if not mask.any():
        return

    func = mode if stat == &#39;mode&#39; else np.nanmedian
    if ndim == 2:
        result = [func(data[mask])]
    else:
        result = tuple(map(lambda u: func(data[u, :, :][mask.astype(bool)]),
                           range(nplanes)))

    if header is not None:
        nlinslev = &#39;,&#39;.join(str(x) for x in result)
        hdinsert(header, &#39;NLINSLEV&#39;, &#39;[%s]&#39; % nlinslev,
                 comment=&#39;Signal level of the background&#39;,
                 refkey=kref)

        history = &#39;Background: level is (%s) &#39; % nlinslev
        history += &#39;using section defined by NLINSLEV keyword&#39;
        hdinsert(header, &#39;HISTORY&#39;, history, refkey=href)

    return np.array(result)</div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>