<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>StepMerge &#8212; sofia_redux v1.3.4.dev0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sofia.css?v=3fe2c07e" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=602f4d50"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="icon" href="../_static/redux.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="StepMkflat" href="sofia_redux.instruments.hawc.steps.stepmkflat.StepMkflat.html" />
    <link rel="prev" title="StepLabPolPlots" href="sofia_redux.instruments.hawc.steps.steplabpolplots.StepLabPolPlots.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">SOFIA</span><span id="logotext2">Redux</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="SOFIA Homepage" href="https://www.sofia.usra.edu/"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="sofia_redux.instruments.hawc.steps.stepmkflat.StepMkflat.html" title="StepMkflat">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="sofia_redux.instruments.hawc.steps.steplabpolplots.StepLabPolPlots.html" title="StepLabPolPlots">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">sofia_redux v1.3.4.dev0</a>
	 &#187;
      </li>
      <li><a href="../sofia_redux/index.html" >SOFIA Redux</a> &#187;</li>
      <li><a href="../manuals/hawc/developers/developers.html" accesskey="U">HAWC+ DRP Developer’s Manual</a> &#187;</li>
      
      <li>StepMerge</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="stepmerge">
<h1>StepMerge<a class="headerlink" href="#stepmerge" title="Permalink to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepmerge.StepMerge">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sofia_redux.instruments.hawc.steps.stepmerge.</span></span><span class="sig-name descname"><span class="pre">StepMerge</span></span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepmerge.html#StepMerge"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepmerge.StepMerge" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="sofia_redux.instruments.hawc.stepmiparent.StepMIParent.html#sofia_redux.instruments.hawc.stepmiparent.StepMIParent" title="sofia_redux.instruments.hawc.stepmiparent.StepMIParent"><code class="xref py py-class docutils literal notranslate"><span class="pre">StepMIParent</span></code></a>, <a class="reference internal" href="sofia_redux.instruments.hawc.steps.basemap.BaseMap.html#sofia_redux.instruments.hawc.steps.basemap.BaseMap" title="sofia_redux.instruments.hawc.steps.basemap.BaseMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseMap</span></code></a></p>
<p>Create a map from multiple input images.</p>
<p>This step resamples all input data into a common output grid.
Resampling is performed via a distance-weighted, low-order
polynomial surface fit to the input data within a window around
each output grid point.  It is assumed that all input files
already contain the correct WCS.</p>
<p>Input files for this step must contain STOKES and ERROR frames for
I, Q and U each, as well as COVAR Q I, COVAR U I, and COVAR Q U
images.  The output is a single file with the same extensions.
In addition, an image mask is created, which gives some information
on how much data went into each output pixel in the map.  The
values are sums over the Gaussian weight of each input data point.
The EXPTIME keyword in the merged header is the sum of all exposure
times from the individual files. The table values for each input
image are stored in the rows of the MERGED DATA table in the output
file.</p>
<p class="rubric">Methods Summary</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.read_fwhm_radius_cdelt_beam" title="sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.read_fwhm_radius_cdelt_beam"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read_fwhm_radius_cdelt_beam</span></code></a>()</p></td>
<td><p>Read a fwhm, radius, and cdelt value from the parameters.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.resample_images" title="sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.resample_images"><code class="xref py py-obj docutils literal notranslate"><span class="pre">resample_images</span></code></a>(radius, fit_order, ...)</p></td>
<td><p>Resample input images into a common grid.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.run" title="sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.run"><code class="xref py py-obj docutils literal notranslate"><span class="pre">run</span></code></a>()</p></td>
<td><p>Run the data reduction algorithm.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.setup" title="sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.setup"><code class="xref py py-obj docutils literal notranslate"><span class="pre">setup</span></code></a>()</p></td>
<td><p>Set parameters and metadata for the pipeline step.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Methods Documentation</p>
<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.read_fwhm_radius_cdelt_beam">
<span class="sig-name descname"><span class="pre">read_fwhm_radius_cdelt_beam</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepmerge.html#StepMerge.read_fwhm_radius_cdelt_beam"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.read_fwhm_radius_cdelt_beam" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a fwhm, radius, and cdelt value from the parameters.</p>
<p>The parameters are expected to be defined as a list, with
one entry for each HAWC band.  The correct value for the
input data is selected from the list.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>fwhm</strong><span class="classifier">float</span></dt><dd><p>FWHM value for the input data.</p>
</dd>
<dt><strong>radius</strong><span class="classifier">float, float, float</span></dt><dd><p>Radius value for the input data.</p>
</dd>
<dt><strong>cdelt</strong><span class="classifier">float</span></dt><dd><p>Pixel scale value for the input data.</p>
</dd>
<dt><strong>beamsize</strong><span class="classifier">float</span></dt><dd><p>Beam size value for the input data.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.resample_images">
<span class="sig-name descname"><span class="pre">resample_images</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">radius</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fit_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smoothing</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adaptive_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adaptive_algorithm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fit_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">errflag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_cores</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepmerge.html#StepMerge.resample_images"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.resample_images" title="Permalink to this definition">¶</a></dt>
<dd><p>Resample input images into a common grid.</p>
<p>Resampling is performed via a distance-weighted, low-order
polynomial surface fit to the input data within a window
around each output grid point.  Output images are stored in
self.pmap.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>radius</strong><span class="classifier">float</span></dt><dd><p>Fit window to consider for local fits.</p>
</dd>
<dt><strong>fit_order</strong><span class="classifier">int</span></dt><dd><p>Polynomial surface order to fit.</p>
</dd>
<dt><strong>smoothing</strong><span class="classifier">float</span></dt><dd><p>Smoothing radius for distance weighting, expressed
as a fraction of the fit window.</p>
</dd>
<dt><strong>edge</strong><span class="classifier">float</span></dt><dd><p>Threshold for setting edge pixels to NaN.  Higher
values block more pixels, a zero values allows all
edge pixels through.</p>
</dd>
<dt><strong>adaptive_threshold</strong><span class="classifier">float</span></dt><dd><p>Threshold for adaptive smoothing.  Range is 0-2; 1.0 is
optimal.  Set lower for smaller scale adaptive kernel; higher
for larger scale.</p>
</dd>
<dt><strong>adaptive_algorithm</strong><span class="classifier">{‘scaled’, ‘shaped’, None}</span></dt><dd><p>Algorithm for adaptive smoothing kernel.  If scaled, only the
size is allowed to vary.  If shaped, the kernel shape and
rotation may also vary.</p>
</dd>
<dt><strong>fit_threshold</strong><span class="classifier">float or None</span></dt><dd><p>Threshold for fit rejection, specified in sigma.  Set to
None to turn off.</p>
</dd>
<dt><strong>errflag</strong><span class="classifier">bool</span></dt><dd><p>If True, errors on the flux values will be used to weight
the fits to the data.  If False, only distance weights
will be used.</p>
</dd>
<dt><strong>max_cores</strong><span class="classifier">int, or None</span></dt><dd><p>If a number larger than 1, the data processing will
proceed in parallel on max_cores CPUs.  Multiprocessing
requires that joblib is installed.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepmerge.html#StepMerge.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the data reduction algorithm.</p>
<p>This step is run as a multi-in single-out (MISO) step:
self.datain should be a list of DataFits, and output
will be a single DataFits, stored in self.dataout.</p>
<p>The process is:</p>
<ol class="arabic simple">
<li><p>Read in all good pixels from the input data.</p></li>
<li><p>Resample all input data into a common map.</p></li>
<li><p>Store output images in a DataFits object.</p></li>
<li><p>Merge headers and table data from all input files.</p></li>
</ol>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.setup">
<span class="sig-name descname"><span class="pre">setup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sofia_redux/instruments/hawc/steps/stepmerge.html#StepMerge.setup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Set parameters and metadata for the pipeline step.</p>
<p>Output files have PRODTYPE = ‘merge’, and are named with
the step abbreviation ‘MRG’.</p>
<p>Parameters defined for this step are:</p>
<dl class="simple">
<dt>beamsize<span class="classifier">list of float</span></dt><dd><p>Beam FWHM size (arcsec) to write into BMAJ/BMIN header
keywords.  One value for each HAWC filter band.</p>
</dd>
<dt>cdelt<span class="classifier">list of float</span></dt><dd><p>Pixel size in arcseconds of output map. One value for each
HAWC filter band.</p>
</dd>
<dt>proj<span class="classifier">str</span></dt><dd><p>Projection of output map.</p>
</dd>
<dt>sizelimit<span class="classifier">int</span></dt><dd><p>Upper limit on output map size (either axis, in pixels).</p>
</dd>
<dt>widowstokesi<span class="classifier">bool</span></dt><dd><p>Use widow pixels (flagged 1 or 2) to compute Stokes I map.</p>
</dd>
<dt>conserveflux<span class="classifier">bool</span></dt><dd><p>If set, a flux conservation factor (due to the change
in pixel size) will be applied to all output images.</p>
</dd>
<dt>fwhm<span class="classifier">list of float</span></dt><dd><p>FWHM of gaussian smoothing kernel in arcseconds (per band).</p>
</dd>
<dt>radius<span class="classifier">list of float</span></dt><dd><p>Integration radius for local fits, in arcseconds (per band).</p>
</dd>
<dt>fit_order<span class="classifier">int</span></dt><dd><p>Polynomial fit order for local regression.</p>
</dd>
<dt>errflag<span class="classifier">bool</span></dt><dd><p>If set, use uncertainties when computing averages.</p>
</dd>
<dt>edge_threshold<span class="classifier">float</span></dt><dd><p>Threshold to set edge pixels to NaN.  Range is 0-1; 0 means
keep all edge pixels. Higher values keep fewer pixels.</p>
</dd>
<dt>adaptive_algorithm<span class="classifier">{‘scaled’, ‘shaped’, ‘none’}</span></dt><dd><p>If ‘shaped’ or ‘scaled’, adaptive smoothing will be used,
varying the kernel size according to the data. If ‘shaped’,
the kernel shape and rotation angle may also vary.</p>
</dd>
<dt>fit_threshold<span class="classifier">float</span></dt><dd><p>Deviation from weighted mean to allow for higher order
fit. Set to 0 to turn off.  Positive values replace bad
values with the mean value in the window; negative values
replace bad values with NaN.</p>
</dd>
<dt>bin_cdelt<span class="classifier">bool</span></dt><dd><p>If set, and data was previously binned via StepBinPixels,
then the input cdelt will be multiplied by the binning factor.
If not set, the provided cdelt will be used directly. This
allows useful default behavior for binned data, but still
allows for tunable output pixel sizes.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">StepMerge</a><ul>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepmerge.StepMerge"><code class="docutils literal notranslate"><span class="pre">StepMerge</span></code></a><ul>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.read_fwhm_radius_cdelt_beam"><code class="docutils literal notranslate"><span class="pre">StepMerge.read_fwhm_radius_cdelt_beam()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.resample_images"><code class="docutils literal notranslate"><span class="pre">StepMerge.resample_images()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.run"><code class="docutils literal notranslate"><span class="pre">StepMerge.run()</span></code></a></li>
<li><a class="reference internal" href="#sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.setup"><code class="docutils literal notranslate"><span class="pre">StepMerge.setup()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/api/sofia_redux.instruments.hawc.steps.stepmerge.StepMerge.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, SOFIA-USRA.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.1.2. &nbsp;
    Last built 13 Aug 2023. <br/>
  </p>
</footer>
  </body>
</html>